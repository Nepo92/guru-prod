$(document).on('click', '.datepicker-here', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).on('click', '.datepicker-here-deal', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).on('click', '.datepicker-here-cs', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});

//список способов оплаты
var $paymentMethodList;
function setPaymentMethodList(paymentMethodList) {
    $paymentMethodList = paymentMethodList;
}
//список статусов
var $statusesList;
function setStatusesList(statusesList) {
    $statusesList = statusesList;
}


//изменение чекера напоминания при редактировании сделки
$(document).on('click', '[js-update-open-reminder]', function(event) {
    $('[js-update-form-deal-reminder-btn]').removeClass('is-open');
    $('[js-update-form-deal-reminder-block]').addClass('is-open');
    $('[js-update-form-deal-reminder-date]').val('');
    $('[js-update-form-deal-reminder-msg]').val('');
    $('[js-update-form-deal-reminder]').prop("checked", true);
});
//изменение чекера напоминания при редактировании сделки закрытие
$(document).on('click', '[js-update-close-reminder]', function(event) {
    $('[js-update-form-deal-reminder-btn]').addClass('is-open');
    $('[js-update-form-deal-reminder-block]').removeClass('is-open');
    $('[js-update-form-deal-reminder-date]').val('—');
    $('[js-update-form-deal-reminder-msg]').val('');
    $('[js-update-form-deal-reminder]').prop("checked", false);
});
//в меню редактирования
$(document).on('change', '[js-update-form-deal-sale-type]', function(event) {
    if ($(this).val() === 'traffic') {
        $('[js-update-form-deal-mailing-block]').addClass('is-open');
    } else {
        $('[js-update-form-deal-mailing-block]').removeClass('is-open');
        $('[js-update-form-deal-mailing]').prop('checked', false);
    }
});
//в меню редактирования
$(document).on('change', '[js-update-form-deal-pr]', function(event) {
    $('[js-update-form-deal-price]').val($('option:selected', this).attr('data-price'));
    $('[js-update-form-deal-product-type]').val($('option:selected', this).attr('data-type'));

    $('[js-update-form-deal-product-id]').val($('option:selected', this).attr('data-id'));

    $list = createKindList($('option:selected', this).val());
    if ($list.length > 0) {
        $('[js-update-form-kind]').html(createKindOptions($list));
        $('[js-update-form-kind-block]').addClass('is-open');
    } else {
        $('[js-update-form-kind-block]').removeClass('is-open');
        $('[js-update-form-kind]').html('');
    }

    if ($('[u-product-types]').val() == 'курс' ) {
        setStreams($('[js-update-form-deal-start-date]'), $('option:selected', this).attr('data-id'));
    }
});
function setStreams(selector, idCourse){
    var formData = new FormData();
    formData.set('idCourse', Number(idCourse));

    $.ajax({
        type: "POST",
        url: "/deals/getStreamsByIdCourse",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var seloption = '<option value="" disabled selected>Выберите дату старта</option>';
            $.each(data, function(index, stream){
                seloption += '<option value="' + stream.id + '">' + stream.startDate + '</option>';
            });

            selector.html(seloption);
        },
        error: function (data) {
        }
    });
}


$(document).ready(function() {
    $('.datepicker-here-deal').datepicker({
        autoClose: true,
        maxDate: new Date(),
        todayButton: true
    });

    $('.datepicker-here').datepicker({
        autoClose: true,
        todayButton: true
    });

    const $menuCreateClient = $('[js-menu-create-client]');

    const $menuClientCard = $('[js-menu-client-card]');
    const $menuClientCardCloseBtn = $('[js-menu-client-card-close-btn]');
    //закрытие карточки клиента
    $menuClientCardCloseBtn.on('click', function () {
        $menuCreateClient.removeClass('is-open');
        $menuClientCard.removeClass('is-open');
        closeEdit();
        checkBodyHidden();
    });



    const $menuUpdateDeal = $('[js-menu-update-deal]');
    const $menuUpdateDealCloseBtn = $('[js-menu-update-deal-close-btn]');
    //закрытие редактирование сделки
    $menuUpdateDealCloseBtn.on('click', function() {
        $menuUpdateDeal.removeClass('is-open');
        checkBodyHidden()
    });


    const $menuUpdateReminderCloseBtn = $('[js-menu-update-reminder-close-btn]');
    const $menuUpdateReminder = $('[js-menu-update-reminder]');

    $menuUpdateReminderCloseBtn.on('click', function() {
        clearReminderForm();
        $menuUpdateReminder.removeClass('is-open');
        checkBodyHidden();
    });


    const $menuBillsCloseBtn = $('[js-menu-bills-close-btn]');
    const $menuBills = $('[js-menu-bills]');
    //закрытие меню счетов
    $menuBillsCloseBtn.on('click', function() {
        $menuBills.removeClass('is-open');
        checkBodyHidden();
        BILLS_TEMP_INFO = {};
    });


    initDatePicker();
});

$(document).on('click', '[close-dialog]', function(event) {
    $(this).closest('.dialog').removeClass('is-open');
});

$(document).on('click', '[js-edit-btn]', function(event) {
    $('[js-client-card-name]').removeAttr('disabled');
    $('[js-client-card-comment]').removeAttr('disabled');
    $('[js-client-card-link]').removeAttr('disabled');
    $('[js-client-card-phone]').removeAttr('disabled');
    $('[js-client-card-email]').removeAttr('disabled');
    $('[js-edit-footer]').addClass('is-open');
});

function closeEdit() {
    $('[js-client-card-name]').attr("disabled", true);
    $('[js-client-card-comment]').attr("disabled", true);
    $('[js-client-card-link]').attr("disabled", true);
    $('[js-client-card-phone]').attr("disabled", true);
    $('[js-client-card-email]').attr("disabled", true);
    $('[js-edit-footer]').removeClass('is-open');
}

$(document).on('change', '[js-form-status]', function(event) {
    var form = $(this).parent($('[js-status-form]'));
    form.removeClassWild("deal-status__form_*");
    form.addClass("deal-status__form_" + ($('option:selected', this).attr('data-code')));

    var data = form.serializeObject();

    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/updateDealStatus",
        data: JSON.stringify(data),
        dataType: 'json',
        cache: false,
        success: function (data) {
        },
        error: function (data) {
        }
    });

});

$(document).on('change', '[js-deal-form-status]', function(event){
    var form = $(this).parent($('[js-deal-status-form]'));
    form.removeClassWild("deal__select_*");
    var code = $('option:selected', this).attr('data-code');
    form.addClass("deal__select_" + code);

    var formData = form.serializeObject();
    formData['code'] = code;

    $('[js-deal-form-status]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/updateDealStatus",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealStatusOnList(formData);
            $('[js-deal-form-status]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-deal-form-status]').prop("disabled", false);
        }
    });
});

//обновление статуса сделки на фронте
function updateDealStatusOnList(value) {
    var dealRow = $('[data-deal="' + value.id + '"]');
    var select = dealRow.find('[js-form-status]');
    var form = select.parent($('form'));
    form.removeClassWild("deal-status__form_*").addClass("deal-status__form_" + value.code);
    $(select).find('option:selected').removeAttr('selected');
    $(select).val(value.status);
}

// //кнопка открытия карточки клиента
// $(document).on('click', '[js-client-card]', function(event){
//     var clientId = $(this).find('[js-client-id]').val();
//
//     $('[js-client-card]').prop("disabled", true);
//     $.ajax({
//         type: "POST",
//         contentType: "application/json",
//         url: "/api/clients/getClientInfo",
//         data: JSON.stringify(clientId),
//         dataType: 'json',
//         cache: false,
//         success: function (data) {
//             setClientCardInfo(data);
//             $('[js-client-card]').prop("disabled", false);
//         },
//         error : function (data) {
//             $('[js-client-card]').prop("disabled", false);
//         }
//     });
// });
//
// var $CLIENT;
// //заполение информации о клиенте в карточке клиента
// function setClientCardInfo(data) {
//     $('[js-client-card-name]').val(data.name);
//     $('[js-client-card-date]').text(data.createDate);
//     $('[js-client-card-manager]').text(data.manager);
//     $('[js-client-card-link]').val(data.link);
//     $('[js-client-card-phone]').val(data.phone);
//     $('[js-client-card-email]').val(data.email);
//     $('[js-client-card-comment]').val(data.comment);
//     $('[js-client-card-id]').val(data.id);
//
//     $('[js-client-name-copy]').text(data.name);
//     $('[js-client-name-copy]').attr('data-link', data.name);
//
//     setIdClient(data.id);
//     //обновление карточек сделок
//     updateDealCard($CLIENT);
//
//     $('[js-menu-client-card]').addClass('is-open');
//     checkBodyHidden()
//
// }
//
// function setIdClient(id) {
//     $('[js-deal-form-client]').val(id);
//     $CLIENT = id;
// }

//обновление карточек сделок
function updateDealCard(idClient) {
    if (typeof idClient !== "undefined") {
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/api/deals/getDeals",
            data: JSON.stringify(idClient),
            dataType: 'json',
            cache: false,
            success: function (data) {
                var $dealList = $('[js-deals-list]');
                $dealList.html('');
                $.each(data, function(index, value) {
                    // установка значения в списке
                    updateDealPriceOnList(value);

                    // установка значения в в меню
                    var seloption = "";
                    $.each($statusesList, function(index, value2){
                        seloption += '<option js-deal-form-status value="'+ value2.id +'" data-code="'+
                            value2.code + '" ' + (value2.id === value.status ? 'selected="selected" ': '') +'">' + value2.title + '</option>';
                    });

                    var reminder = "";
                    if (value.reminder) {
                        reminder += '<div class="menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-violet">' +
                            '<div class="deal__comment" title="' + value.reminderMessage + '">' + value.reminderMessage + '</div></div>';
                    } else {
                        reminder += '<div class="menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-empty">' +
                            '<div class="deal__comment">Нет напоминаний</div></div>';
                    }
                    var response = $("<div/>").attr("class", "deal deal_told deal_white")
                        .append($("<div/>").attr("class", "deal-wrapper")
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_bordered deal__wrapper_column")
                                .append($("<div/>").attr("class", "deal__title").html(value.status === 1 ? 'Целевая заявка' : value.course))
                                .append($("<div/>").attr("class", "deal__subtitle")
                                    .append($("<div/>").attr("class", value.kind !== null ? "deal__kind deal__kind_del" : "deal__kind").html(value.kind))
                                    .append($("<div/>").attr("class", "deal__date").html(value.createDate)))
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_overflow deal__wrapper_bordered c-tooltip").attr('js-deal-id', value.id)
                                .append($("<div/>").attr("class", "c-tooltip__wrapper")
                                    .append($("<div/>").attr("class", "c-tooltip__text").html(value.managerAccessName)))
                                .append($("<div/>").attr("class", "deal__social")
                                    .append($("<div/>").attr("class", "deal-social deal-social_" + value.socialCode)))
                                .append($("<div/>").attr("class", "deal__manager").html(value.managerName))
                                .append($("<div/>").attr("class", "deal__sale-type").html(value.type))
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_between deal__wrapper_bordered ")
                                .append($("<div/>").attr("class", "deal__sum")
                                    .append($("<div/>").attr("class", "deal__sum-title").html("Стоимость"))
                                    .append($("<div/>").attr("class", "deal__sum-value").html(value.price))
                                )
                                .append($("<div/>").attr("class", "deal__sum")
                                    .append($("<div/>").attr("class", "deal__sum-title").html("Получено"))
                                    .append($("<div/>").attr("class", "deal__sum-value deal__sum-value_blue").html(value.paid))
                                )
                                .append((value.status !== 1) ? $("<div/>").attr("class", "deal_bill")
                                    .append($("<form/>").attr("js-add-bill-form", "").attr("action", "#").attr("class", value.isHidden ? "hidden-deal" : "")
                                        .append($("<input/>").attr("type", "hidden").attr("name", "id").val(value.id))
                                        .append($("<button/>").attr("js-add-bill-button", "").attr("class", "add-btn"))
                                    ) : ''
                                )
                            )
                            .append((value.status !== 1) ? $("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                                    .append($("<form/>").attr("js-deal-status-form","").attr("class", "deal__select deal__select_" + value.statusCode)
                                        .append($("<input/>").attr("name", "id").attr("type", "hidden").val(value.id))
                                        .append($("<select/>").attr("class","deal-select menu-input__input_select").attr("name","status").attr("js-deal-form-status","").html(seloption))
                                    ) :
                                $("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                                    .append($("<div/>").attr("class", "deal__select deal__select_" + value.statusCode)
                                        .append($("<div/>").attr("class","deal-select menu-input__input_select").html(value.statusName))
                                    )
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                                    .append($("<div/>").attr("class", "deal__reminder")
                                        .append($("<div/>").attr("class", (value.reminder) ?
                                            (value.reminderExpiration) ? "deal__reminder-title deal-reminder deal-reminder_red " :
                                                (value.reminderToday) ? "deal__reminder-title deal-reminder deal-reminder_green " : "deal__reminder-title deal-reminder deal-reminder_gray " : "deal__reminder-title deal__reminder-title_left")
                                            .html((value.reminder) ? value.reminderDate : "Нет напоминания"))
                                        .append((value.status !== 1) ? $("<div/>").attr("class", "add-reminder")
                                            .append($("<form/>").attr("js-add-reminder-form", "").attr("action", "#")
                                                .append($("<input/>").attr("type", "hidden").attr("name", "idDeal").val(value.id))
                                                .append($("<button/>").attr("js-add-reminder-button", "").attr("class", "add-btn"))
                                            ) : ''
                                        )
                                    )
                                // .append(reminder)
                            )
                            // .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                            //     .append($("<div/>").attr("class", "deal__reminder")
                            //         .append($("<div/>").attr("class", "deal__reminder-title").html('Напоминание'))
                            //         .append($("<div/>").attr("class", "deal__reminder-date").html(value.reminderDate))
                            //     )
                            //     .append(reminder)
                            // )
                            // .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                            //     .append($("<div/>").attr("class", "menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-small")
                            //         .append($("<div/>").attr("class", "deal__comment").attr("title", value.comment).html(value.comment))
                            //     )
                            // )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column")
                                .append($("<form/>").attr("class", "button_full").attr("action", "#").attr("js-update-deal-form", "")
                                    .append($("<input/>").attr("name", "id").attr("type", "hidden").val(value.id))
                                    .append($("<button/>").attr("type", "button").attr("class", "button button_white button_full").attr("js-update-deal-btn", "").html("Редактировать сделку"))
                                )

                                .append(
                                    (value.isHidden)
                                        ?
                                        $("<form/>").attr("class", "button_full").attr("action", "#").attr("js-reveal-deal-form", "")
                                            .append($("<input/>").attr("data-hide-deal", value.id).attr("name", "id").attr("type", "hidden").val(value.id))
                                            .append(
                                                $("<button/>").attr("type", "button").attr("class", "button button_red button_full").attr("js-reveal-deal-btn", "")
                                                    .append($("<span/>").attr("class", "hidden-btn hidden-btn_left hidden-btn_reveal").html("Восстановить сделку"))
                                            )
                                        :
                                        $("<form/>").attr("class", "button_full").attr("action", "#").attr("js-hide-deal-form", "")
                                            .append($("<input/>").attr("data-hide-deal", value.id).attr("name", "id").attr("type", "hidden").val(value.id))
                                            .append($("<button/>").attr("type", "button").attr("class", "button button_red button_full").attr("js-hide-deal-btn", "")
                                                .append($("<span/>").attr("class", "hidden-btn hidden-btn_left hidden-btn_hide").html("Скрыть сделку")))
                                )
                            )
                        );
                    $dealList.append(response);
                    loadModules(idClient, value.id);
                });
            }
        });
    }
}

function loadModules(idClient, idDeal){
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/getDealsModulesInfo",
        data: JSON.stringify(idDeal),
        dataType: 'json',
        cache: false,
        success: function (data) {
            if (data.modules.length > 0){
                $modulesRoot = $("<div/>").attr("class", "deal__access-lessons ");
                $lessons = $("<div/>").attr("class", "deal__lessons");
                $.each(data.modules, function(index, value) {
                    $lessons.append($("<div/>").attr('js-module', value.idModule).attr('js-module-deal', idDeal).attr('js-module-client', idClient).attr('js-allowed', data.allowed).attr("class", "deal__lessons-item " + (value.enabled ? 'deal__lessons-item_active' : '')).html(value.number));
                });
                $access = $("<div/>").attr("class", "deal__access")
                    .append($("<div/>").attr("class", "deal__access-text")).html('Доступ к продукту')
                    .append($("<div/>").attr("class", "deal__access-btn slide-toggle " + (data.allowed ? 'slide-toggle_active' : '')).attr("js-id-deal-toggle", idDeal)
                        .append($("<div/>").attr("class", "slide-toggle__thumb")));
                $modulesRoot.append($access);
                $modulesRoot.append($lessons);

                $modulesRoot.insertAfter($('[js-deal-id='+idDeal+']'));
                $(".slide-toggle[js-id-deal-toggle="+idDeal+"]").click(function (event) {
                    var toggle = $(this);
                    var idDeal = toggle.attr('js-id-deal-toggle');
                    var allowed = toggle.hasClass('slide-toggle_active');
                    if (allowed){
                        toggle.removeClass('slide-toggle_active');
                    }else{
                        toggle.addClass('slide-toggle_active');
                        $('.deal__lessons-item[js-module-deal='+idDeal+']').toggleClass('deal__lessons-item_active', true)
                    }
                    changeAllowed(idDeal, idClient, !allowed);
                });
                $('.deal__lessons-item[js-module-deal='+idDeal+']').click(function (event){
                    var $this = $(this);
                    var idModule = $this.attr('js-module');
                    var idDeal = $this.attr('js-module-deal');
                    var allowed = $(".slide-toggle[js-id-deal-toggle="+idDeal+"]").hasClass('slide-toggle_active');
                    var idClient = $this.attr('js-module-client');
                    var enabled = $this.hasClass('deal__lessons-item_active');
                    if (allowed){
                        if (enabled){
                            $this.removeClass('deal__lessons-item_active');
                        }else{
                            $this.addClass('deal__lessons-item_active');
                        }
                        changeEnabledModule(idClient, idDeal, idModule, !enabled);
                    }
                });
            }
        }
    });
}

function changeAllowed(idDeal, idClient, allowed){
    console.log('Change allowed', idDeal, idClient, allowed);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/changeModulesAllowed",
        data: JSON.stringify({id: idDeal, idClient: idClient, value: allowed}),
        dataType: 'json',
        cache: false,
        success: function (data) {
            console.log(data);
        }
    });
}

function changeEnabledModule(idClient, idDeal, idModule, enabled){
    console.log('Change enabled', idClient, idDeal, idModule, enabled);

    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/changeModulesEnabled",
        data: JSON.stringify({idDeal: idDeal, idModule: idModule, idClient: idClient, value: enabled}),
        dataType: 'json',
        cache: false,
        success: function (data) {
            console.log(data);
        }
    });
}

//кнопка редактирования клиента
$(document).on('click', '[js-edit-client-btn]', function(event) {
    event.preventDefault();
    $(this).closest('[js-edit-client-form]').trigger('submit');
});
//form'a редактирование клиента
$(document).on('submit', '[js-edit-client-form]', function(event) {
    event.preventDefault();
    updateClient($(this).serializeObject());
});
function updateClient(formData) {
    $('[js-update-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/clients/updateClient",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            closeEdit();
            updateClientNameOnFront(data);
            updateClientLinkOnFront(data);
            updateClientPhoneOnFront(data);
            updateClientNameOnList(data);
            $('[js-update-deal]').prop("disabled", false);
            $('[js-client-name-copy]').text(data.name);
            $('[js-client-name-copy]').attr('data-link', data.name);
        },
        error: function (data) {
            $('[js-update-deal]').prop("disabled", false);
        }
    });
}
function updateClientNameOnFront(value) {
    var clientRow = $('[data-client="' + value.id + '"]');
    clientRow.siblings('span').html(value.name);
}
function updateClientLinkOnFront(value) {
    var clientCell = $('[data-link-client="' + value.id + '"]');
    if (value.link === null || value.link === '') {
        clientCell.html('<div>—</div>');
    } else {
        clientCell.html('<div class="column-links">' +
            '<div js-copy-link class="column_mwidth column_mwidth-copy" data-link="' + value.link + '"></div>' +
            '<a href="' + value.link + '" target="_blank" class="column_mwidth column_mwidth-open"></a>' +
            '</div>');
    }
}
function updateClientPhoneOnFront(value) {
    var clientCell = $('[data-phone-client="' + value.id + '"]');
    if (value.phone === null || value.phone === '') {
        clientCell.html('<div>—</div>');
    } else {
        clientCell.html('<div js-copy-link class="client-phone" data-link="' + value.phone + '">' + value.phone + '</div>');
    }
}

function updateClientNameOnList(value) {
    var clientCard = $('[value="' + value.id + '"].js-client-id-l');
    var card = clientCard.closest('[js-client-card]');
    card.find('.client-card__title').html(value.name);
    card.find('.client-card__info-link').html(value.link);
    card.find('.client-card__info-phone').html(value.phone);
}
//скрыть сделку
var HIDE_DEAL_FORM;
$(document).on('click', '[js-hide-deal-btn]', function(event) {
    event.preventDefault();
    $('[dialog]').find('.dialog__title').html('Вы действительно хотите скрыть сделку?');
    $('[dialog]').find('.dialog__text').html('В данном случае информация о сделке не будет учитываться');
    $('[dialog]').find('[accept-dialog]').attr('hide-deal', '');
    $('[dialog]').addClass('is-open');
    HIDE_DEAL_FORM =  $(this).closest('[js-hide-deal-form]');
});

$(document).on('click', '[hide-deal]', function(event) {
    event.preventDefault();
    $('[dialog]').removeClass('is-open');
    HIDE_DEAL_FORM.trigger('submit');
});

$(document).on('submit', '[js-hide-deal-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        hideDeal(formData);
    }
});
function hideDeal(formData) {
    $('[js-hide-deal-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/hideDeal",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-hide-deal-btn]').prop("disabled", false);
            updateHideForm(formData.id, true);
        },
        error: function (data) {
            $('[js-hide-deal-btn]').prop("disabled", false);
        }
    });
}
//раскрыть сделку
$(document).on('click', '[js-reveal-deal-btn]', function(event) {
    event.preventDefault();
    $(this).closest('[js-reveal-deal-form]').trigger('submit');
});

$(document).on('submit', '[js-reveal-deal-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        revealDeal(formData);
    }
});
function revealDeal(formData) {
    $('[js-reveal-deal-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/revealDeal",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-reveal-deal-btn]').prop("disabled", false);
            updateHideForm(formData.id, false);
        },
        error: function (data) {
            $('[js-reveal-deal-btn]').prop("disabled", false);
        }
    });
}
function updateHideForm(idDeal, isHide) {
    var el = $('[data-hide-deal="' + idDeal + '"]');
    var form = el.closest('form');

    var billForm = $('[js-add-bill-form]').find('input[name="id"][value="' + idDeal + '"]').closest('[js-add-bill-form]');
    if (isHide) {
        form.removeAttr("js-hide-deal-form").attr("js-reveal-deal-form",'');
        var btn = form.find('[js-hide-deal-btn]');
        btn.removeAttr("js-hide-deal-btn").attr("js-reveal-deal-btn",'');
        btn.find('.hidden-btn_hide').removeClass('hidden-btn_hide').addClass('hidden-btn_reveal');
        btn.find('span').html('Восстановить сделку');

        billForm.addClass("hidden-deal");
    } else {
        form.removeAttr("js-reveal-deal-form").attr("js-hide-deal-form",'');
        var btn = form.find('[js-reveal-deal-btn]');
        btn.removeAttr("js-reveal-deal-btn").attr("js-hide-deal-btn",'');
        btn.find('.hidden-btn_reveal').removeClass('hidden-btn_reveal').addClass('hidden-btn_hide');
        btn.find('span').html('Скрыть сделку');

        billForm.removeClass("hidden-deal");
    }
}

$(document).on('click', '[js-update-deal-btn]', function(event) {
    event.preventDefault();
    $(this).closest('[js-update-deal-form]').trigger('submit');
});

$(document).on('submit', '[js-update-deal-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        setDealInfo(formData);
    }
});

function setDealInfo(data) {
    $('[js-update-deal-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/getDeal",
        data: JSON.stringify(data),
        dataType: 'json',
        cache: false,
        success: function (data) {
            setUpdateDealInfo(data);
            $('[js-update-deal-btn]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-deal-btn]').prop("disabled", false);
        }
    });
}

function setUpdateStreams(idCourse) {
    var formData = new FormData();
    formData.set('idCourse', Number(idCourse));

    $.ajax({
        type: "POST",
        url: "/deals/getStreamsByIdCourse",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var seloption = '';
            $.each(data, function(index, stream){
                seloption += '<option value="' + stream.id + '">' + stream.startDate + '</option>';
            });

            $('[js-update-form-deal-start-date]').append(seloption);
        },
        error: function (data) {
        }
    });
}

$(document).on('click', '[js-update-deal]', function(event) {
    event.preventDefault();
    $('[js-update-form-deal]').trigger('submit');
});

$(document).on('submit', '[js-update-form-deal]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        updateDeal(formData);
    }
});

function updateDeal(formData) {
    $('[js-update-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/updateDeal",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard(data.idClient);
            $('[js-menu-update-deal]').removeClass('is-open');
            checkBodyHidden()
            updateDealAfterUpdateOnList(data);
            $('[js-update-deal]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-deal]').prop("disabled", false);
        }
    });
}

function updateDealAfterUpdateOnList(value) {
    var dealRow = $('[data-deal="' + value.id + '"]');
    dealRow.find('[data-deal-date-deal]').html(value.dealDate);

    dealRow.find('[data-deal-social]').removeClassWild("deal-social_*").addClass("deal-social_" + value.socialCode).addClass("deal-social_big");

    var course = value.course != null ? (value.course + (value.kind !== null && value.kind !== '' ? ' (' + value.kind + ')' : '')) : 'Целевая заявка' ;
    dealRow.find('[data-deal-course]').attr('title', course).html(course);
    dealRow.find('[data-deal-type]').html(value.type);
    dealRow.find('[data-deal-price]').html(value.price);

    var colPaid = dealRow.find('.column-paid');
    colPaid.removeClassWild('column-paid_*');
    if (value.price <= dealRow.find('[data-deal-paid]').html().replace(/\D+/g,"")) {
        colPaid.addClass('column-paid_green');
    }

    dealRow.find('[data-deal-start-date]').html(value.startDate);
    if (value.tag === null) {
        dealRow.find('[data-deal-tag]').html('<div>—</div>');
    } else {
        dealRow.find('[data-deal-tag]').html('<div title="' + value.tag + '" class="column-msg">' + value.tag + '</div>');
    }
    dealRow.find('[data-deal-mailing]').html(value.coupling);

    var select = dealRow.find('[js-form-status]');
    var form = select.parent($('form'));
    form.removeClassWild("deal-status__form_*").addClass("deal-status__form_" + value.statusCode);
    select.on('change', function (event) {
        event.preventDefault();
    });
    $("#" + $(select).attr('id') + " option:selected").removeAttr('selected');
    $("#" + $(select).attr('id')).val(value.status);

    var reminder = '';
    if (value.reminder) {
        reminder += '<div class="reminder-wrapper">' +
            '<div class="reminder-date" >' + value.reminderDate + '</div>' +
            '<div class="reminder-msg">' + value.reminderMessage + '</div>' +
            '</div>';
    }
    reminder += '<div class="reminder ' + (value.reminder ? (value.reminderExpiration ? 'reminder_red' : (value.reminderToday ? 'reminder_green' : 'reminder_gray')) : '') + '"></div>';
    if (value.reminder) {
        reminder += '<div class="reminder-d">' + value.reminderDate + '</div>';
    }

    dealRow.find('[data-deal-reminder]').html(reminder);

}

$(document).on('submit', '[js-add-bill-form]', function(event) {
    event.preventDefault();
    if ($(this).hasClass("hidden-deal")) {
        openBills($(this).serializeObject(), "/api/bills/getHiddenBills");
    } else {
        openBills($(this).serializeObject(), "/api/bills/getBills");
    }
});
function openBills(formData, queryLink) {
    $('[js-add-bill-form]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: queryLink,
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-bills-deal-id]').val(formData.id);
            createBills(data);
            $('[js-menu-bills]').addClass('is-open');
            checkBodyHidden()
            $('[js-add-bill-form]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-bill-form]').prop("disabled", false);
        }
    });
}

function createBills(billList) {
    $('[js-bills-body]').html('');

    if (billList.length > 0) {
        $('[js-bills]').addClass('is-open');
    } else {
        $('[js-bills]').removeClass('is-open');
    }
    checkBodyHidden()
    $.each(billList, function(index, value) {
        var response = "";
        response += '<div class="div-table__body-row">';

        // установка значения в в меню
        var seloption = "";
        $.each($paymentMethodList, function(index, value2){
            seloption += '<option value="'+ value2.title +'" data-code="' + value2.code + '">' + value2.title + '</option>';
        });

        //если статус 1 проверено, то зеленая иначе можно редактировать
        if (value.status === 2) {
            response += '<div class="div-table__body-col div-table__body-col_exxsmall div-table__body-col_center">' +
                '<div class="column_bstatus column_bstatus_checked"></div>' +
                '</div>';
        } else {
            response += '<div class="div-table__body-col div-table__body-col_exxsmall div-table__body-col_center">' +
                '<div class="column_bstatus column_bstatus_unchecked"></div>' +
                '</div>';
        }

        response += '<div class="div-table__body-col div-table__body-col_medium">' +
            '<div class="column-text">' + value.manager + '</div>' +
            '</div>';

        response += '<form b-update-bill-form action="#" class="edit-form-bill">' +
            '<input type="hidden" b-id-bill value="' + value.id + '" name="id" required>' +
            '<input type="hidden" value="' + value.idDeal + '" name="idDeal" required>' +
            '<input type="hidden" b-pm value="' + value.paymentMethod + '" name="paymentMethod">' +
            '<input type="hidden" b-pm-code value="' + value.paymentMethodCode + '" name="paymentMethodCode">' +
            '<div class="div-table__body-col div-table__body-col_small">' + value.billDate + '</div>';

        // add сумму
        response += '<div class="div-table__body-col div-table__body-col_center div-table__body-col_xsmall">' +
            '<input b-sum disabled name="sum" class="menu-input__input menu-input__input_small editable" value="'+ value.sum +'" placeholder="0 ₽">' +
            '</div>';

        response += '<div class="div-table__body-col div-table__body-col_xxsmall">' +
            '<div b-pm-wrapper class="pmethod-wrapper disabled">' +
            '<select b-pm-selector disabled class="column_pmethod-select column_pmethod_' + value.paymentMethodCode + '">' +
            seloption +
            '</select>' +
            '</div>' +
            '</div>';

        // add номер счета
        response +=   '<div class="div-table__body-col div-table__body-col_medium  div-table__body-col_center div-table__body-col_r10">' +
            '<input b-account-number disabled name="accountNumber" class="menu-input__input menu-input__input_small editable" value="'+ (value.accountNumber === null ? '' : value.accountNumber) +'" placeholder="—">' +
            '</div>';

        response += '<div class="div-table__body-col col-pay-date div-table__body-col_center div-table__body-col_medium ">' +
            '<div class="menu-input__wrapper menu-input__wrapper_xsmall">' +
            '<input b-pay-date disabled name="payDate" ' +
            'class="datepicker-here-cs menu-input__input menu-input__input_small editable" autocomplete="off" value="' + (value.payDate === null ? '' : value.payDate) + '" data-autoclose="true" placeholder="—"/>' +
            '</div></div>';

        // add оплачен/выставлен
        if (value.payDate === null) {
            response += '<div class="div-table__body-col div-table__body-col_small col-status">Выставлен</div>';
        } else {
            response += '<div class="div-table__body-col div-table__body-col_small col-status div-table__body-col_green">Оплачен</div>';
        }

        // add тип оплаты
        response += '<div class="div-table__body-col div-table__body-col_small">' + (value.paymentType === 'Новый клиент' ? 'Первый' : 'Доплата') + '</div>';

        // add ссылка
        if (value.link !== null && value.link !== '') {
            response += '<div class="div-table__body-col div-table__body-col_xxsmall div-table__body-col_center">' +
                '<div class="column-links"><div js-copy-link data-link="' + value.link + '" class="column_mwidth column_mwidth-copy"></div>' +
                '<a js-open-link href="' + value.link + '" target="_blank" class="column_mwidth column_mwidth-open"></a></div></div>';
        } else {
            response += '<div class="div-table__body-col div-table__body-col_xxsmall">' +
                '<div>—</div></div>';
        }
        response += '</form>';

        // add коммент
        response += '<div data-bill-id="' + value.id + '" class="div-table__body-col div-table__body-col_medium div-table__body-col_center">' +
            '<div class="column-links">' +
            ((value.comment === null)
                ? '<div js-add-sms-check js-check-btn class="column_mwidth column_mwidth-large column_mwidth_bordered div-table__body-col_center column_mwidth-add-check"></div>'
                : '<div js-delete-sms-check js-check-btn title="' + value.comment + '" class="column_mwidth column_mwidth-large column_mwidth_bordered div-table__body-col_center column_mwidth-delete-check"></div>') +
            ((value.billImage !== null && value.billImage !== '')
                ? '<a class="column-img column_mwidth column-img_large div-table__body-col_center" data-fancybox="gallery" href="../' + value.billImage + '">' +
                '<img src="/' + value.billImage + '">' +
                '</a>'
                : '<form js-upload-bill-form action="#" class="column_mwidth column_mwidth-large div-table__body-col_center div-table__body-col_fl" enctype="multipart/form-data">' +
                '<input type="hidden" value="' + value.id + '" name="id" required>' +
                '<input type="hidden" value="' + value.isHidden + '" name="isHidden" required>' +
                '<input type="hidden" value="' + value.idDeal + '" name="idDeal" required>' +
                '<input js-upload-bill accept="image/*,image/jpeg" class="input-file" name="file" type="file" id="file' + index + '"/>' +
                '<label for="file' + index + '" class="js-labelFile">' +
                '<span class="js-upload-file js-upload-file_small"></span>' +
                '</label>' +
                '</form>') +
            '</div>' +
            '</div>';

        response += '<div class="div-table__body-col div-table__body-col_center div-table__body-col_xxsmall">';

        if(value.isEditable) {
            response +=  '<div js-edit-btns class="column-links display-flex-none">' +
                '<div js-edit-bill-accept class="column_mwidth column_mwidth-accept"></div>' +
                '<div js-edit-bill-cancel class="column_mwidth column_mwidth-cancel"></div>' +
                '</div>' +
                '<div js-edit-menu class="column-links display-flex-none is-open">' +
                '<div js-edit-bill class="column_mwidth div-table__body-col_center column_mwidth-edit"></div>' +
                '<form js-delete-bill-form class="column-form" action="#">' +
                '<input type="hidden" value="' + value.id + '" name="id" required>' +
                '<button js-delete-bill type="button" class="column_mwidth column_mwidth-delete"></button>' +
                '</form>' +
                '</div>';
        }

        response += '</div>'+
            '</div>';

        $('[js-bills-body]').html($('[js-bills-body]').html() + response);
    });

    initDatePicker();
    initFancy();

    initEditBillForm();
    initCancelEditBill();
    initAcceptEditBill();
}

function initDatePicker() {
    $('.datepicker-here-cs').datepicker({
        autoClose: true,
        maxDate: new Date(),
        todayButton: true
    });
}
function initFancy() {
    $('[data-fancybox="gallery"]').fancybox({
        infobar: false,
        buttons: [
            "close"
        ],
    });
}
$(document).on('click', '[js-add-bill-up-client]', function(event) {
    var clientName = $(this).closest('.custom-table__body-row').find('[js-client-id]').siblings('span').html();
    $('[js-client-name-copy]').text(clientName);
    $('[js-client-name-copy]').attr('data-link', clientName);
});
$(document).on('change', '[js-upload-bill]', function(event) {
    var form = $(this).closest('[js-upload-bill-form]')
    var data = new FormData(form[0]);
    $('[js-upload-bill]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "/api/bills/uploadBill",
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 300000,
        success: function (data) {
            updateBillImageOnList(data);

            var formData = form.serializeObject();
            formData['id'] = formData.idDeal;

            if (data.isHidden) {
                openBills(formData, "/api/bills/getHiddenBills");
            } else {
                openBills(formData, "/api/bills/getBills");
            }

            $('[js-upload-bill]').prop("disabled", false);
        },
        error: function (e) {
            console.log("ERROR : ", e);
            $('[js-upload-bill]').prop("disabled", false);
        }
    });
});
$(document).on('change', '[js-upload-bill-front]', function(event) {
    var form = $(this).closest('[js-upload-bill-form]')
    var data = new FormData(form[0]);
    $('[js-upload-bill-front]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "/api/bills/uploadBill",
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 300000,
        success: function (data) {
            updateBillImageOnList(data);
            $('[js-upload-bill-front]').prop("disabled", false);
        },
        error: function (e) {
            console.log("ERROR : ", e);
            $('[js-upload-bill-front]').prop("disabled", false);
        }
    });
});
function updateBillImageOnList(billData) {
    var imageBillForm = $('[js-upload-bill-form][bill-image="' + billData.id + '"]');
    imageBillForm.replaceWith('<a class="column-img column-img_mr5" data-fancybox="gallery' + billData.id + '" href="/' + billData.billImage + '">' +
        '  <img src="/' + billData.billImage + '"></a>');
}

//активация редактирования формы
var BILLS_INFO_TEMP = {};

$(document).on('click', '[edit-bill]', function(event) {
    event.preventDefault();
    $(this).closest('[edit-menu]').removeClass('is-open').siblings('[edit-btns]').addClass('is-open');
    var list = {};
    var pd = $(this).closest('.custom-table__body-row').find('[b-pay-date]');
    pd.removeAttr('disabled');
    list['payDate'] = pd.val();

    var s = $(this).closest('.custom-table__body-row').find('[b-sum]');
    list['sum'] = s.val();
    s.val(s.val().replace(' ₽','')).removeAttr('disabled');

    $(this).closest('.custom-table__body-row').find('[b-pm-wrapper]').removeClass('disabled');
    $(this).closest('.custom-table__body-row').find('[b-pm-selector]').removeAttr('disabled');
    var pm = $(this).closest('.custom-table__body-row').find('[b-pm]');
    list['paymentMethod'] = pm.val();
    var pmCode = $(this).closest('.custom-table__body-row').find('[b-pm-code]');
    list['paymentMethodCode'] = pmCode.val();

    var an = $(this).closest('.custom-table__body-row').find('[b-account-number]');
    an.removeAttr('disabled');
    list['accountNumber'] = an.val();

    BILLS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[b-id-bill]').val()] = list;
});

$(document).on('click', '[edit-bill-cancel]', function(event) {
    event.preventDefault();
    var values = BILLS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[b-id-bill]').val()];

    $(this).closest('.custom-table__body-row').find('[b-pay-date]').val(values.payDate).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[b-sum]').val(values.sum).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[b-account-number]').val(values.accountNumber).attr("disabled", true);

    $(this).closest('.custom-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
    $(this).closest('.custom-table__body-row').find('[b-pm-selector]')
        .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + values.paymentMethodCode).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[b-pm]').val(values.paymentMethod);
    $(this).closest('.custom-table__body-row').find('[b-pm-code]').val(values.paymentMethodCode);

    $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
    delete BILLS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[b-id-bill]').val()];
});

var ACCEPT_EDITE_BTN;
$(document).on('click', '[edit-bill-accept]', function(event) {
    event.preventDefault();
    ACCEPT_EDITE_BTN = $(this);

    var billData = new Object();
    billData.id = $(this).closest('.custom-table__body-row').find('[b-id-bill]').val();
    billData.idDeal = $(this).closest('.custom-table__body-row').find('[b-id-deal]').val();
    billData.paymentMethod = $(this).closest('.custom-table__body-row').find('[b-pm]').val();
    billData.paymentMethodCode = $(this).closest('.custom-table__body-row').find('[b-pm-code]').val();
    billData.sum = $(this).closest('.custom-table__body-row').find('[b-sum]').val();
    billData.accountNumber = $(this).closest('.custom-table__body-row').find('[b-account-number]').val();
    billData.payDate = $(this).closest('.custom-table__body-row').find('[b-pay-date]').val();

    $('[edit-bill-accept]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/bills/updateBill",
        data: JSON.stringify(billData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pay-date]').val(data.payDate).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-sum]').val(data.sum + ' ₽').attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-account-number]').val(data.accountNumber).attr("disabled", true);

            if(data.payDate === null || data.payDate === '') {
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('.column-bill__status').removeClass('column-bill__status_paid').html('Выставлен');
            } else {
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('.column-bill__status').addClass('column-bill__status_paid').html('Оплачен');
            }

            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-selector]')
                .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + data.paymentMethodCode).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm]').val(data.paymentMethod);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-code]').val(data.paymentMethodCode);


            ACCEPT_EDITE_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
            delete BILLS_INFO_TEMP[data.id];

            $('[edit-bill-accept]').prop("disabled", false);
        },
        error: function (data) {
            var values = BILLS_INFO_TEMP[billData.id];

            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pay-date]').val(values.payDate).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-sum]').val(values.sum).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-account-number]').val(values.accountNumber).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-selector]')
                .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + values.paymentMethodCode).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm]').val(values.paymentMethod);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-code]').val(values.paymentMethodCode);

            ACCEPT_EDITE_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
            delete BILLS_INFO_TEMP[data.id];
            $('[edit-bill-accept]').prop("disabled", false);
        }
    });
});





//кнопка добавления напоминания
$(document).on('click', '[js-add-reminder-button]', function(event) {
    event.preventDefault();
    $(this).closest('[js-add-reminder-form]').trigger('submit');
});
//form'a напоминания
$(document).on('submit', '[js-add-reminder-form]', function(event) {
    event.preventDefault();
    openUpdateReminder($(this).find('[name="idDeal"]').val());
});
function openUpdateReminder(idDeal) {
    $('[js-add-reminder-button]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/getReminder",
        data: JSON.stringify(idDeal),
        dataType: 'json',
        cache: false,
        success: function (data) {
            openReminderMenu(data);

            $('[js-add-reminder-button]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-reminder-button]').prop("disabled", false);
        }
    });
}
function openReminderMenu(data) {
    $('[js-update-form-reminder-id-deal]').val(data.idDeal);
    $('[js-update-form-reminder-date]').val(data.reminderDate);
    $('[js-update-form-reminder-msg]').html(data.reminderMessage);

    if (data.reminder) {
        $('[js-delete-reminder-block]').addClass('is-open');
    }

    $('[js-menu-update-reminder]').addClass('is-open');
    checkBodyHidden();
}
function clearReminderForm() {
    $('[js-update-form-reminder]').trigger('reset');
    $('[js-update-form-reminder-msg]').html('');
    $('[js-delete-reminder-block]').removeClass('is-open');
}

$(document).on('click', '[js-delete-reminder]', function (event) {
    event.preventDefault();

    var idDeal = $(this).closest('[js-update-form-reminder]').find('[name="idDeal"]').val();

    $('[js-delete-reminder]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/deleteReminder",
        data: JSON.stringify(idDeal),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard($CLIENT);

            $('[data-deal="' + idDeal + '"]').find('[data-deal-reminder]').html('<div class="reminder"></div>');

            clearReminderForm();
            $('[js-menu-update-reminder]').removeClass('is-open');
            checkBodyHidden();

            $('[js-delete-reminder]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-delete-reminder]').prop("disabled", false);
        }
    });

})
$(document).on('click', '[js-update-reminder]', function (event) {
    event.preventDefault();
    $('[js-update-form-reminder]').trigger('submit');

});
$(document).on('submit', '[js-update-form-reminder]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        updateReminder(formData);
    }
});
function updateReminder(formData) {
    $('[js-update-reminder]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/saveReminder",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard($CLIENT);
            updateReminderOnList(data);
            clearReminderForm();
            $('[js-menu-update-reminder]').removeClass('is-open');
            checkBodyHidden();

            $('[js-update-reminder]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-reminder]').prop("disabled", false);
        }
    });
}
function updateReminderOnList(value) {
    var dealRow = $('[data-deal="' + value.idDeal + '"]');

    var reminder = '';
    if (value.reminder) {
        reminder += '<div class="reminder-wrapper">' +
            '<div class="reminder-date" >' + value.reminderDate + '</div>' +
            '<div class="reminder-msg">' + value.reminderMessage + '</div>' +
            '</div>';
    }
    reminder += '<div class="reminder ' + (value.reminder ? (value.reminderExpiration ? 'reminder_red' : (value.reminderToday ? 'reminder_green' : 'reminder_gray')) : '') + '"></div>';
    if (value.reminder) {
        reminder += '<div class="reminder-d">' + value.reminderDate + '</div>';
    }

    dealRow.find('[data-deal-reminder]').html(reminder);
}

//список курсов
var $coursesList;
function setCoursesList(coursesList) {
    $coursesList = coursesList;
}
function createProductOptions(list, ident) {
    var seloption = "";
    seloption += '<option value="" disabled selected>Выберите продукт</option>';
    $.each(list, function(index, value2){
        seloption += '<option data-id="'+ value2.id + '" value="'+ value2.name +'" data-type="'+ value2.type + '" data-price="' + value2.price + '"">' + value2.name + '</option>';
    });
    $('[' + ident + ']').html(seloption);
}
function createEmptyProductOptions(ident) {
    $('[' + ident + ']').html('<option value="" disabled selected>Выберите продукт</option>');
}

//список продуков по категориям
var $productMap;
function setProductMap(productMap) {
    $productMap = productMap;
}
$(document).on('change', '[product-category]', function(event) {
    $('[js-deal-form-price]').val(0);
    var idCategory = $('option:selected', this).val();
    createProductOptions($productMap[idCategory], 'js-deal-form-product');
    $('[product-block]').removeClass('menu-input_close');

});

$(document).on('change', '[u-product-category]', function(event) {
    $('[js-update-form-deal-price]').val(0);
    var idCategory = $('option:selected', this).val();
    createProductOptions($productMap[idCategory], 'js-update-form-deal-pr');
    $('[u-product-block]').removeClass('menu-input_close');

});
$(document).on('change', '[u-product-types]', function(event) {
    $('[js-update-form-deal-price]').val(0);
    $('[js-update-form-deal-start-date]').html('<option value="" disabled selected>Выберите дату старта</option>');
    var idType = $('option:selected', this).attr('data-id');

    $('#u-product-category option:selected').removeAttr('selected');
    $('#u-product-category option:first').prop('selected', true);
    $('#js-update-form-deal-pr option:selected').removeAttr('selected');
    $('#js-update-form-deal-pr option:first').prop('selected', true);

    if (idType == 2) {
        createProductOptions($coursesList, 'js-update-form-deal-pr');
        $('[u-product-block]').removeClass('menu-input_close');
        $('[u-trial-block]').removeClass('menu-input_close');
        $('[u-product-category-block]').addClass('menu-input_close');
        $('[u-start-date-block]').removeClass('menu-input_close');
    } else if (idType == 3) {
        createEmptyProductOptions('js-update-form-deal-pr');
        $('[u-product-category-block]').removeClass('menu-input_close');
        $('[u-product-block]').addClass('menu-input_close');
        $('[u-trial-block]').addClass('menu-input_close');
        $('[u-start-date-block]').addClass('menu-input_close');
    } else {
        $('[u-product-block]').addClass('menu-input_close');
        $('[u-trial-block]').addClass('menu-input_close');
        $('[u-product-category-block]').addClass('menu-input_close');
        $('[u-start-date-block]').removeClass('menu-input_close');
    }
});


$(document).on('click', '[delete-ma]', function(event) {

    var row = $(this).closest('.custom-table__body-row');
    var maData = new Object();
    maData.id = row.find('[ma-id]').val();

    $('[ma]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "deleteManagerAccess",
        data: JSON.stringify(maData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            row.remove();
            $('[delete-ma]').prop("disabled", false);
        },
        error: function (data) {
            $('[delete-ma]').prop("disabled", false);
        }
    });
});

$(document).ready(function() {

    const $menuCreateRowBtn = $('[js-create-row]');
    const $menuCreateRowCloseBtn = $('[js-menu-create-row-close-btn]');
    const $menuCreateRow = $('[js-menu-create-row]');

    const $saveRowBtn = $('[js-save-row]');
    const $createRowForm = $('[js-row-form]');

    $menuCreateRowBtn.on('click', function () {
        $menuCreateRow.addClass('is-open');
        checkBodyHidden()
    });

    $menuCreateRowCloseBtn.on('click', function() {
        $menuCreateRow.removeClass('is-open');
        $createRowForm.trigger('reset');
        checkBodyHidden()
    });

    $saveRowBtn.on('click', function(event) {
        event.preventDefault();
        $createRowForm.trigger('submit');
    });

    $createRowForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var rowData = $createRowForm.serializeObject();
            createRow(rowData);
        }
    });

});

function createRow(rowData) {
    $('[js-save-row]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveManagerAccess",
        data: JSON.stringify(rowData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateRowOnFront(data);
            $('[js-menu-create-row]').removeClass('is-open');
            $('[js-row-form]').trigger('reset');
            $('[js-save-row]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-row]').prop("disabled", false);
        }
    });
}
function updateRowOnFront(managerAccess) {
    var row = $('[ma-id][value="' + managerAccess.id + '"]');
    if(!row.length) {
        var table = $('[table-body]');
        table.html('<tr class="custom-table__body-row">' +
            '                        <input type="hidden" ma-id value="' + managerAccess.id + '" name="id" required>' +
            '                        <td class="custom-table__body-col"></td>' +
            '                        <td class="custom-table__body-col custom-table__body-col_xlarge">' + managerAccess.managerName + '</td>' +
            '                        <td class="custom-table__body-col custom-table__body-col_xlarge">' + managerAccess.managerAccessName + '</td>' +
            '                        <td class="custom-table__body-col custom-table__body-col_last">' +
            '                            <div edit-menu class="column-links display-flex-none is-open">' +
            '                                <div delete-ma-form class="column-form">' +
            '                                    <button delete-ma type="button" class="column_mwidth column_mwidth-delete"></button>' +
            '                                </div>' +
            '                            </div>' +
            '                        </td>' +
            '                    </tr>'
            + table.html());
    }
}
$(document).on('change', '[js-action-form-action-type]', function(event){

    const $rank = $('[js-action-rank]');
    const $unrank = $('[js-action-unrank]');
    const $indiv = $('[js-action-indiv]');

    if ($(this).val() == 1) {
        $rank.css('display', 'none');
        $indiv.css('display', 'none');
        $unrank.css('display', 'flex');

        $('input[js-bonus]').val(null);
        $('input[js-mech]').val(null);
        $('input[js-place]').val(null);
        $('input[js-min]').val(null);
    } else if($(this).val() == 2){
        $unrank.css('display', 'none');
        $indiv.css('display', 'none');
        $rank.css('display', 'flex');

        $('input[js-bonus]').val('0');
        $('input[js-mech]').val(0);
        $('input[js-place]').val(null);
        $('input[js-min]').val(null);
    } else if($(this).val() == 3){
        $rank.css('display', 'none');
        $unrank.css('display', 'none');
        $indiv.css('display', 'flex');

        $('input[js-bonus]').val(null);
        $('input[js-mech]').val(null);
        $('input[js-place]').val(null);
        $('input[js-min]').val(null);
    }
});
$(document).on('click', '[js-action-form-mech]', function(event) {
    const $value = $('[js-action-form-value]');
    const $minimum = $('[js-action-form-minimum]');
    var $checked = $(this).children().first().val();
    if($checked == 2) {
        $value.parent().removeClassWild("menu-input__wrapper_*").addClass("menu-input__wrapper_count");
        $minimum.parent().removeClassWild("menu-input__wrapper_*").addClass("menu-input__wrapper_count");
    } else {
        $value.parent().removeClassWild("menu-input__wrapper_*").addClass("menu-input__wrapper_sum");
        $minimum.parent().removeClassWild("menu-input__wrapper_*").addClass("menu-input__wrapper_sum");
    }
});
$(document).on('change', '[js-action-form-bonus-type]', function(event) {
    const $bonus = $('[js-bonus]');
    const $place = $('[js-place]');

    if($(this).val() == 1) {
        $bonus.parent().removeClassWild("menu-input__wrapper_*").addClass("menu-input__wrapper_sum");
        $place.parent().removeClassWild("menu-input__wrapper_*").addClass("menu-input__wrapper_sum");
    } else {
        $bonus.parent().removeClassWild("menu-input__wrapper_*");
        $place.parent().removeClassWild("menu-input__wrapper_*");
    }
});

$(document).ready(function(){
    const $createActionBtn = $('[js-create-action]');
    const $menuCreateAction = $('[js-menu-create-action]');
    const $menuCreateActionCloseBtn = $('[js-menu-create-action-close-btn]');

    $createActionBtn.on('click', function() {
        $menuCreateAction.addClass('is-open');
        checkBodyHidden()
    });

    $menuCreateActionCloseBtn.on('click', function() {
        $menuCreateAction.removeClass('is-open');
        resetForm();
        checkBodyHidden()
    });

    const $saveAction = $('[js-save-action]');
    const $actionForm = $('[js-action-form]');

    $saveAction.on('click', function() {
        event.preventDefault();
        $actionForm.trigger('submit');
    });

    $actionForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var form = $('#actionForm')[0];
            var actionData = new FormData(form);
            if (actionData.get('actionType') === "3") {
                addLevelValues(actionData);
            }
            saveAction(actionData);
        }
    });

    initDatePickerStart();
    initDatePickerCs();

    initActionManagersTypeSelector();

    initDeleteLevel();
    initAddLevel();
})

function addLevelValues(actionData) {
    let counter = 0;
    for (let i = 1; i <= DEFAULT_LEVEL_COUNT; i++) {
        var data = $('div[data-level="' + i + '"]');
        actionData.append('levels[' + counter +'].level', data.attr('data-level'));
        actionData.append('levels[' + counter +'].value', data.find('[js-action-form-value]').val());
        actionData.append('levels[' + counter +'].bonus', data.find('[js-action-form-bonus]').val());

        counter++;
    }
}

function initDatePickerStart() {
    $('.datepicker-here-start').datepicker({
        autoClose: true,
        minDate: new Date()
    });
}
function initDatePickerCs() {
    $('.datepicker-here-cs').datepicker({
        autoClose: true
    });
}
var DEFAULT_LEVEL_COUNT = 1;
function initDeleteLevel() {
    $('[js-delete-level]').on('click', function() {
        if (DEFAULT_LEVEL_COUNT > 1) {
            $('div[data-level="' + DEFAULT_LEVEL_COUNT + '"]').remove();
            DEFAULT_LEVEL_COUNT -= 1;
        }
    });
}
function initAddLevel() {
    $('[js-add-level]').on('click', function() {
        var lastLevelBlock = $('div[data-level="' + DEFAULT_LEVEL_COUNT + '"]');
        var bonusType = $('[js-action-form-bonus-type]').val();
        DEFAULT_LEVEL_COUNT += 1;
        lastLevelBlock.after(
            '<div js-action-indiv data-level="' + DEFAULT_LEVEL_COUNT + '" class="menu-input__wrapper menu-input__wrapper_row menu-input__wrapper_margin">' +
            '                        <div class="menu-input menu-input_m menu-input_full">' +
            '                            <div class="menu-input__title">Значение ур.' + DEFAULT_LEVEL_COUNT + ' *</div>' +
            '                            <div class="menu-input__wrapper menu-input__wrapper_sum">' +
            '                                <input js-mech js-action-form-value name="value' + DEFAULT_LEVEL_COUNT + '" class="menu-input__input menu-input__input_small" placeholder="Введите значение" required/>' +
            '                            </div>' +
            '                        </div>' +
            '                        <div class="menu-input menu-input_m  menu-input_full">' +
            '                            <div class="menu-input__title">Награда ур.' + DEFAULT_LEVEL_COUNT + ' *</div>' +
            '                            <div class="menu-input__wrapper ' + (bonusType == 1 ? 'menu-input__wrapper_sum' : '') + '">' +
            '                                <input js-bonus js-action-form-bonus name="bonus' + DEFAULT_LEVEL_COUNT + '" class="menu-input__input menu-input__input_small" placeholder="Введите награду" required/>' +
            '                            </div>' +
            '                        </div>' +
            '                    </div>'
        );
    });
}

function initActionManagersTypeSelector() {
    $('input[name=managers]').prop("checked", true);

    const $actionManagerType = $('[js-action-form-manager-type]');
    const $managers = $('[js-managers-row]');

    $actionManagerType.on('change', function () {
        if ($actionManagerType.val() == 1) {
            $managers.css('display','none');
            $('input[name=managers]').prop("checked", true);
        } else if($actionManagerType.val() == 2) {
            $managers.css('display','flex');
            $('input[name=managers]').prop("checked", false);
        }
    })
}

function resetForm() {
    $('[js-action-form]').trigger('reset');

    $('.js-labelFile').removeClass('has-file');
    $('.js-fileName').html('Загрузите изображение акции 420х340');

    $('[js-managers-row]').removeAttr('style');
    $('input[name=managers]').prop("checked", true);

    $('[js-action-unrank]').removeAttr('style');
    $('[js-action-rank]').removeAttr('style');
    $('[js-action-indiv]').removeAttr('style');

    $('[js-bonus]').parent().removeClassWild("menu-input__wrapper_*").addClass("menu-input__wrapper_sum");
    $('[js-place]').parent().removeClassWild("menu-input__wrapper_*").addClass("menu-input__wrapper_sum");

    $('[js-action-form-value]').parent().removeClassWild("menu-input__wrapper_*").addClass("menu-input__wrapper_sum");
   $('[js-action-form-minimum]').parent().removeClassWild("menu-input__wrapper_*").addClass("menu-input__wrapper_sum");
}

function validateForm(form) {

    $(form).validate({
        onkeyup: false,
        onfocusout: false,
        errorPlacement: function(label, element) {
            label.addClass('error-wrapper');
            label.insertAfter(element.parent().last());
        },
        wrapper: 'span'
    });
    $(form).rules('add', {
        messages: {
            required: 'Заполните это поле.',
        }
    });

    return $(form).valid();
}

function saveAction(actionData) {
    $('[js-save-action]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: "multipart/form-data",
        url: "saveAction",
        data: actionData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[js-menu-create-action]').removeClass('is-open');
            checkBodyHidden();
            resetForm();
            $('[js-save-action]').prop("disabled", false);
            location.reload();
        },
        error: function (data) {
            $('[js-save-action]').prop("disabled", false);
        }
    });
}


var DEFAULT_PLACE_COUNT = 1;
$(document).on('click', '[js-delete-place]', function(event) {
    if (DEFAULT_PLACE_COUNT > 1) {
        $('div[data-place="' + DEFAULT_PLACE_COUNT + '"]').remove();
        DEFAULT_PLACE_COUNT -= 1;
    }
});
$(document).on('click', '[js-add-place]', function(event) {
    var lastAddBlock = $('div[data-place="' + DEFAULT_PLACE_COUNT + '"]');
    var bonusType = $('[js-action-form-bonus-type]').val();
    if (DEFAULT_PLACE_COUNT < 3) {
        DEFAULT_PLACE_COUNT += 1;
        lastAddBlock.after(
            ' <div js-action-rank data-place="' + DEFAULT_PLACE_COUNT + '" class="menu-input__wrapper menu-input__wrapper_row menu-input__wrapper_margin">' +
            '   <div class="menu-input menu-input_m  menu-input_full">' +
            '       <div class="menu-input__title">' + DEFAULT_PLACE_COUNT + ' место *</div>' +
            '           <div class="menu-input__wrapper ' + (bonusType == 1 ? 'menu-input__wrapper_sum' : '') + '">' +
            '                <input js-place name="places" class="menu-input__input menu-input__input_small" placeholder="Введите награду" required/>' +
            '           </div>' +
            '       </div>' +
            '   </div>'
        );
    }
});
var DELETE_LINK_FORM;
var LINK_ROW;
$(document).on('click', '[delete-inside-link-btn]', function(event) {
    event.preventDefault();
    $('[dialog]').find('.dialog__title').html('Вы действительно хотите удалить ссылку?');
    $('[dialog]').find('.dialog__text').html('Внутренняя ссылка будет удалена');
    $('[dialog]').find('[accept-dialog]').attr('accept-delete-link', '');
    $('[dialog]').addClass('is-open');
    DELETE_LINK_FORM =  $(this).closest('[delete-inside-link-form]');
    LINK_ROW = $(this);
});

$(document).on('click', '[accept-delete-link]', function(event) {
    event.preventDefault();
    $('[dialog]').removeClass('is-open');
    removeAcceptBtnAttribute($(this));
    DELETE_LINK_FORM.trigger('submit');
});

$(document).on('click', '[close-dialog]', function(event) {
    removeAcceptBtnAttribute($(this).siblings('[accept-dialog]'));
    $(this).closest('.dialog').removeClass('is-open');
});

$(document).on('submit', '[delete-inside-link-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        deleteInsideLink(formData);
    }
});
//функция удаления счета
function deleteInsideLink(formData) {
    $('[delete-inside-link-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "deleteInsideLink",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            LINK_ROW.closest('tr').remove();
            $('[delete-inside-link-btn]').prop("disabled", false);
        },
        error: function (data) {
            $('[delete-inside-link-btn]').prop("disabled", false);
        }
    });
}

$(document).on('click', '[delete-outside-link-btn]', function(event) {
    event.preventDefault();
    $('[dialog]').find('.dialog__title').html('Вы действительно хотите удалить ссылку?');
    $('[dialog]').find('.dialog__text').html('Внешняя и внутренние ссылки будут удалены');
    $('[dialog]').find('[accept-dialog]').attr('accept-delete-olink', '');
    $('[dialog]').addClass('is-open');
    DELETE_LINK_FORM =  $(this).closest('[delete-outside-link-form]');
    LINK_ROW = $(this);
});

$(document).on('click', '[accept-delete-olink]', function(event) {
    event.preventDefault();
    $('[dialog]').removeClass('is-open');
    removeAcceptBtnAttribute($(this));
    DELETE_LINK_FORM.trigger('submit');
});


$(document).on('submit', '[delete-outside-link-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        deleteOutsideLink(formData);
    }
});
//функция удаления счета
function deleteOutsideLink(formData) {
    $('[delete-outside-link-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "deleteOutsideLink",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            LINK_ROW.closest('tr').remove();
            $('[parent="' + formData['id'] + '"]').remove();
            $('[delete-outside-link-btn]').prop("disabled", false);
        },
        error: function (data) {
            $('[delete-outside-link-btn]').prop("disabled", false);
        }
    });
}


$(document).on('click', '[js-add-link]', function(event) {
    $('[js-menu-add]').addClass('is-open');
    checkBodyHidden();
});
$(document).on('click', '[js-menu-add-close-btn]', function(event) {
    $('[js-menu-add]').removeClass('is-open');
    $('[js-menu-add-form]').trigger('reset');
    checkBodyHidden();
});

$(document).on('click', '[js-add]', function(event){
    event.preventDefault();
    $('[js-menu-add-form]').trigger('submit');
});

$(document).on('submit', '[js-menu-add-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        saveLink($(this).serializeObject());
    }
});
function saveLink(linkData) {
    $('[js-add]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveLink",
        data: JSON.stringify(linkData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateLinkInTable(data);

            $('[js-menu-add]').removeClass('is-open');
            $('[js-menu-add-form]').trigger('reset');
            checkBodyHidden();
            $('[js-add]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add]').prop("disabled", false);
        }
    });
}

function updateLinkInTable(data) {
    var linksTable = $('[links-table]');
    linksTable.html(
        '<tr class="custom-table__body-row">' +
        '   <td class="custom-table__body-col">' + data.name + '</td>' +
        '   <td class="custom-table__body-col">' + data.advertiser + '</td>' +
        '   <td class="custom-table__body-col">' + data.link + '</td>' +
        '</tr>'
        + linksTable.html());
}

$(document).on('keyup', '[link-search]', function(event){
    var $v = $(this).val().toLowerCase();

    $('.link-row').each(function () {
        if (!(~$(this).find('.link-name').text().toLowerCase().indexOf($v) ||
            ~$(this).find('.link-name').val().toLowerCase().indexOf($v))) {
            $(this).addClass('none');
            $('[parent="' + $(this).data('outside') + '"]').addClass('none');
        } else {
            $(this).removeClass('none');
            $('[parent="' + $(this).data('outside') + '"]').removeClass('none');
        }
    })
});

var OUTSIDE_INFO_TEMP = {};
$(document).on('click', '[js-edit-outside]', function(event) {
    event.preventDefault();
    $(this).closest('[js-edit-menu]').removeClass('is-open').siblings('[js-edit-btns]').addClass('is-open');
    var list = {};

    var name = $(this).closest('.custom-table__body-row').find('[o-name]');
    name.removeAttr('disabled');
    list['name'] = name.val();

    OUTSIDE_INFO_TEMP[$(this).closest('[data-outside]').data('outside')] = list;
});

$(document).on('click', '[js-edit-outside-cancel]', function(event) {
    event.preventDefault();
    var values = OUTSIDE_INFO_TEMP[$(this).closest('[data-outside]').data('outside')];

    $(this).closest('.custom-table__body-row').find('[o-name]').val(values.name).attr("disabled", true);

    $(this).closest('[js-edit-btns]').removeClass('is-open').siblings('[js-edit-menu]').addClass('is-open');
    delete OUTSIDE_INFO_TEMP[$(this).closest('[data-outside]').data('outside')];
});
var OUTSIDE_ACCEPT_BTN;
$(document).on('click', '[js-edit-outside-accept]', function(event) {
    event.preventDefault();
    OUTSIDE_ACCEPT_BTN = $(this);

    var linkData = new Object();
    linkData.id = $(this).closest('[data-outside]').data('outside');
    linkData.name = $(this).closest('.custom-table__body-row').find('[o-name]').val();

    $('[js-edit-outside-accept]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateOutsideLink",
        data: JSON.stringify(linkData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            OUTSIDE_ACCEPT_BTN.closest('.custom-table__body-row').find('[o-name]').attr("disabled", true);

            OUTSIDE_ACCEPT_BTN.closest('[js-edit-btns]').removeClass('is-open').siblings('[js-edit-menu]').addClass('is-open');
            delete OUTSIDE_INFO_TEMP[linkData.id];

            $('[js-edit-outside-accept]').prop("disabled", false);
        },
        error: function (data) {
            var values = OUTSIDE_INFO_TEMP[linkData.id];

            OUTSIDE_ACCEPT_BTN.closest('.custom-table__body-row').find('[o-name]').val(values.name).attr("disabled", true);

            delete OUTSIDE_INFO_TEMP[linkData.id];

            $('[js-edit-outside-accept]').prop("disabled", false);
        }
    });
});


//внешняя ссылка
$(document).on('click', '[js-add-outside-link]', function(event) {
    $('[js-menu-add-outside]').addClass('is-open');
    checkBodyHidden();
});
$(document).on('click', '[js-menu-add-outside-close-btn]', function(event) {
    $('[js-menu-add-outside]').removeClass('is-open');
    $('[js-menu-add-outside-form]').trigger('reset');
    checkBodyHidden();
});
$(document).on('click', '[js-add-outside]', function(event){
    event.preventDefault();
    $('[js-menu-add-outside-form]').trigger('submit');
});

$(document).on('submit', '[js-menu-add-outside-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        saveOutsideLink($(this).serializeObject());
    }
});
function saveOutsideLink(linkData) {
    $('[js-add-outside]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveOutsideLink",
        data: JSON.stringify(linkData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateOutsideLinkInTable(data);

            $('[js-menu-add-outside]').removeClass('is-open');
            $('[js-menu-add-outside-form]').trigger('reset');
            checkBodyHidden();
            $('[js-add-outside]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-outside]').prop("disabled", false);
        }
    });
}

function updateOutsideLinkInTable(data) {
    var linksTable = $('[links-table]');
    linksTable.html(
        '<tr class="custom-table__body-row link-row" data-outside="' + data.id + '">' +
        '                                <td class="custom-table__body-col">' +
        '                                    <input o-name name="name" class="menu-input__input menu-input__input_small link-name editable" value="' + data.name + '" disabled required placeholder="Введите название">' +
        '                                </td>' +
        '                                <td class="custom-table__body-col">' +
        '                                    <div class="column-wrapper">' +
        '                                        <div class="column-full-text">' + data.link + '</div>' +
        '                                        <div class="column-links">' +
        '                                            <div js-copy-link class="column_mwidth column_mwidth-copy" data-link="' + data.link + '"></div>' +
        '                                            <a target="_blank" class="column_mwidth column_mwidth-open" href="' + data.link + '"></a>' +
        '                                        </div>' +
        '                                    </div>' +
        '                                </td>' +
        '                                <td>' +
        '                                    <div class="div-table__body-col div-table__body-col_center div-table__body-col_xxsmall div-table__body-col_lauto">' +
        '                                        <div js-edit-btns class="column-links display-flex-none">' +
        '                                            <div js-edit-outside-accept class="column_mwidth column_mwidth-accept"></div>' +
        '                                            <div js-edit-outside-cancel class="column_mwidth column_mwidth-cancel"></div>' +
        '                                        </div>' +
        '                                        <div js-edit-menu class="column-links display-flex-none is-open">' +
        '                                            <div js-edit-outside class="column_mwidth div-table__body-col_center column_mwidth-edit"></div>' +
        '                                            <form delete-outside-link-form= class="column-form" action="#">' +
        '                                                <input type="hidden" value="' + data.id + '" name="id" required="">' +
        '                                                <button delete-outside-link-btn= type="button" class="column_mwidth column_mwidth-delete"></button>' +
        '                                            </form>' +
        '                                        </div>' +
        '                                    </div>' +
        '                                </td>' +
        '                                <td class="custom-table__body-col">' +
        '                                    <div class="accordion-btn">' +
        '                                        <div data-toggle="collapse" aria-expanded="false" class="accordion-btn__wrapper collapsed" data-target="#out' + data.id + '" aria-controls="out' + data.id + '">' +
        '                                        </div>' +
        '                                    </div>' +
        '                                </td>' +
        '                            </tr>' +
        '                            <tr id="out' + data.id + '" class="custom-table__body-row collapse" parent="' + data.id + '">' +
        '                                <td colspan="4" class="custom-table__body-col custom-table__body-col_center">' +
        '                                    <table class="custom-table custom-table_inset">' +
        '                                        <tbody><tr class="custom-table__body-row">' +
        '                                            <td colspan="5" class="custom-table__body-col custom-table__body-col_p18 custom-table__body-col_r30">' +
        '                                                <div class="column-wrapper">' +
        '                                                    <div js-add-inside-link class="add-button add-button_right add-button_medium">+ Добавить внутреннюю ссылку</div>' +
        '                                                </div>' +
        '                                            </td>' +
        '                                        </tr>' +
        '                                    </tbody></table>' +
        '                                </td>' +
        '                            </tr>'
        + linksTable.html());
}

//редактирование внутренней
var INSIDE_INFO_TEMP = {};
$(document).on('click', '[js-edit-inside]', function(event) {
    event.preventDefault();
    $(this).closest('[js-edit-menu]').removeClass('is-open').siblings('[js-edit-btns]').addClass('is-open');
    var list = {};

    var name = $(this).closest('.custom-table__body-row').find('[i-name]');
    name.removeAttr('disabled');
    list['name'] = name.val();

    var link = $(this).closest('.custom-table__body-row').find('[i-link]');
    link.removeAttr('disabled');
    list['link'] = link.val();

    INSIDE_INFO_TEMP[$(this).closest('[data-inside]').data('inside')] = list;
});

$(document).on('click', '[js-edit-inside-cancel]', function(event) {
    event.preventDefault();
    var values = INSIDE_INFO_TEMP[$(this).closest('[data-inside]').data('inside')];

    $(this).closest('.custom-table__body-row').find('[i-name]').val(values.name).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[i-link]').val(values.link).attr("disabled", true);

    $(this).closest('[js-edit-btns]').removeClass('is-open').siblings('[js-edit-menu]').addClass('is-open');
    delete INSIDE_INFO_TEMP[$(this).closest('[data-inside]').data('inside')];
});
var INSIDE_ACCEPT_BTN;
$(document).on('click', '[js-edit-inside-accept]', function(event) {
    event.preventDefault();
    INSIDE_ACCEPT_BTN = $(this);

    var linkData = new Object();
    linkData.id = $(this).closest('[data-inside]').data('inside');
    linkData.name = $(this).closest('.custom-table__body-row').find('[i-name]').val();
    linkData.link = $(this).closest('.custom-table__body-row').find('[i-link]').val();

    $('[js-edit-inside-accept]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateInsideLink",
        data: JSON.stringify(linkData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            INSIDE_ACCEPT_BTN.closest('.custom-table__body-row').find('[i-name]').attr("disabled", true);
            INSIDE_ACCEPT_BTN.closest('.custom-table__body-row').find('[i-link]').attr("disabled", true);

            INSIDE_ACCEPT_BTN.closest('[js-edit-btns]').removeClass('is-open').siblings('[js-edit-menu]').addClass('is-open');
            delete INSIDE_INFO_TEMP[linkData.id];

            $('[js-edit-inside-accept]').prop("disabled", false);
        },
        error: function (data) {
            var values = INSIDE_INFO_TEMP[linkData.id];

            INSIDE_ACCEPT_BTN.closest('.custom-table__body-row').find('[i-name]').val(values.name).attr("disabled", true);
            INSIDE_ACCEPT_BTN.closest('.custom-table__body-row').find('[i-link]').val(values.link).attr("disabled", true);

            delete INSIDE_INFO_TEMP[linkData.id];

            $('[js-edit-inside-accept]').prop("disabled", false);
        }
    });
});

//внутрненяя ссылка
$(document).on('click', '[js-add-inside-link]', function(event) {
    $('[inside-parent]').val($(this).closest('[parent]').attr('parent'));
    $('[js-menu-add-inside]').addClass('is-open');
    checkBodyHidden();
});
$(document).on('click', '[js-menu-add-inside-close-btn]', function(event) {
    $('[js-menu-add-inside]').removeClass('is-open');
    $('[js-menu-add-inside-form]').trigger('reset');
    checkBodyHidden();
});
$(document).on('click', '[js-add-inside]', function(event){
    event.preventDefault();
    $('[js-menu-add-inside-form]').trigger('submit');
});

$(document).on('submit', '[js-menu-add-inside-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        saveInsideLink($(this).serializeObject());
    }
});
function saveInsideLink(linkData) {
    $('[js-add-inside]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveInsideLink",
        data: JSON.stringify(linkData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateInsideLinkInTable(data);

            $('[js-menu-add-inside]').removeClass('is-open');
            $('[js-menu-add-inside-form]').trigger('reset');
            checkBodyHidden();
            $('[js-add-inside]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-inside]').prop("disabled", false);
        }
    });
}

function updateInsideLinkInTable(data) {
    var linksTable = $('[parent="' + data.idParent + '"]').find('tbody');
    linksTable.prepend(
        '<tr class="custom-table__body-row custom-table__body-row_gray" data-inside="' + data.id + '">' +
        '                                                <td class="custom-table__body-col custom-table__body-col_15per">' +
        '                                                    <input i-name name="name" class="menu-input__input menu-input__input_small editable" value="' + data.name + '" disabled required placeholder="Введите имя">' +
        '                                                </td>' +
        '                                                <td class="custom-table__body-col custom-table__body-col custom-table__body-col_15per">' + data.counter + ' переходов</td>' +
        '                                                <td class="custom-table__body-col custom-table__body-col_center custom-table__body-col_35per">' +
        '                                                    <div class="column-wrapper">' +
        '                                                        <div class="column-full-text">' +
        '                                                            <input i-link name="link" class="menu-input__input menu-input__input_small editable" value="' + data.link + '" disabled required placeholder="Введите ссылку">' +
        '                                                        </div>' +
        '                                                        <div class="column-links">' +
        '                                                            <div js-copy-link class="column_mwidth column_mwidth-copy" data-link="' + data.link + '"></div>' +
        '                                                            <a target="_blank" class="column_mwidth column_mwidth-open" href="' + data.link + '"></a>' +
        '                                                        </div>' +
        '                                                    </div>' +
        '                                                </td>' +
        '                                                <td class="custom-table__body-col custom-table__body-col_center">' +
        '                                                    <form action="#" js-link-active-form class="input-element__input input-element__input_status input-element__input_max input-element__input_right input-element__input_row">' +
        '                                                        <div class="input-element__radio input-element__input_xxsmall">' +
        '                                                            <input js-link-active type="radio" id="active' + data.id + '" class="radio radio_green" name="isActive" value="true" checked="checked">' +
        '                                                            <label for="active' + data.id + '" class="label">Включена</label>' +
        '                                                        </div>' +
        '                                                        <div class="input-element__radio input-element__input_xxsmall">' +
        '                                                            <input js-link-active type="radio" id="inactive' + data.id + '" class="radio radio_red" name="isActive" value="false">' +
        '                                                            <label for="inactive' + data.id + '" class="label">Выключена</label>' +
        '                                                        </div>' +
        '                                                        <input type="hidden" name="id" value="' + data.id + '">' +
        '                                                    </form>' +
        '                                                </td>' +
        '                                                <td class="custom-table__body-col custom-table__body-col_lsmall">' +
        '                                                    <div class="div-table__body-col div-table__body-col_center div-table__body-col_xxsmall">' +
        '                                                        <div js-edit-btns class="column-links display-flex-none">' +
        '                                                            <div js-edit-inside-accept class="column_mwidth column_mwidth-accept"></div>' +
        '                                                            <div js-edit-inside-cancel class="column_mwidth column_mwidth-cancel"></div>' +
        '                                                        </div>' +
        '                                                        <div js-edit-menu class="column-links display-flex-none is-open">' +
        '                                                            <div js-edit-inside class="column_mwidth div-table__body-col_center column_mwidth-edit"></div>' +
        '                                                            <form delete-inside-link-form class="column-form" action="#">' +
        '                                                                <input type="hidden" value="' + data.id + '" name="id" required>' +
        '                                                                <button delete-inside-link-btn type="button" class="column_mwidth column_mwidth-delete"></button>' +
        '                                                            </form>' +
        '                                                        </div>' +
        '                                                    </div>' +
        '                                                </td>' +
        '                                            </tr>');
}

//обновление вкл/выкл

$(document).on('change', '[js-link-active]', function(event){
    event.preventDefault();
    $(this).closest('[js-link-active-form]').trigger('submit');
});

$(document).on('submit', '[js-link-active-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        updateStatusLink($(this).serializeObject());
    }
});
function updateStatusLink(formData) {
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateStatusLink",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
        },
        error: function (data) {
        }
    });
}
// //открытие модалки
// $(document).on('click', '[js-open-article]', function(event) {
//     setArticleDataToModal($(this).closest('.theme').attr('data-article'));
//     $('[js-menu-open-article]').addClass('is-open');
//     checkBodyHidden()
// });
// $(document).on('click', '[js-menu-open-article-close-btn]', function(event) {
//     $('[js-menu-open-article]').removeClass('is-open');
//     checkBodyHidden()
// });

$(document).on('click', '[js-update-article]', function(event) {
    setUpdateArticleFormData($(this).closest('.theme').attr('data-article'));
    $('[js-menu-update-article]').addClass('is-open');
    checkBodyHidden()
});
$(document).on('click', '[js-menu-update-article-close-btn]', function(event) {
    $('[js-menu-update-article]').removeClass('is-open');
    resetUpdateForm();
    checkBodyHidden()
});
$(document).on('click', '[js-update-save-article]', function(event){
    event.preventDefault();
    $('[js-update-article-form]').trigger('submit');
});
$(document).on('submit', '[js-update-article-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var form = $('#update-article-form')[0];
        var articleData = new FormData(form);
        updateTextArticle(articleData);
    }
});

$(document).ready(function() {
    const $menuCreateArticleBtn = $('[js-create-article]');
    const $menuCreateArticleCloseBtn = $('[js-menu-create-article-close-btn]');
    const $menuCreateArticle = $('[js-menu-create-article]');
    const $saveArticleBtn = $('[js-save-article]');
    const $createArticleForm = $('[js-article-form]');

    $menuCreateArticleBtn.on('click', function () {
        $menuCreateArticle.addClass('is-open');
        checkBodyHidden();
    });

    $menuCreateArticleCloseBtn.on('click', function() {
        $menuCreateArticle.removeClass('is-open');
        resetCreateForm();
        checkBodyHidden();
    });

    $saveArticleBtn.on('click', function(event) {
        event.preventDefault();
        $createArticleForm.trigger('submit');
    });

    $createArticleForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var form = $createArticleForm[0];
            var articleData = new FormData(form);
            createArticle(articleData);
        }
    });

    initChangeKindRadiobutton();
    initDeleteArticle();


    initEditor();
    initUpdateEditor();
});
function initDeleteArticle() {
    $('[js-delete-article]').on('click', function(event) {
        var idArticle = $('[js-update-article-form-id]').val();

        $('[js-delete-article]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "deleteArticle",
            data: JSON.stringify(idArticle),
            dataType: 'json',
            cache: false,
            success: function (data) {
                $('.theme[data-article="' + idArticle + '"]').remove();
                $('[js-menu-update-article]').removeClass('is-open');
                checkBodyHidden();
                resetUpdateForm();
                $('[js-delete-article]').prop("disabled", false);
            },
            error: function (data) {
                $('[js-delete-article]').prop("disabled", false);
            }
        });
    });
}
function createArticle(articleData) {
    $('[js-save-article]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: "multipart/form-data",
        url: "saveArticle",
        data: articleData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateArticleInContainer(data);
            $('[js-menu-create-article]').removeClass('is-open');
            checkBodyHidden();
            resetCreateForm();
            $('[js-save-article]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-article]').prop("disabled", false);
        }
    });
}

function initChangeKindRadiobutton() {
    const $articleKind = $('[js-article-kind]');

    $articleKind.on('click', function () {
        var idKind = $(this).children().first().val();
        changeKind(idKind);
    })
}
function changeKind(idKind) {
    const $link = $('[js-kind-link]');
    const $editor = $('[js-kind-editor]');

    if(idKind == 1) {
        $link.removeClass("is-open");
        $editor.removeClass("is-open");
    } else if (idKind == 2) {
        $link.removeClass("is-open");
        $editor.addClass("is-open");
    } else if (idKind == 3) {
        $link.addClass("is-open");
        $editor.removeClass("is-open");
    }
}
function resetCreateForm() {
    $('[js-article-form]').trigger('reset');
    $('[js-kind-link]').removeClass("is-open");
    $('[js-kind-editor]').removeClass("is-open");

    $('.js-labelFile').removeClass('has-file');
    $('.js-fileName').html('Загрузите обложку 900x100');
}
function validateForm(form) {

    $(form).validate({
        onkeyup: false,
        onfocusout: false,
        errorPlacement: function(label, element) {
            label.addClass('error-wrapper');
            label.insertAfter(element.parent().last());
        },
        wrapper: 'span'
    });
    $(form).rules('add', {
        messages: {
            required: 'Заполните это поле.',
        }
    });

    return $(form).valid();
}

function updateArticleInContainer(articleData) {
    $('.article-container').html($('.article-container').html() +
        '<div class="theme" data-article="' + articleData.id + '">' +
        '   <div class="theme-wrapper theme-wrapper_row">' +
        '       <div class="theme__text-wrapper">' +
        (
        (articleData.kind == 1) ? '<img class="article__img" src="/' + articleData.previewImg + '">' :

        (articleData.kind == 2) ? '<img js-open-article class="article__img article__img_modal" src="/' + articleData.previewImg + '">' :

        (articleData.kind == 3) ? '<a target="_blank" href="' + articleData.link + '">' +
            '                            <img class="article__img" src="/' + articleData.previewImg + '">' +
            '                      </a>' : ''
        ) +
        '       </div>' +
        '       <div js-update-article class="theme-setting theme-setting_top theme-setting_big"></div>' +
        '   </div>' +
        '</div>'
    );
}
// function setArticleDataToModal(idArticle) {
//     $('[js-open-article]').prop("disabled", true);
//     $.ajax({
//         type: "POST",
//         contentType: "application/json",
//         url: "getArticle",
//         data: JSON.stringify(idArticle),
//         dataType: 'json',
//         cache: false,
//         success: function (data) {
//             $('[js-open-title]').html(data.name);
//             $('[js-open-text]').html(data.text);
//             $('[js-open-article]').prop("disabled", false);
//         },
//         error: function (data) {
//             $('[js-open-article]').prop("disabled", false);
//         }
//     });
// }


function resetUpdateForm() {
    $('[js-update-article-form]').trigger('reset');
    $('[js-kind-link]').removeClass("is-open");
    $('[js-kind-editor]').removeClass("is-open");
    $('#js-update-article-form-type option:selected').removeAttr('selected');
    $("input[name=kind]").prop("checked", false);
    $("input[name=kind][value='1']").prop("checked",true);

    $('.js-labelFile').removeClass('has-file');
    $('.js-fileName').html('Загрузите обложку 900x100');
}
function setUpdateArticleFormData(idArticle) {
    $('[js-update-article]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getArticle",
        data: JSON.stringify(idArticle),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-update-article-form-id]').val(data.id);
            $('[js-update-article-form-name]').val(data.name);
            $('[js-update-article-form-link]').val(data.link);
            $('[js-update-article-form-type]').val(data.type);
            $('[js-update-article-form-img]').val(data.previewImg);
            $('#editor-update .ql-editor').html(data.text);
            $('#editor-hidden-update').val(data.text);
            $("input[name=kind][value='" + data.kind + "']").prop("checked",true);
            changeKind(data.kind);
            $('[js-update-article]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-article]').prop("disabled", false);
        }
    });
}





function initEditor() {
    const toolbarOptions = [
        [{ 'header': [1, 2, 3, false] }],
        ['bold', 'italic'],
        [{ 'list': 'bullet' }],
        [{ 'align': ['', 'center', 'right'] }],
        ['video'],
        ['image'],
        // ['iframe'],
        ['clean']
    ];
    const $hiddenEditor = $('#editor-hidden');

    var quill = new Quill('#editor', {
        theme: 'snow',
        modules: {
            toolbar: toolbarOptions
        }
    });

    quill.on('text-change', function(delta, oldDelta, source) {
        $hiddenEditor.val(quill.root.innerHTML);
    });
}

function initUpdateEditor() {
    const toolbarOptions = [
        [{ 'header': [1, 2, 3, false] }],
        ['bold', 'italic'],
        [{ 'list': 'bullet' }],
        [{ 'align': ['', 'center', 'right'] }],
        ['video'],
        ['image'],
        // ['iframe'],
        ['clean']
    ];
    const $hiddenEditor = $('#editor-hidden-update');

    var quill = new Quill('#editor-update', {
        theme: 'snow',
        modules: {
            toolbar: toolbarOptions
        }
    });

    quill.on('text-change', function(delta, oldDelta, source) {
        $hiddenEditor.val(quill.root.innerHTML);
    });
}

function updateTextArticle(articleData) {
    $('[js-save-update-article]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: "multipart/form-data",
        url: "updateArticle",
        data: articleData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateArticleAfterUpdate(data);
            $('[js-menu-update-article]').removeClass('is-open');
            checkBodyHidden();
            resetUpdateForm();
            $('[js-save-update-article]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-update-article]').prop("disabled", false);
        }
    });
}
function updateArticleAfterUpdate(articleData) {
    if (articleData.type === $('[js-type]').attr('type')) {
        $('.theme[data-article="' + articleData.id + '"]').find('.theme__text-wrapper').html(
            (
                (articleData.kind == 1) ? '<img class="article__img" src="/' + articleData.previewImg + '">' :

                (articleData.kind == 2) ? '<img js-open-article class="article__img article__img_modal" src="/' + articleData.previewImg + '">' :

                (articleData.kind == 3) ? '<a target="_blank" href="' + articleData.link + '">' +
                '                            <img class="article__img" src="/' + articleData.previewImg + '">' +
                '                          </a>' : ''
            )
        );
    } else {
        $('.theme[data-article="' + articleData.id + '"]').remove();
    }
}
$(document).ready(function(){
    const $filterForm = $('[tr-filter-form]');
    const $filterFormBtn = $('[tr-filter-form-btn]');
    const $filter = $('[tr-filter]');
    const $filterOpenBtn = $('[tr-filter-btn]');
    const $filterCloseBtn = $('[tr-filter-close-btn]');

    $filterOpenBtn.on('click', function() {
        $('body').addClass('hiddenOverflow');
        $filter.addClass('is-open');
    });

    $filterCloseBtn.on('click', function() {
        $('body').removeClass('hiddenOverflow');
        $filter.removeClass('is-open');
        resetFilter($filterFromBack);
    });

    $filterFormBtn.on('click', function(event) {
        event.preventDefault();
        $filterForm.trigger('submit');
    });

    $('.datepicker-here-f').datepicker({
        autoClose: true
    });

    setKindToFilter($('[filter-courses]'));
    selectKind($filterFromBack.kind);
});

//список фильтр
var $filterFromBack;
function setFilter(filter) {
    $filterFromBack = filter;
}

function resetFilter(filter) {
    $('#idManager option:selected').removeAttr('selected');
    $('#idManager').val(filter.idManager);

    $('#product option:selected').removeAttr('selected');
    $('#product').val(filter.product);

    $('#projectId option:selected').removeAttr('selected');
    $('#projectId').val(filter.projectId);

    setKindToFilter($('[filter-courses]'));
    selectKind($filterFromBack.kind);

    $('#status option:selected').removeAttr('selected');
    $('#status').val(filter.status);

    $('#paymentMethod option:selected').removeAttr('selected');
    $('#paymentMethod').val(filter.paymentMethod);

    $('#paidFrom').val(filter.paidFrom);
    $('#paidTo').val(filter.paidTo);

    $('#startDateFrom').val(filter.startDateFrom);
    $('#startDateTo').val(filter.startDateTo);

    $('#client').val(filter.client);
    $('#accountNumber').val(filter.accountNumber);

    $('#dealDateFrom').val(filter.dealDateFrom);
    $('#dealDateTo').val(filter.dealDateTo);
    $('#payDateFrom').val(filter.payDateFrom);
    $('#payDateTo').val(filter.payDateTo);

    $('input:checkbox[name="empties"]').prop("checked", false).attr("checked", false).removeAttr("checked");
    $.each(filter.statuses, function(index, value) {
        $('input:checkbox[name="empties"]').filter('[value="' + value + '"]').attr('checked', true).prop("checked", true);
    });
}


var BILL_ROW;

$(document).ready(function() {

    //изменение чекера напоминания при редактировании сделки
    $('[js-update-open-reminder]').on('click', function () {
        $('[js-update-form-deal-reminder-btn]').removeClass('is-open');
        $('[js-update-form-deal-reminder-block]').addClass('is-open');
        $('[js-update-form-deal-reminder-date]').val('');
        $('[js-update-form-deal-reminder-msg]').val('');
        $('[js-update-form-deal-reminder]').prop("checked", true);
    });
    //изменение чекера напоминания при редактировании сделки закрытие
    $('[js-update-close-reminder]').on('click', function () {
        $('[js-update-form-deal-reminder-btn]').addClass('is-open');
        $('[js-update-form-deal-reminder-block]').removeClass('is-open');
        $('[js-update-form-deal-reminder-date]').val('—');
        $('[js-update-form-deal-reminder-msg]').val('');
        $('[js-update-form-deal-reminder]').prop("checked", false);
    });
    //изменение чекера напоминания при создании сделки открытие
    $('[js-open-reminder]').on('click', function () {
        $('[js-deal-form-reminder-btn]').removeClass('is-open');
        $('[js-deal-form-reminder-block]').addClass('is-open');
        $('[js-deal-form-reminder-date]').val('');
        $('[js-deal-form-reminder-msg]').val('');
        $('[js-deal-form-reminder]').prop("checked", true);
    });
    //изменение чекера напоминания при создании сделки закрытие
    $('[js-close-reminder]').on('click', function () {
        $('[js-deal-form-reminder-btn]').addClass('is-open');
        $('[js-deal-form-reminder-block]').removeClass('is-open');
        $('[js-deal-form-reminder-date]').val('—');
        $('[js-deal-form-reminder-msg]').val('');
        $('[js-deal-form-reminder]').prop("checked", false);
    });



    $('[filter-courses]').on('change', function () {
        setKindToFilter($(this));
        selectKind('all');
    });
});

//активация формы удаления счета
var DELETE_BILL_FORM;
$(document).on('click', '[js-delete-bill]', function(event) {
    event.preventDefault();
    $('[dialog]').find('.dialog__title').html('Вы действительно хотите удалить счет?');
    $('[dialog]').find('.dialog__text').html('Вся информация о выставленном счете будет удалена');
    $('[dialog]').find('[accept-dialog]').attr('accept-delete-bill', '');
    $('[dialog]').addClass('is-open');
    DELETE_BILL_FORM =  $(this).closest('[js-delete-bill-form]');
    BILL_ROW = $(this);
});

$(document).on('click', '[accept-delete-bill]', function(event) {
    event.preventDefault();
    $('[dialog]').removeClass('is-open');
    removeAcceptBtnAttribute($(this));
    DELETE_BILL_FORM.trigger('submit');
});
//
// $(document).on('click', '[js-delete-bill]', function(event){
//     event.preventDefault();
//     BILL_ROW = $(this);
//     $(this).closest('[js-delete-bill-form]').trigger('submit');
// });

$(document).on('submit', '[js-delete-bill-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        deleteBill(formData);
    }
});
//функция удаления счета
function deleteBill(formData) {
    $('[js-delete-bill]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/bills/deleteBill",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            BILL_ROW.closest('.div-table__body-row').remove();
            BILL_ROW.closest('.custom-table__body-row').remove();
            updateDealCard($CLIENT);
            $('[js-delete-bill]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-delete-bill]').prop("disabled", false);
        }
    });
}

var BILLS_TEMP_INFO = {};

$(document).on('change', '[b-pm-selector]', function(event){
    $(this).removeClassWild("column_pmethod_*");
    var pm = $('option:selected', this).attr('value');
    var code = $('option:selected', this).attr('data-code');
    $(this).addClass("column_pmethod_" + code);
    $(this).closest('.div-table__body-row').find('[b-pm]').val(pm);
    $(this).closest('.div-table__body-row').find('[b-pm-code]').val(code);

    $(this).closest('.custom-table__body-row').find('[b-pm]').val(pm);
    $(this).closest('.custom-table__body-row').find('[b-pm-code]').val(code);
});
//активация редактирования формы
function initEditBillForm() {


    $('[js-edit-bill]').on('click', function (event) {
        event.preventDefault();
        $(this).closest('[js-edit-menu]').removeClass('is-open').siblings('[js-edit-btns]').addClass('is-open');
        var list = {};
        var pd = $(this).closest('.div-table__body-row').find('[b-pay-date]');
        pd.removeAttr('disabled');
        list['payDate'] = pd.val();

        var s = $(this).closest('.div-table__body-row').find('[b-sum]');
        s.removeAttr('disabled');
        list['sum'] = s.val();

        $(this).closest('.div-table__body-row').find('[b-pm-wrapper]').removeClass('disabled');
        $(this).closest('.div-table__body-row').find('[b-pm-selector]').removeAttr('disabled');
        var pm = $(this).closest('.div-table__body-row').find('[b-pm]');
        list['paymentMethod'] = pm.val();
        var pmCode = $(this).closest('.div-table__body-row').find('[b-pm-code]');
        list['paymentMethodCode'] = pmCode.val();

        var an = $(this).closest('.div-table__body-row').find('[b-account-number]');
        an.removeAttr('disabled');
        list['accountNumber'] = an.val();

        // var c = $(this).closest('.div-table__body-row').find('[b-comment]');
        // c.removeAttr('disabled');
        // list['comment'] = c.val();

        BILLS_TEMP_INFO[$(this).closest('.div-table__body-row').find('[b-id-bill]').val()] = list;
    });
}

function initCancelEditBill() {
    $('[js-edit-bill-cancel]').on('click', function (event) {
        event.preventDefault();
        var values = BILLS_TEMP_INFO[$(this).closest('.div-table__body-row').find('[b-id-bill]').val()];

        $(this).closest('.div-table__body-row').find('[b-pay-date]').val(values.payDate).attr("disabled", true);
        $(this).closest('.div-table__body-row').find('[b-sum]').val(values.sum).attr("disabled", true);
        $(this).closest('.div-table__body-row').find('[b-account-number]').val(values.accountNumber).attr("disabled", true);
        // $(this).closest('.div-table__body-row').find('[b-comment]').val(values.comment).attr("disabled", true);

        $(this).closest('.div-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
        $(this).closest('.div-table__body-row').find('[b-pm-selector]')
            .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + values.paymentMethodCode).attr("disabled", true);
        $(this).closest('.div-table__body-row').find('[b-pm]').val(values.paymentMethod);
        $(this).closest('.div-table__body-row').find('[b-pm-code]').val(values.paymentMethodCode);

        $(this).closest('[js-edit-btns]').removeClass('is-open').siblings('[js-edit-menu]').addClass('is-open');
        delete BILLS_TEMP_INFO[$(this).closest('.div-table__body-row').find('[b-id-bill]').val()];
    });
}

var ACCEPT_BTN;
function initAcceptEditBill() {
    $('[js-edit-bill-accept]').on('click', function (event) {
        event.preventDefault();
        ACCEPT_BTN = $(this);
        var billData = $(this).closest('.div-table__body-row').find('[b-update-bill-form]').serializeObject();
        $('[js-edit-bill-accept]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/api/bills/updateBill",
            data: JSON.stringify(billData),
            dataType: 'json',
            cache: false,
            success: function (data) {
                ACCEPT_BTN.closest('.div-table__body-row').find('[b-pay-date]').val(data.payDate).attr("disabled", true);
                ACCEPT_BTN.closest('.div-table__body-row').find('[b-sum]').val(data.sum).attr("disabled", true);
                ACCEPT_BTN.closest('.div-table__body-row').find('[b-account-number]').val(data.accountNumber).attr("disabled", true);
                // ACCEPT_BTN.closest('.div-table__body-row').find('[b-comment]').val(data.comment).attr("disabled", true);

                if(data.payDate === null || data.payDate === '') {
                    ACCEPT_BTN.closest('.div-table__body-row').find('.col-status').removeClass('div-table__body-col_green').html('Выставлен');
                } else {
                    ACCEPT_BTN.closest('.div-table__body-row').find('.col-status').addClass('div-table__body-col_green').html('Оплачен');
                }

                ACCEPT_BTN.closest('.div-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
                ACCEPT_BTN.closest('.div-table__body-row').find('[b-pm-selector]')
                    .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + data.paymentMethodCode).attr("disabled", true);
                ACCEPT_BTN.closest('.div-table__body-row').find('[b-pm]').val(data.paymentMethod);
                ACCEPT_BTN.closest('.div-table__body-row').find('[b-pm-code]').val(data.paymentMethodCode);


                ACCEPT_BTN.closest('[js-edit-btns]').removeClass('is-open').siblings('[js-edit-menu]').addClass('is-open');
                delete BILLS_TEMP_INFO[data.id];
                updateDealCard($CLIENT);
                updateBillOnFrontCard(data);
                $('[js-edit-bill-accept]').prop("disabled", false);
            },
            error: function (data) {
                var values = BILLS_TEMP_INFO[billData.id];

                ACCEPT_BTN.closest('.div-table__body-row').find('[b-pay-date]').val(values.payDate).attr("disabled", true);
                ACCEPT_BTN.closest('.div-table__body-row').find('[b-sum]').val(values.sum).attr("disabled", true);
                ACCEPT_BTN.closest('.div-table__body-row').find('[b-account-number]').val(values.accountNumber).attr("disabled", true);
                // ACCEPT_BTN.closest('.div-table__body-row').find('[b-comment]').val(values.comment).attr("disabled", true);

                ACCEPT_BTN.closest('.div-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
                ACCEPT_BTN.closest('.div-table__body-row').find('[b-pm-selector]')
                    .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + values.paymentMethodCode).attr("disabled", true);
                ACCEPT_BTN.closest('.div-table__body-row').find('[b-pm]').val(values.paymentMethod);
                ACCEPT_BTN.closest('.div-table__body-row').find('[b-pm-code]').val(values.paymentMethodCode);

                ACCEPT_BTN.closest('[js-edit-btns]').removeClass('is-open').siblings('[js-edit-menu]').addClass('is-open');
                delete BILLS_TEMP_INFO[data.id];
                $('[js-edit-bill-accept]').prop("disabled", false);
            }
        });
    });
}
//список типов продуктов
var $courseKindsList;
function setCourseKindsList(courseKindsList) {
    $courseKindsList = courseKindsList;
}

function createKindList(course) {
    return $courseKindsList.filter($courseKindsList => $courseKindsList['courseName'] === course);
}
function createKindOptions(kindList) {
    var options = '<option value="" disabled selected>Выберите тип</option>';

    kindList.forEach(function (kind) {
        options += '<option value="' + kind["name"] + '">' + kind["name"] + '</option>';
    })
    return options;
}
function createKindOptionsWithAll(kindList) {
    var options = '<option value="all">Все типы</option>';

    kindList.forEach(function (kind) {
        options += '<option value="' + kind["name"] + '">' + kind["name"] + '</option>';
    })
    return options;
}
function createKindOptionsAll() {
    return '<option value="all">Все типы</option>';
}

function setKindToFilter(selector) {
    $list = createKindList($('option:selected', selector).val());
    if ($list.length > 0) {
        $('[filter-course-kinds]').html(createKindOptionsWithAll($list));
        // $('[filter-course-kinds]').prop("disabled", false);
    } else {
        $('[filter-course-kinds]').html(createKindOptionsAll());
        // $('[filter-course-kinds]').prop("disabled", true);
    }
}
function selectKind(kind) {
    $('#kind option:selected').removeAttr('selected');
    $('#kind').val(kind);
}

function updateBillOnFrontCard(data) {
    var billRow = $('[data-bill="' + data.id + '"]');
    if (billRow.length !== 0) {
        billRow.find('[b-pm-selector]').removeClassWild("column_pmethod_*").addClass("column_pmethod_" + data.paymentMethodCode);
        billRow.find('[b-pm]').val(data.paymentMethod);
        billRow.find('[b-pm-code]').val(data.paymentMethodCode);
        billRow.find('[b-account-number]').val(data.accountNumber);
        billRow.find('[b-sum]').val(data.sum + ' ₽');
        billRow.find('[b-pay-date]').val(data.payDate);

        if (data.payDate === null || data.payDate === '') {
            billRow.find('[data-bill-status]').html('<div class="column-bill__status">Выставлен</div>');
        } else {
            billRow.find('[data-bill-status]').html('<div class="column-bill__status column-bill__status_paid">Оплачен</div>');
        }
    }
}
$(document).on('click', '.datepicker-here-b', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).on('click', '.datepicker-here-deal', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).on('click', '.datepicker-here-cs', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});

$(document).ready(function(){
    const $menuUpdateDeal = $('[js-menu-update-deal]');
    const $menuUpdateDealCloseBtn = $('[js-menu-update-deal-close-btn]');

    $menuUpdateDealCloseBtn.on('click', function() {
        $menuUpdateDeal.removeClass('is-open');
        checkBodyHidden()
    });


    const $updateDeal = $('[js-update-deal]');
    const $updateFormDeal = $('[js-update-form-deal]');

    $updateDeal.on('click', function() {
        event.preventDefault();
        $updateFormDeal.trigger('submit');
    });

    $updateFormDeal.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var formData = $(this).serializeObject();
            updateDeal(formData);
        }
    });

    const $menuClientCard = $('[js-menu-client-card]');
    const $menuClientCardCloseBtn = $('[js-menu-client-card-close-btn]');

    $menuClientCardCloseBtn.on('click', function () {
        $menuClientCard.removeClass('is-open');
        closeEdit();
        checkBodyHidden()
    });

    const $editClientBtn = $('[js-edit-client-btn]');
    const $editClientForm = $('[js-edit-client-form]');
    $editClientBtn.on('click', function (event) {
        event.preventDefault();
        $(this).closest('[js-edit-client-form]').trigger('submit');
    });

    $editClientForm.on('submit', function (event) {
        event.preventDefault();
        updateClient($(this).serializeObject());
    });

    $('[ js-copy-link]').on('click', function() {
        var $tmp = $("<textarea>");
        $("body").append($tmp);
        $tmp.val($(this).attr('data-link')).select();
        document.execCommand("copy");
        $tmp.remove();
    });

    initPayForm();
    initClearPayForm();

    $('.datepicker-here-b').datepicker({
        autoClose: true,
        maxDate: new Date(),
        todayButton: true,
        onSelect: function(formattedDate, date, inst) {
            PAYFORM.trigger('submit');
        }
    });

    //в меню редактирования
    $('[js-update-form-deal-sale-type]').on('change', function() {
        if ($(this).val() === 'traffic') {
            $('[js-update-form-deal-mailing-block]').addClass('is-open');
        } else {
            $('[js-update-form-deal-mailing-block]').removeClass('is-open');
            $('[js-update-form-deal-mailing]').prop('checked', false);
        }
    });
    //в меню редактирования
    $('[js-update-form-deal-pr]').on('change', function() {
        $('[js-update-form-deal-price]').val($('option:selected', this).attr('data-price'));
        $('[js-update-form-deal-product-type]').val($('option:selected', this).attr('data-type'));

        $list = createKindList($('option:selected', this).val());
        if ($list.length > 0) {
            $('[js-update-form-kind]').html(createKindOptions($list));
            $('[js-update-form-kind-block]').addClass('is-open');
        } else {
            $('[js-update-form-kind-block]').removeClass('is-open');
            $('[js-update-form-kind]').html('');
        }
    });

    const $menuBillsCloseBtn = $('[js-menu-bills-close-btn]');
    const $menuBills = $('[js-menu-bills]');

    $menuBillsCloseBtn.on('click', function() {
        $menuBills.removeClass('is-open');
        checkBodyHidden();
        BILLS_TEMP_INFO = {};
    });


    const $billsFrom = $('[js-bills-form]');
    const $saveBillsBtn = $('[js-save-bills]');

    $saveBillsBtn.on('click', function() {
        event.preventDefault();
        $billsFrom.trigger('submit');
    });

    $billsFrom.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var billData = $(this).serializeObject();
            saveBillWithUpdate(billData);
        }
    });

    const $dealFormSaleType= $('[js-deal-form-sale-type]');
    const $dealFormProduct= $('[js-deal-form-product]');

    $dealFormProduct.on('change', function() {
        $('[js-deal-form-price]').val($('option:selected', this).attr('data-price'));
        $('[js-deal-form-product-type]').val($('option:selected', this).attr('data-type'));

        $list = createKindList($('option:selected', this).val());
        if ($list.length > 0) {
            $('[js-deal-form-kind]').html(createKindOptions($list));
            $('[js-deal-form-kind-block]').addClass('is-open');
        } else {
            $('[js-deal-form-kind-block]').removeClass('is-open');
            $('[js-deal-form-kind]').html('');
        }
    });

    $dealFormSaleType.on('change', function() {
        if ($(this).val() === 'traffic') {
            $('[js-deal-form-mailing-block]').addClass('is-open');
            checkBodyHidden()
        } else {
            $('[js-deal-form-mailing-block]').removeClass('is-open');
            $('[js-deal-form-mailing]').prop('checked', false);
            checkBodyHidden()
        }
    });

    const $menuCreateDealCloseBtn = $('[js-menu-create-deal-close-btn]');
    const $menuCreateDeal = $('[js-menu-create-deal]');

    $menuCreateDealCloseBtn.on('click', function() {
        $menuCreateDeal.removeClass('is-open');
        checkBodyHidden()
    });


    const $createDealForm = $('[js-deal-form]');
    const $saveDealBtn = $('[js-save-deal]');

    $saveDealBtn.on('click', function(event) {
        event.preventDefault();
        $createDealForm.trigger('submit');
    });

    $createDealForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var dealData = $createDealForm.serializeObject();
            createDeal(dealData);
        }
    });

    openUpdateDealMenuF();
    openClientCard();
    editClientInfo();

    initDeleteBillFromList();
    initEditBillFromList();
    initCancelEditBillFromList();
    initAcceptEditBillFromList();
    initDatePickerCs();

    initFancy();

    $('.datepicker-here-deal').datepicker({
        autoClose: true,
        maxDate: new Date(),
        todayButton: true
    });
})

var PAYFORM;
function initPayForm() {
    $('[js-pay-date]').on('click', function () {
        PAYFORM = $(this).closest('[js-pay-form]');
    });

    $('[js-pay-form]').submit(function (event) {
        event.preventDefault();
        updateBillPayInfo($(this).serializeObject());
    });
}
function updateBillPayInfo(formData) {
    $('[js-pay-date]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateBillPayDate",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            var row = PAYFORM.closest('.custom-table__body-row');
            row.find('.column-bill__status').addClass('column-bill__status_paid').html('Оплачен');

            var form = '<td class="custom-table__body-col col-pay-date custom-table__body-col_center">' +
                '<form js-pay-clear-form action="#" class="menu-input__wrapper menu-input__wrapper_small menu-input__wrapper_close">' +
                '<input type="hidden" value="' + formData.id + '" name="id" required>' +
                '<div js-pay-clear-date name="payDate" class="menu-input__input menu-input__input_small">' + formData.payDate + '</div>' +
                '</form></td>';

            row.find('.col-pay-date').html(form);
            initClearPayForm();

            $('[js-pay-date]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-pay-date]').prop("disabled", false);
        }
    });
}
function initClearPayForm() {
    $('[js-pay-clear-date]').on('click', function () {
        PAYFORM = $(this).closest('[js-pay-clear-form]');
        PAYFORM.trigger('submit');
    });

    $('[js-pay-clear-form]').submit(function (event) {
        event.preventDefault();
        clearBillPayInfo($(this).serializeObject());
    });
}
function clearBillPayInfo(formData) {
    $('[js-pay-clear-date]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "clearBill",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            var row = PAYFORM.closest('.custom-table__body-row');
            row.find('.column-bill__status').removeClass('column-bill__status_paid').html('Выставлен');

            var form = '<td class="custom-table__body-col col-pay-date custom-table__body-col_center">' +
                '<form js-pay-form action="#" class="menu-input__wrapper menu-input__wrapper_small menu-input__wrapper_cal">' +
                '<input type="hidden" value="' + formData.id + '" name="id" required>' +
                '<input js-pay-date name="payDate" autocomplete="off" class="datepicker-here-b menu-input__input menu-input__input_small" data-autoclose="true" placeholder="Дата оплаты" required/>' +
                '</form></td>';
            row.find('.col-pay-date').html(form);

            initPayForm();
            initDatePicker();

            $('[js-pay-clear-date]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-pay-clear-date]').prop("disabled", false);
        }
    });
}
function initDatePicker() {
    $('.datepicker-here-b').datepicker({
        autoClose: true,
        todayButton: true,
        onSelect: function(formattedDate, date, inst) {
            PAYFORM.trigger('submit');
        }
    });
}

function initDatePickerCs() {
    $('.datepicker-here-cs').datepicker({
        autoClose: true,
        maxDate: new Date(),
        todayButton: true
    });
}
//редактирование сделки
function openUpdateDealMenuF() {
    var $updateDealForm = $('[js-update-deal-f]');
    var $updateDealBtn = $('[js-update-deal-b]');

    $updateDealBtn.on('click', function (event) {
        event.preventDefault();
        $(this).closest('[js-update-deal-f]').trigger('submit');
    });

    $updateDealForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var formData = $(this).serializeObject();
            setDealInfo(formData);
        }
    });
}
function setDealInfo(data) {
    $('[js-update-deal-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getDeal",
        data: JSON.stringify(data),
        dataType: 'json',
        cache: false,
        success: function (data) {
            setUpdateDealInfo(data);
            $('[js-update-deal-btn]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-deal-btn]').prop("disabled", false);
        }
    });
}
function setUpdateDealInfo(data) {
    $('#js-update-form-deal-status option:selected').removeAttr('selected');
    $('#js-update-form-deal-social option:selected').removeAttr('selected');
    $('#js-update-form-deal-pr option:selected').removeAttr('selected');
    $('#js-update-form-deal-sale-type option:selected').removeAttr('selected');

    $("#js-update-form-deal-status").val(data.status);
    $("#js-update-form-deal-social").val(data.social);
    $('[js-update-form-deal-deal-date]').val(data.dealDate);
    $("#js-update-form-deal-pr").val(data.course);
    $("#js-update-form-deal-sale-type").val(data.type);
    $('[js-update-form-deal-start-date]').val(data.startDate);

    $('[js-update-form-kind-block]').removeClass('is-open');
    $('[js-update-form-kind]').html('');
    var list = createKindList(data.course);
    if (list.length > 0) {
        $('[js-update-form-kind]').html(createKindOptions(list));
        $('[js-update-form-kind]').val(data.kind);
        $('[js-update-form-kind-block]').addClass('is-open');
    }

    $('[js-update-form-deal-mailing]').prop("checked", false);
    if (data.type === 'traffic') {
        $('[js-update-form-deal-mailing-block]').addClass('is-open');
        if (data.isMailing) {
            $('[js-update-form-deal-mailing]').prop("checked", true);
        } else {
            $('[js-update-form-deal-mailing]').prop("checked", false);
        }
    } else {
        $('[js-update-form-deal-mailing-block]').removeClass('is-open');
        $('[js-update-form-deal-mailing]').prop('checked', false);
    }
    $('[js-update-form-deal-trial]').prop('checked', data.trial);
    $('[js-update-form-deal-price]').val(data.price);
    $('[js-update-form-deal-tag]').val(data.tag);
    $('[js-update-form-deal-comment]').val(data.comment);
    $('[js-deal-open-lessons]').prop('checked', data.allModulesHomeworkAllowed);

    $('[js-update-form-deal-reminder]').prop("checked", false);
    if (data.reminder) {
        $('[js-update-form-deal-reminder-block]').addClass('is-open');
        $('[js-update-form-deal-reminder-btn]').removeClass('is-open');
        $('[js-update-form-deal-reminder]').prop("checked", true);
        $('[js-update-form-deal-reminder-date]').val(data.reminderDate);
        $('[js-update-form-deal-reminder-msg]').val(data.reminderMessage);
    } else {
        $('[js-update-form-deal-reminder-block]').removeClass('is-open');
        $('[js-update-form-deal-reminder-btn]').addClass('is-open');
        $('[js-update-form-deal-reminder]').prop("checked", false);
        $('[js-update-form-deal-reminder-date]').val('');
        $('[js-update-form-deal-reminder-msg]').val('');
    }

    $('[js-update-form-deal-product-type]').val(data.product);
    $('[js-update-form-deal-client]').val(data.idClient);
    $('[js-update-form-deal-manager]').val(data.idManager);
    $('[js-update-form-deal-id]').val(data.id);

    $('[js-menu-update-deal]').addClass('is-open');
    checkBodyHidden();
}
function updateDeal(formData) {
    $('[js-update-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateDeal",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard(data.idClient);
            $('[js-menu-update-deal]').removeClass('is-open');
            checkBodyHidden()
            updateBillAfterUpdateOnList(data);
            $('[js-update-deal]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-deal]').prop("disabled", false);
        }
    });
}
function updateBillAfterUpdateOnList(value) {
    var dealRow = $('[data-deal="' + value.id + '"]');

    var course = value.course + (value.kind !== null && value.kind !== '' ? ' (' + value.kind + ')' : '');
    dealRow.siblings('[data-bill-course]').attr('title', course).html(course);
}

//карта клиента
var $CLIENT;
function openClientCard() {
    $('[js-client-card]').on('click', function() {
        var clientId = $(this).find('[js-client-id]').val();

        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "getClientInfo",
            data: JSON.stringify(clientId),
            dataType: 'json',
            cache: false,
            success: function (data) {
                setClientCardInfo(data);
            }
        });
    });
}
function setClientCardInfo(data) {
    $('[js-client-card-name]').val(data.name);
    $('[js-client-card-date]').text(data.createDate);
    $('[js-client-card-manager]').text(data.manager);
    $('[js-client-card-link]').val(data.link);
    $('[js-client-card-phone]').val(data.phone);
    $('[js-client-card-email]').val(data.email);
    $('[js-client-card-comment]').val(data.comment);
    $('[js-client-card-id]').val(data.id);

    $('[js-client-name-copy]').text(data.name);
    $('[js-client-name-copy]').attr('data-link', data.name);

    setIdClient(data.id);
    updateDealCard($CLIENT);

    $('[js-menu-client-card]').addClass('is-open');
    checkBodyHidden()
}
function closeEdit() {
    $('[js-client-card-name]').attr("disabled", true);
    $('[js-client-card-comment]').attr("disabled", true);
    $('[js-client-card-link]').attr("disabled", true);
    $('[js-client-card-phone]').attr("disabled", true);
    $('[js-client-card-email]').attr("disabled", true);
    $('[js-edit-footer]').removeClass('is-open');
}
function editClientInfo() {
    $('[js-edit-btn]').on('click', function () {
        $('[js-client-card-name]').removeAttr('disabled');
        $('[js-client-card-comment]').removeAttr('disabled');
        $('[js-client-card-link]').removeAttr('disabled');
        $('[js-client-card-phone]').removeAttr('disabled');
        $('[js-client-card-email]').removeAttr('disabled');
        $('[js-edit-footer]').addClass('is-open');
    })
}
function updateClient(formData) {
    $('[js-update-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateClient",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            closeEdit();
            updateClientNameOnFront(data);
            $('[js-update-deal]').prop("disabled", false);
            $('[js-client-name-copy]').text(data.name);
            $('[js-client-name-copy]').attr('data-link', data.name);
        },
        error: function (data) {
            $('[js-update-deal]').prop("disabled", false);
        }
    });
}
function updateClientNameOnFront(value) {
    var clientRow = $('[data-client="' + value.id + '"]');
    clientRow.siblings('span').html(value.name);
}
function updateDealCard(idClient) {
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getDeals",
        data: JSON.stringify(idClient),
        dataType: 'json',
        cache: false,
        success: function (data) {
            var $dealList = $('[js-deals-list]');
            $dealList.html('');
            $.each(data, function(index, value) {

                // установка значения в в меню
                var seloption = "";
                $.each($statusesList, function(index, value2){
                    seloption += '<option js-deal-form-status value="'+ value2.id +'" data-code="'+
                        value2.code + '" ' + (value2.id === value.status ? 'selected="selected" ': '') +'">' + value2.title + '</option>';
                });

                var reminder = "";
                if (value.reminder) {
                    reminder += '<div class="menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-violet">' +
                        '<div class="deal__comment" title="' + value.reminderMessage + '">' + value.reminderMessage + '</div></div>';
                } else {
                    reminder += '<div class="menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-empty">' +
                        '<div class="deal__comment">Нет напоминаний</div></div>';
                }

                var response = $("<div/>").attr("class", "deal deal_white")
                    .append($("<div/>").attr("class", "deal-wrapper")
                        .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_bordered deal__wrapper_column")
                            .append($("<div/>").attr("class", "deal__title").html(value.course))
                            .append($("<div/>").attr("class", "deal__subtitle")
                                .append($("<div/>").attr("class", value.kind !== null ? "deal__kind deal__kind_del" : "deal__kind").html(value.kind))
                                .append($("<div/>").attr("class", "deal__date").html(value.createDate)))
                        )
                        .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_bordered ")
                            .append($("<div/>").attr("class", "deal__social")
                                .append($("<div/>").attr("class", "deal-social deal-social_" + value.socialCode)))
                            .append($("<div/>").attr("class", "deal__manager").html(value.managerName))
                            .append($("<div/>").attr("class", "deal__sale-type").html(value.type))
                        )
                        .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_between deal__wrapper_bordered ")
                            .append($("<div/>").attr("class", "deal__sum")
                                .append($("<div/>").attr("class", "deal__sum-title").html("Стоимость"))
                                .append($("<div/>").attr("class", "deal__sum-value").html(value.price))
                            )
                            .append($("<div/>").attr("class", "deal__sum")
                                .append($("<div/>").attr("class", "deal__sum-title").html("Получено"))
                                .append($("<div/>").attr("class", "deal__sum-value deal__sum-value_blue").html(value.paid))
                            )
                            .append($("<div/>").attr("class", "deal_bill")
                                .append($("<form/>").attr("js-add-bill-form", "").attr("action", "#")
                                    .append($("<input/>").attr("type", "hidden").attr("name", "id").val(value.id))
                                    .append($("<button/>").attr("js-add-bill-button", "").attr("class", "add-btn"))
                                )
                            )
                        )
                        .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                            .append($("<form/>").attr("js-deal-status-form","").attr("class", "deal__select deal__select_" + value.statusCode)
                                .append($("<input/>").attr("name", "id").attr("type", "hidden").val(value.id))
                                .append($("<select/>").attr("class","deal-select menu-input__input_select").attr("name","status").attr("js-deal-form-status","").html(seloption))
                            )
                        )
                        .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                            .append($("<div/>").attr("class", "deal__reminder")
                                .append($("<div/>").attr("class", "deal__reminder-title").html('Напоминание'))
                                .append($("<div/>").attr("class", "deal__reminder-date").html(value.reminderDate))
                            )
                            .append(reminder)
                        )
                        .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                            .append($("<div/>").attr("class", "menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-small")
                                .append($("<div/>").attr("class", "deal__comment").attr("title", value.comment).html(value.comment))
                            )
                        )
                        .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column")
                            .append($("<form/>").attr("class", "button_full").attr("action", "#").attr("js-update-deal-form", "")
                                .append($("<input/>").attr("name", "id").attr("type", "hidden").val(value.id))
                                .append($("<button/>").attr("type", "button").attr("class", "button button_white button_full").attr("js-update-deal-btn", "").html("Редактировать сделку"))
                            )
                        )
                    )
                $dealList.append(response);
            });

            changeStatus();
            $('[js-add-bill-form]').on('submit', function (event) {
                event.preventDefault();
                openBills($(this).serializeObject());
            });

            var $createDealBlock = $("<div/>").attr("js-create-deal", "").attr("class", "deal deal_create")
                .append($("<div/>").attr("class", "deal__btm-message").html('Добавить сделку'));

            $dealList.append($createDealBlock);

            $('[js-create-deal]').on('click', function() {
                $('[js-menu-create-deal]').addClass('is-open');
                checkBodyHidden()
            });

            openUpdateDealMenu();
        }
    });
}
function setIdClient(id) {
    $('[js-deal-form-client]').val(id);
    $CLIENT = id;
}
function changeStatus() {
    $('[js-deal-form-status]').on('change', function () {
        var form = $(this).parent($('[js-deal-status-form]'));
        form.removeClassWild("deal__select_*");
        var code = $('option:selected', this).attr('data-code');
        form.addClass("deal__select_" + code);

        var formData = form.serializeObject();
        formData['code'] = code;
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "updateDealStatus",
            data: JSON.stringify(formData),
            dataType: 'json',
            cache: false,
            success: function (data) {
               
            },
            error: function (data) {
                
            }
        });

    });
}
function openUpdateDealMenu() {
    var $updateDealForm = $('[js-update-deal-form]');
    var $updateDealBtn = $('[js-update-deal-btn]');

    $updateDealBtn.on('click', function (event) {
        event.preventDefault();
        $(this).closest('[js-update-deal-form]').trigger('submit');
    });

    $updateDealForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var formData = $(this).serializeObject();
            setDealInfo(formData);
        }
    });
}
function openBills(formData) {
    $('[js-add-bill-form]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getBills",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-bills-deal-id]').val(formData.id);
            createBills(data);
            $('[js-menu-bills]').addClass('is-open');
            checkBodyHidden()
            $('[js-add-bill-form]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-bill-form]').prop("disabled", false);
        }
    });
}
function createBills(billList) {
    $('[js-bills-body]').html('');

    if (billList.length > 0) {
        $('[js-bills]').addClass('is-open');
    } else {
        $('[js-bills]').removeClass('is-open');
    }
    checkBodyHidden()
    $.each(billList, function(index, value) {
        var response = "";
        response += '<div class="div-table__body-row">';

        // установка значения в в меню
        var seloption = "";
        $.each($paymentMethodList, function(index, value2){
            seloption += '<option value="'+ value2.title +'" data-code="' + value2.code + '">' + value2.title + '</option>';
        });

        //если статус 1 проверено, то зеленая иначе можно редактировать
        if (value.status === 2) {
            response += '<div class="div-table__body-col div-table__body-col_exxsmall div-table__body-col_center">' +
                '<div class="column_bstatus column_bstatus_checked"></div>' +
                '</div>';
        } else {
            response += '<div class="div-table__body-col div-table__body-col_exxsmall div-table__body-col_center">' +
                '<div class="column_bstatus column_bstatus_unchecked"></div>' +
                '</div>';
        }

        response += '<div class="div-table__body-col div-table__body-col_medium">' +
            '<div class="column-text">' + value.manager + '</div>' +
            '</div>';

        response += '<form b-update-bill-form action="#" class="edit-form-bill">' +
            '<input type="hidden" b-id-bill value="' + value.id + '" name="id" required>' +
            '<input type="hidden" value="' + value.idDeal + '" name="idDeal" required>' +
            '<input type="hidden" b-pm value="' + value.paymentMethod + '" name="paymentMethod">' +
            '<input type="hidden" b-pm-code value="' + value.paymentMethodCode + '" name="paymentMethodCode">' +
            '<div class="div-table__body-col div-table__body-col_small">' + value.billDate + '</div>';



        // add сумму
        response += '<div class="div-table__body-col div-table__body-col_center div-table__body-col_xsmall">' +
            '<input b-sum disabled name="sum" class="menu-input__input menu-input__input_small editable" value="'+ value.sum +'" placeholder="0 ₽">' +
            '</div>';

        //селектор выбора типа оплаты
        // response += '<div class="div-table__body-col div-table__body-col_xxsmall">' +
        //         '<input type="hidden" value="' + value.paymentMethodId + '" name="paymentMethodId" required>' +
        //         '<div b-payment-method class="column_pmethod column_pmethod_' + value.paymentMethod + '"></div>' +
        //     '</div>';

        response += '<div class="div-table__body-col div-table__body-col_xxsmall">' +
            '<div b-pm-wrapper class="pmethod-wrapper disabled">' +
            '<select b-pm-selector disabled class="column_pmethod-select column_pmethod_' + value.paymentMethodCode + '">' +
            seloption +
            '</select>' +
            '</div>' +
            '</div>';

        // add номер счета
        response +=   '<div class="div-table__body-col div-table__body-col_medium  div-table__body-col_center div-table__body-col_r10">' +
            '<input b-account-number disabled name="accountNumber" class="menu-input__input menu-input__input_small editable" value="'+ (value.accountNumber === null ? '' : value.accountNumber) +'" placeholder="—">' +
            '</div>';

        response += '<div class="div-table__body-col col-pay-date div-table__body-col_center div-table__body-col_medium ">' +
            '<div class="menu-input__wrapper menu-input__wrapper_xsmall">' +
            '<input b-pay-date disabled name="payDate" ' +
            'class="datepicker-here-cs menu-input__input menu-input__input_small editable" autocomplete="off" value="' + (value.payDate === null ? '' : value.payDate) + '" data-autoclose="true" placeholder="—"/>' +
            '</div></div>';

        // add оплачен/выставлен
        if (value.payDate === null) {
            response += '<div class="div-table__body-col div-table__body-col_small col-status">Выставлен</div>';
        } else {
            response += '<div class="div-table__body-col div-table__body-col_small col-status div-table__body-col_green">Оплачен</div>';
        }

        // add тип оплаты
        response += '<div class="div-table__body-col div-table__body-col_small">' + (value.paymentType === 'Новый клиент' ? 'Первый' : 'Доплата') + '</div>';

        // add ссылка
        if (value.link !== null && value.link !== '') {
            response += '<div class="div-table__body-col div-table__body-col_xxsmall div-table__body-col_center">' +
                '<div class="column-links"><div js-copy-link data-link="' + value.link + '" class="column_mwidth column_mwidth-copy"></div>' +
                '<a js-open-link href="' + value.link + '" target="_blank" class="column_mwidth column_mwidth-open"></a></div></div>';
        } else {
            response += '<div class="div-table__body-col div-table__body-col_xxsmall">' +
                '<div>—</div></div>';
        }

        response += '</form>';

        // add коммент
        response += '<div data-bill-id="' + value.id + '" class="div-table__body-col div-table__body-col_medium div-table__body-col_center">' +
            '<div class="column-links">' +
            ((value.comment === null)
                ? '<div js-add-sms-check js-check-btn class="column_mwidth column_mwidth-large column_mwidth_bordered div-table__body-col_center column_mwidth-add-check"></div>'
                : '<div js-delete-sms-check js-check-btn title="' + value.comment + '" class="column_mwidth column_mwidth-large column_mwidth_bordered div-table__body-col_center column_mwidth-delete-check"></div>') +
            ((value.billImage !== null && value.billImage !== '')
                ? '<a class="column-img column_mwidth column-img_large div-table__body-col_center" data-fancybox="gallery" href="../' + value.billImage + '">' +
                '<img src="/' + value.billImage + '">' +
                '</a>'
                : '<form js-upload-bill-form action="#" class="column_mwidth column_mwidth-large div-table__body-col_center div-table__body-col_fl" enctype="multipart/form-data">' +
                '<input type="hidden" value="' + value.id + '" name="id" required>' +
                '<input type="hidden" value="' + value.idDeal + '" name="idDeal" required>' +
                '<input js-upload-bill accept="image/*,image/jpeg" class="input-file" name="file" type="file" id="file' + index + '"/>' +
                '<label for="file' + index + '" class="js-labelFile">' +
                '<span class="js-upload-file js-upload-file_small"></span>' +
                '</label>' +
                '</form>') +
            '</div>' +
            '</div>';
        // response += '<div data-bill-id="' + value.id + '"  class="div-table__body-col div-table__body-col_small">' +
        //     ((value.comment === null)
        //         ? '<div js-add-sms-check class="column_mwidth div-table__body-col_center column_mwidth-add-check"></div>'
        //         : '<div title="' + value.comment + '" js-delete-sms-check class="column_mwidth div-table__body-col_center column_mwidth-delete-check"></div>') +
        //     '</div>';
        //
        // // add image
        // if (value.billImage !== null && value.billImage !== '') {
        //     response +='<div class="div-table__body-col div-table__body-col_xxxsmall">' +
        //         '<a class="column-img" data-fancybox="gallery" href="../' + value.billImage + '">' +
        //         '<img src="/' + value.billImage + '">' +
        //         '</a></div>';
        // } else {
        //     response += '<div class="div-table__body-col div-table__body-col_xxxsmall">' +
        //         '<form js-upload-bill-form action="#" enctype="multipart/form-data">' +
        //         '<input type="hidden" value="' + value.id + '" name="id" required>' +
        //         '<input type="hidden" value="' + value.idDeal + '" name="idDeal" required>' +
        //         '<input js-upload-bill accept="image/*,image/jpeg" class="input-file" name="file" type="file" id="file' + index + '"/>' +
        //         '<label for="file' + index + '" class="js-labelFile">' +
        //         '<span class="js-upload-file"></span>' +
        //         '</label>' +
        //         '</form>' +
        //         '</div>';
        // }
        response += '<div class="div-table__body-col div-table__body-col_center div-table__body-col_xxsmall">';

        //если статус 1 проверено, то зеленая иначе можно редактировать
        if (value.status === 1 && value.isEditable) {
            response +=  '<div js-edit-btns class="column-links display-flex-none">' +
                '<div js-edit-bill-accept class="column_mwidth column_mwidth-accept"></div>' +
                '<div js-edit-bill-cancel class="column_mwidth column_mwidth-cancel"></div>' +
                '</div>' +
                '<div js-edit-menu class="column-links display-flex-none is-open">' +
                '<div js-edit-bill class="column_mwidth div-table__body-col_center column_mwidth-edit"></div>' +
                '<form js-delete-bill-form class="column-form" action="#">' +
                '<input type="hidden" value="' + value.id + '" name="id" required>' +
                '<button js-delete-bill type="button" class="column_mwidth column_mwidth-delete"></button>' +
                '</form>' +
                '</div>';
        }

        response += '</div>'+
            '</div>';

        $('[js-bills-body]').html($('[js-bills-body]').html() + response);
    });

    initDatePickerCs();
    uploadImage();
    initFancy();
    // copyLink();
    // initDeleteBillForm();
    initEditBillForm();
    initCancelEditBill();
    initAcceptEditBill();
}
function uploadImage() {
    $('[js-upload-bill]').on('change', function () {
        var form = $(this).closest('[js-upload-bill-form]')
        var data = new FormData(form[0]);
        $('[js-upload-bill]').prop("disabled", true);
        $.ajax({
            type: "POST",
            enctype: 'multipart/form-data',
            url: "uploadBill",
            data: data,
            processData: false,
            contentType: false,
            cache: false,
            timeout: 300000,
            success: function (data) {
                var formData = form.serializeObject();
                formData['id'] = formData.idDeal;
                openBills(formData);
                $('[js-upload-bill]').prop("disabled", false);
            },
            error: function (e) {
                console.log("ERROR : ", e);
                $('[js-upload-bill]').prop("disabled", false);
            }
        });
    });
}
function initFancy() {
    $('[data-fancybox]').fancybox({
        infobar: false,
        buttons: [
            "close"
        ],
    });
}
// function copyLink() {
//     $('[ js-copy-link]').on('click', function() {
//         var $tmp = $("<textarea>");
//         $("body").append($tmp);
//         $tmp.val($(this).attr('data-link')).select();
//         document.execCommand("copy");
//         $tmp.remove();
//     });
// }
function saveBillWithUpdate(billData) {
    $('[js-save-bills]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveBill",
        data: JSON.stringify(billData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard($CLIENT);
            billData['id'] = billData.idDeal;
            openBills(billData);
            $('[js-bills-form]').trigger('reset');
            $('[js-bills-form]').find('[js-bill-account-number-wrapper]').removeClass('is-open');
            $('[js-save-bills]').prop("disabled", false);

            BILLS_TEMP_INFO = {};
        },
        error: function (data) {
            $('[js-save-bills]').prop("disabled", false);
        }
    });
}
//список статусов сделки
var $statusesList;
function setStatusesList(statusesList) {
    $statusesList = statusesList;
}
//список способов оплаты
var $paymentMethodList;
function setPaymentMethodList(paymentMethodList) {
    $paymentMethodList = paymentMethodList;
}

function createDeal(dealData) {
    $('[js-save-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveDeal",
        data: JSON.stringify(dealData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard(dealData.idClient);
            $('[js-bill-deal-id]').val(data);
            $('[js-menu-create-deal]').removeClass('is-open');
            $('[js-deal-form-kind-block]').removeClass('is-open');
            $('[js-deal-form-kind]').html('');
            $('[js-deal-form-mailing-block]').removeClass('is-open');
            $('[js-deal-form-mailing]').prop("checked", false);
            $('[js-deal-form-trial]').prop("checked", false);
            $('[js-deal-form-reminder-block]').removeClass('is-open');
            $('[js-deal-form-reminder-btn]').addClass('is-open');
            $('[js-deal-form-reminder]').prop("checked", false);
            checkBodyHidden()
            $('[js-deal-form]').trigger('reset');
            $('[js-save-deal]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-deal]').prop("disabled", false);
        }
    });
}

//активация формы удаления счета
function initDeleteBillFromList() {
    $('[delete-bill]').on('click', function (event) {
        event.preventDefault();
        BILL_ROW = $(this);
        $(this).closest('[delete-bill-form]').trigger('submit');
    });

    $('[delete-bill-form]').submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var formData = $(this).serializeObject();
            deleteBillFromList(formData);
        }
    });
}
//функция удаления счета
function deleteBillFromList(formData) {
    $('[delete-bill]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "deleteBill",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            BILL_ROW.closest('.custom-table__body-row').remove();
            $('[delete-bill]').prop("disabled", false);
        },
        error: function (data) {
            $('[delete-bill]').prop("disabled", false);
        }
    });
}
//активация редактирования формы
var BILLS_INFO_TEMP = {};
function initEditBillFromList() {

    // $('[b-pm-selector]').on('change', function () {
    //     $(this).removeClassWild("column_pmethod_*");
    //     var pm = $('option:selected', this).attr('value');
    //     var code = $('option:selected', this).attr('data-code');
    //     $(this).addClass("column_pmethod_" + code);
    //     $(this).closest('.custom-table__body-row').find('[b-pm]').val(pm);
    //     $(this).closest('.custom-table__body-row').find('[b-pm-code]').val(code);
    // });

    $('[edit-bill]').on('click', function (event) {
        event.preventDefault();
        $(this).closest('[edit-menu]').removeClass('is-open').siblings('[edit-btns]').addClass('is-open');
        var list = {};
        var pd = $(this).closest('.custom-table__body-row').find('[b-pay-date]');
        pd.removeAttr('disabled');
        list['payDate'] = pd.val();

        var s = $(this).closest('.custom-table__body-row').find('[b-sum]');
        list['sum'] = s.val();
        s.val(s.val().replace(' ₽','')).removeAttr('disabled');

        $(this).closest('.custom-table__body-row').find('[b-pm-wrapper]').removeClass('disabled');
        $(this).closest('.custom-table__body-row').find('[b-pm-selector]').removeAttr('disabled');
        var pm = $(this).closest('.custom-table__body-row').find('[b-pm]');
        list['paymentMethod'] = pm.val();
        var pmCode = $(this).closest('.custom-table__body-row').find('[b-pm-code]');
        list['paymentMethodCode'] = pmCode.val();

        var an = $(this).closest('.custom-table__body-row').find('[b-account-number]');
        an.removeAttr('disabled');
        list['accountNumber'] = an.val();

        // var c = $(this).closest('.custom-table__body-row').find('[b-comment]');
        // c.removeAttr('disabled');
        // list['comment'] = c.val();

        BILLS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[b-id-bill]').val()] = list;
    });
}
function initCancelEditBillFromList() {
    $('[edit-bill-cancel]').on('click', function (event) {
        event.preventDefault();
        var values = BILLS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[b-id-bill]').val()];

        $(this).closest('.custom-table__body-row').find('[b-pay-date]').val(values.payDate).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[b-sum]').val(values.sum).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[b-account-number]').val(values.accountNumber).attr("disabled", true);
        // $(this).closest('.custom-table__body-row').find('[b-comment]').val(values.comment).attr("disabled", true);

        $(this).closest('.custom-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
        $(this).closest('.custom-table__body-row').find('[b-pm-selector]')
            .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + values.paymentMethodCode).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[b-pm]').val(values.paymentMethod);
        $(this).closest('.custom-table__body-row').find('[b-pm-code]').val(values.paymentMethodCode);

        $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
        delete BILLS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[b-id-bill]').val()];
    });
}
var ACCEPT_EDITE_BTN;
function initAcceptEditBillFromList() {
    $('[edit-bill-accept]').on('click', function (event) {
        event.preventDefault();
        ACCEPT_EDITE_BTN = $(this);

        var billData = new Object();
        billData.id = $(this).closest('.custom-table__body-row').find('[b-id-bill]').val();
        billData.idDeal = $(this).closest('.custom-table__body-row').find('[b-id-deal]').val();
        billData.paymentMethod = $(this).closest('.custom-table__body-row').find('[b-pm]').val();
        billData.paymentMethodCode = $(this).closest('.custom-table__body-row').find('[b-pm-code]').val();
        billData.sum = $(this).closest('.custom-table__body-row').find('[b-sum]').val();
        billData.accountNumber = $(this).closest('.custom-table__body-row').find('[b-account-number]').val();
        billData.payDate = $(this).closest('.custom-table__body-row').find('[b-pay-date]').val();
        // billData.comment = $(this).closest('.custom-table__body-row').find('[b-comment]').val();

        $('[edit-bill-accept]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/api/bills/updateBill",
            data: JSON.stringify(billData),
            dataType: 'json',
            cache: false,
            success: function (data) {
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pay-date]').val(data.payDate).attr("disabled", true);
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-sum]').val(data.sum + ' ₽').attr("disabled", true);
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-account-number]').val(data.accountNumber).attr("disabled", true);
                // ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-comment]').val(data.comment).attr("disabled", true);

                if(data.payDate === null || data.payDate === '') {
                    ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('.column-bill__status').removeClass('column-bill__status_paid').html('Выставлен');
                } else {
                    ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('.column-bill__status').addClass('column-bill__status_paid').html('Оплачен');
                }

                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-selector]')
                    .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + data.paymentMethodCode).attr("disabled", true);
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm]').val(data.paymentMethod);
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-code]').val(data.paymentMethodCode);


                ACCEPT_EDITE_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
                delete BILLS_INFO_TEMP[data.id];

                $('[edit-bill-accept]').prop("disabled", false);
            },
            error: function (data) {
                var values = BILLS_INFO_TEMP[billData.id];

                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pay-date]').val(values.payDate).attr("disabled", true);
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-sum]').val(values.sum + ' ₽').attr("disabled", true);
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-account-number]').val(values.accountNumber).attr("disabled", true);
                // ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-comment]').val(values.comment).attr("disabled", true);

                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-selector]')
                    .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + values.paymentMethodCode).attr("disabled", true);
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm]').val(values.paymentMethod);
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-code]').val(values.paymentMethodCode);

                ACCEPT_EDITE_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
                delete BILLS_INFO_TEMP[data.id];
                $('[edit-bill-accept]').prop("disabled", false);
            }
        });
    });
}
function validateForm(form) {

    $(form).validate({
        onkeyup: false,
        onfocusout: false,
        errorPlacement: function(label, element) {
            label.addClass('error-wrapper');
            label.insertAfter(element);
        },
        wrapper: 'span'
    });
    $(form).rules('add', {
        messages: {
            required: 'Заполните это поле.',
        }
    });

    return $(form).valid();
}

/*!
  * Bootstrap v4.3.1 (https://getbootstrap.com/)
  * Copyright 2011-2019 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("jquery"),require("popper.js")):"function"==typeof define&&define.amd?define(["exports","jquery","popper.js"],e):e((t=t||self).bootstrap={},t.jQuery,t.Popper)}(this,function(t,g,u){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function l(o){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},e=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),e.forEach(function(t){var e,n,i;e=o,i=r[n=t],n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i})}return o}g=g&&g.hasOwnProperty("default")?g.default:g,u=u&&u.hasOwnProperty("default")?u.default:u;var e="transitionend";function n(t){var e=this,n=!1;return g(this).one(_.TRANSITION_END,function(){n=!0}),setTimeout(function(){n||_.triggerTransitionEnd(e)},t),this}var _={TRANSITION_END:"bsTransitionEnd",getUID:function(t){for(;t+=~~(1e6*Math.random()),document.getElementById(t););return t},getSelectorFromElement:function(t){var e=t.getAttribute("data-target");if(!e||"#"===e){var n=t.getAttribute("href");e=n&&"#"!==n?n.trim():""}try{return document.querySelector(e)?e:null}catch(t){return null}},getTransitionDurationFromElement:function(t){if(!t)return 0;var e=g(t).css("transition-duration"),n=g(t).css("transition-delay"),i=parseFloat(e),o=parseFloat(n);return i||o?(e=e.split(",")[0],n=n.split(",")[0],1e3*(parseFloat(e)+parseFloat(n))):0},reflow:function(t){return t.offsetHeight},triggerTransitionEnd:function(t){g(t).trigger(e)},supportsTransitionEnd:function(){return Boolean(e)},isElement:function(t){return(t[0]||t).nodeType},typeCheckConfig:function(t,e,n){for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var o=n[i],r=e[i],s=r&&_.isElement(r)?"element":(a=r,{}.toString.call(a).match(/\s([a-z]+)/i)[1].toLowerCase());if(!new RegExp(o).test(s))throw new Error(t.toUpperCase()+': Option "'+i+'" provided type "'+s+'" but expected type "'+o+'".')}var a},findShadowRoot:function(t){if(!document.documentElement.attachShadow)return null;if("function"!=typeof t.getRootNode)return t instanceof ShadowRoot?t:t.parentNode?_.findShadowRoot(t.parentNode):null;var e=t.getRootNode();return e instanceof ShadowRoot?e:null}};g.fn.emulateTransitionEnd=n,g.event.special[_.TRANSITION_END]={bindType:e,delegateType:e,handle:function(t){if(g(t.target).is(this))return t.handleObj.handler.apply(this,arguments)}};var o="alert",r="bs.alert",a="."+r,c=g.fn[o],h={CLOSE:"close"+a,CLOSED:"closed"+a,CLICK_DATA_API:"click"+a+".data-api"},f="alert",d="fade",m="show",p=function(){function i(t){this._element=t}var t=i.prototype;return t.close=function(t){var e=this._element;t&&(e=this._getRootElement(t)),this._triggerCloseEvent(e).isDefaultPrevented()||this._removeElement(e)},t.dispose=function(){g.removeData(this._element,r),this._element=null},t._getRootElement=function(t){var e=_.getSelectorFromElement(t),n=!1;return e&&(n=document.querySelector(e)),n||(n=g(t).closest("."+f)[0]),n},t._triggerCloseEvent=function(t){var e=g.Event(h.CLOSE);return g(t).trigger(e),e},t._removeElement=function(e){var n=this;if(g(e).removeClass(m),g(e).hasClass(d)){var t=_.getTransitionDurationFromElement(e);g(e).one(_.TRANSITION_END,function(t){return n._destroyElement(e,t)}).emulateTransitionEnd(t)}else this._destroyElement(e)},t._destroyElement=function(t){g(t).detach().trigger(h.CLOSED).remove()},i._jQueryInterface=function(n){return this.each(function(){var t=g(this),e=t.data(r);e||(e=new i(this),t.data(r,e)),"close"===n&&e[n](this)})},i._handleDismiss=function(e){return function(t){t&&t.preventDefault(),e.close(this)}},s(i,null,[{key:"VERSION",get:function(){return"4.3.1"}}]),i}();g(document).on(h.CLICK_DATA_API,'[data-dismiss="alert"]',p._handleDismiss(new p)),g.fn[o]=p._jQueryInterface,g.fn[o].Constructor=p,g.fn[o].noConflict=function(){return g.fn[o]=c,p._jQueryInterface};var v="button",y="bs.button",E="."+y,C=".data-api",T=g.fn[v],S="active",b="btn",I="focus",D='[data-toggle^="button"]',w='[data-toggle="buttons"]',A='input:not([type="hidden"])',N=".active",O=".btn",k={CLICK_DATA_API:"click"+E+C,FOCUS_BLUR_DATA_API:"focus"+E+C+" blur"+E+C},P=function(){function n(t){this._element=t}var t=n.prototype;return t.toggle=function(){var t=!0,e=!0,n=g(this._element).closest(w)[0];if(n){var i=this._element.querySelector(A);if(i){if("radio"===i.type)if(i.checked&&this._element.classList.contains(S))t=!1;else{var o=n.querySelector(N);o&&g(o).removeClass(S)}if(t){if(i.hasAttribute("disabled")||n.hasAttribute("disabled")||i.classList.contains("disabled")||n.classList.contains("disabled"))return;i.checked=!this._element.classList.contains(S),g(i).trigger("change")}i.focus(),e=!1}}e&&this._element.setAttribute("aria-pressed",!this._element.classList.contains(S)),t&&g(this._element).toggleClass(S)},t.dispose=function(){g.removeData(this._element,y),this._element=null},n._jQueryInterface=function(e){return this.each(function(){var t=g(this).data(y);t||(t=new n(this),g(this).data(y,t)),"toggle"===e&&t[e]()})},s(n,null,[{key:"VERSION",get:function(){return"4.3.1"}}]),n}();g(document).on(k.CLICK_DATA_API,D,function(t){t.preventDefault();var e=t.target;g(e).hasClass(b)||(e=g(e).closest(O)),P._jQueryInterface.call(g(e),"toggle")}).on(k.FOCUS_BLUR_DATA_API,D,function(t){var e=g(t.target).closest(O)[0];g(e).toggleClass(I,/^focus(in)?$/.test(t.type))}),g.fn[v]=P._jQueryInterface,g.fn[v].Constructor=P,g.fn[v].noConflict=function(){return g.fn[v]=T,P._jQueryInterface};var L="carousel",j="bs.carousel",H="."+j,R=".data-api",x=g.fn[L],F={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0,touch:!0},U={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean",touch:"boolean"},W="next",q="prev",M="left",K="right",Q={SLIDE:"slide"+H,SLID:"slid"+H,KEYDOWN:"keydown"+H,MOUSEENTER:"mouseenter"+H,MOUSELEAVE:"mouseleave"+H,TOUCHSTART:"touchstart"+H,TOUCHMOVE:"touchmove"+H,TOUCHEND:"touchend"+H,POINTERDOWN:"pointerdown"+H,POINTERUP:"pointerup"+H,DRAG_START:"dragstart"+H,LOAD_DATA_API:"load"+H+R,CLICK_DATA_API:"click"+H+R},B="carousel",V="active",Y="slide",z="carousel-item-right",X="carousel-item-left",$="carousel-item-next",G="carousel-item-prev",J="pointer-event",Z=".active",tt=".active.carousel-item",et=".carousel-item",nt=".carousel-item img",it=".carousel-item-next, .carousel-item-prev",ot=".carousel-indicators",rt="[data-slide], [data-slide-to]",st='[data-ride="carousel"]',at={TOUCH:"touch",PEN:"pen"},lt=function(){function r(t,e){this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this.touchStartX=0,this.touchDeltaX=0,this._config=this._getConfig(e),this._element=t,this._indicatorsElement=this._element.querySelector(ot),this._touchSupported="ontouchstart"in document.documentElement||0<navigator.maxTouchPoints,this._pointerEvent=Boolean(window.PointerEvent||window.MSPointerEvent),this._addEventListeners()}var t=r.prototype;return t.next=function(){this._isSliding||this._slide(W)},t.nextWhenVisible=function(){!document.hidden&&g(this._element).is(":visible")&&"hidden"!==g(this._element).css("visibility")&&this.next()},t.prev=function(){this._isSliding||this._slide(q)},t.pause=function(t){t||(this._isPaused=!0),this._element.querySelector(it)&&(_.triggerTransitionEnd(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null},t.cycle=function(t){t||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config.interval&&!this._isPaused&&(this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))},t.to=function(t){var e=this;this._activeElement=this._element.querySelector(tt);var n=this._getItemIndex(this._activeElement);if(!(t>this._items.length-1||t<0))if(this._isSliding)g(this._element).one(Q.SLID,function(){return e.to(t)});else{if(n===t)return this.pause(),void this.cycle();var i=n<t?W:q;this._slide(i,this._items[t])}},t.dispose=function(){g(this._element).off(H),g.removeData(this._element,j),this._items=null,this._config=null,this._element=null,this._interval=null,this._isPaused=null,this._isSliding=null,this._activeElement=null,this._indicatorsElement=null},t._getConfig=function(t){return t=l({},F,t),_.typeCheckConfig(L,t,U),t},t._handleSwipe=function(){var t=Math.abs(this.touchDeltaX);if(!(t<=40)){var e=t/this.touchDeltaX;0<e&&this.prev(),e<0&&this.next()}},t._addEventListeners=function(){var e=this;this._config.keyboard&&g(this._element).on(Q.KEYDOWN,function(t){return e._keydown(t)}),"hover"===this._config.pause&&g(this._element).on(Q.MOUSEENTER,function(t){return e.pause(t)}).on(Q.MOUSELEAVE,function(t){return e.cycle(t)}),this._config.touch&&this._addTouchEventListeners()},t._addTouchEventListeners=function(){var n=this;if(this._touchSupported){var e=function(t){n._pointerEvent&&at[t.originalEvent.pointerType.toUpperCase()]?n.touchStartX=t.originalEvent.clientX:n._pointerEvent||(n.touchStartX=t.originalEvent.touches[0].clientX)},i=function(t){n._pointerEvent&&at[t.originalEvent.pointerType.toUpperCase()]&&(n.touchDeltaX=t.originalEvent.clientX-n.touchStartX),n._handleSwipe(),"hover"===n._config.pause&&(n.pause(),n.touchTimeout&&clearTimeout(n.touchTimeout),n.touchTimeout=setTimeout(function(t){return n.cycle(t)},500+n._config.interval))};g(this._element.querySelectorAll(nt)).on(Q.DRAG_START,function(t){return t.preventDefault()}),this._pointerEvent?(g(this._element).on(Q.POINTERDOWN,function(t){return e(t)}),g(this._element).on(Q.POINTERUP,function(t){return i(t)}),this._element.classList.add(J)):(g(this._element).on(Q.TOUCHSTART,function(t){return e(t)}),g(this._element).on(Q.TOUCHMOVE,function(t){var e;(e=t).originalEvent.touches&&1<e.originalEvent.touches.length?n.touchDeltaX=0:n.touchDeltaX=e.originalEvent.touches[0].clientX-n.touchStartX}),g(this._element).on(Q.TOUCHEND,function(t){return i(t)}))}},t._keydown=function(t){if(!/input|textarea/i.test(t.target.tagName))switch(t.which){case 37:t.preventDefault(),this.prev();break;case 39:t.preventDefault(),this.next()}},t._getItemIndex=function(t){return this._items=t&&t.parentNode?[].slice.call(t.parentNode.querySelectorAll(et)):[],this._items.indexOf(t)},t._getItemByDirection=function(t,e){var n=t===W,i=t===q,o=this._getItemIndex(e),r=this._items.length-1;if((i&&0===o||n&&o===r)&&!this._config.wrap)return e;var s=(o+(t===q?-1:1))%this._items.length;return-1===s?this._items[this._items.length-1]:this._items[s]},t._triggerSlideEvent=function(t,e){var n=this._getItemIndex(t),i=this._getItemIndex(this._element.querySelector(tt)),o=g.Event(Q.SLIDE,{relatedTarget:t,direction:e,from:i,to:n});return g(this._element).trigger(o),o},t._setActiveIndicatorElement=function(t){if(this._indicatorsElement){var e=[].slice.call(this._indicatorsElement.querySelectorAll(Z));g(e).removeClass(V);var n=this._indicatorsElement.children[this._getItemIndex(t)];n&&g(n).addClass(V)}},t._slide=function(t,e){var n,i,o,r=this,s=this._element.querySelector(tt),a=this._getItemIndex(s),l=e||s&&this._getItemByDirection(t,s),c=this._getItemIndex(l),h=Boolean(this._interval);if(o=t===W?(n=X,i=$,M):(n=z,i=G,K),l&&g(l).hasClass(V))this._isSliding=!1;else if(!this._triggerSlideEvent(l,o).isDefaultPrevented()&&s&&l){this._isSliding=!0,h&&this.pause(),this._setActiveIndicatorElement(l);var u=g.Event(Q.SLID,{relatedTarget:l,direction:o,from:a,to:c});if(g(this._element).hasClass(Y)){g(l).addClass(i),_.reflow(l),g(s).addClass(n),g(l).addClass(n);var f=parseInt(l.getAttribute("data-interval"),10);this._config.interval=f?(this._config.defaultInterval=this._config.defaultInterval||this._config.interval,f):this._config.defaultInterval||this._config.interval;var d=_.getTransitionDurationFromElement(s);g(s).one(_.TRANSITION_END,function(){g(l).removeClass(n+" "+i).addClass(V),g(s).removeClass(V+" "+i+" "+n),r._isSliding=!1,setTimeout(function(){return g(r._element).trigger(u)},0)}).emulateTransitionEnd(d)}else g(s).removeClass(V),g(l).addClass(V),this._isSliding=!1,g(this._element).trigger(u);h&&this.cycle()}},r._jQueryInterface=function(i){return this.each(function(){var t=g(this).data(j),e=l({},F,g(this).data());"object"==typeof i&&(e=l({},e,i));var n="string"==typeof i?i:e.slide;if(t||(t=new r(this,e),g(this).data(j,t)),"number"==typeof i)t.to(i);else if("string"==typeof n){if("undefined"==typeof t[n])throw new TypeError('No method named "'+n+'"');t[n]()}else e.interval&&e.ride&&(t.pause(),t.cycle())})},r._dataApiClickHandler=function(t){var e=_.getSelectorFromElement(this);if(e){var n=g(e)[0];if(n&&g(n).hasClass(B)){var i=l({},g(n).data(),g(this).data()),o=this.getAttribute("data-slide-to");o&&(i.interval=!1),r._jQueryInterface.call(g(n),i),o&&g(n).data(j).to(o),t.preventDefault()}}},s(r,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return F}}]),r}();g(document).on(Q.CLICK_DATA_API,rt,lt._dataApiClickHandler),g(window).on(Q.LOAD_DATA_API,function(){for(var t=[].slice.call(document.querySelectorAll(st)),e=0,n=t.length;e<n;e++){var i=g(t[e]);lt._jQueryInterface.call(i,i.data())}}),g.fn[L]=lt._jQueryInterface,g.fn[L].Constructor=lt,g.fn[L].noConflict=function(){return g.fn[L]=x,lt._jQueryInterface};var ct="collapse",ht="bs.collapse",ut="."+ht,ft=g.fn[ct],dt={toggle:!0,parent:""},gt={toggle:"boolean",parent:"(string|element)"},_t={SHOW:"show"+ut,SHOWN:"shown"+ut,HIDE:"hide"+ut,HIDDEN:"hidden"+ut,CLICK_DATA_API:"click"+ut+".data-api"},mt="show",pt="collapse",vt="collapsing",yt="collapsed",Et="width",Ct="height",Tt=".show, .collapsing",St='[data-toggle="collapse"]',bt=function(){function a(e,t){this._isTransitioning=!1,this._element=e,this._config=this._getConfig(t),this._triggerArray=[].slice.call(document.querySelectorAll('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'));for(var n=[].slice.call(document.querySelectorAll(St)),i=0,o=n.length;i<o;i++){var r=n[i],s=_.getSelectorFromElement(r),a=[].slice.call(document.querySelectorAll(s)).filter(function(t){return t===e});null!==s&&0<a.length&&(this._selector=s,this._triggerArray.push(r))}this._parent=this._config.parent?this._getParent():null,this._config.parent||this._addAriaAndCollapsedClass(this._element,this._triggerArray),this._config.toggle&&this.toggle()}var t=a.prototype;return t.toggle=function(){g(this._element).hasClass(mt)?this.hide():this.show()},t.show=function(){var t,e,n=this;if(!this._isTransitioning&&!g(this._element).hasClass(mt)&&(this._parent&&0===(t=[].slice.call(this._parent.querySelectorAll(Tt)).filter(function(t){return"string"==typeof n._config.parent?t.getAttribute("data-parent")===n._config.parent:t.classList.contains(pt)})).length&&(t=null),!(t&&(e=g(t).not(this._selector).data(ht))&&e._isTransitioning))){var i=g.Event(_t.SHOW);if(g(this._element).trigger(i),!i.isDefaultPrevented()){t&&(a._jQueryInterface.call(g(t).not(this._selector),"hide"),e||g(t).data(ht,null));var o=this._getDimension();g(this._element).removeClass(pt).addClass(vt),this._element.style[o]=0,this._triggerArray.length&&g(this._triggerArray).removeClass(yt).attr("aria-expanded",!0),this.setTransitioning(!0);var r="scroll"+(o[0].toUpperCase()+o.slice(1)),s=_.getTransitionDurationFromElement(this._element);g(this._element).one(_.TRANSITION_END,function(){g(n._element).removeClass(vt).addClass(pt).addClass(mt),n._element.style[o]="",n.setTransitioning(!1),g(n._element).trigger(_t.SHOWN)}).emulateTransitionEnd(s),this._element.style[o]=this._element[r]+"px"}}},t.hide=function(){var t=this;if(!this._isTransitioning&&g(this._element).hasClass(mt)){var e=g.Event(_t.HIDE);if(g(this._element).trigger(e),!e.isDefaultPrevented()){var n=this._getDimension();this._element.style[n]=this._element.getBoundingClientRect()[n]+"px",_.reflow(this._element),g(this._element).addClass(vt).removeClass(pt).removeClass(mt);var i=this._triggerArray.length;if(0<i)for(var o=0;o<i;o++){var r=this._triggerArray[o],s=_.getSelectorFromElement(r);if(null!==s)g([].slice.call(document.querySelectorAll(s))).hasClass(mt)||g(r).addClass(yt).attr("aria-expanded",!1)}this.setTransitioning(!0);this._element.style[n]="";var a=_.getTransitionDurationFromElement(this._element);g(this._element).one(_.TRANSITION_END,function(){t.setTransitioning(!1),g(t._element).removeClass(vt).addClass(pt).trigger(_t.HIDDEN)}).emulateTransitionEnd(a)}}},t.setTransitioning=function(t){this._isTransitioning=t},t.dispose=function(){g.removeData(this._element,ht),this._config=null,this._parent=null,this._element=null,this._triggerArray=null,this._isTransitioning=null},t._getConfig=function(t){return(t=l({},dt,t)).toggle=Boolean(t.toggle),_.typeCheckConfig(ct,t,gt),t},t._getDimension=function(){return g(this._element).hasClass(Et)?Et:Ct},t._getParent=function(){var t,n=this;_.isElement(this._config.parent)?(t=this._config.parent,"undefined"!=typeof this._config.parent.jquery&&(t=this._config.parent[0])):t=document.querySelector(this._config.parent);var e='[data-toggle="collapse"][data-parent="'+this._config.parent+'"]',i=[].slice.call(t.querySelectorAll(e));return g(i).each(function(t,e){n._addAriaAndCollapsedClass(a._getTargetFromElement(e),[e])}),t},t._addAriaAndCollapsedClass=function(t,e){var n=g(t).hasClass(mt);e.length&&g(e).toggleClass(yt,!n).attr("aria-expanded",n)},a._getTargetFromElement=function(t){var e=_.getSelectorFromElement(t);return e?document.querySelector(e):null},a._jQueryInterface=function(i){return this.each(function(){var t=g(this),e=t.data(ht),n=l({},dt,t.data(),"object"==typeof i&&i?i:{});if(!e&&n.toggle&&/show|hide/.test(i)&&(n.toggle=!1),e||(e=new a(this,n),t.data(ht,e)),"string"==typeof i){if("undefined"==typeof e[i])throw new TypeError('No method named "'+i+'"');e[i]()}})},s(a,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return dt}}]),a}();g(document).on(_t.CLICK_DATA_API,St,function(t){"A"===t.currentTarget.tagName&&t.preventDefault();var n=g(this),e=_.getSelectorFromElement(this),i=[].slice.call(document.querySelectorAll(e));g(i).each(function(){var t=g(this),e=t.data(ht)?"toggle":n.data();bt._jQueryInterface.call(t,e)})}),g.fn[ct]=bt._jQueryInterface,g.fn[ct].Constructor=bt,g.fn[ct].noConflict=function(){return g.fn[ct]=ft,bt._jQueryInterface};var It="dropdown",Dt="bs.dropdown",wt="."+Dt,At=".data-api",Nt=g.fn[It],Ot=new RegExp("38|40|27"),kt={HIDE:"hide"+wt,HIDDEN:"hidden"+wt,SHOW:"show"+wt,SHOWN:"shown"+wt,CLICK:"click"+wt,CLICK_DATA_API:"click"+wt+At,KEYDOWN_DATA_API:"keydown"+wt+At,KEYUP_DATA_API:"keyup"+wt+At},Pt="disabled",Lt="show",jt="dropup",Ht="dropright",Rt="dropleft",xt="dropdown-menu-right",Ft="position-static",Ut='[data-toggle="dropdown"]',Wt=".dropdown form",qt=".dropdown-menu",Mt=".navbar-nav",Kt=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",Qt="top-start",Bt="top-end",Vt="bottom-start",Yt="bottom-end",zt="right-start",Xt="left-start",$t={offset:0,flip:!0,boundary:"scrollParent",reference:"toggle",display:"dynamic"},Gt={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)",reference:"(string|element)",display:"string"},Jt=function(){function c(t,e){this._element=t,this._popper=null,this._config=this._getConfig(e),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}var t=c.prototype;return t.toggle=function(){if(!this._element.disabled&&!g(this._element).hasClass(Pt)){var t=c._getParentFromElement(this._element),e=g(this._menu).hasClass(Lt);if(c._clearMenus(),!e){var n={relatedTarget:this._element},i=g.Event(kt.SHOW,n);if(g(t).trigger(i),!i.isDefaultPrevented()){if(!this._inNavbar){if("undefined"==typeof u)throw new TypeError("Bootstrap's dropdowns require Popper.js (https://popper.js.org/)");var o=this._element;"parent"===this._config.reference?o=t:_.isElement(this._config.reference)&&(o=this._config.reference,"undefined"!=typeof this._config.reference.jquery&&(o=this._config.reference[0])),"scrollParent"!==this._config.boundary&&g(t).addClass(Ft),this._popper=new u(o,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===g(t).closest(Mt).length&&g(document.body).children().on("mouseover",null,g.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),g(this._menu).toggleClass(Lt),g(t).toggleClass(Lt).trigger(g.Event(kt.SHOWN,n))}}}},t.show=function(){if(!(this._element.disabled||g(this._element).hasClass(Pt)||g(this._menu).hasClass(Lt))){var t={relatedTarget:this._element},e=g.Event(kt.SHOW,t),n=c._getParentFromElement(this._element);g(n).trigger(e),e.isDefaultPrevented()||(g(this._menu).toggleClass(Lt),g(n).toggleClass(Lt).trigger(g.Event(kt.SHOWN,t)))}},t.hide=function(){if(!this._element.disabled&&!g(this._element).hasClass(Pt)&&g(this._menu).hasClass(Lt)){var t={relatedTarget:this._element},e=g.Event(kt.HIDE,t),n=c._getParentFromElement(this._element);g(n).trigger(e),e.isDefaultPrevented()||(g(this._menu).toggleClass(Lt),g(n).toggleClass(Lt).trigger(g.Event(kt.HIDDEN,t)))}},t.dispose=function(){g.removeData(this._element,Dt),g(this._element).off(wt),this._element=null,(this._menu=null)!==this._popper&&(this._popper.destroy(),this._popper=null)},t.update=function(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()},t._addEventListeners=function(){var e=this;g(this._element).on(kt.CLICK,function(t){t.preventDefault(),t.stopPropagation(),e.toggle()})},t._getConfig=function(t){return t=l({},this.constructor.Default,g(this._element).data(),t),_.typeCheckConfig(It,t,this.constructor.DefaultType),t},t._getMenuElement=function(){if(!this._menu){var t=c._getParentFromElement(this._element);t&&(this._menu=t.querySelector(qt))}return this._menu},t._getPlacement=function(){var t=g(this._element.parentNode),e=Vt;return t.hasClass(jt)?(e=Qt,g(this._menu).hasClass(xt)&&(e=Bt)):t.hasClass(Ht)?e=zt:t.hasClass(Rt)?e=Xt:g(this._menu).hasClass(xt)&&(e=Yt),e},t._detectNavbar=function(){return 0<g(this._element).closest(".navbar").length},t._getOffset=function(){var e=this,t={};return"function"==typeof this._config.offset?t.fn=function(t){return t.offsets=l({},t.offsets,e._config.offset(t.offsets,e._element)||{}),t}:t.offset=this._config.offset,t},t._getPopperConfig=function(){var t={placement:this._getPlacement(),modifiers:{offset:this._getOffset(),flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}};return"static"===this._config.display&&(t.modifiers.applyStyle={enabled:!1}),t},c._jQueryInterface=function(e){return this.each(function(){var t=g(this).data(Dt);if(t||(t=new c(this,"object"==typeof e?e:null),g(this).data(Dt,t)),"string"==typeof e){if("undefined"==typeof t[e])throw new TypeError('No method named "'+e+'"');t[e]()}})},c._clearMenus=function(t){if(!t||3!==t.which&&("keyup"!==t.type||9===t.which))for(var e=[].slice.call(document.querySelectorAll(Ut)),n=0,i=e.length;n<i;n++){var o=c._getParentFromElement(e[n]),r=g(e[n]).data(Dt),s={relatedTarget:e[n]};if(t&&"click"===t.type&&(s.clickEvent=t),r){var a=r._menu;if(g(o).hasClass(Lt)&&!(t&&("click"===t.type&&/input|textarea/i.test(t.target.tagName)||"keyup"===t.type&&9===t.which)&&g.contains(o,t.target))){var l=g.Event(kt.HIDE,s);g(o).trigger(l),l.isDefaultPrevented()||("ontouchstart"in document.documentElement&&g(document.body).children().off("mouseover",null,g.noop),e[n].setAttribute("aria-expanded","false"),g(a).removeClass(Lt),g(o).removeClass(Lt).trigger(g.Event(kt.HIDDEN,s)))}}}},c._getParentFromElement=function(t){var e,n=_.getSelectorFromElement(t);return n&&(e=document.querySelector(n)),e||t.parentNode},c._dataApiKeydownHandler=function(t){if((/input|textarea/i.test(t.target.tagName)?!(32===t.which||27!==t.which&&(40!==t.which&&38!==t.which||g(t.target).closest(qt).length)):Ot.test(t.which))&&(t.preventDefault(),t.stopPropagation(),!this.disabled&&!g(this).hasClass(Pt))){var e=c._getParentFromElement(this),n=g(e).hasClass(Lt);if(n&&(!n||27!==t.which&&32!==t.which)){var i=[].slice.call(e.querySelectorAll(Kt));if(0!==i.length){var o=i.indexOf(t.target);38===t.which&&0<o&&o--,40===t.which&&o<i.length-1&&o++,o<0&&(o=0),i[o].focus()}}else{if(27===t.which){var r=e.querySelector(Ut);g(r).trigger("focus")}g(this).trigger("click")}}},s(c,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return $t}},{key:"DefaultType",get:function(){return Gt}}]),c}();g(document).on(kt.KEYDOWN_DATA_API,Ut,Jt._dataApiKeydownHandler).on(kt.KEYDOWN_DATA_API,qt,Jt._dataApiKeydownHandler).on(kt.CLICK_DATA_API+" "+kt.KEYUP_DATA_API,Jt._clearMenus).on(kt.CLICK_DATA_API,Ut,function(t){t.preventDefault(),t.stopPropagation(),Jt._jQueryInterface.call(g(this),"toggle")}).on(kt.CLICK_DATA_API,Wt,function(t){t.stopPropagation()}),g.fn[It]=Jt._jQueryInterface,g.fn[It].Constructor=Jt,g.fn[It].noConflict=function(){return g.fn[It]=Nt,Jt._jQueryInterface};var Zt="modal",te="bs.modal",ee="."+te,ne=g.fn[Zt],ie={backdrop:!0,keyboard:!0,focus:!0,show:!0},oe={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean",show:"boolean"},re={HIDE:"hide"+ee,HIDDEN:"hidden"+ee,SHOW:"show"+ee,SHOWN:"shown"+ee,FOCUSIN:"focusin"+ee,RESIZE:"resize"+ee,CLICK_DISMISS:"click.dismiss"+ee,KEYDOWN_DISMISS:"keydown.dismiss"+ee,MOUSEUP_DISMISS:"mouseup.dismiss"+ee,MOUSEDOWN_DISMISS:"mousedown.dismiss"+ee,CLICK_DATA_API:"click"+ee+".data-api"},se="modal-dialog-scrollable",ae="modal-scrollbar-measure",le="modal-backdrop",ce="modal-open",he="fade",ue="show",fe=".modal-dialog",de=".modal-body",ge='[data-toggle="modal"]',_e='[data-dismiss="modal"]',me=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",pe=".sticky-top",ve=function(){function o(t,e){this._config=this._getConfig(e),this._element=t,this._dialog=t.querySelector(fe),this._backdrop=null,this._isShown=!1,this._isBodyOverflowing=!1,this._ignoreBackdropClick=!1,this._isTransitioning=!1,this._scrollbarWidth=0}var t=o.prototype;return t.toggle=function(t){return this._isShown?this.hide():this.show(t)},t.show=function(t){var e=this;if(!this._isShown&&!this._isTransitioning){g(this._element).hasClass(he)&&(this._isTransitioning=!0);var n=g.Event(re.SHOW,{relatedTarget:t});g(this._element).trigger(n),this._isShown||n.isDefaultPrevented()||(this._isShown=!0,this._checkScrollbar(),this._setScrollbar(),this._adjustDialog(),this._setEscapeEvent(),this._setResizeEvent(),g(this._element).on(re.CLICK_DISMISS,_e,function(t){return e.hide(t)}),g(this._dialog).on(re.MOUSEDOWN_DISMISS,function(){g(e._element).one(re.MOUSEUP_DISMISS,function(t){g(t.target).is(e._element)&&(e._ignoreBackdropClick=!0)})}),this._showBackdrop(function(){return e._showElement(t)}))}},t.hide=function(t){var e=this;if(t&&t.preventDefault(),this._isShown&&!this._isTransitioning){var n=g.Event(re.HIDE);if(g(this._element).trigger(n),this._isShown&&!n.isDefaultPrevented()){this._isShown=!1;var i=g(this._element).hasClass(he);if(i&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),g(document).off(re.FOCUSIN),g(this._element).removeClass(ue),g(this._element).off(re.CLICK_DISMISS),g(this._dialog).off(re.MOUSEDOWN_DISMISS),i){var o=_.getTransitionDurationFromElement(this._element);g(this._element).one(_.TRANSITION_END,function(t){return e._hideModal(t)}).emulateTransitionEnd(o)}else this._hideModal()}}},t.dispose=function(){[window,this._element,this._dialog].forEach(function(t){return g(t).off(ee)}),g(document).off(re.FOCUSIN),g.removeData(this._element,te),this._config=null,this._element=null,this._dialog=null,this._backdrop=null,this._isShown=null,this._isBodyOverflowing=null,this._ignoreBackdropClick=null,this._isTransitioning=null,this._scrollbarWidth=null},t.handleUpdate=function(){this._adjustDialog()},t._getConfig=function(t){return t=l({},ie,t),_.typeCheckConfig(Zt,t,oe),t},t._showElement=function(t){var e=this,n=g(this._element).hasClass(he);this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.appendChild(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),g(this._dialog).hasClass(se)?this._dialog.querySelector(de).scrollTop=0:this._element.scrollTop=0,n&&_.reflow(this._element),g(this._element).addClass(ue),this._config.focus&&this._enforceFocus();var i=g.Event(re.SHOWN,{relatedTarget:t}),o=function(){e._config.focus&&e._element.focus(),e._isTransitioning=!1,g(e._element).trigger(i)};if(n){var r=_.getTransitionDurationFromElement(this._dialog);g(this._dialog).one(_.TRANSITION_END,o).emulateTransitionEnd(r)}else o()},t._enforceFocus=function(){var e=this;g(document).off(re.FOCUSIN).on(re.FOCUSIN,function(t){document!==t.target&&e._element!==t.target&&0===g(e._element).has(t.target).length&&e._element.focus()})},t._setEscapeEvent=function(){var e=this;this._isShown&&this._config.keyboard?g(this._element).on(re.KEYDOWN_DISMISS,function(t){27===t.which&&(t.preventDefault(),e.hide())}):this._isShown||g(this._element).off(re.KEYDOWN_DISMISS)},t._setResizeEvent=function(){var e=this;this._isShown?g(window).on(re.RESIZE,function(t){return e.handleUpdate(t)}):g(window).off(re.RESIZE)},t._hideModal=function(){var t=this;this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._isTransitioning=!1,this._showBackdrop(function(){g(document.body).removeClass(ce),t._resetAdjustments(),t._resetScrollbar(),g(t._element).trigger(re.HIDDEN)})},t._removeBackdrop=function(){this._backdrop&&(g(this._backdrop).remove(),this._backdrop=null)},t._showBackdrop=function(t){var e=this,n=g(this._element).hasClass(he)?he:"";if(this._isShown&&this._config.backdrop){if(this._backdrop=document.createElement("div"),this._backdrop.className=le,n&&this._backdrop.classList.add(n),g(this._backdrop).appendTo(document.body),g(this._element).on(re.CLICK_DISMISS,function(t){e._ignoreBackdropClick?e._ignoreBackdropClick=!1:t.target===t.currentTarget&&("static"===e._config.backdrop?e._element.focus():e.hide())}),n&&_.reflow(this._backdrop),g(this._backdrop).addClass(ue),!t)return;if(!n)return void t();var i=_.getTransitionDurationFromElement(this._backdrop);g(this._backdrop).one(_.TRANSITION_END,t).emulateTransitionEnd(i)}else if(!this._isShown&&this._backdrop){g(this._backdrop).removeClass(ue);var o=function(){e._removeBackdrop(),t&&t()};if(g(this._element).hasClass(he)){var r=_.getTransitionDurationFromElement(this._backdrop);g(this._backdrop).one(_.TRANSITION_END,o).emulateTransitionEnd(r)}else o()}else t&&t()},t._adjustDialog=function(){var t=this._element.scrollHeight>document.documentElement.clientHeight;!this._isBodyOverflowing&&t&&(this._element.style.paddingLeft=this._scrollbarWidth+"px"),this._isBodyOverflowing&&!t&&(this._element.style.paddingRight=this._scrollbarWidth+"px")},t._resetAdjustments=function(){this._element.style.paddingLeft="",this._element.style.paddingRight=""},t._checkScrollbar=function(){var t=document.body.getBoundingClientRect();this._isBodyOverflowing=t.left+t.right<window.innerWidth,this._scrollbarWidth=this._getScrollbarWidth()},t._setScrollbar=function(){var o=this;if(this._isBodyOverflowing){var t=[].slice.call(document.querySelectorAll(me)),e=[].slice.call(document.querySelectorAll(pe));g(t).each(function(t,e){var n=e.style.paddingRight,i=g(e).css("padding-right");g(e).data("padding-right",n).css("padding-right",parseFloat(i)+o._scrollbarWidth+"px")}),g(e).each(function(t,e){var n=e.style.marginRight,i=g(e).css("margin-right");g(e).data("margin-right",n).css("margin-right",parseFloat(i)-o._scrollbarWidth+"px")});var n=document.body.style.paddingRight,i=g(document.body).css("padding-right");g(document.body).data("padding-right",n).css("padding-right",parseFloat(i)+this._scrollbarWidth+"px")}g(document.body).addClass(ce)},t._resetScrollbar=function(){var t=[].slice.call(document.querySelectorAll(me));g(t).each(function(t,e){var n=g(e).data("padding-right");g(e).removeData("padding-right"),e.style.paddingRight=n||""});var e=[].slice.call(document.querySelectorAll(""+pe));g(e).each(function(t,e){var n=g(e).data("margin-right");"undefined"!=typeof n&&g(e).css("margin-right",n).removeData("margin-right")});var n=g(document.body).data("padding-right");g(document.body).removeData("padding-right"),document.body.style.paddingRight=n||""},t._getScrollbarWidth=function(){var t=document.createElement("div");t.className=ae,document.body.appendChild(t);var e=t.getBoundingClientRect().width-t.clientWidth;return document.body.removeChild(t),e},o._jQueryInterface=function(n,i){return this.each(function(){var t=g(this).data(te),e=l({},ie,g(this).data(),"object"==typeof n&&n?n:{});if(t||(t=new o(this,e),g(this).data(te,t)),"string"==typeof n){if("undefined"==typeof t[n])throw new TypeError('No method named "'+n+'"');t[n](i)}else e.show&&t.show(i)})},s(o,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return ie}}]),o}();g(document).on(re.CLICK_DATA_API,ge,function(t){var e,n=this,i=_.getSelectorFromElement(this);i&&(e=document.querySelector(i));var o=g(e).data(te)?"toggle":l({},g(e).data(),g(this).data());"A"!==this.tagName&&"AREA"!==this.tagName||t.preventDefault();var r=g(e).one(re.SHOW,function(t){t.isDefaultPrevented()||r.one(re.HIDDEN,function(){g(n).is(":visible")&&n.focus()})});ve._jQueryInterface.call(g(e),o,this)}),g.fn[Zt]=ve._jQueryInterface,g.fn[Zt].Constructor=ve,g.fn[Zt].noConflict=function(){return g.fn[Zt]=ne,ve._jQueryInterface};var ye=["background","cite","href","itemtype","longdesc","poster","src","xlink:href"],Ee={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Ce=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,Te=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+/]+=*$/i;function Se(t,s,e){if(0===t.length)return t;if(e&&"function"==typeof e)return e(t);for(var n=(new window.DOMParser).parseFromString(t,"text/html"),a=Object.keys(s),l=[].slice.call(n.body.querySelectorAll("*")),i=function(t,e){var n=l[t],i=n.nodeName.toLowerCase();if(-1===a.indexOf(n.nodeName.toLowerCase()))return n.parentNode.removeChild(n),"continue";var o=[].slice.call(n.attributes),r=[].concat(s["*"]||[],s[i]||[]);o.forEach(function(t){(function(t,e){var n=t.nodeName.toLowerCase();if(-1!==e.indexOf(n))return-1===ye.indexOf(n)||Boolean(t.nodeValue.match(Ce)||t.nodeValue.match(Te));for(var i=e.filter(function(t){return t instanceof RegExp}),o=0,r=i.length;o<r;o++)if(n.match(i[o]))return!0;return!1})(t,r)||n.removeAttribute(t.nodeName)})},o=0,r=l.length;o<r;o++)i(o);return n.body.innerHTML}var be="tooltip",Ie="bs.tooltip",De="."+Ie,we=g.fn[be],Ae="bs-tooltip",Ne=new RegExp("(^|\\s)"+Ae+"\\S+","g"),Oe=["sanitize","whiteList","sanitizeFn"],ke={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(number|string|function)",container:"(string|element|boolean)",fallbackPlacement:"(string|array)",boundary:"(string|element)",sanitize:"boolean",sanitizeFn:"(null|function)",whiteList:"object"},Pe={AUTO:"auto",TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},Le={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:0,container:!1,fallbackPlacement:"flip",boundary:"scrollParent",sanitize:!0,sanitizeFn:null,whiteList:Ee},je="show",He="out",Re={HIDE:"hide"+De,HIDDEN:"hidden"+De,SHOW:"show"+De,SHOWN:"shown"+De,INSERTED:"inserted"+De,CLICK:"click"+De,FOCUSIN:"focusin"+De,FOCUSOUT:"focusout"+De,MOUSEENTER:"mouseenter"+De,MOUSELEAVE:"mouseleave"+De},xe="fade",Fe="show",Ue=".tooltip-inner",We=".arrow",qe="hover",Me="focus",Ke="click",Qe="manual",Be=function(){function i(t,e){if("undefined"==typeof u)throw new TypeError("Bootstrap's tooltips require Popper.js (https://popper.js.org/)");this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this.element=t,this.config=this._getConfig(e),this.tip=null,this._setListeners()}var t=i.prototype;return t.enable=function(){this._isEnabled=!0},t.disable=function(){this._isEnabled=!1},t.toggleEnabled=function(){this._isEnabled=!this._isEnabled},t.toggle=function(t){if(this._isEnabled)if(t){var e=this.constructor.DATA_KEY,n=g(t.currentTarget).data(e);n||(n=new this.constructor(t.currentTarget,this._getDelegateConfig()),g(t.currentTarget).data(e,n)),n._activeTrigger.click=!n._activeTrigger.click,n._isWithActiveTrigger()?n._enter(null,n):n._leave(null,n)}else{if(g(this.getTipElement()).hasClass(Fe))return void this._leave(null,this);this._enter(null,this)}},t.dispose=function(){clearTimeout(this._timeout),g.removeData(this.element,this.constructor.DATA_KEY),g(this.element).off(this.constructor.EVENT_KEY),g(this.element).closest(".modal").off("hide.bs.modal"),this.tip&&g(this.tip).remove(),this._isEnabled=null,this._timeout=null,this._hoverState=null,(this._activeTrigger=null)!==this._popper&&this._popper.destroy(),this._popper=null,this.element=null,this.config=null,this.tip=null},t.show=function(){var e=this;if("none"===g(this.element).css("display"))throw new Error("Please use show on visible elements");var t=g.Event(this.constructor.Event.SHOW);if(this.isWithContent()&&this._isEnabled){g(this.element).trigger(t);var n=_.findShadowRoot(this.element),i=g.contains(null!==n?n:this.element.ownerDocument.documentElement,this.element);if(t.isDefaultPrevented()||!i)return;var o=this.getTipElement(),r=_.getUID(this.constructor.NAME);o.setAttribute("id",r),this.element.setAttribute("aria-describedby",r),this.setContent(),this.config.animation&&g(o).addClass(xe);var s="function"==typeof this.config.placement?this.config.placement.call(this,o,this.element):this.config.placement,a=this._getAttachment(s);this.addAttachmentClass(a);var l=this._getContainer();g(o).data(this.constructor.DATA_KEY,this),g.contains(this.element.ownerDocument.documentElement,this.tip)||g(o).appendTo(l),g(this.element).trigger(this.constructor.Event.INSERTED),this._popper=new u(this.element,o,{placement:a,modifiers:{offset:this._getOffset(),flip:{behavior:this.config.fallbackPlacement},arrow:{element:We},preventOverflow:{boundariesElement:this.config.boundary}},onCreate:function(t){t.originalPlacement!==t.placement&&e._handlePopperPlacementChange(t)},onUpdate:function(t){return e._handlePopperPlacementChange(t)}}),g(o).addClass(Fe),"ontouchstart"in document.documentElement&&g(document.body).children().on("mouseover",null,g.noop);var c=function(){e.config.animation&&e._fixTransition();var t=e._hoverState;e._hoverState=null,g(e.element).trigger(e.constructor.Event.SHOWN),t===He&&e._leave(null,e)};if(g(this.tip).hasClass(xe)){var h=_.getTransitionDurationFromElement(this.tip);g(this.tip).one(_.TRANSITION_END,c).emulateTransitionEnd(h)}else c()}},t.hide=function(t){var e=this,n=this.getTipElement(),i=g.Event(this.constructor.Event.HIDE),o=function(){e._hoverState!==je&&n.parentNode&&n.parentNode.removeChild(n),e._cleanTipClass(),e.element.removeAttribute("aria-describedby"),g(e.element).trigger(e.constructor.Event.HIDDEN),null!==e._popper&&e._popper.destroy(),t&&t()};if(g(this.element).trigger(i),!i.isDefaultPrevented()){if(g(n).removeClass(Fe),"ontouchstart"in document.documentElement&&g(document.body).children().off("mouseover",null,g.noop),this._activeTrigger[Ke]=!1,this._activeTrigger[Me]=!1,this._activeTrigger[qe]=!1,g(this.tip).hasClass(xe)){var r=_.getTransitionDurationFromElement(n);g(n).one(_.TRANSITION_END,o).emulateTransitionEnd(r)}else o();this._hoverState=""}},t.update=function(){null!==this._popper&&this._popper.scheduleUpdate()},t.isWithContent=function(){return Boolean(this.getTitle())},t.addAttachmentClass=function(t){g(this.getTipElement()).addClass(Ae+"-"+t)},t.getTipElement=function(){return this.tip=this.tip||g(this.config.template)[0],this.tip},t.setContent=function(){var t=this.getTipElement();this.setElementContent(g(t.querySelectorAll(Ue)),this.getTitle()),g(t).removeClass(xe+" "+Fe)},t.setElementContent=function(t,e){"object"!=typeof e||!e.nodeType&&!e.jquery?this.config.html?(this.config.sanitize&&(e=Se(e,this.config.whiteList,this.config.sanitizeFn)),t.html(e)):t.text(e):this.config.html?g(e).parent().is(t)||t.empty().append(e):t.text(g(e).text())},t.getTitle=function(){var t=this.element.getAttribute("data-original-title");return t||(t="function"==typeof this.config.title?this.config.title.call(this.element):this.config.title),t},t._getOffset=function(){var e=this,t={};return"function"==typeof this.config.offset?t.fn=function(t){return t.offsets=l({},t.offsets,e.config.offset(t.offsets,e.element)||{}),t}:t.offset=this.config.offset,t},t._getContainer=function(){return!1===this.config.container?document.body:_.isElement(this.config.container)?g(this.config.container):g(document).find(this.config.container)},t._getAttachment=function(t){return Pe[t.toUpperCase()]},t._setListeners=function(){var i=this;this.config.trigger.split(" ").forEach(function(t){if("click"===t)g(i.element).on(i.constructor.Event.CLICK,i.config.selector,function(t){return i.toggle(t)});else if(t!==Qe){var e=t===qe?i.constructor.Event.MOUSEENTER:i.constructor.Event.FOCUSIN,n=t===qe?i.constructor.Event.MOUSELEAVE:i.constructor.Event.FOCUSOUT;g(i.element).on(e,i.config.selector,function(t){return i._enter(t)}).on(n,i.config.selector,function(t){return i._leave(t)})}}),g(this.element).closest(".modal").on("hide.bs.modal",function(){i.element&&i.hide()}),this.config.selector?this.config=l({},this.config,{trigger:"manual",selector:""}):this._fixTitle()},t._fixTitle=function(){var t=typeof this.element.getAttribute("data-original-title");(this.element.getAttribute("title")||"string"!==t)&&(this.element.setAttribute("data-original-title",this.element.getAttribute("title")||""),this.element.setAttribute("title",""))},t._enter=function(t,e){var n=this.constructor.DATA_KEY;(e=e||g(t.currentTarget).data(n))||(e=new this.constructor(t.currentTarget,this._getDelegateConfig()),g(t.currentTarget).data(n,e)),t&&(e._activeTrigger["focusin"===t.type?Me:qe]=!0),g(e.getTipElement()).hasClass(Fe)||e._hoverState===je?e._hoverState=je:(clearTimeout(e._timeout),e._hoverState=je,e.config.delay&&e.config.delay.show?e._timeout=setTimeout(function(){e._hoverState===je&&e.show()},e.config.delay.show):e.show())},t._leave=function(t,e){var n=this.constructor.DATA_KEY;(e=e||g(t.currentTarget).data(n))||(e=new this.constructor(t.currentTarget,this._getDelegateConfig()),g(t.currentTarget).data(n,e)),t&&(e._activeTrigger["focusout"===t.type?Me:qe]=!1),e._isWithActiveTrigger()||(clearTimeout(e._timeout),e._hoverState=He,e.config.delay&&e.config.delay.hide?e._timeout=setTimeout(function(){e._hoverState===He&&e.hide()},e.config.delay.hide):e.hide())},t._isWithActiveTrigger=function(){for(var t in this._activeTrigger)if(this._activeTrigger[t])return!0;return!1},t._getConfig=function(t){var e=g(this.element).data();return Object.keys(e).forEach(function(t){-1!==Oe.indexOf(t)&&delete e[t]}),"number"==typeof(t=l({},this.constructor.Default,e,"object"==typeof t&&t?t:{})).delay&&(t.delay={show:t.delay,hide:t.delay}),"number"==typeof t.title&&(t.title=t.title.toString()),"number"==typeof t.content&&(t.content=t.content.toString()),_.typeCheckConfig(be,t,this.constructor.DefaultType),t.sanitize&&(t.template=Se(t.template,t.whiteList,t.sanitizeFn)),t},t._getDelegateConfig=function(){var t={};if(this.config)for(var e in this.config)this.constructor.Default[e]!==this.config[e]&&(t[e]=this.config[e]);return t},t._cleanTipClass=function(){var t=g(this.getTipElement()),e=t.attr("class").match(Ne);null!==e&&e.length&&t.removeClass(e.join(""))},t._handlePopperPlacementChange=function(t){var e=t.instance;this.tip=e.popper,this._cleanTipClass(),this.addAttachmentClass(this._getAttachment(t.placement))},t._fixTransition=function(){var t=this.getTipElement(),e=this.config.animation;null===t.getAttribute("x-placement")&&(g(t).removeClass(xe),this.config.animation=!1,this.hide(),this.show(),this.config.animation=e)},i._jQueryInterface=function(n){return this.each(function(){var t=g(this).data(Ie),e="object"==typeof n&&n;if((t||!/dispose|hide/.test(n))&&(t||(t=new i(this,e),g(this).data(Ie,t)),"string"==typeof n)){if("undefined"==typeof t[n])throw new TypeError('No method named "'+n+'"');t[n]()}})},s(i,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return Le}},{key:"NAME",get:function(){return be}},{key:"DATA_KEY",get:function(){return Ie}},{key:"Event",get:function(){return Re}},{key:"EVENT_KEY",get:function(){return De}},{key:"DefaultType",get:function(){return ke}}]),i}();g.fn[be]=Be._jQueryInterface,g.fn[be].Constructor=Be,g.fn[be].noConflict=function(){return g.fn[be]=we,Be._jQueryInterface};var Ve="popover",Ye="bs.popover",ze="."+Ye,Xe=g.fn[Ve],$e="bs-popover",Ge=new RegExp("(^|\\s)"+$e+"\\S+","g"),Je=l({},Be.Default,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),Ze=l({},Be.DefaultType,{content:"(string|element|function)"}),tn="fade",en="show",nn=".popover-header",on=".popover-body",rn={HIDE:"hide"+ze,HIDDEN:"hidden"+ze,SHOW:"show"+ze,SHOWN:"shown"+ze,INSERTED:"inserted"+ze,CLICK:"click"+ze,FOCUSIN:"focusin"+ze,FOCUSOUT:"focusout"+ze,MOUSEENTER:"mouseenter"+ze,MOUSELEAVE:"mouseleave"+ze},sn=function(t){var e,n;function i(){return t.apply(this,arguments)||this}n=t,(e=i).prototype=Object.create(n.prototype),(e.prototype.constructor=e).__proto__=n;var o=i.prototype;return o.isWithContent=function(){return this.getTitle()||this._getContent()},o.addAttachmentClass=function(t){g(this.getTipElement()).addClass($e+"-"+t)},o.getTipElement=function(){return this.tip=this.tip||g(this.config.template)[0],this.tip},o.setContent=function(){var t=g(this.getTipElement());this.setElementContent(t.find(nn),this.getTitle());var e=this._getContent();"function"==typeof e&&(e=e.call(this.element)),this.setElementContent(t.find(on),e),t.removeClass(tn+" "+en)},o._getContent=function(){return this.element.getAttribute("data-content")||this.config.content},o._cleanTipClass=function(){var t=g(this.getTipElement()),e=t.attr("class").match(Ge);null!==e&&0<e.length&&t.removeClass(e.join(""))},i._jQueryInterface=function(n){return this.each(function(){var t=g(this).data(Ye),e="object"==typeof n?n:null;if((t||!/dispose|hide/.test(n))&&(t||(t=new i(this,e),g(this).data(Ye,t)),"string"==typeof n)){if("undefined"==typeof t[n])throw new TypeError('No method named "'+n+'"');t[n]()}})},s(i,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return Je}},{key:"NAME",get:function(){return Ve}},{key:"DATA_KEY",get:function(){return Ye}},{key:"Event",get:function(){return rn}},{key:"EVENT_KEY",get:function(){return ze}},{key:"DefaultType",get:function(){return Ze}}]),i}(Be);g.fn[Ve]=sn._jQueryInterface,g.fn[Ve].Constructor=sn,g.fn[Ve].noConflict=function(){return g.fn[Ve]=Xe,sn._jQueryInterface};var an="scrollspy",ln="bs.scrollspy",cn="."+ln,hn=g.fn[an],un={offset:10,method:"auto",target:""},fn={offset:"number",method:"string",target:"(string|element)"},dn={ACTIVATE:"activate"+cn,SCROLL:"scroll"+cn,LOAD_DATA_API:"load"+cn+".data-api"},gn="dropdown-item",_n="active",mn='[data-spy="scroll"]',pn=".nav, .list-group",vn=".nav-link",yn=".nav-item",En=".list-group-item",Cn=".dropdown",Tn=".dropdown-item",Sn=".dropdown-toggle",bn="offset",In="position",Dn=function(){function n(t,e){var n=this;this._element=t,this._scrollElement="BODY"===t.tagName?window:t,this._config=this._getConfig(e),this._selector=this._config.target+" "+vn+","+this._config.target+" "+En+","+this._config.target+" "+Tn,this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,g(this._scrollElement).on(dn.SCROLL,function(t){return n._process(t)}),this.refresh(),this._process()}var t=n.prototype;return t.refresh=function(){var e=this,t=this._scrollElement===this._scrollElement.window?bn:In,o="auto"===this._config.method?t:this._config.method,r=o===In?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight(),[].slice.call(document.querySelectorAll(this._selector)).map(function(t){var e,n=_.getSelectorFromElement(t);if(n&&(e=document.querySelector(n)),e){var i=e.getBoundingClientRect();if(i.width||i.height)return[g(e)[o]().top+r,n]}return null}).filter(function(t){return t}).sort(function(t,e){return t[0]-e[0]}).forEach(function(t){e._offsets.push(t[0]),e._targets.push(t[1])})},t.dispose=function(){g.removeData(this._element,ln),g(this._scrollElement).off(cn),this._element=null,this._scrollElement=null,this._config=null,this._selector=null,this._offsets=null,this._targets=null,this._activeTarget=null,this._scrollHeight=null},t._getConfig=function(t){if("string"!=typeof(t=l({},un,"object"==typeof t&&t?t:{})).target){var e=g(t.target).attr("id");e||(e=_.getUID(an),g(t.target).attr("id",e)),t.target="#"+e}return _.typeCheckConfig(an,t,fn),t},t._getScrollTop=function(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop},t._getScrollHeight=function(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},t._getOffsetHeight=function(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height},t._process=function(){var t=this._getScrollTop()+this._config.offset,e=this._getScrollHeight(),n=this._config.offset+e-this._getOffsetHeight();if(this._scrollHeight!==e&&this.refresh(),n<=t){var i=this._targets[this._targets.length-1];this._activeTarget!==i&&this._activate(i)}else{if(this._activeTarget&&t<this._offsets[0]&&0<this._offsets[0])return this._activeTarget=null,void this._clear();for(var o=this._offsets.length;o--;){this._activeTarget!==this._targets[o]&&t>=this._offsets[o]&&("undefined"==typeof this._offsets[o+1]||t<this._offsets[o+1])&&this._activate(this._targets[o])}}},t._activate=function(e){this._activeTarget=e,this._clear();var t=this._selector.split(",").map(function(t){return t+'[data-target="'+e+'"],'+t+'[href="'+e+'"]'}),n=g([].slice.call(document.querySelectorAll(t.join(","))));n.hasClass(gn)?(n.closest(Cn).find(Sn).addClass(_n),n.addClass(_n)):(n.addClass(_n),n.parents(pn).prev(vn+", "+En).addClass(_n),n.parents(pn).prev(yn).children(vn).addClass(_n)),g(this._scrollElement).trigger(dn.ACTIVATE,{relatedTarget:e})},t._clear=function(){[].slice.call(document.querySelectorAll(this._selector)).filter(function(t){return t.classList.contains(_n)}).forEach(function(t){return t.classList.remove(_n)})},n._jQueryInterface=function(e){return this.each(function(){var t=g(this).data(ln);if(t||(t=new n(this,"object"==typeof e&&e),g(this).data(ln,t)),"string"==typeof e){if("undefined"==typeof t[e])throw new TypeError('No method named "'+e+'"');t[e]()}})},s(n,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"Default",get:function(){return un}}]),n}();g(window).on(dn.LOAD_DATA_API,function(){for(var t=[].slice.call(document.querySelectorAll(mn)),e=t.length;e--;){var n=g(t[e]);Dn._jQueryInterface.call(n,n.data())}}),g.fn[an]=Dn._jQueryInterface,g.fn[an].Constructor=Dn,g.fn[an].noConflict=function(){return g.fn[an]=hn,Dn._jQueryInterface};var wn="bs.tab",An="."+wn,Nn=g.fn.tab,On={HIDE:"hide"+An,HIDDEN:"hidden"+An,SHOW:"show"+An,SHOWN:"shown"+An,CLICK_DATA_API:"click"+An+".data-api"},kn="dropdown-menu",Pn="active",Ln="disabled",jn="fade",Hn="show",Rn=".dropdown",xn=".nav, .list-group",Fn=".active",Un="> li > .active",Wn='[data-toggle="tab"], [data-toggle="pill"], [data-toggle="list"]',qn=".dropdown-toggle",Mn="> .dropdown-menu .active",Kn=function(){function i(t){this._element=t}var t=i.prototype;return t.show=function(){var n=this;if(!(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&g(this._element).hasClass(Pn)||g(this._element).hasClass(Ln))){var t,i,e=g(this._element).closest(xn)[0],o=_.getSelectorFromElement(this._element);if(e){var r="UL"===e.nodeName||"OL"===e.nodeName?Un:Fn;i=(i=g.makeArray(g(e).find(r)))[i.length-1]}var s=g.Event(On.HIDE,{relatedTarget:this._element}),a=g.Event(On.SHOW,{relatedTarget:i});if(i&&g(i).trigger(s),g(this._element).trigger(a),!a.isDefaultPrevented()&&!s.isDefaultPrevented()){o&&(t=document.querySelector(o)),this._activate(this._element,e);var l=function(){var t=g.Event(On.HIDDEN,{relatedTarget:n._element}),e=g.Event(On.SHOWN,{relatedTarget:i});g(i).trigger(t),g(n._element).trigger(e)};t?this._activate(t,t.parentNode,l):l()}}},t.dispose=function(){g.removeData(this._element,wn),this._element=null},t._activate=function(t,e,n){var i=this,o=(!e||"UL"!==e.nodeName&&"OL"!==e.nodeName?g(e).children(Fn):g(e).find(Un))[0],r=n&&o&&g(o).hasClass(jn),s=function(){return i._transitionComplete(t,o,n)};if(o&&r){var a=_.getTransitionDurationFromElement(o);g(o).removeClass(Hn).one(_.TRANSITION_END,s).emulateTransitionEnd(a)}else s()},t._transitionComplete=function(t,e,n){if(e){g(e).removeClass(Pn);var i=g(e.parentNode).find(Mn)[0];i&&g(i).removeClass(Pn),"tab"===e.getAttribute("role")&&e.setAttribute("aria-selected",!1)}if(g(t).addClass(Pn),"tab"===t.getAttribute("role")&&t.setAttribute("aria-selected",!0),_.reflow(t),t.classList.contains(jn)&&t.classList.add(Hn),t.parentNode&&g(t.parentNode).hasClass(kn)){var o=g(t).closest(Rn)[0];if(o){var r=[].slice.call(o.querySelectorAll(qn));g(r).addClass(Pn)}t.setAttribute("aria-expanded",!0)}n&&n()},i._jQueryInterface=function(n){return this.each(function(){var t=g(this),e=t.data(wn);if(e||(e=new i(this),t.data(wn,e)),"string"==typeof n){if("undefined"==typeof e[n])throw new TypeError('No method named "'+n+'"');e[n]()}})},s(i,null,[{key:"VERSION",get:function(){return"4.3.1"}}]),i}();g(document).on(On.CLICK_DATA_API,Wn,function(t){t.preventDefault(),Kn._jQueryInterface.call(g(this),"show")}),g.fn.tab=Kn._jQueryInterface,g.fn.tab.Constructor=Kn,g.fn.tab.noConflict=function(){return g.fn.tab=Nn,Kn._jQueryInterface};var Qn="toast",Bn="bs.toast",Vn="."+Bn,Yn=g.fn[Qn],zn={CLICK_DISMISS:"click.dismiss"+Vn,HIDE:"hide"+Vn,HIDDEN:"hidden"+Vn,SHOW:"show"+Vn,SHOWN:"shown"+Vn},Xn="fade",$n="hide",Gn="show",Jn="showing",Zn={animation:"boolean",autohide:"boolean",delay:"number"},ti={animation:!0,autohide:!0,delay:500},ei='[data-dismiss="toast"]',ni=function(){function i(t,e){this._element=t,this._config=this._getConfig(e),this._timeout=null,this._setListeners()}var t=i.prototype;return t.show=function(){var t=this;g(this._element).trigger(zn.SHOW),this._config.animation&&this._element.classList.add(Xn);var e=function(){t._element.classList.remove(Jn),t._element.classList.add(Gn),g(t._element).trigger(zn.SHOWN),t._config.autohide&&t.hide()};if(this._element.classList.remove($n),this._element.classList.add(Jn),this._config.animation){var n=_.getTransitionDurationFromElement(this._element);g(this._element).one(_.TRANSITION_END,e).emulateTransitionEnd(n)}else e()},t.hide=function(t){var e=this;this._element.classList.contains(Gn)&&(g(this._element).trigger(zn.HIDE),t?this._close():this._timeout=setTimeout(function(){e._close()},this._config.delay))},t.dispose=function(){clearTimeout(this._timeout),this._timeout=null,this._element.classList.contains(Gn)&&this._element.classList.remove(Gn),g(this._element).off(zn.CLICK_DISMISS),g.removeData(this._element,Bn),this._element=null,this._config=null},t._getConfig=function(t){return t=l({},ti,g(this._element).data(),"object"==typeof t&&t?t:{}),_.typeCheckConfig(Qn,t,this.constructor.DefaultType),t},t._setListeners=function(){var t=this;g(this._element).on(zn.CLICK_DISMISS,ei,function(){return t.hide(!0)})},t._close=function(){var t=this,e=function(){t._element.classList.add($n),g(t._element).trigger(zn.HIDDEN)};if(this._element.classList.remove(Gn),this._config.animation){var n=_.getTransitionDurationFromElement(this._element);g(this._element).one(_.TRANSITION_END,e).emulateTransitionEnd(n)}else e()},i._jQueryInterface=function(n){return this.each(function(){var t=g(this),e=t.data(Bn);if(e||(e=new i(this,"object"==typeof n&&n),t.data(Bn,e)),"string"==typeof n){if("undefined"==typeof e[n])throw new TypeError('No method named "'+n+'"');e[n](this)}})},s(i,null,[{key:"VERSION",get:function(){return"4.3.1"}},{key:"DefaultType",get:function(){return Zn}},{key:"Default",get:function(){return ti}}]),i}();g.fn[Qn]=ni._jQueryInterface,g.fn[Qn].Constructor=ni,g.fn[Qn].noConflict=function(){return g.fn[Qn]=Yn,ni._jQueryInterface},function(){if("undefined"==typeof g)throw new TypeError("Bootstrap's JavaScript requires jQuery. jQuery must be included before Bootstrap's JavaScript.");var t=g.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||1===t[0]&&9===t[1]&&t[2]<1||4<=t[0])throw new Error("Bootstrap's JavaScript requires at least jQuery v1.9.1 but less than v4.0.0")}(),t.Util=_,t.Alert=p,t.Button=P,t.Carousel=lt,t.Collapse=bt,t.Dropdown=Jt,t.Modal=ve,t.Popover=sn,t.Scrollspy=Dn,t.Tab=Kn,t.Toast=ni,t.Tooltip=Be,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=bootstrap.min.js.map
/*!
 * Chart.js v2.8.0
 * https://www.chartjs.org
 * (c) 2019 Chart.js Contributors
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(function(){try{return require("moment")}catch(t){}}()):"function"==typeof define&&define.amd?define(["require"],function(t){return e(function(){try{return t("moment")}catch(t){}}())}):t.Chart=e(t.moment)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e={rgb2hsl:i,rgb2hsv:n,rgb2hwb:a,rgb2cmyk:o,rgb2keyword:s,rgb2xyz:l,rgb2lab:d,rgb2lch:function(t){return x(d(t))},hsl2rgb:u,hsl2hsv:function(t){var e=t[0],i=t[1]/100,n=t[2]/100;if(0===n)return[0,0,0];return[e,100*(2*(i*=(n*=2)<=1?n:2-n)/(n+i)),100*((n+i)/2)]},hsl2hwb:function(t){return a(u(t))},hsl2cmyk:function(t){return o(u(t))},hsl2keyword:function(t){return s(u(t))},hsv2rgb:h,hsv2hsl:function(t){var e,i,n=t[0],a=t[1]/100,o=t[2]/100;return e=a*o,[n,100*(e=(e/=(i=(2-a)*o)<=1?i:2-i)||0),100*(i/=2)]},hsv2hwb:function(t){return a(h(t))},hsv2cmyk:function(t){return o(h(t))},hsv2keyword:function(t){return s(h(t))},hwb2rgb:c,hwb2hsl:function(t){return i(c(t))},hwb2hsv:function(t){return n(c(t))},hwb2cmyk:function(t){return o(c(t))},hwb2keyword:function(t){return s(c(t))},cmyk2rgb:f,cmyk2hsl:function(t){return i(f(t))},cmyk2hsv:function(t){return n(f(t))},cmyk2hwb:function(t){return a(f(t))},cmyk2keyword:function(t){return s(f(t))},keyword2rgb:w,keyword2hsl:function(t){return i(w(t))},keyword2hsv:function(t){return n(w(t))},keyword2hwb:function(t){return a(w(t))},keyword2cmyk:function(t){return o(w(t))},keyword2lab:function(t){return d(w(t))},keyword2xyz:function(t){return l(w(t))},xyz2rgb:p,xyz2lab:m,xyz2lch:function(t){return x(m(t))},lab2xyz:v,lab2rgb:y,lab2lch:x,lch2lab:k,lch2xyz:function(t){return v(k(t))},lch2rgb:function(t){return y(k(t))}};function i(t){var e,i,n=t[0]/255,a=t[1]/255,o=t[2]/255,r=Math.min(n,a,o),s=Math.max(n,a,o),l=s-r;return s==r?e=0:n==s?e=(a-o)/l:a==s?e=2+(o-n)/l:o==s&&(e=4+(n-a)/l),(e=Math.min(60*e,360))<0&&(e+=360),i=(r+s)/2,[e,100*(s==r?0:i<=.5?l/(s+r):l/(2-s-r)),100*i]}function n(t){var e,i,n=t[0],a=t[1],o=t[2],r=Math.min(n,a,o),s=Math.max(n,a,o),l=s-r;return i=0==s?0:l/s*1e3/10,s==r?e=0:n==s?e=(a-o)/l:a==s?e=2+(o-n)/l:o==s&&(e=4+(n-a)/l),(e=Math.min(60*e,360))<0&&(e+=360),[e,i,s/255*1e3/10]}function a(t){var e=t[0],n=t[1],a=t[2];return[i(t)[0],100*(1/255*Math.min(e,Math.min(n,a))),100*(a=1-1/255*Math.max(e,Math.max(n,a)))]}function o(t){var e,i=t[0]/255,n=t[1]/255,a=t[2]/255;return[100*((1-i-(e=Math.min(1-i,1-n,1-a)))/(1-e)||0),100*((1-n-e)/(1-e)||0),100*((1-a-e)/(1-e)||0),100*e]}function s(t){return _[JSON.stringify(t)]}function l(t){var e=t[0]/255,i=t[1]/255,n=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.1805*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)),100*(.2126*e+.7152*i+.0722*n),100*(.0193*e+.1192*i+.9505*n)]}function d(t){var e=l(t),i=e[0],n=e[1],a=e[2];return n/=100,a/=108.883,i=(i/=95.047)>.008856?Math.pow(i,1/3):7.787*i+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(i-n),200*(n-(a=a>.008856?Math.pow(a,1/3):7.787*a+16/116))]}function u(t){var e,i,n,a,o,r=t[0]/360,s=t[1]/100,l=t[2]/100;if(0==s)return[o=255*l,o,o];e=2*l-(i=l<.5?l*(1+s):l+s-l*s),a=[0,0,0];for(var d=0;d<3;d++)(n=r+1/3*-(d-1))<0&&n++,n>1&&n--,o=6*n<1?e+6*(i-e)*n:2*n<1?i:3*n<2?e+(i-e)*(2/3-n)*6:e,a[d]=255*o;return a}function h(t){var e=t[0]/60,i=t[1]/100,n=t[2]/100,a=Math.floor(e)%6,o=e-Math.floor(e),r=255*n*(1-i),s=255*n*(1-i*o),l=255*n*(1-i*(1-o));n*=255;switch(a){case 0:return[n,l,r];case 1:return[s,n,r];case 2:return[r,n,l];case 3:return[r,s,n];case 4:return[l,r,n];case 5:return[n,r,s]}}function c(t){var e,i,n,a,o=t[0]/360,s=t[1]/100,l=t[2]/100,d=s+l;switch(d>1&&(s/=d,l/=d),n=6*o-(e=Math.floor(6*o)),0!=(1&e)&&(n=1-n),a=s+n*((i=1-l)-s),e){default:case 6:case 0:r=i,g=a,b=s;break;case 1:r=a,g=i,b=s;break;case 2:r=s,g=i,b=a;break;case 3:r=s,g=a,b=i;break;case 4:r=a,g=s,b=i;break;case 5:r=i,g=s,b=a}return[255*r,255*g,255*b]}function f(t){var e=t[0]/100,i=t[1]/100,n=t[2]/100,a=t[3]/100;return[255*(1-Math.min(1,e*(1-a)+a)),255*(1-Math.min(1,i*(1-a)+a)),255*(1-Math.min(1,n*(1-a)+a))]}function p(t){var e,i,n,a=t[0]/100,o=t[1]/100,r=t[2]/100;return i=-.9689*a+1.8758*o+.0415*r,n=.0557*a+-.204*o+1.057*r,e=(e=3.2406*a+-1.5372*o+-.4986*r)>.0031308?1.055*Math.pow(e,1/2.4)-.055:e*=12.92,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:i*=12.92,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n*=12.92,[255*(e=Math.min(Math.max(0,e),1)),255*(i=Math.min(Math.max(0,i),1)),255*(n=Math.min(Math.max(0,n),1))]}function m(t){var e=t[0],i=t[1],n=t[2];return i/=100,n/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(e-i),200*(i-(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116))]}function v(t){var e,i,n,a,o=t[0],r=t[1],s=t[2];return o<=8?a=(i=100*o/903.3)/100*7.787+16/116:(i=100*Math.pow((o+16)/116,3),a=Math.pow(i/100,1/3)),[e=e/95.047<=.008856?e=95.047*(r/500+a-16/116)/7.787:95.047*Math.pow(r/500+a,3),i,n=n/108.883<=.008859?n=108.883*(a-s/200-16/116)/7.787:108.883*Math.pow(a-s/200,3)]}function x(t){var e,i=t[0],n=t[1],a=t[2];return(e=360*Math.atan2(a,n)/2/Math.PI)<0&&(e+=360),[i,Math.sqrt(n*n+a*a),e]}function y(t){return p(v(t))}function k(t){var e,i=t[0],n=t[1];return e=t[2]/360*2*Math.PI,[i,n*Math.cos(e),n*Math.sin(e)]}function w(t){return M[t]}var M={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},_={};for(var C in M)_[JSON.stringify(M[C])]=C;var S=function(){return new T};for(var P in e){S[P+"Raw"]=function(t){return function(i){return"number"==typeof i&&(i=Array.prototype.slice.call(arguments)),e[t](i)}}(P);var I=/(\w+)2(\w+)/.exec(P),A=I[1],D=I[2];(S[A]=S[A]||{})[D]=S[P]=function(t){return function(i){"number"==typeof i&&(i=Array.prototype.slice.call(arguments));var n=e[t](i);if("string"==typeof n||void 0===n)return n;for(var a=0;a<n.length;a++)n[a]=Math.round(n[a]);return n}}(P)}var T=function(){this.convs={}};T.prototype.routeSpace=function(t,e){var i=e[0];return void 0===i?this.getValues(t):("number"==typeof i&&(i=Array.prototype.slice.call(e)),this.setValues(t,i))},T.prototype.setValues=function(t,e){return this.space=t,this.convs={},this.convs[t]=e,this},T.prototype.getValues=function(t){var e=this.convs[t];if(!e){var i=this.space,n=this.convs[i];e=S[i][t](n),this.convs[t]=e}return e},["rgb","hsl","hsv","cmyk","keyword"].forEach(function(t){T.prototype[t]=function(e){return this.routeSpace(t,arguments)}});var F=S,L={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},R={getRgba:O,getHsla:z,getRgb:function(t){var e=O(t);return e&&e.slice(0,3)},getHsl:function(t){var e=z(t);return e&&e.slice(0,3)},getHwb:B,getAlpha:function(t){var e=O(t);if(e)return e[3];if(e=z(t))return e[3];if(e=B(t))return e[3]},hexString:function(t,e){var e=void 0!==e&&3===t.length?e:t[3];return"#"+H(t[0])+H(t[1])+H(t[2])+(e>=0&&e<1?H(Math.round(255*e)):"")},rgbString:function(t,e){if(e<1||t[3]&&t[3]<1)return N(t,e);return"rgb("+t[0]+", "+t[1]+", "+t[2]+")"},rgbaString:N,percentString:function(t,e){if(e<1||t[3]&&t[3]<1)return W(t,e);var i=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),a=Math.round(t[2]/255*100);return"rgb("+i+"%, "+n+"%, "+a+"%)"},percentaString:W,hslString:function(t,e){if(e<1||t[3]&&t[3]<1)return V(t,e);return"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)"},hslaString:V,hwbString:function(t,e){void 0===e&&(e=void 0!==t[3]?t[3]:1);return"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+(void 0!==e&&1!==e?", "+e:"")+")"},keyword:function(t){return j[t.slice(0,3)]}};function O(t){if(t){var e=[0,0,0],i=1,n=t.match(/^#([a-fA-F0-9]{3,4})$/i),a="";if(n){a=(n=n[1])[3];for(var o=0;o<e.length;o++)e[o]=parseInt(n[o]+n[o],16);a&&(i=Math.round(parseInt(a+a,16)/255*100)/100)}else if(n=t.match(/^#([a-fA-F0-9]{6}([a-fA-F0-9]{2})?)$/i)){a=n[2],n=n[1];for(o=0;o<e.length;o++)e[o]=parseInt(n.slice(2*o,2*o+2),16);a&&(i=Math.round(parseInt(a,16)/255*100)/100)}else if(n=t.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/i)){for(o=0;o<e.length;o++)e[o]=parseInt(n[o+1]);i=parseFloat(n[4])}else if(n=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/i)){for(o=0;o<e.length;o++)e[o]=Math.round(2.55*parseFloat(n[o+1]));i=parseFloat(n[4])}else if(n=t.match(/(\w+)/)){if("transparent"==n[1])return[0,0,0,0];if(!(e=L[n[1]]))return}for(o=0;o<e.length;o++)e[o]=E(e[o],0,255);return i=i||0==i?E(i,0,1):1,e[3]=i,e}}function z(t){if(t){var e=t.match(/^hsla?\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/);if(e){var i=parseFloat(e[4]);return[E(parseInt(e[1]),0,360),E(parseFloat(e[2]),0,100),E(parseFloat(e[3]),0,100),E(isNaN(i)?1:i,0,1)]}}}function B(t){if(t){var e=t.match(/^hwb\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/);if(e){var i=parseFloat(e[4]);return[E(parseInt(e[1]),0,360),E(parseFloat(e[2]),0,100),E(parseFloat(e[3]),0,100),E(isNaN(i)?1:i,0,1)]}}}function N(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")"}function W(t,e){return"rgba("+Math.round(t[0]/255*100)+"%, "+Math.round(t[1]/255*100)+"%, "+Math.round(t[2]/255*100)+"%, "+(e||t[3]||1)+")"}function V(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+e+")"}function E(t,e,i){return Math.min(Math.max(e,t),i)}function H(t){var e=t.toString(16).toUpperCase();return e.length<2?"0"+e:e}var j={};for(var q in L)j[L[q]]=q;var Y=function(t){return t instanceof Y?t:this instanceof Y?(this.valid=!1,this.values={rgb:[0,0,0],hsl:[0,0,0],hsv:[0,0,0],hwb:[0,0,0],cmyk:[0,0,0,0],alpha:1},void("string"==typeof t?(e=R.getRgba(t))?this.setValues("rgb",e):(e=R.getHsla(t))?this.setValues("hsl",e):(e=R.getHwb(t))&&this.setValues("hwb",e):"object"==typeof t&&(void 0!==(e=t).r||void 0!==e.red?this.setValues("rgb",e):void 0!==e.l||void 0!==e.lightness?this.setValues("hsl",e):void 0!==e.v||void 0!==e.value?this.setValues("hsv",e):void 0!==e.w||void 0!==e.whiteness?this.setValues("hwb",e):void 0===e.c&&void 0===e.cyan||this.setValues("cmyk",e)))):new Y(t);var e};Y.prototype={isValid:function(){return this.valid},rgb:function(){return this.setSpace("rgb",arguments)},hsl:function(){return this.setSpace("hsl",arguments)},hsv:function(){return this.setSpace("hsv",arguments)},hwb:function(){return this.setSpace("hwb",arguments)},cmyk:function(){return this.setSpace("cmyk",arguments)},rgbArray:function(){return this.values.rgb},hslArray:function(){return this.values.hsl},hsvArray:function(){return this.values.hsv},hwbArray:function(){var t=this.values;return 1!==t.alpha?t.hwb.concat([t.alpha]):t.hwb},cmykArray:function(){return this.values.cmyk},rgbaArray:function(){var t=this.values;return t.rgb.concat([t.alpha])},hslaArray:function(){var t=this.values;return t.hsl.concat([t.alpha])},alpha:function(t){return void 0===t?this.values.alpha:(this.setValues("alpha",t),this)},red:function(t){return this.setChannel("rgb",0,t)},green:function(t){return this.setChannel("rgb",1,t)},blue:function(t){return this.setChannel("rgb",2,t)},hue:function(t){return t&&(t=(t%=360)<0?360+t:t),this.setChannel("hsl",0,t)},saturation:function(t){return this.setChannel("hsl",1,t)},lightness:function(t){return this.setChannel("hsl",2,t)},saturationv:function(t){return this.setChannel("hsv",1,t)},whiteness:function(t){return this.setChannel("hwb",1,t)},blackness:function(t){return this.setChannel("hwb",2,t)},value:function(t){return this.setChannel("hsv",2,t)},cyan:function(t){return this.setChannel("cmyk",0,t)},magenta:function(t){return this.setChannel("cmyk",1,t)},yellow:function(t){return this.setChannel("cmyk",2,t)},black:function(t){return this.setChannel("cmyk",3,t)},hexString:function(){return R.hexString(this.values.rgb)},rgbString:function(){return R.rgbString(this.values.rgb,this.values.alpha)},rgbaString:function(){return R.rgbaString(this.values.rgb,this.values.alpha)},percentString:function(){return R.percentString(this.values.rgb,this.values.alpha)},hslString:function(){return R.hslString(this.values.hsl,this.values.alpha)},hslaString:function(){return R.hslaString(this.values.hsl,this.values.alpha)},hwbString:function(){return R.hwbString(this.values.hwb,this.values.alpha)},keyword:function(){return R.keyword(this.values.rgb,this.values.alpha)},rgbNumber:function(){var t=this.values.rgb;return t[0]<<16|t[1]<<8|t[2]},luminosity:function(){for(var t=this.values.rgb,e=[],i=0;i<t.length;i++){var n=t[i]/255;e[i]=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),i=t.luminosity();return e>i?(e+.05)/(i+.05):(i+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},dark:function(){var t=this.values.rgb;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},light:function(){return!this.dark()},negate:function(){for(var t=[],e=0;e<3;e++)t[e]=255-this.values.rgb[e];return this.setValues("rgb",t),this},lighten:function(t){var e=this.values.hsl;return e[2]+=e[2]*t,this.setValues("hsl",e),this},darken:function(t){var e=this.values.hsl;return e[2]-=e[2]*t,this.setValues("hsl",e),this},saturate:function(t){var e=this.values.hsl;return e[1]+=e[1]*t,this.setValues("hsl",e),this},desaturate:function(t){var e=this.values.hsl;return e[1]-=e[1]*t,this.setValues("hsl",e),this},whiten:function(t){var e=this.values.hwb;return e[1]+=e[1]*t,this.setValues("hwb",e),this},blacken:function(t){var e=this.values.hwb;return e[2]+=e[2]*t,this.setValues("hwb",e),this},greyscale:function(){var t=this.values.rgb,e=.3*t[0]+.59*t[1]+.11*t[2];return this.setValues("rgb",[e,e,e]),this},clearer:function(t){var e=this.values.alpha;return this.setValues("alpha",e-e*t),this},opaquer:function(t){var e=this.values.alpha;return this.setValues("alpha",e+e*t),this},rotate:function(t){var e=this.values.hsl,i=(e[0]+t)%360;return e[0]=i<0?360+i:i,this.setValues("hsl",e),this},mix:function(t,e){var i=t,n=void 0===e?.5:e,a=2*n-1,o=this.alpha()-i.alpha(),r=((a*o==-1?a:(a+o)/(1+a*o))+1)/2,s=1-r;return this.rgb(r*this.red()+s*i.red(),r*this.green()+s*i.green(),r*this.blue()+s*i.blue()).alpha(this.alpha()*n+i.alpha()*(1-n))},toJSON:function(){return this.rgb()},clone:function(){var t,e,i=new Y,n=this.values,a=i.values;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],"[object Array]"===(e={}.toString.call(t))?a[o]=t.slice(0):"[object Number]"===e?a[o]=t:console.error("unexpected color value:",t));return i}},Y.prototype.spaces={rgb:["red","green","blue"],hsl:["hue","saturation","lightness"],hsv:["hue","saturation","value"],hwb:["hue","whiteness","blackness"],cmyk:["cyan","magenta","yellow","black"]},Y.prototype.maxes={rgb:[255,255,255],hsl:[360,100,100],hsv:[360,100,100],hwb:[360,100,100],cmyk:[100,100,100,100]},Y.prototype.getValues=function(t){for(var e=this.values,i={},n=0;n<t.length;n++)i[t.charAt(n)]=e[t][n];return 1!==e.alpha&&(i.a=e.alpha),i},Y.prototype.setValues=function(t,e){var i,n,a=this.values,o=this.spaces,r=this.maxes,s=1;if(this.valid=!0,"alpha"===t)s=e;else if(e.length)a[t]=e.slice(0,t.length),s=e[t.length];else if(void 0!==e[t.charAt(0)]){for(i=0;i<t.length;i++)a[t][i]=e[t.charAt(i)];s=e.a}else if(void 0!==e[o[t][0]]){var l=o[t];for(i=0;i<t.length;i++)a[t][i]=e[l[i]];s=e.alpha}if(a.alpha=Math.max(0,Math.min(1,void 0===s?a.alpha:s)),"alpha"===t)return!1;for(i=0;i<t.length;i++)n=Math.max(0,Math.min(r[t][i],a[t][i])),a[t][i]=Math.round(n);for(var d in o)d!==t&&(a[d]=F[t][d](a[t]));return!0},Y.prototype.setSpace=function(t,e){var i=e[0];return void 0===i?this.getValues(t):("number"==typeof i&&(i=Array.prototype.slice.call(e)),this.setValues(t,i),this)},Y.prototype.setChannel=function(t,e,i){var n=this.values[t];return void 0===i?n[e]:i===n[e]?this:(n[e]=i,this.setValues(t,n),this)},"undefined"!=typeof window&&(window.Color=Y);var U,X=Y,K={noop:function(){},uid:(U=0,function(){return U++}),isNullOrUndef:function(t){return null==t},isArray:function(t){if(Array.isArray&&Array.isArray(t))return!0;var e=Object.prototype.toString.call(t);return"[object"===e.substr(0,7)&&"Array]"===e.substr(-6)},isObject:function(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)},isFinite:function(t){return("number"==typeof t||t instanceof Number)&&isFinite(t)},valueOrDefault:function(t,e){return void 0===t?e:t},valueAtIndexOrDefault:function(t,e,i){return K.valueOrDefault(K.isArray(t)?t[e]:t,i)},callback:function(t,e,i){if(t&&"function"==typeof t.call)return t.apply(i,e)},each:function(t,e,i,n){var a,o,r;if(K.isArray(t))if(o=t.length,n)for(a=o-1;a>=0;a--)e.call(i,t[a],a);else for(a=0;a<o;a++)e.call(i,t[a],a);else if(K.isObject(t))for(o=(r=Object.keys(t)).length,a=0;a<o;a++)e.call(i,t[r[a]],r[a])},arrayEquals:function(t,e){var i,n,a,o;if(!t||!e||t.length!==e.length)return!1;for(i=0,n=t.length;i<n;++i)if(a=t[i],o=e[i],a instanceof Array&&o instanceof Array){if(!K.arrayEquals(a,o))return!1}else if(a!==o)return!1;return!0},clone:function(t){if(K.isArray(t))return t.map(K.clone);if(K.isObject(t)){for(var e={},i=Object.keys(t),n=i.length,a=0;a<n;++a)e[i[a]]=K.clone(t[i[a]]);return e}return t},_merger:function(t,e,i,n){var a=e[t],o=i[t];K.isObject(a)&&K.isObject(o)?K.merge(a,o,n):e[t]=K.clone(o)},_mergerIf:function(t,e,i){var n=e[t],a=i[t];K.isObject(n)&&K.isObject(a)?K.mergeIf(n,a):e.hasOwnProperty(t)||(e[t]=K.clone(a))},merge:function(t,e,i){var n,a,o,r,s,l=K.isArray(e)?e:[e],d=l.length;if(!K.isObject(t))return t;for(n=(i=i||{}).merger||K._merger,a=0;a<d;++a)if(e=l[a],K.isObject(e))for(s=0,r=(o=Object.keys(e)).length;s<r;++s)n(o[s],t,e,i);return t},mergeIf:function(t,e){return K.merge(t,e,{merger:K._mergerIf})},extend:function(t){for(var e=function(e,i){t[i]=e},i=1,n=arguments.length;i<n;++i)K.each(arguments[i],e);return t},inherits:function(t){var e=this,i=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return e.apply(this,arguments)},n=function(){this.constructor=i};return n.prototype=e.prototype,i.prototype=new n,i.extend=K.inherits,t&&K.extend(i.prototype,t),i.__super__=e.prototype,i}},G=K;K.callCallback=K.callback,K.indexOf=function(t,e,i){return Array.prototype.indexOf.call(t,e,i)},K.getValueOrDefault=K.valueOrDefault,K.getValueAtIndexOrDefault=K.valueAtIndexOrDefault;var Z={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return-t*(t-2)},easeInOutQuad:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return(t-=1)*t*t+1},easeInOutCubic:function(t){return(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return-((t-=1)*t*t*t-1)},easeInOutQuart:function(t){return(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return(t-=1)*t*t*t*t+1},easeInOutQuint:function(t){return(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},easeInSine:function(t){return 1-Math.cos(t*(Math.PI/2))},easeOutSine:function(t){return Math.sin(t*(Math.PI/2))},easeInOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},easeInExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},easeOutExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},easeInOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},easeInCirc:function(t){return t>=1?t:-(Math.sqrt(1-t*t)-1)},easeOutCirc:function(t){return Math.sqrt(1-(t-=1)*t)},easeInOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},easeInElastic:function(t){var e=1.70158,i=0,n=1;return 0===t?0:1===t?1:(i||(i=.3),n<1?(n=1,e=i/4):e=i/(2*Math.PI)*Math.asin(1/n),-n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i))},easeOutElastic:function(t){var e=1.70158,i=0,n=1;return 0===t?0:1===t?1:(i||(i=.3),n<1?(n=1,e=i/4):e=i/(2*Math.PI)*Math.asin(1/n),n*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/i)+1)},easeInOutElastic:function(t){var e=1.70158,i=0,n=1;return 0===t?0:2==(t/=.5)?1:(i||(i=.45),n<1?(n=1,e=i/4):e=i/(2*Math.PI)*Math.asin(1/n),t<1?n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)*-.5:n*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)*.5+1)},easeInBack:function(t){var e=1.70158;return t*t*((e+1)*t-e)},easeOutBack:function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack:function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:function(t){return 1-Z.easeOutBounce(1-t)},easeOutBounce:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInOutBounce:function(t){return t<.5?.5*Z.easeInBounce(2*t):.5*Z.easeOutBounce(2*t-1)+.5}},$={effects:Z};G.easingEffects=Z;var J=Math.PI,Q=J/180,tt=2*J,et=J/2,it=J/4,nt=2*J/3,at={clear:function(t){t.ctx.clearRect(0,0,t.width,t.height)},roundedRect:function(t,e,i,n,a,o){if(o){var r=Math.min(o,a/2,n/2),s=e+r,l=i+r,d=e+n-r,u=i+a-r;t.moveTo(e,l),s<d&&l<u?(t.arc(s,l,r,-J,-et),t.arc(d,l,r,-et,0),t.arc(d,u,r,0,et),t.arc(s,u,r,et,J)):s<d?(t.moveTo(s,i),t.arc(d,l,r,-et,et),t.arc(s,l,r,et,J+et)):l<u?(t.arc(s,l,r,-J,0),t.arc(s,u,r,0,J)):t.arc(s,l,r,-J,J),t.closePath(),t.moveTo(e,i)}else t.rect(e,i,n,a)},drawPoint:function(t,e,i,n,a,o){var r,s,l,d,u,h=(o||0)*Q;if(!e||"object"!=typeof e||"[object HTMLImageElement]"!==(r=e.toString())&&"[object HTMLCanvasElement]"!==r){if(!(isNaN(i)||i<=0)){switch(t.beginPath(),e){default:t.arc(n,a,i,0,tt),t.closePath();break;case"triangle":t.moveTo(n+Math.sin(h)*i,a-Math.cos(h)*i),h+=nt,t.lineTo(n+Math.sin(h)*i,a-Math.cos(h)*i),h+=nt,t.lineTo(n+Math.sin(h)*i,a-Math.cos(h)*i),t.closePath();break;case"rectRounded":d=i-(u=.516*i),s=Math.cos(h+it)*d,l=Math.sin(h+it)*d,t.arc(n-s,a-l,u,h-J,h-et),t.arc(n+l,a-s,u,h-et,h),t.arc(n+s,a+l,u,h,h+et),t.arc(n-l,a+s,u,h+et,h+J),t.closePath();break;case"rect":if(!o){d=Math.SQRT1_2*i,t.rect(n-d,a-d,2*d,2*d);break}h+=it;case"rectRot":s=Math.cos(h)*i,l=Math.sin(h)*i,t.moveTo(n-s,a-l),t.lineTo(n+l,a-s),t.lineTo(n+s,a+l),t.lineTo(n-l,a+s),t.closePath();break;case"crossRot":h+=it;case"cross":s=Math.cos(h)*i,l=Math.sin(h)*i,t.moveTo(n-s,a-l),t.lineTo(n+s,a+l),t.moveTo(n+l,a-s),t.lineTo(n-l,a+s);break;case"star":s=Math.cos(h)*i,l=Math.sin(h)*i,t.moveTo(n-s,a-l),t.lineTo(n+s,a+l),t.moveTo(n+l,a-s),t.lineTo(n-l,a+s),h+=it,s=Math.cos(h)*i,l=Math.sin(h)*i,t.moveTo(n-s,a-l),t.lineTo(n+s,a+l),t.moveTo(n+l,a-s),t.lineTo(n-l,a+s);break;case"line":s=Math.cos(h)*i,l=Math.sin(h)*i,t.moveTo(n-s,a-l),t.lineTo(n+s,a+l);break;case"dash":t.moveTo(n,a),t.lineTo(n+Math.cos(h)*i,a+Math.sin(h)*i)}t.fill(),t.stroke()}}else t.drawImage(e,n-e.width/2,a-e.height/2,e.width,e.height)},_isPointInArea:function(t,e){return t.x>e.left-1e-6&&t.x<e.right+1e-6&&t.y>e.top-1e-6&&t.y<e.bottom+1e-6},clipArea:function(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()},unclipArea:function(t){t.restore()},lineTo:function(t,e,i,n){var a=i.steppedLine;if(a){if("middle"===a){var o=(e.x+i.x)/2;t.lineTo(o,n?i.y:e.y),t.lineTo(o,n?e.y:i.y)}else"after"===a&&!n||"after"!==a&&n?t.lineTo(e.x,i.y):t.lineTo(i.x,e.y);t.lineTo(i.x,i.y)}else i.tension?t.bezierCurveTo(n?e.controlPointPreviousX:e.controlPointNextX,n?e.controlPointPreviousY:e.controlPointNextY,n?i.controlPointNextX:i.controlPointPreviousX,n?i.controlPointNextY:i.controlPointPreviousY,i.x,i.y):t.lineTo(i.x,i.y)}},ot=at;G.clear=at.clear,G.drawRoundedRectangle=function(t){t.beginPath(),at.roundedRect.apply(at,arguments)};var rt={_set:function(t,e){return G.merge(this[t]||(this[t]={}),e)}};rt._set("global",{defaultColor:"rgba(0,0,0,0.1)",defaultFontColor:"#666",defaultFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",defaultFontSize:12,defaultFontStyle:"normal",defaultLineHeight:1.2,showLines:!0});var st=rt,lt=G.valueOrDefault;var dt={toLineHeight:function(t,e){var i=(""+t).match(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/);if(!i||"normal"===i[1])return 1.2*e;switch(t=+i[2],i[3]){case"px":return t;case"%":t/=100}return e*t},toPadding:function(t){var e,i,n,a;return G.isObject(t)?(e=+t.top||0,i=+t.right||0,n=+t.bottom||0,a=+t.left||0):e=i=n=a=+t||0,{top:e,right:i,bottom:n,left:a,height:e+n,width:a+i}},_parseFont:function(t){var e=st.global,i=lt(t.fontSize,e.defaultFontSize),n={family:lt(t.fontFamily,e.defaultFontFamily),lineHeight:G.options.toLineHeight(lt(t.lineHeight,e.defaultLineHeight),i),size:i,style:lt(t.fontStyle,e.defaultFontStyle),weight:null,string:""};return n.string=function(t){return!t||G.isNullOrUndef(t.size)||G.isNullOrUndef(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}(n),n},resolve:function(t,e,i){var n,a,o;for(n=0,a=t.length;n<a;++n)if(void 0!==(o=t[n])&&(void 0!==e&&"function"==typeof o&&(o=o(e)),void 0!==i&&G.isArray(o)&&(o=o[i]),void 0!==o))return o}},ut=G,ht=$,ct=ot,ft=dt;ut.easing=ht,ut.canvas=ct,ut.options=ft;var gt=function(t){ut.extend(this,t),this.initialize.apply(this,arguments)};ut.extend(gt.prototype,{initialize:function(){this.hidden=!1},pivot:function(){var t=this;return t._view||(t._view=ut.clone(t._model)),t._start={},t},transition:function(t){var e=this,i=e._model,n=e._start,a=e._view;return i&&1!==t?(a||(a=e._view={}),n||(n=e._start={}),function(t,e,i,n){var a,o,r,s,l,d,u,h,c,f=Object.keys(i);for(a=0,o=f.length;a<o;++a)if(d=i[r=f[a]],e.hasOwnProperty(r)||(e[r]=d),(s=e[r])!==d&&"_"!==r[0]){if(t.hasOwnProperty(r)||(t[r]=s),(u=typeof d)==typeof(l=t[r]))if("string"===u){if((h=X(l)).valid&&(c=X(d)).valid){e[r]=c.mix(h,n).rgbString();continue}}else if(ut.isFinite(l)&&ut.isFinite(d)){e[r]=l+(d-l)*n;continue}e[r]=d}}(n,a,i,t),e):(e._view=i,e._start=null,e)},tooltipPosition:function(){return{x:this._model.x,y:this._model.y}},hasValue:function(){return ut.isNumber(this._model.x)&&ut.isNumber(this._model.y)}}),gt.extend=ut.inherits;var pt=gt,mt=pt.extend({chart:null,currentStep:0,numSteps:60,easing:"",render:null,onAnimationProgress:null,onAnimationComplete:null}),vt=mt;Object.defineProperty(mt.prototype,"animationObject",{get:function(){return this}}),Object.defineProperty(mt.prototype,"chartInstance",{get:function(){return this.chart},set:function(t){this.chart=t}}),st._set("global",{animation:{duration:1e3,easing:"easeOutQuart",onProgress:ut.noop,onComplete:ut.noop}});var bt={animations:[],request:null,addAnimation:function(t,e,i,n){var a,o,r=this.animations;for(e.chart=t,e.startTime=Date.now(),e.duration=i,n||(t.animating=!0),a=0,o=r.length;a<o;++a)if(r[a].chart===t)return void(r[a]=e);r.push(e),1===r.length&&this.requestAnimationFrame()},cancelAnimation:function(t){var e=ut.findIndex(this.animations,function(e){return e.chart===t});-1!==e&&(this.animations.splice(e,1),t.animating=!1)},requestAnimationFrame:function(){var t=this;null===t.request&&(t.request=ut.requestAnimFrame.call(window,function(){t.request=null,t.startDigest()}))},startDigest:function(){this.advance(),this.animations.length>0&&this.requestAnimationFrame()},advance:function(){for(var t,e,i,n,a=this.animations,o=0;o<a.length;)e=(t=a[o]).chart,i=t.numSteps,n=Math.floor((Date.now()-t.startTime)/t.duration*i)+1,t.currentStep=Math.min(n,i),ut.callback(t.render,[e,t],e),ut.callback(t.onAnimationProgress,[t],e),t.currentStep>=i?(ut.callback(t.onAnimationComplete,[t],e),e.animating=!1,a.splice(o,1)):++o}},xt=ut.options.resolve,yt=["push","pop","shift","splice","unshift"];function kt(t,e){var i=t._chartjs;if(i){var n=i.listeners,a=n.indexOf(e);-1!==a&&n.splice(a,1),n.length>0||(yt.forEach(function(e){delete t[e]}),delete t._chartjs)}}var wt=function(t,e){this.initialize(t,e)};ut.extend(wt.prototype,{datasetElementType:null,dataElementType:null,initialize:function(t,e){this.chart=t,this.index=e,this.linkScales(),this.addElements()},updateIndex:function(t){this.index=t},linkScales:function(){var t=this,e=t.getMeta(),i=t.getDataset();null!==e.xAxisID&&e.xAxisID in t.chart.scales||(e.xAxisID=i.xAxisID||t.chart.options.scales.xAxes[0].id),null!==e.yAxisID&&e.yAxisID in t.chart.scales||(e.yAxisID=i.yAxisID||t.chart.options.scales.yAxes[0].id)},getDataset:function(){return this.chart.data.datasets[this.index]},getMeta:function(){return this.chart.getDatasetMeta(this.index)},getScaleForId:function(t){return this.chart.scales[t]},_getValueScaleId:function(){return this.getMeta().yAxisID},_getIndexScaleId:function(){return this.getMeta().xAxisID},_getValueScale:function(){return this.getScaleForId(this._getValueScaleId())},_getIndexScale:function(){return this.getScaleForId(this._getIndexScaleId())},reset:function(){this.update(!0)},destroy:function(){this._data&&kt(this._data,this)},createMetaDataset:function(){var t=this.datasetElementType;return t&&new t({_chart:this.chart,_datasetIndex:this.index})},createMetaData:function(t){var e=this.dataElementType;return e&&new e({_chart:this.chart,_datasetIndex:this.index,_index:t})},addElements:function(){var t,e,i=this.getMeta(),n=this.getDataset().data||[],a=i.data;for(t=0,e=n.length;t<e;++t)a[t]=a[t]||this.createMetaData(t);i.dataset=i.dataset||this.createMetaDataset()},addElementAndReset:function(t){var e=this.createMetaData(t);this.getMeta().data.splice(t,0,e),this.updateElement(e,t,!0)},buildOrUpdateElements:function(){var t,e,i=this,n=i.getDataset(),a=n.data||(n.data=[]);i._data!==a&&(i._data&&kt(i._data,i),a&&Object.isExtensible(a)&&(e=i,(t=a)._chartjs?t._chartjs.listeners.push(e):(Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),yt.forEach(function(e){var i="onData"+e.charAt(0).toUpperCase()+e.slice(1),n=t[e];Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:function(){var e=Array.prototype.slice.call(arguments),a=n.apply(this,e);return ut.each(t._chartjs.listeners,function(t){"function"==typeof t[i]&&t[i].apply(t,e)}),a}})}))),i._data=a),i.resyncElements()},update:ut.noop,transition:function(t){for(var e=this.getMeta(),i=e.data||[],n=i.length,a=0;a<n;++a)i[a].transition(t);e.dataset&&e.dataset.transition(t)},draw:function(){var t=this.getMeta(),e=t.data||[],i=e.length,n=0;for(t.dataset&&t.dataset.draw();n<i;++n)e[n].draw()},removeHoverStyle:function(t){ut.merge(t._model,t.$previousStyle||{}),delete t.$previousStyle},setHoverStyle:function(t){var e=this.chart.data.datasets[t._datasetIndex],i=t._index,n=t.custom||{},a=t._model,o=ut.getHoverColor;t.$previousStyle={backgroundColor:a.backgroundColor,borderColor:a.borderColor,borderWidth:a.borderWidth},a.backgroundColor=xt([n.hoverBackgroundColor,e.hoverBackgroundColor,o(a.backgroundColor)],void 0,i),a.borderColor=xt([n.hoverBorderColor,e.hoverBorderColor,o(a.borderColor)],void 0,i),a.borderWidth=xt([n.hoverBorderWidth,e.hoverBorderWidth,a.borderWidth],void 0,i)},resyncElements:function(){var t=this.getMeta(),e=this.getDataset().data,i=t.data.length,n=e.length;n<i?t.data.splice(n,i-n):n>i&&this.insertElements(i,n-i)},insertElements:function(t,e){for(var i=0;i<e;++i)this.addElementAndReset(t+i)},onDataPush:function(){var t=arguments.length;this.insertElements(this.getDataset().data.length-t,t)},onDataPop:function(){this.getMeta().data.pop()},onDataShift:function(){this.getMeta().data.shift()},onDataSplice:function(t,e){this.getMeta().data.splice(t,e),this.insertElements(t,arguments.length-2)},onDataUnshift:function(){this.insertElements(0,arguments.length)}}),wt.extend=ut.inherits;var Mt=wt;st._set("global",{elements:{arc:{backgroundColor:st.global.defaultColor,borderColor:"#fff",borderWidth:2,borderAlign:"center"}}});var _t=pt.extend({inLabelRange:function(t){var e=this._view;return!!e&&Math.pow(t-e.x,2)<Math.pow(e.radius+e.hoverRadius,2)},inRange:function(t,e){var i=this._view;if(i){for(var n=ut.getAngleFromPoint(i,{x:t,y:e}),a=n.angle,o=n.distance,r=i.startAngle,s=i.endAngle;s<r;)s+=2*Math.PI;for(;a>s;)a-=2*Math.PI;for(;a<r;)a+=2*Math.PI;var l=a>=r&&a<=s,d=o>=i.innerRadius&&o<=i.outerRadius;return l&&d}return!1},getCenterPoint:function(){var t=this._view,e=(t.startAngle+t.endAngle)/2,i=(t.innerRadius+t.outerRadius)/2;return{x:t.x+Math.cos(e)*i,y:t.y+Math.sin(e)*i}},getArea:function(){var t=this._view;return Math.PI*((t.endAngle-t.startAngle)/(2*Math.PI))*(Math.pow(t.outerRadius,2)-Math.pow(t.innerRadius,2))},tooltipPosition:function(){var t=this._view,e=t.startAngle+(t.endAngle-t.startAngle)/2,i=(t.outerRadius-t.innerRadius)/2+t.innerRadius;return{x:t.x+Math.cos(e)*i,y:t.y+Math.sin(e)*i}},draw:function(){var t,e=this._chart.ctx,i=this._view,n=i.startAngle,a=i.endAngle,o="inner"===i.borderAlign?.33:0;e.save(),e.beginPath(),e.arc(i.x,i.y,Math.max(i.outerRadius-o,0),n,a),e.arc(i.x,i.y,i.innerRadius,a,n,!0),e.closePath(),e.fillStyle=i.backgroundColor,e.fill(),i.borderWidth&&("inner"===i.borderAlign?(e.beginPath(),t=o/i.outerRadius,e.arc(i.x,i.y,i.outerRadius,n-t,a+t),i.innerRadius>o?(t=o/i.innerRadius,e.arc(i.x,i.y,i.innerRadius-o,a+t,n-t,!0)):e.arc(i.x,i.y,o,a+Math.PI/2,n-Math.PI/2),e.closePath(),e.clip(),e.beginPath(),e.arc(i.x,i.y,i.outerRadius,n,a),e.arc(i.x,i.y,i.innerRadius,a,n,!0),e.closePath(),e.lineWidth=2*i.borderWidth,e.lineJoin="round"):(e.lineWidth=i.borderWidth,e.lineJoin="bevel"),e.strokeStyle=i.borderColor,e.stroke()),e.restore()}}),Ct=ut.valueOrDefault,St=st.global.defaultColor;st._set("global",{elements:{line:{tension:.4,backgroundColor:St,borderWidth:3,borderColor:St,borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",capBezierPoints:!0,fill:!0}}});var Pt=pt.extend({draw:function(){var t,e,i,n,a=this._view,o=this._chart.ctx,r=a.spanGaps,s=this._children.slice(),l=st.global,d=l.elements.line,u=-1;for(this._loop&&s.length&&s.push(s[0]),o.save(),o.lineCap=a.borderCapStyle||d.borderCapStyle,o.setLineDash&&o.setLineDash(a.borderDash||d.borderDash),o.lineDashOffset=Ct(a.borderDashOffset,d.borderDashOffset),o.lineJoin=a.borderJoinStyle||d.borderJoinStyle,o.lineWidth=Ct(a.borderWidth,d.borderWidth),o.strokeStyle=a.borderColor||l.defaultColor,o.beginPath(),u=-1,t=0;t<s.length;++t)e=s[t],i=ut.previousItem(s,t),n=e._view,0===t?n.skip||(o.moveTo(n.x,n.y),u=t):(i=-1===u?i:s[u],n.skip||(u!==t-1&&!r||-1===u?o.moveTo(n.x,n.y):ut.canvas.lineTo(o,i._view,e._view),u=t));o.stroke(),o.restore()}}),It=ut.valueOrDefault,At=st.global.defaultColor;function Dt(t){var e=this._view;return!!e&&Math.abs(t-e.x)<e.radius+e.hitRadius}st._set("global",{elements:{point:{radius:3,pointStyle:"circle",backgroundColor:At,borderColor:At,borderWidth:1,hitRadius:1,hoverRadius:4,hoverBorderWidth:1}}});var Tt=pt.extend({inRange:function(t,e){var i=this._view;return!!i&&Math.pow(t-i.x,2)+Math.pow(e-i.y,2)<Math.pow(i.hitRadius+i.radius,2)},inLabelRange:Dt,inXRange:Dt,inYRange:function(t){var e=this._view;return!!e&&Math.abs(t-e.y)<e.radius+e.hitRadius},getCenterPoint:function(){var t=this._view;return{x:t.x,y:t.y}},getArea:function(){return Math.PI*Math.pow(this._view.radius,2)},tooltipPosition:function(){var t=this._view;return{x:t.x,y:t.y,padding:t.radius+t.borderWidth}},draw:function(t){var e=this._view,i=this._chart.ctx,n=e.pointStyle,a=e.rotation,o=e.radius,r=e.x,s=e.y,l=st.global,d=l.defaultColor;e.skip||(void 0===t||ut.canvas._isPointInArea(e,t))&&(i.strokeStyle=e.borderColor||d,i.lineWidth=It(e.borderWidth,l.elements.point.borderWidth),i.fillStyle=e.backgroundColor||d,ut.canvas.drawPoint(i,n,o,r,s,a))}}),Ft=st.global.defaultColor;function Lt(t){return t&&void 0!==t.width}function Rt(t){var e,i,n,a,o;return Lt(t)?(o=t.width/2,e=t.x-o,i=t.x+o,n=Math.min(t.y,t.base),a=Math.max(t.y,t.base)):(o=t.height/2,e=Math.min(t.x,t.base),i=Math.max(t.x,t.base),n=t.y-o,a=t.y+o),{left:e,top:n,right:i,bottom:a}}function Ot(t,e,i){return t===e?i:t===i?e:t}function zt(t,e,i){var n,a,o,r,s=t.borderWidth,l=function(t){var e=t.borderSkipped,i={};return e?(t.horizontal?t.base>t.x&&(e=Ot(e,"left","right")):t.base<t.y&&(e=Ot(e,"bottom","top")),i[e]=!0,i):i}(t);return ut.isObject(s)?(n=+s.top||0,a=+s.right||0,o=+s.bottom||0,r=+s.left||0):n=a=o=r=+s||0,{t:l.top||n<0?0:n>i?i:n,r:l.right||a<0?0:a>e?e:a,b:l.bottom||o<0?0:o>i?i:o,l:l.left||r<0?0:r>e?e:r}}function Bt(t,e,i){var n=null===e,a=null===i,o=!(!t||n&&a)&&Rt(t);return o&&(n||e>=o.left&&e<=o.right)&&(a||i>=o.top&&i<=o.bottom)}st._set("global",{elements:{rectangle:{backgroundColor:Ft,borderColor:Ft,borderSkipped:"bottom",borderWidth:0}}});var Nt=pt.extend({draw:function(){var t=this._chart.ctx,e=this._view,i=function(t){var e=Rt(t),i=e.right-e.left,n=e.bottom-e.top,a=zt(t,i/2,n/2);return{outer:{x:e.left,y:e.top,w:i,h:n},inner:{x:e.left+a.l,y:e.top+a.t,w:i-a.l-a.r,h:n-a.t-a.b}}}(e),n=i.outer,a=i.inner;t.fillStyle=e.backgroundColor,t.fillRect(n.x,n.y,n.w,n.h),n.w===a.w&&n.h===a.h||(t.save(),t.beginPath(),t.rect(n.x,n.y,n.w,n.h),t.clip(),t.fillStyle=e.borderColor,t.rect(a.x,a.y,a.w,a.h),t.fill("evenodd"),t.restore())},height:function(){var t=this._view;return t.base-t.y},inRange:function(t,e){return Bt(this._view,t,e)},inLabelRange:function(t,e){var i=this._view;return Lt(i)?Bt(i,t,null):Bt(i,null,e)},inXRange:function(t){return Bt(this._view,t,null)},inYRange:function(t){return Bt(this._view,null,t)},getCenterPoint:function(){var t,e,i=this._view;return Lt(i)?(t=i.x,e=(i.y+i.base)/2):(t=(i.x+i.base)/2,e=i.y),{x:t,y:e}},getArea:function(){var t=this._view;return Lt(t)?t.width*Math.abs(t.y-t.base):t.height*Math.abs(t.x-t.base)},tooltipPosition:function(){var t=this._view;return{x:t.x,y:t.y}}}),Wt={},Vt=_t,Et=Pt,Ht=Tt,jt=Nt;Wt.Arc=Vt,Wt.Line=Et,Wt.Point=Ht,Wt.Rectangle=jt;var qt=ut.options.resolve;st._set("bar",{hover:{mode:"label"},scales:{xAxes:[{type:"category",categoryPercentage:.8,barPercentage:.9,offset:!0,gridLines:{offsetGridLines:!0}}],yAxes:[{type:"linear"}]}});var Yt=Mt.extend({dataElementType:Wt.Rectangle,initialize:function(){var t;Mt.prototype.initialize.apply(this,arguments),(t=this.getMeta()).stack=this.getDataset().stack,t.bar=!0},update:function(t){var e,i,n=this.getMeta().data;for(this._ruler=this.getRuler(),e=0,i=n.length;e<i;++e)this.updateElement(n[e],e,t)},updateElement:function(t,e,i){var n=this,a=n.getMeta(),o=n.getDataset(),r=n._resolveElementOptions(t,e);t._xScale=n.getScaleForId(a.xAxisID),t._yScale=n.getScaleForId(a.yAxisID),t._datasetIndex=n.index,t._index=e,t._model={backgroundColor:r.backgroundColor,borderColor:r.borderColor,borderSkipped:r.borderSkipped,borderWidth:r.borderWidth,datasetLabel:o.label,label:n.chart.data.labels[e]},n._updateElementGeometry(t,e,i),t.pivot()},_updateElementGeometry:function(t,e,i){var n=this,a=t._model,o=n._getValueScale(),r=o.getBasePixel(),s=o.isHorizontal(),l=n._ruler||n.getRuler(),d=n.calculateBarValuePixels(n.index,e),u=n.calculateBarIndexPixels(n.index,e,l);a.horizontal=s,a.base=i?r:d.base,a.x=s?i?r:d.head:u.center,a.y=s?u.center:i?r:d.head,a.height=s?u.size:void 0,a.width=s?void 0:u.size},_getStacks:function(t){var e,i,n=this.chart,a=this._getIndexScale().options.stacked,o=void 0===t?n.data.datasets.length:t+1,r=[];for(e=0;e<o;++e)(i=n.getDatasetMeta(e)).bar&&n.isDatasetVisible(e)&&(!1===a||!0===a&&-1===r.indexOf(i.stack)||void 0===a&&(void 0===i.stack||-1===r.indexOf(i.stack)))&&r.push(i.stack);return r},getStackCount:function(){return this._getStacks().length},getStackIndex:function(t,e){var i=this._getStacks(t),n=void 0!==e?i.indexOf(e):-1;return-1===n?i.length-1:n},getRuler:function(){var t,e,i=this._getIndexScale(),n=this.getStackCount(),a=this.index,o=i.isHorizontal(),r=o?i.left:i.top,s=r+(o?i.width:i.height),l=[];for(t=0,e=this.getMeta().data.length;t<e;++t)l.push(i.getPixelForValue(null,t,a));return{min:ut.isNullOrUndef(i.options.barThickness)?function(t,e){var i,n,a,o,r=t.isHorizontal()?t.width:t.height,s=t.getTicks();for(a=1,o=e.length;a<o;++a)r=Math.min(r,Math.abs(e[a]-e[a-1]));for(a=0,o=s.length;a<o;++a)n=t.getPixelForTick(a),r=a>0?Math.min(r,n-i):r,i=n;return r}(i,l):-1,pixels:l,start:r,end:s,stackCount:n,scale:i}},calculateBarValuePixels:function(t,e){var i,n,a,o,r,s,l=this.chart,d=this.getMeta(),u=this._getValueScale(),h=u.isHorizontal(),c=l.data.datasets,f=+u.getRightValue(c[t].data[e]),g=u.options.minBarLength,p=u.options.stacked,m=d.stack,v=0;if(p||void 0===p&&void 0!==m)for(i=0;i<t;++i)(n=l.getDatasetMeta(i)).bar&&n.stack===m&&n.controller._getValueScaleId()===u.id&&l.isDatasetVisible(i)&&(a=+u.getRightValue(c[i].data[e]),(f<0&&a<0||f>=0&&a>0)&&(v+=a));return o=u.getPixelForValue(v),s=(r=u.getPixelForValue(v+f))-o,void 0!==g&&Math.abs(s)<g&&(s=g,r=f>=0&&!h||f<0&&h?o-g:o+g),{size:s,base:o,head:r,center:r+s/2}},calculateBarIndexPixels:function(t,e,i){var n=i.scale.options,a="flex"===n.barThickness?function(t,e,i){var n,a=e.pixels,o=a[t],r=t>0?a[t-1]:null,s=t<a.length-1?a[t+1]:null,l=i.categoryPercentage;return null===r&&(r=o-(null===s?e.end-e.start:s-o)),null===s&&(s=o+o-r),n=o-(o-Math.min(r,s))/2*l,{chunk:Math.abs(s-r)/2*l/e.stackCount,ratio:i.barPercentage,start:n}}(e,i,n):function(t,e,i){var n,a,o=i.barThickness,r=e.stackCount,s=e.pixels[t];return ut.isNullOrUndef(o)?(n=e.min*i.categoryPercentage,a=i.barPercentage):(n=o*r,a=1),{chunk:n/r,ratio:a,start:s-n/2}}(e,i,n),o=this.getStackIndex(t,this.getMeta().stack),r=a.start+a.chunk*o+a.chunk/2,s=Math.min(ut.valueOrDefault(n.maxBarThickness,1/0),a.chunk*a.ratio);return{base:r-s/2,head:r+s/2,center:r,size:s}},draw:function(){var t=this.chart,e=this._getValueScale(),i=this.getMeta().data,n=this.getDataset(),a=i.length,o=0;for(ut.canvas.clipArea(t.ctx,t.chartArea);o<a;++o)isNaN(e.getRightValue(n.data[o]))||i[o].draw();ut.canvas.unclipArea(t.ctx)},_resolveElementOptions:function(t,e){var i,n,a,o=this.chart,r=o.data.datasets[this.index],s=t.custom||{},l=o.options.elements.rectangle,d={},u={chart:o,dataIndex:e,dataset:r,datasetIndex:this.index},h=["backgroundColor","borderColor","borderSkipped","borderWidth"];for(i=0,n=h.length;i<n;++i)d[a=h[i]]=qt([s[a],r[a],l[a]],u,e);return d}}),Ut=ut.valueOrDefault,Xt=ut.options.resolve;st._set("bubble",{hover:{mode:"single"},scales:{xAxes:[{type:"linear",position:"bottom",id:"x-axis-0"}],yAxes:[{type:"linear",position:"left",id:"y-axis-0"}]},tooltips:{callbacks:{title:function(){return""},label:function(t,e){var i=e.datasets[t.datasetIndex].label||"",n=e.datasets[t.datasetIndex].data[t.index];return i+": ("+t.xLabel+", "+t.yLabel+", "+n.r+")"}}}});var Kt=Mt.extend({dataElementType:Wt.Point,update:function(t){var e=this,i=e.getMeta().data;ut.each(i,function(i,n){e.updateElement(i,n,t)})},updateElement:function(t,e,i){var n=this,a=n.getMeta(),o=t.custom||{},r=n.getScaleForId(a.xAxisID),s=n.getScaleForId(a.yAxisID),l=n._resolveElementOptions(t,e),d=n.getDataset().data[e],u=n.index,h=i?r.getPixelForDecimal(.5):r.getPixelForValue("object"==typeof d?d:NaN,e,u),c=i?s.getBasePixel():s.getPixelForValue(d,e,u);t._xScale=r,t._yScale=s,t._options=l,t._datasetIndex=u,t._index=e,t._model={backgroundColor:l.backgroundColor,borderColor:l.borderColor,borderWidth:l.borderWidth,hitRadius:l.hitRadius,pointStyle:l.pointStyle,rotation:l.rotation,radius:i?0:l.radius,skip:o.skip||isNaN(h)||isNaN(c),x:h,y:c},t.pivot()},setHoverStyle:function(t){var e=t._model,i=t._options,n=ut.getHoverColor;t.$previousStyle={backgroundColor:e.backgroundColor,borderColor:e.borderColor,borderWidth:e.borderWidth,radius:e.radius},e.backgroundColor=Ut(i.hoverBackgroundColor,n(i.backgroundColor)),e.borderColor=Ut(i.hoverBorderColor,n(i.borderColor)),e.borderWidth=Ut(i.hoverBorderWidth,i.borderWidth),e.radius=i.radius+i.hoverRadius},_resolveElementOptions:function(t,e){var i,n,a,o=this.chart,r=o.data.datasets[this.index],s=t.custom||{},l=o.options.elements.point,d=r.data[e],u={},h={chart:o,dataIndex:e,dataset:r,datasetIndex:this.index},c=["backgroundColor","borderColor","borderWidth","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth","hoverRadius","hitRadius","pointStyle","rotation"];for(i=0,n=c.length;i<n;++i)u[a=c[i]]=Xt([s[a],r[a],l[a]],h,e);return u.radius=Xt([s.radius,d?d.r:void 0,r.radius,l.radius],h,e),u}}),Gt=ut.options.resolve,Zt=ut.valueOrDefault;st._set("doughnut",{animation:{animateRotate:!0,animateScale:!1},hover:{mode:"single"},legendCallback:function(t){var e=[];e.push('<ul class="'+t.id+'-legend">');var i=t.data,n=i.datasets,a=i.labels;if(n.length)for(var o=0;o<n[0].data.length;++o)e.push('<li><span style="background-color:'+n[0].backgroundColor[o]+'"></span>'),a[o]&&e.push(a[o]),e.push("</li>");return e.push("</ul>"),e.join("")},legend:{labels:{generateLabels:function(t){var e=t.data;return e.labels.length&&e.datasets.length?e.labels.map(function(i,n){var a=t.getDatasetMeta(0),o=e.datasets[0],r=a.data[n],s=r&&r.custom||{},l=t.options.elements.arc;return{text:i,fillStyle:Gt([s.backgroundColor,o.backgroundColor,l.backgroundColor],void 0,n),strokeStyle:Gt([s.borderColor,o.borderColor,l.borderColor],void 0,n),lineWidth:Gt([s.borderWidth,o.borderWidth,l.borderWidth],void 0,n),hidden:isNaN(o.data[n])||a.data[n].hidden,index:n}}):[]}},onClick:function(t,e){var i,n,a,o=e.index,r=this.chart;for(i=0,n=(r.data.datasets||[]).length;i<n;++i)(a=r.getDatasetMeta(i)).data[o]&&(a.data[o].hidden=!a.data[o].hidden);r.update()}},cutoutPercentage:50,rotation:-.5*Math.PI,circumference:2*Math.PI,tooltips:{callbacks:{title:function(){return""},label:function(t,e){var i=e.labels[t.index],n=": "+e.datasets[t.datasetIndex].data[t.index];return ut.isArray(i)?(i=i.slice())[0]+=n:i+=n,i}}}});var $t=Mt.extend({dataElementType:Wt.Arc,linkScales:ut.noop,getRingIndex:function(t){for(var e=0,i=0;i<t;++i)this.chart.isDatasetVisible(i)&&++e;return e},update:function(t){var e,i,n=this,a=n.chart,o=a.chartArea,r=a.options,s=o.right-o.left,l=o.bottom-o.top,d=Math.min(s,l),u={x:0,y:0},h=n.getMeta(),c=h.data,f=r.cutoutPercentage,g=r.circumference,p=n._getRingWeight(n.index);if(g<2*Math.PI){var m=r.rotation%(2*Math.PI),v=(m+=2*Math.PI*(m>=Math.PI?-1:m<-Math.PI?1:0))+g,b={x:Math.cos(m),y:Math.sin(m)},x={x:Math.cos(v),y:Math.sin(v)},y=m<=0&&v>=0||m<=2*Math.PI&&2*Math.PI<=v,k=m<=.5*Math.PI&&.5*Math.PI<=v||m<=2.5*Math.PI&&2.5*Math.PI<=v,w=m<=-Math.PI&&-Math.PI<=v||m<=Math.PI&&Math.PI<=v,M=m<=.5*-Math.PI&&.5*-Math.PI<=v||m<=1.5*Math.PI&&1.5*Math.PI<=v,_=f/100,C={x:w?-1:Math.min(b.x*(b.x<0?1:_),x.x*(x.x<0?1:_)),y:M?-1:Math.min(b.y*(b.y<0?1:_),x.y*(x.y<0?1:_))},S={x:y?1:Math.max(b.x*(b.x>0?1:_),x.x*(x.x>0?1:_)),y:k?1:Math.max(b.y*(b.y>0?1:_),x.y*(x.y>0?1:_))},P={width:.5*(S.x-C.x),height:.5*(S.y-C.y)};d=Math.min(s/P.width,l/P.height),u={x:-.5*(S.x+C.x),y:-.5*(S.y+C.y)}}for(e=0,i=c.length;e<i;++e)c[e]._options=n._resolveElementOptions(c[e],e);for(a.borderWidth=n.getMaxBorderWidth(),a.outerRadius=Math.max((d-a.borderWidth)/2,0),a.innerRadius=Math.max(f?a.outerRadius/100*f:0,0),a.radiusLength=(a.outerRadius-a.innerRadius)/(n._getVisibleDatasetWeightTotal()||1),a.offsetX=u.x*a.outerRadius,a.offsetY=u.y*a.outerRadius,h.total=n.calculateTotal(),n.outerRadius=a.outerRadius-a.radiusLength*n._getRingWeightOffset(n.index),n.innerRadius=Math.max(n.outerRadius-a.radiusLength*p,0),e=0,i=c.length;e<i;++e)n.updateElement(c[e],e,t)},updateElement:function(t,e,i){var n=this,a=n.chart,o=a.chartArea,r=a.options,s=r.animation,l=(o.left+o.right)/2,d=(o.top+o.bottom)/2,u=r.rotation,h=r.rotation,c=n.getDataset(),f=i&&s.animateRotate?0:t.hidden?0:n.calculateCircumference(c.data[e])*(r.circumference/(2*Math.PI)),g=i&&s.animateScale?0:n.innerRadius,p=i&&s.animateScale?0:n.outerRadius,m=t._options||{};ut.extend(t,{_datasetIndex:n.index,_index:e,_model:{backgroundColor:m.backgroundColor,borderColor:m.borderColor,borderWidth:m.borderWidth,borderAlign:m.borderAlign,x:l+a.offsetX,y:d+a.offsetY,startAngle:u,endAngle:h,circumference:f,outerRadius:p,innerRadius:g,label:ut.valueAtIndexOrDefault(c.label,e,a.data.labels[e])}});var v=t._model;i&&s.animateRotate||(v.startAngle=0===e?r.rotation:n.getMeta().data[e-1]._model.endAngle,v.endAngle=v.startAngle+v.circumference),t.pivot()},calculateTotal:function(){var t,e=this.getDataset(),i=this.getMeta(),n=0;return ut.each(i.data,function(i,a){t=e.data[a],isNaN(t)||i.hidden||(n+=Math.abs(t))}),n},calculateCircumference:function(t){var e=this.getMeta().total;return e>0&&!isNaN(t)?2*Math.PI*(Math.abs(t)/e):0},getMaxBorderWidth:function(t){var e,i,n,a,o,r,s,l,d=0,u=this.chart;if(!t)for(e=0,i=u.data.datasets.length;e<i;++e)if(u.isDatasetVisible(e)){t=(n=u.getDatasetMeta(e)).data,e!==this.index&&(o=n.controller);break}if(!t)return 0;for(e=0,i=t.length;e<i;++e)a=t[e],"inner"!==(r=o?o._resolveElementOptions(a,e):a._options).borderAlign&&(s=r.borderWidth,d=(l=r.hoverBorderWidth)>(d=s>d?s:d)?l:d);return d},setHoverStyle:function(t){var e=t._model,i=t._options,n=ut.getHoverColor;t.$previousStyle={backgroundColor:e.backgroundColor,borderColor:e.borderColor,borderWidth:e.borderWidth},e.backgroundColor=Zt(i.hoverBackgroundColor,n(i.backgroundColor)),e.borderColor=Zt(i.hoverBorderColor,n(i.borderColor)),e.borderWidth=Zt(i.hoverBorderWidth,i.borderWidth)},_resolveElementOptions:function(t,e){var i,n,a,o=this.chart,r=this.getDataset(),s=t.custom||{},l=o.options.elements.arc,d={},u={chart:o,dataIndex:e,dataset:r,datasetIndex:this.index},h=["backgroundColor","borderColor","borderWidth","borderAlign","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth"];for(i=0,n=h.length;i<n;++i)d[a=h[i]]=Gt([s[a],r[a],l[a]],u,e);return d},_getRingWeightOffset:function(t){for(var e=0,i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e},_getRingWeight:function(t){return Math.max(Zt(this.chart.data.datasets[t].weight,1),0)},_getVisibleDatasetWeightTotal:function(){return this._getRingWeightOffset(this.chart.data.datasets.length)}});st._set("horizontalBar",{hover:{mode:"index",axis:"y"},scales:{xAxes:[{type:"linear",position:"bottom"}],yAxes:[{type:"category",position:"left",categoryPercentage:.8,barPercentage:.9,offset:!0,gridLines:{offsetGridLines:!0}}]},elements:{rectangle:{borderSkipped:"left"}},tooltips:{mode:"index",axis:"y"}});var Jt=Yt.extend({_getValueScaleId:function(){return this.getMeta().xAxisID},_getIndexScaleId:function(){return this.getMeta().yAxisID}}),Qt=ut.valueOrDefault,te=ut.options.resolve,ee=ut.canvas._isPointInArea;function ie(t,e){return Qt(t.showLine,e.showLines)}st._set("line",{showLines:!0,spanGaps:!1,hover:{mode:"label"},scales:{xAxes:[{type:"category",id:"x-axis-0"}],yAxes:[{type:"linear",id:"y-axis-0"}]}});var ne=Mt.extend({datasetElementType:Wt.Line,dataElementType:Wt.Point,update:function(t){var e,i,n=this,a=n.getMeta(),o=a.dataset,r=a.data||[],s=n.getScaleForId(a.yAxisID),l=n.getDataset(),d=ie(l,n.chart.options);for(d&&(void 0!==l.tension&&void 0===l.lineTension&&(l.lineTension=l.tension),o._scale=s,o._datasetIndex=n.index,o._children=r,o._model=n._resolveLineOptions(o),o.pivot()),e=0,i=r.length;e<i;++e)n.updateElement(r[e],e,t);for(d&&0!==o._model.tension&&n.updateBezierControlPoints(),e=0,i=r.length;e<i;++e)r[e].pivot()},updateElement:function(t,e,i){var n,a,o=this,r=o.getMeta(),s=t.custom||{},l=o.getDataset(),d=o.index,u=l.data[e],h=o.getScaleForId(r.yAxisID),c=o.getScaleForId(r.xAxisID),f=r.dataset._model,g=o._resolvePointOptions(t,e);n=c.getPixelForValue("object"==typeof u?u:NaN,e,d),a=i?h.getBasePixel():o.calculatePointY(u,e,d),t._xScale=c,t._yScale=h,t._options=g,t._datasetIndex=d,t._index=e,t._model={x:n,y:a,skip:s.skip||isNaN(n)||isNaN(a),radius:g.radius,pointStyle:g.pointStyle,rotation:g.rotation,backgroundColor:g.backgroundColor,borderColor:g.borderColor,borderWidth:g.borderWidth,tension:Qt(s.tension,f?f.tension:0),steppedLine:!!f&&f.steppedLine,hitRadius:g.hitRadius}},_resolvePointOptions:function(t,e){var i,n,a,o=this.chart,r=o.data.datasets[this.index],s=t.custom||{},l=o.options.elements.point,d={},u={chart:o,dataIndex:e,dataset:r,datasetIndex:this.index},h={backgroundColor:"pointBackgroundColor",borderColor:"pointBorderColor",borderWidth:"pointBorderWidth",hitRadius:"pointHitRadius",hoverBackgroundColor:"pointHoverBackgroundColor",hoverBorderColor:"pointHoverBorderColor",hoverBorderWidth:"pointHoverBorderWidth",hoverRadius:"pointHoverRadius",pointStyle:"pointStyle",radius:"pointRadius",rotation:"pointRotation"},c=Object.keys(h);for(i=0,n=c.length;i<n;++i)d[a=c[i]]=te([s[a],r[h[a]],r[a],l[a]],u,e);return d},_resolveLineOptions:function(t){var e,i,n,a=this.chart,o=a.data.datasets[this.index],r=t.custom||{},s=a.options,l=s.elements.line,d={},u=["backgroundColor","borderWidth","borderColor","borderCapStyle","borderDash","borderDashOffset","borderJoinStyle","fill","cubicInterpolationMode"];for(e=0,i=u.length;e<i;++e)d[n=u[e]]=te([r[n],o[n],l[n]]);return d.spanGaps=Qt(o.spanGaps,s.spanGaps),d.tension=Qt(o.lineTension,l.tension),d.steppedLine=te([r.steppedLine,o.steppedLine,l.stepped]),d},calculatePointY:function(t,e,i){var n,a,o,r=this.chart,s=this.getMeta(),l=this.getScaleForId(s.yAxisID),d=0,u=0;if(l.options.stacked){for(n=0;n<i;n++)if(a=r.data.datasets[n],"line"===(o=r.getDatasetMeta(n)).type&&o.yAxisID===l.id&&r.isDatasetVisible(n)){var h=Number(l.getRightValue(a.data[e]));h<0?u+=h||0:d+=h||0}var c=Number(l.getRightValue(t));return c<0?l.getPixelForValue(u+c):l.getPixelForValue(d+c)}return l.getPixelForValue(t)},updateBezierControlPoints:function(){var t,e,i,n,a=this.chart,o=this.getMeta(),r=o.dataset._model,s=a.chartArea,l=o.data||[];function d(t,e,i){return Math.max(Math.min(t,i),e)}if(r.spanGaps&&(l=l.filter(function(t){return!t._model.skip})),"monotone"===r.cubicInterpolationMode)ut.splineCurveMonotone(l);else for(t=0,e=l.length;t<e;++t)i=l[t]._model,n=ut.splineCurve(ut.previousItem(l,t)._model,i,ut.nextItem(l,t)._model,r.tension),i.controlPointPreviousX=n.previous.x,i.controlPointPreviousY=n.previous.y,i.controlPointNextX=n.next.x,i.controlPointNextY=n.next.y;if(a.options.elements.line.capBezierPoints)for(t=0,e=l.length;t<e;++t)i=l[t]._model,ee(i,s)&&(t>0&&ee(l[t-1]._model,s)&&(i.controlPointPreviousX=d(i.controlPointPreviousX,s.left,s.right),i.controlPointPreviousY=d(i.controlPointPreviousY,s.top,s.bottom)),t<l.length-1&&ee(l[t+1]._model,s)&&(i.controlPointNextX=d(i.controlPointNextX,s.left,s.right),i.controlPointNextY=d(i.controlPointNextY,s.top,s.bottom)))},draw:function(){var t,e=this.chart,i=this.getMeta(),n=i.data||[],a=e.chartArea,o=n.length,r=0;for(ie(this.getDataset(),e.options)&&(t=(i.dataset._model.borderWidth||0)/2,ut.canvas.clipArea(e.ctx,{left:a.left,right:a.right,top:a.top-t,bottom:a.bottom+t}),i.dataset.draw(),ut.canvas.unclipArea(e.ctx));r<o;++r)n[r].draw(a)},setHoverStyle:function(t){var e=t._model,i=t._options,n=ut.getHoverColor;t.$previousStyle={backgroundColor:e.backgroundColor,borderColor:e.borderColor,borderWidth:e.borderWidth,radius:e.radius},e.backgroundColor=Qt(i.hoverBackgroundColor,n(i.backgroundColor)),e.borderColor=Qt(i.hoverBorderColor,n(i.borderColor)),e.borderWidth=Qt(i.hoverBorderWidth,i.borderWidth),e.radius=Qt(i.hoverRadius,i.radius)}}),ae=ut.options.resolve;st._set("polarArea",{scale:{type:"radialLinear",angleLines:{display:!1},gridLines:{circular:!0},pointLabels:{display:!1},ticks:{beginAtZero:!0}},animation:{animateRotate:!0,animateScale:!0},startAngle:-.5*Math.PI,legendCallback:function(t){var e=[];e.push('<ul class="'+t.id+'-legend">');var i=t.data,n=i.datasets,a=i.labels;if(n.length)for(var o=0;o<n[0].data.length;++o)e.push('<li><span style="background-color:'+n[0].backgroundColor[o]+'"></span>'),a[o]&&e.push(a[o]),e.push("</li>");return e.push("</ul>"),e.join("")},legend:{labels:{generateLabels:function(t){var e=t.data;return e.labels.length&&e.datasets.length?e.labels.map(function(i,n){var a=t.getDatasetMeta(0),o=e.datasets[0],r=a.data[n].custom||{},s=t.options.elements.arc;return{text:i,fillStyle:ae([r.backgroundColor,o.backgroundColor,s.backgroundColor],void 0,n),strokeStyle:ae([r.borderColor,o.borderColor,s.borderColor],void 0,n),lineWidth:ae([r.borderWidth,o.borderWidth,s.borderWidth],void 0,n),hidden:isNaN(o.data[n])||a.data[n].hidden,index:n}}):[]}},onClick:function(t,e){var i,n,a,o=e.index,r=this.chart;for(i=0,n=(r.data.datasets||[]).length;i<n;++i)(a=r.getDatasetMeta(i)).data[o].hidden=!a.data[o].hidden;r.update()}},tooltips:{callbacks:{title:function(){return""},label:function(t,e){return e.labels[t.index]+": "+t.yLabel}}}});var oe=Mt.extend({dataElementType:Wt.Arc,linkScales:ut.noop,update:function(t){var e,i,n,a=this,o=a.getDataset(),r=a.getMeta(),s=a.chart.options.startAngle||0,l=a._starts=[],d=a._angles=[],u=r.data;for(a._updateRadius(),r.count=a.countVisibleElements(),e=0,i=o.data.length;e<i;e++)l[e]=s,n=a._computeAngle(e),d[e]=n,s+=n;for(e=0,i=u.length;e<i;++e)u[e]._options=a._resolveElementOptions(u[e],e),a.updateElement(u[e],e,t)},_updateRadius:function(){var t=this,e=t.chart,i=e.chartArea,n=e.options,a=Math.min(i.right-i.left,i.bottom-i.top);e.outerRadius=Math.max(a/2,0),e.innerRadius=Math.max(n.cutoutPercentage?e.outerRadius/100*n.cutoutPercentage:1,0),e.radiusLength=(e.outerRadius-e.innerRadius)/e.getVisibleDatasetCount(),t.outerRadius=e.outerRadius-e.radiusLength*t.index,t.innerRadius=t.outerRadius-e.radiusLength},updateElement:function(t,e,i){var n=this,a=n.chart,o=n.getDataset(),r=a.options,s=r.animation,l=a.scale,d=a.data.labels,u=l.xCenter,h=l.yCenter,c=r.startAngle,f=t.hidden?0:l.getDistanceFromCenterForValue(o.data[e]),g=n._starts[e],p=g+(t.hidden?0:n._angles[e]),m=s.animateScale?0:l.getDistanceFromCenterForValue(o.data[e]),v=t._options||{};ut.extend(t,{_datasetIndex:n.index,_index:e,_scale:l,_model:{backgroundColor:v.backgroundColor,borderColor:v.borderColor,borderWidth:v.borderWidth,borderAlign:v.borderAlign,x:u,y:h,innerRadius:0,outerRadius:i?m:f,startAngle:i&&s.animateRotate?c:g,endAngle:i&&s.animateRotate?c:p,label:ut.valueAtIndexOrDefault(d,e,d[e])}}),t.pivot()},countVisibleElements:function(){var t=this.getDataset(),e=this.getMeta(),i=0;return ut.each(e.data,function(e,n){isNaN(t.data[n])||e.hidden||i++}),i},setHoverStyle:function(t){var e=t._model,i=t._options,n=ut.getHoverColor,a=ut.valueOrDefault;t.$previousStyle={backgroundColor:e.backgroundColor,borderColor:e.borderColor,borderWidth:e.borderWidth},e.backgroundColor=a(i.hoverBackgroundColor,n(i.backgroundColor)),e.borderColor=a(i.hoverBorderColor,n(i.borderColor)),e.borderWidth=a(i.hoverBorderWidth,i.borderWidth)},_resolveElementOptions:function(t,e){var i,n,a,o=this.chart,r=this.getDataset(),s=t.custom||{},l=o.options.elements.arc,d={},u={chart:o,dataIndex:e,dataset:r,datasetIndex:this.index},h=["backgroundColor","borderColor","borderWidth","borderAlign","hoverBackgroundColor","hoverBorderColor","hoverBorderWidth"];for(i=0,n=h.length;i<n;++i)d[a=h[i]]=ae([s[a],r[a],l[a]],u,e);return d},_computeAngle:function(t){var e=this,i=this.getMeta().count,n=e.getDataset(),a=e.getMeta();if(isNaN(n.data[t])||a.data[t].hidden)return 0;var o={chart:e.chart,dataIndex:t,dataset:n,datasetIndex:e.index};return ae([e.chart.options.elements.arc.angle,2*Math.PI/i],o,t)}});st._set("pie",ut.clone(st.doughnut)),st._set("pie",{cutoutPercentage:0});var re=$t,se=ut.valueOrDefault,le=ut.options.resolve;st._set("radar",{scale:{type:"radialLinear"},elements:{line:{tension:0}}});var de=Mt.extend({datasetElementType:Wt.Line,dataElementType:Wt.Point,linkScales:ut.noop,update:function(t){var e,i,n=this,a=n.getMeta(),o=a.dataset,r=a.data||[],s=n.chart.scale,l=n.getDataset();for(void 0!==l.tension&&void 0===l.lineTension&&(l.lineTension=l.tension),o._scale=s,o._datasetIndex=n.index,o._children=r,o._loop=!0,o._model=n._resolveLineOptions(o),o.pivot(),e=0,i=r.length;e<i;++e)n.updateElement(r[e],e,t);for(n.updateBezierControlPoints(),e=0,i=r.length;e<i;++e)r[e].pivot()},updateElement:function(t,e,i){var n=this,a=t.custom||{},o=n.getDataset(),r=n.chart.scale,s=r.getPointPositionForValue(e,o.data[e]),l=n._resolvePointOptions(t,e),d=n.getMeta().dataset._model,u=i?r.xCenter:s.x,h=i?r.yCenter:s.y;t._scale=r,t._options=l,t._datasetIndex=n.index,t._index=e,t._model={x:u,y:h,skip:a.skip||isNaN(u)||isNaN(h),radius:l.radius,pointStyle:l.pointStyle,rotation:l.rotation,backgroundColor:l.backgroundColor,borderColor:l.borderColor,borderWidth:l.borderWidth,tension:se(a.tension,d?d.tension:0),hitRadius:l.hitRadius}},_resolvePointOptions:function(t,e){var i,n,a,o=this.chart,r=o.data.datasets[this.index],s=t.custom||{},l=o.options.elements.point,d={},u={chart:o,dataIndex:e,dataset:r,datasetIndex:this.index},h={backgroundColor:"pointBackgroundColor",borderColor:"pointBorderColor",borderWidth:"pointBorderWidth",hitRadius:"pointHitRadius",hoverBackgroundColor:"pointHoverBackgroundColor",hoverBorderColor:"pointHoverBorderColor",hoverBorderWidth:"pointHoverBorderWidth",hoverRadius:"pointHoverRadius",pointStyle:"pointStyle",radius:"pointRadius",rotation:"pointRotation"},c=Object.keys(h);for(i=0,n=c.length;i<n;++i)d[a=c[i]]=le([s[a],r[h[a]],r[a],l[a]],u,e);return d},_resolveLineOptions:function(t){var e,i,n,a=this.chart,o=a.data.datasets[this.index],r=t.custom||{},s=a.options.elements.line,l={},d=["backgroundColor","borderWidth","borderColor","borderCapStyle","borderDash","borderDashOffset","borderJoinStyle","fill"];for(e=0,i=d.length;e<i;++e)l[n=d[e]]=le([r[n],o[n],s[n]]);return l.tension=se(o.lineTension,s.tension),l},updateBezierControlPoints:function(){var t,e,i,n,a=this.getMeta(),o=this.chart.chartArea,r=a.data||[];function s(t,e,i){return Math.max(Math.min(t,i),e)}for(t=0,e=r.length;t<e;++t)i=r[t]._model,n=ut.splineCurve(ut.previousItem(r,t,!0)._model,i,ut.nextItem(r,t,!0)._model,i.tension),i.controlPointPreviousX=s(n.previous.x,o.left,o.right),i.controlPointPreviousY=s(n.previous.y,o.top,o.bottom),i.controlPointNextX=s(n.next.x,o.left,o.right),i.controlPointNextY=s(n.next.y,o.top,o.bottom)},setHoverStyle:function(t){var e=t._model,i=t._options,n=ut.getHoverColor;t.$previousStyle={backgroundColor:e.backgroundColor,borderColor:e.borderColor,borderWidth:e.borderWidth,radius:e.radius},e.backgroundColor=se(i.hoverBackgroundColor,n(i.backgroundColor)),e.borderColor=se(i.hoverBorderColor,n(i.borderColor)),e.borderWidth=se(i.hoverBorderWidth,i.borderWidth),e.radius=se(i.hoverRadius,i.radius)}});st._set("scatter",{hover:{mode:"single"},scales:{xAxes:[{id:"x-axis-1",type:"linear",position:"bottom"}],yAxes:[{id:"y-axis-1",type:"linear",position:"left"}]},showLines:!1,tooltips:{callbacks:{title:function(){return""},label:function(t){return"("+t.xLabel+", "+t.yLabel+")"}}}});var ue={bar:Yt,bubble:Kt,doughnut:$t,horizontalBar:Jt,line:ne,polarArea:oe,pie:re,radar:de,scatter:ne};function he(t,e){return t.native?{x:t.x,y:t.y}:ut.getRelativePosition(t,e)}function ce(t,e){var i,n,a,o,r;for(n=0,o=t.data.datasets.length;n<o;++n)if(t.isDatasetVisible(n))for(a=0,r=(i=t.getDatasetMeta(n)).data.length;a<r;++a){var s=i.data[a];s._view.skip||e(s)}}function fe(t,e){var i=[];return ce(t,function(t){t.inRange(e.x,e.y)&&i.push(t)}),i}function ge(t,e,i,n){var a=Number.POSITIVE_INFINITY,o=[];return ce(t,function(t){if(!i||t.inRange(e.x,e.y)){var r=t.getCenterPoint(),s=n(e,r);s<a?(o=[t],a=s):s===a&&o.push(t)}}),o}function pe(t){var e=-1!==t.indexOf("x"),i=-1!==t.indexOf("y");return function(t,n){var a=e?Math.abs(t.x-n.x):0,o=i?Math.abs(t.y-n.y):0;return Math.sqrt(Math.pow(a,2)+Math.pow(o,2))}}function me(t,e,i){var n=he(e,t);i.axis=i.axis||"x";var a=pe(i.axis),o=i.intersect?fe(t,n):ge(t,n,!1,a),r=[];return o.length?(t.data.datasets.forEach(function(e,i){if(t.isDatasetVisible(i)){var n=t.getDatasetMeta(i).data[o[0]._index];n&&!n._view.skip&&r.push(n)}}),r):[]}var ve={modes:{single:function(t,e){var i=he(e,t),n=[];return ce(t,function(t){if(t.inRange(i.x,i.y))return n.push(t),n}),n.slice(0,1)},label:me,index:me,dataset:function(t,e,i){var n=he(e,t);i.axis=i.axis||"xy";var a=pe(i.axis),o=i.intersect?fe(t,n):ge(t,n,!1,a);return o.length>0&&(o=t.getDatasetMeta(o[0]._datasetIndex).data),o},"x-axis":function(t,e){return me(t,e,{intersect:!1})},point:function(t,e){return fe(t,he(e,t))},nearest:function(t,e,i){var n=he(e,t);i.axis=i.axis||"xy";var a=pe(i.axis);return ge(t,n,i.intersect,a)},x:function(t,e,i){var n=he(e,t),a=[],o=!1;return ce(t,function(t){t.inXRange(n.x)&&a.push(t),t.inRange(n.x,n.y)&&(o=!0)}),i.intersect&&!o&&(a=[]),a},y:function(t,e,i){var n=he(e,t),a=[],o=!1;return ce(t,function(t){t.inYRange(n.y)&&a.push(t),t.inRange(n.x,n.y)&&(o=!0)}),i.intersect&&!o&&(a=[]),a}}};function be(t,e){return ut.where(t,function(t){return t.position===e})}function xe(t,e){t.forEach(function(t,e){return t._tmpIndex_=e,t}),t.sort(function(t,i){var n=e?i:t,a=e?t:i;return n.weight===a.weight?n._tmpIndex_-a._tmpIndex_:n.weight-a.weight}),t.forEach(function(t){delete t._tmpIndex_})}function ye(t,e){ut.each(t,function(t){e[t.position]+=t.isHorizontal()?t.height:t.width})}st._set("global",{layout:{padding:{top:0,right:0,bottom:0,left:0}}});var ke={defaults:{},addBox:function(t,e){t.boxes||(t.boxes=[]),e.fullWidth=e.fullWidth||!1,e.position=e.position||"top",e.weight=e.weight||0,t.boxes.push(e)},removeBox:function(t,e){var i=t.boxes?t.boxes.indexOf(e):-1;-1!==i&&t.boxes.splice(i,1)},configure:function(t,e,i){for(var n,a=["fullWidth","position","weight"],o=a.length,r=0;r<o;++r)n=a[r],i.hasOwnProperty(n)&&(e[n]=i[n])},update:function(t,e,i){if(t){var n=t.options.layout||{},a=ut.options.toPadding(n.padding),o=a.left,r=a.right,s=a.top,l=a.bottom,d=be(t.boxes,"left"),u=be(t.boxes,"right"),h=be(t.boxes,"top"),c=be(t.boxes,"bottom"),f=be(t.boxes,"chartArea");xe(d,!0),xe(u,!1),xe(h,!0),xe(c,!1);var g,p=d.concat(u),m=h.concat(c),v=p.concat(m),b=e-o-r,x=i-s-l,y=(e-b/2)/p.length,k=b,w=x,M={top:s,left:o,bottom:l,right:r},_=[];ut.each(v,function(t){var e,i=t.isHorizontal();i?(e=t.update(t.fullWidth?b:k,x/2),w-=e.height):(e=t.update(y,w),k-=e.width),_.push({horizontal:i,width:e.width,box:t})}),g=function(t){var e=0,i=0,n=0,a=0;return ut.each(t,function(t){if(t.getPadding){var o=t.getPadding();e=Math.max(e,o.top),i=Math.max(i,o.left),n=Math.max(n,o.bottom),a=Math.max(a,o.right)}}),{top:e,left:i,bottom:n,right:a}}(v),ut.each(p,T),ye(p,M),ut.each(m,T),ye(m,M),ut.each(p,function(t){var e=ut.findNextWhere(_,function(e){return e.box===t}),i={left:0,right:0,top:M.top,bottom:M.bottom};e&&t.update(e.width,w,i)}),ye(v,M={top:s,left:o,bottom:l,right:r});var C=Math.max(g.left-M.left,0);M.left+=C,M.right+=Math.max(g.right-M.right,0);var S=Math.max(g.top-M.top,0);M.top+=S,M.bottom+=Math.max(g.bottom-M.bottom,0);var P=i-M.top-M.bottom,I=e-M.left-M.right;I===k&&P===w||(ut.each(p,function(t){t.height=P}),ut.each(m,function(t){t.fullWidth||(t.width=I)}),w=P,k=I);var A=o+C,D=s+S;ut.each(d.concat(h),F),A+=k,D+=w,ut.each(u,F),ut.each(c,F),t.chartArea={left:M.left,top:M.top,right:M.left+k,bottom:M.top+w},ut.each(f,function(e){e.left=t.chartArea.left,e.top=t.chartArea.top,e.right=t.chartArea.right,e.bottom=t.chartArea.bottom,e.update(k,w)})}function T(t){var e=ut.findNextWhere(_,function(e){return e.box===t});if(e)if(e.horizontal){var i={left:Math.max(M.left,g.left),right:Math.max(M.right,g.right),top:0,bottom:0};t.update(t.fullWidth?b:k,x/2,i)}else t.update(e.width,w)}function F(t){t.isHorizontal()?(t.left=t.fullWidth?o:M.left,t.right=t.fullWidth?e-r:M.left+k,t.top=D,t.bottom=D+t.height,D=t.bottom):(t.left=A,t.right=A+t.width,t.top=M.top,t.bottom=M.top+w,A=t.right)}}};var we,Me=(we=Object.freeze({default:"@keyframes chartjs-render-animation{from{opacity:.99}to{opacity:1}}.chartjs-render-monitor{animation:chartjs-render-animation 1ms}.chartjs-size-monitor,.chartjs-size-monitor-expand,.chartjs-size-monitor-shrink{position:absolute;direction:ltr;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1}.chartjs-size-monitor-expand>div{position:absolute;width:1000000px;height:1000000px;left:0;top:0}.chartjs-size-monitor-shrink>div{position:absolute;width:200%;height:200%;left:0;top:0}"}))&&we.default||we,_e="$chartjs",Ce="chartjs-size-monitor",Se="chartjs-render-monitor",Pe="chartjs-render-animation",Ie=["animationstart","webkitAnimationStart"],Ae={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"};function De(t,e){var i=ut.getStyle(t,e),n=i&&i.match(/^(\d+)(\.\d+)?px$/);return n?Number(n[1]):void 0}var Te=!!function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("e",null,e)}catch(t){}return t}()&&{passive:!0};function Fe(t,e,i){t.addEventListener(e,i,Te)}function Le(t,e,i){t.removeEventListener(e,i,Te)}function Re(t,e,i,n,a){return{type:t,chart:e,native:a||null,x:void 0!==i?i:null,y:void 0!==n?n:null}}function Oe(t){var e=document.createElement("div");return e.className=t||"",e}function ze(t,e,i){var n,a,o,r,s=t[_e]||(t[_e]={}),l=s.resizer=function(t){var e=Oe(Ce),i=Oe(Ce+"-expand"),n=Oe(Ce+"-shrink");i.appendChild(Oe()),n.appendChild(Oe()),e.appendChild(i),e.appendChild(n),e._reset=function(){i.scrollLeft=1e6,i.scrollTop=1e6,n.scrollLeft=1e6,n.scrollTop=1e6};var a=function(){e._reset(),t()};return Fe(i,"scroll",a.bind(i,"expand")),Fe(n,"scroll",a.bind(n,"shrink")),e}((n=function(){if(s.resizer){var n=i.options.maintainAspectRatio&&t.parentNode,a=n?n.clientWidth:0;e(Re("resize",i)),n&&n.clientWidth<a&&i.canvas&&e(Re("resize",i))}},o=!1,r=[],function(){r=Array.prototype.slice.call(arguments),a=a||this,o||(o=!0,ut.requestAnimFrame.call(window,function(){o=!1,n.apply(a,r)}))}));!function(t,e){var i=t[_e]||(t[_e]={}),n=i.renderProxy=function(t){t.animationName===Pe&&e()};ut.each(Ie,function(e){Fe(t,e,n)}),i.reflow=!!t.offsetParent,t.classList.add(Se)}(t,function(){if(s.resizer){var e=t.parentNode;e&&e!==l.parentNode&&e.insertBefore(l,e.firstChild),l._reset()}})}function Be(t){var e=t[_e]||{},i=e.resizer;delete e.resizer,function(t){var e=t[_e]||{},i=e.renderProxy;i&&(ut.each(Ie,function(e){Le(t,e,i)}),delete e.renderProxy),t.classList.remove(Se)}(t),i&&i.parentNode&&i.parentNode.removeChild(i)}var Ne={disableCSSInjection:!1,_enabled:"undefined"!=typeof window&&"undefined"!=typeof document,_ensureLoaded:function(){var t,e,i;this._loaded||(this._loaded=!0,this.disableCSSInjection||(e=Me,i=(t=this)._style||document.createElement("style"),t._style||(t._style=i,e="/* Chart.js */\n"+e,i.setAttribute("type","text/css"),document.getElementsByTagName("head")[0].appendChild(i)),i.appendChild(document.createTextNode(e))))},acquireContext:function(t,e){"string"==typeof t?t=document.getElementById(t):t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas);var i=t&&t.getContext&&t.getContext("2d");return this._ensureLoaded(),i&&i.canvas===t?(function(t,e){var i=t.style,n=t.getAttribute("height"),a=t.getAttribute("width");if(t[_e]={initial:{height:n,width:a,style:{display:i.display,height:i.height,width:i.width}}},i.display=i.display||"block",null===a||""===a){var o=De(t,"width");void 0!==o&&(t.width=o)}if(null===n||""===n)if(""===t.style.height)t.height=t.width/(e.options.aspectRatio||2);else{var r=De(t,"height");void 0!==o&&(t.height=r)}}(t,e),i):null},releaseContext:function(t){var e=t.canvas;if(e[_e]){var i=e[_e].initial;["height","width"].forEach(function(t){var n=i[t];ut.isNullOrUndef(n)?e.removeAttribute(t):e.setAttribute(t,n)}),ut.each(i.style||{},function(t,i){e.style[i]=t}),e.width=e.width,delete e[_e]}},addEventListener:function(t,e,i){var n=t.canvas;if("resize"!==e){var a=i[_e]||(i[_e]={});Fe(n,e,(a.proxies||(a.proxies={}))[t.id+"_"+e]=function(e){i(function(t,e){var i=Ae[t.type]||t.type,n=ut.getRelativePosition(t,e);return Re(i,e,n.x,n.y,t)}(e,t))})}else ze(n,i,t)},removeEventListener:function(t,e,i){var n=t.canvas;if("resize"!==e){var a=((i[_e]||{}).proxies||{})[t.id+"_"+e];a&&Le(n,e,a)}else Be(n)}};ut.addEvent=Fe,ut.removeEvent=Le;var We=Ne._enabled?Ne:{acquireContext:function(t){return t&&t.canvas&&(t=t.canvas),t&&t.getContext("2d")||null}},Ve=ut.extend({initialize:function(){},acquireContext:function(){},releaseContext:function(){},addEventListener:function(){},removeEventListener:function(){}},We);st._set("global",{plugins:{}});var Ee={_plugins:[],_cacheId:0,register:function(t){var e=this._plugins;[].concat(t).forEach(function(t){-1===e.indexOf(t)&&e.push(t)}),this._cacheId++},unregister:function(t){var e=this._plugins;[].concat(t).forEach(function(t){var i=e.indexOf(t);-1!==i&&e.splice(i,1)}),this._cacheId++},clear:function(){this._plugins=[],this._cacheId++},count:function(){return this._plugins.length},getAll:function(){return this._plugins},notify:function(t,e,i){var n,a,o,r,s,l=this.descriptors(t),d=l.length;for(n=0;n<d;++n)if("function"==typeof(s=(o=(a=l[n]).plugin)[e])&&((r=[t].concat(i||[])).push(a.options),!1===s.apply(o,r)))return!1;return!0},descriptors:function(t){var e=t.$plugins||(t.$plugins={});if(e.id===this._cacheId)return e.descriptors;var i=[],n=[],a=t&&t.config||{},o=a.options&&a.options.plugins||{};return this._plugins.concat(a.plugins||[]).forEach(function(t){if(-1===i.indexOf(t)){var e=t.id,a=o[e];!1!==a&&(!0===a&&(a=ut.clone(st.global.plugins[e])),i.push(t),n.push({plugin:t,options:a||{}}))}}),e.descriptors=n,e.id=this._cacheId,n},_invalidate:function(t){delete t.$plugins}},He={constructors:{},defaults:{},registerScaleType:function(t,e,i){this.constructors[t]=e,this.defaults[t]=ut.clone(i)},getScaleConstructor:function(t){return this.constructors.hasOwnProperty(t)?this.constructors[t]:void 0},getScaleDefaults:function(t){return this.defaults.hasOwnProperty(t)?ut.merge({},[st.scale,this.defaults[t]]):{}},updateScaleDefaults:function(t,e){this.defaults.hasOwnProperty(t)&&(this.defaults[t]=ut.extend(this.defaults[t],e))},addScalesToLayout:function(t){ut.each(t.scales,function(e){e.fullWidth=e.options.fullWidth,e.position=e.options.position,e.weight=e.options.weight,ke.addBox(t,e)})}},je=ut.valueOrDefault;st._set("global",{tooltips:{enabled:!0,custom:null,mode:"nearest",position:"average",intersect:!0,backgroundColor:"rgba(0,0,0,0.8)",titleFontStyle:"bold",titleSpacing:2,titleMarginBottom:6,titleFontColor:"#fff",titleAlign:"left",bodySpacing:2,bodyFontColor:"#fff",bodyAlign:"left",footerFontStyle:"bold",footerSpacing:2,footerMarginTop:6,footerFontColor:"#fff",footerAlign:"left",yPadding:6,xPadding:6,caretPadding:2,caretSize:5,cornerRadius:6,multiKeyBackground:"#fff",displayColors:!0,borderColor:"rgba(0,0,0,0)",borderWidth:0,callbacks:{beforeTitle:ut.noop,title:function(t,e){var i="",n=e.labels,a=n?n.length:0;if(t.length>0){var o=t[0];o.label?i=o.label:o.xLabel?i=o.xLabel:a>0&&o.index<a&&(i=n[o.index])}return i},afterTitle:ut.noop,beforeBody:ut.noop,beforeLabel:ut.noop,label:function(t,e){var i=e.datasets[t.datasetIndex].label||"";return i&&(i+=": "),ut.isNullOrUndef(t.value)?i+=t.yLabel:i+=t.value,i},labelColor:function(t,e){var i=e.getDatasetMeta(t.datasetIndex).data[t.index]._view;return{borderColor:i.borderColor,backgroundColor:i.backgroundColor}},labelTextColor:function(){return this._options.bodyFontColor},afterLabel:ut.noop,afterBody:ut.noop,beforeFooter:ut.noop,footer:ut.noop,afterFooter:ut.noop}}});var qe={average:function(t){if(!t.length)return!1;var e,i,n=0,a=0,o=0;for(e=0,i=t.length;e<i;++e){var r=t[e];if(r&&r.hasValue()){var s=r.tooltipPosition();n+=s.x,a+=s.y,++o}}return{x:n/o,y:a/o}},nearest:function(t,e){var i,n,a,o=e.x,r=e.y,s=Number.POSITIVE_INFINITY;for(i=0,n=t.length;i<n;++i){var l=t[i];if(l&&l.hasValue()){var d=l.getCenterPoint(),u=ut.distanceBetweenPoints(e,d);u<s&&(s=u,a=l)}}if(a){var h=a.tooltipPosition();o=h.x,r=h.y}return{x:o,y:r}}};function Ye(t,e){return e&&(ut.isArray(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function Ue(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function Xe(t){var e=st.global;return{xPadding:t.xPadding,yPadding:t.yPadding,xAlign:t.xAlign,yAlign:t.yAlign,bodyFontColor:t.bodyFontColor,_bodyFontFamily:je(t.bodyFontFamily,e.defaultFontFamily),_bodyFontStyle:je(t.bodyFontStyle,e.defaultFontStyle),_bodyAlign:t.bodyAlign,bodyFontSize:je(t.bodyFontSize,e.defaultFontSize),bodySpacing:t.bodySpacing,titleFontColor:t.titleFontColor,_titleFontFamily:je(t.titleFontFamily,e.defaultFontFamily),_titleFontStyle:je(t.titleFontStyle,e.defaultFontStyle),titleFontSize:je(t.titleFontSize,e.defaultFontSize),_titleAlign:t.titleAlign,titleSpacing:t.titleSpacing,titleMarginBottom:t.titleMarginBottom,footerFontColor:t.footerFontColor,_footerFontFamily:je(t.footerFontFamily,e.defaultFontFamily),_footerFontStyle:je(t.footerFontStyle,e.defaultFontStyle),footerFontSize:je(t.footerFontSize,e.defaultFontSize),_footerAlign:t.footerAlign,footerSpacing:t.footerSpacing,footerMarginTop:t.footerMarginTop,caretSize:t.caretSize,cornerRadius:t.cornerRadius,backgroundColor:t.backgroundColor,opacity:0,legendColorBackground:t.multiKeyBackground,displayColors:t.displayColors,borderColor:t.borderColor,borderWidth:t.borderWidth}}function Ke(t,e){return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-t.xPadding:t.x+t.xPadding}function Ge(t){return Ye([],Ue(t))}var Ze=pt.extend({initialize:function(){this._model=Xe(this._options),this._lastActive=[]},getTitle:function(){var t=this._options.callbacks,e=t.beforeTitle.apply(this,arguments),i=t.title.apply(this,arguments),n=t.afterTitle.apply(this,arguments),a=[];return a=Ye(a,Ue(e)),a=Ye(a,Ue(i)),a=Ye(a,Ue(n))},getBeforeBody:function(){return Ge(this._options.callbacks.beforeBody.apply(this,arguments))},getBody:function(t,e){var i=this,n=i._options.callbacks,a=[];return ut.each(t,function(t){var o={before:[],lines:[],after:[]};Ye(o.before,Ue(n.beforeLabel.call(i,t,e))),Ye(o.lines,n.label.call(i,t,e)),Ye(o.after,Ue(n.afterLabel.call(i,t,e))),a.push(o)}),a},getAfterBody:function(){return Ge(this._options.callbacks.afterBody.apply(this,arguments))},getFooter:function(){var t=this._options.callbacks,e=t.beforeFooter.apply(this,arguments),i=t.footer.apply(this,arguments),n=t.afterFooter.apply(this,arguments),a=[];return a=Ye(a,Ue(e)),a=Ye(a,Ue(i)),a=Ye(a,Ue(n))},update:function(t){var e,i,n,a,o,r,s,l,d,u,h=this,c=h._options,f=h._model,g=h._model=Xe(c),p=h._active,m=h._data,v={xAlign:f.xAlign,yAlign:f.yAlign},b={x:f.x,y:f.y},x={width:f.width,height:f.height},y={x:f.caretX,y:f.caretY};if(p.length){g.opacity=1;var k=[],w=[];y=qe[c.position].call(h,p,h._eventPosition);var M=[];for(e=0,i=p.length;e<i;++e)M.push((n=p[e],a=void 0,o=void 0,r=void 0,s=void 0,l=void 0,d=void 0,u=void 0,a=n._xScale,o=n._yScale||n._scale,r=n._index,s=n._datasetIndex,l=n._chart.getDatasetMeta(s).controller,d=l._getIndexScale(),u=l._getValueScale(),{xLabel:a?a.getLabelForIndex(r,s):"",yLabel:o?o.getLabelForIndex(r,s):"",label:d?""+d.getLabelForIndex(r,s):"",value:u?""+u.getLabelForIndex(r,s):"",index:r,datasetIndex:s,x:n._model.x,y:n._model.y}));c.filter&&(M=M.filter(function(t){return c.filter(t,m)})),c.itemSort&&(M=M.sort(function(t,e){return c.itemSort(t,e,m)})),ut.each(M,function(t){k.push(c.callbacks.labelColor.call(h,t,h._chart)),w.push(c.callbacks.labelTextColor.call(h,t,h._chart))}),g.title=h.getTitle(M,m),g.beforeBody=h.getBeforeBody(M,m),g.body=h.getBody(M,m),g.afterBody=h.getAfterBody(M,m),g.footer=h.getFooter(M,m),g.x=y.x,g.y=y.y,g.caretPadding=c.caretPadding,g.labelColors=k,g.labelTextColors=w,g.dataPoints=M,x=function(t,e){var i=t._chart.ctx,n=2*e.yPadding,a=0,o=e.body,r=o.reduce(function(t,e){return t+e.before.length+e.lines.length+e.after.length},0);r+=e.beforeBody.length+e.afterBody.length;var s=e.title.length,l=e.footer.length,d=e.titleFontSize,u=e.bodyFontSize,h=e.footerFontSize;n+=s*d,n+=s?(s-1)*e.titleSpacing:0,n+=s?e.titleMarginBottom:0,n+=r*u,n+=r?(r-1)*e.bodySpacing:0,n+=l?e.footerMarginTop:0,n+=l*h,n+=l?(l-1)*e.footerSpacing:0;var c=0,f=function(t){a=Math.max(a,i.measureText(t).width+c)};return i.font=ut.fontString(d,e._titleFontStyle,e._titleFontFamily),ut.each(e.title,f),i.font=ut.fontString(u,e._bodyFontStyle,e._bodyFontFamily),ut.each(e.beforeBody.concat(e.afterBody),f),c=e.displayColors?u+2:0,ut.each(o,function(t){ut.each(t.before,f),ut.each(t.lines,f),ut.each(t.after,f)}),c=0,i.font=ut.fontString(h,e._footerFontStyle,e._footerFontFamily),ut.each(e.footer,f),{width:a+=2*e.xPadding,height:n}}(this,g),b=function(t,e,i,n){var a=t.x,o=t.y,r=t.caretSize,s=t.caretPadding,l=t.cornerRadius,d=i.xAlign,u=i.yAlign,h=r+s,c=l+s;return"right"===d?a-=e.width:"center"===d&&((a-=e.width/2)+e.width>n.width&&(a=n.width-e.width),a<0&&(a=0)),"top"===u?o+=h:o-="bottom"===u?e.height+h:e.height/2,"center"===u?"left"===d?a+=h:"right"===d&&(a-=h):"left"===d?a-=c:"right"===d&&(a+=c),{x:a,y:o}}(g,x,v=function(t,e){var i,n,a,o,r,s=t._model,l=t._chart,d=t._chart.chartArea,u="center",h="center";s.y<e.height?h="top":s.y>l.height-e.height&&(h="bottom");var c=(d.left+d.right)/2,f=(d.top+d.bottom)/2;"center"===h?(i=function(t){return t<=c},n=function(t){return t>c}):(i=function(t){return t<=e.width/2},n=function(t){return t>=l.width-e.width/2}),a=function(t){return t+e.width+s.caretSize+s.caretPadding>l.width},o=function(t){return t-e.width-s.caretSize-s.caretPadding<0},r=function(t){return t<=f?"top":"bottom"},i(s.x)?(u="left",a(s.x)&&(u="center",h=r(s.y))):n(s.x)&&(u="right",o(s.x)&&(u="center",h=r(s.y)));var g=t._options;return{xAlign:g.xAlign?g.xAlign:u,yAlign:g.yAlign?g.yAlign:h}}(this,x),h._chart)}else g.opacity=0;return g.xAlign=v.xAlign,g.yAlign=v.yAlign,g.x=b.x,g.y=b.y,g.width=x.width,g.height=x.height,g.caretX=y.x,g.caretY=y.y,h._model=g,t&&c.custom&&c.custom.call(h,g),h},drawCaret:function(t,e){var i=this._chart.ctx,n=this._view,a=this.getCaretPosition(t,e,n);i.lineTo(a.x1,a.y1),i.lineTo(a.x2,a.y2),i.lineTo(a.x3,a.y3)},getCaretPosition:function(t,e,i){var n,a,o,r,s,l,d=i.caretSize,u=i.cornerRadius,h=i.xAlign,c=i.yAlign,f=t.x,g=t.y,p=e.width,m=e.height;if("center"===c)s=g+m/2,"left"===h?(a=(n=f)-d,o=n,r=s+d,l=s-d):(a=(n=f+p)+d,o=n,r=s-d,l=s+d);else if("left"===h?(n=(a=f+u+d)-d,o=a+d):"right"===h?(n=(a=f+p-u-d)-d,o=a+d):(n=(a=i.caretX)-d,o=a+d),"top"===c)s=(r=g)-d,l=r;else{s=(r=g+m)+d,l=r;var v=o;o=n,n=v}return{x1:n,x2:a,x3:o,y1:r,y2:s,y3:l}},drawTitle:function(t,e,i){var n=e.title;if(n.length){t.x=Ke(e,e._titleAlign),i.textAlign=e._titleAlign,i.textBaseline="top";var a,o,r=e.titleFontSize,s=e.titleSpacing;for(i.fillStyle=e.titleFontColor,i.font=ut.fontString(r,e._titleFontStyle,e._titleFontFamily),a=0,o=n.length;a<o;++a)i.fillText(n[a],t.x,t.y),t.y+=r+s,a+1===n.length&&(t.y+=e.titleMarginBottom-s)}},drawBody:function(t,e,i){var n,a=e.bodyFontSize,o=e.bodySpacing,r=e._bodyAlign,s=e.body,l=e.displayColors,d=e.labelColors,u=0,h=l?Ke(e,"left"):0;i.textAlign=r,i.textBaseline="top",i.font=ut.fontString(a,e._bodyFontStyle,e._bodyFontFamily),t.x=Ke(e,r);var c=function(e){i.fillText(e,t.x+u,t.y),t.y+=a+o};i.fillStyle=e.bodyFontColor,ut.each(e.beforeBody,c),u=l&&"right"!==r?"center"===r?a/2+1:a+2:0,ut.each(s,function(o,r){n=e.labelTextColors[r],i.fillStyle=n,ut.each(o.before,c),ut.each(o.lines,function(o){l&&(i.fillStyle=e.legendColorBackground,i.fillRect(h,t.y,a,a),i.lineWidth=1,i.strokeStyle=d[r].borderColor,i.strokeRect(h,t.y,a,a),i.fillStyle=d[r].backgroundColor,i.fillRect(h+1,t.y+1,a-2,a-2),i.fillStyle=n),c(o)}),ut.each(o.after,c)}),u=0,ut.each(e.afterBody,c),t.y-=o},drawFooter:function(t,e,i){var n=e.footer;n.length&&(t.x=Ke(e,e._footerAlign),t.y+=e.footerMarginTop,i.textAlign=e._footerAlign,i.textBaseline="top",i.fillStyle=e.footerFontColor,i.font=ut.fontString(e.footerFontSize,e._footerFontStyle,e._footerFontFamily),ut.each(n,function(n){i.fillText(n,t.x,t.y),t.y+=e.footerFontSize+e.footerSpacing}))},drawBackground:function(t,e,i,n){i.fillStyle=e.backgroundColor,i.strokeStyle=e.borderColor,i.lineWidth=e.borderWidth;var a=e.xAlign,o=e.yAlign,r=t.x,s=t.y,l=n.width,d=n.height,u=e.cornerRadius;i.beginPath(),i.moveTo(r+u,s),"top"===o&&this.drawCaret(t,n),i.lineTo(r+l-u,s),i.quadraticCurveTo(r+l,s,r+l,s+u),"center"===o&&"right"===a&&this.drawCaret(t,n),i.lineTo(r+l,s+d-u),i.quadraticCurveTo(r+l,s+d,r+l-u,s+d),"bottom"===o&&this.drawCaret(t,n),i.lineTo(r+u,s+d),i.quadraticCurveTo(r,s+d,r,s+d-u),"center"===o&&"left"===a&&this.drawCaret(t,n),i.lineTo(r,s+u),i.quadraticCurveTo(r,s,r+u,s),i.closePath(),i.fill(),e.borderWidth>0&&i.stroke()},draw:function(){var t=this._chart.ctx,e=this._view;if(0!==e.opacity){var i={width:e.width,height:e.height},n={x:e.x,y:e.y},a=Math.abs(e.opacity<.001)?0:e.opacity,o=e.title.length||e.beforeBody.length||e.body.length||e.afterBody.length||e.footer.length;this._options.enabled&&o&&(t.save(),t.globalAlpha=a,this.drawBackground(n,e,t,i),n.y+=e.yPadding,this.drawTitle(n,e,t),this.drawBody(n,e,t),this.drawFooter(n,e,t),t.restore())}},handleEvent:function(t){var e,i=this,n=i._options;return i._lastActive=i._lastActive||[],"mouseout"===t.type?i._active=[]:i._active=i._chart.getElementsAtEventForMode(t,n.mode,n),(e=!ut.arrayEquals(i._active,i._lastActive))&&(i._lastActive=i._active,(n.enabled||n.custom)&&(i._eventPosition={x:t.x,y:t.y},i.update(!0),i.pivot())),e}}),$e=qe,Je=Ze;Je.positioners=$e;var Qe=ut.valueOrDefault;function ti(){return ut.merge({},[].slice.call(arguments),{merger:function(t,e,i,n){if("xAxes"===t||"yAxes"===t){var a,o,r,s=i[t].length;for(e[t]||(e[t]=[]),a=0;a<s;++a)r=i[t][a],o=Qe(r.type,"xAxes"===t?"category":"linear"),a>=e[t].length&&e[t].push({}),!e[t][a].type||r.type&&r.type!==e[t][a].type?ut.merge(e[t][a],[He.getScaleDefaults(o),r]):ut.merge(e[t][a],r)}else ut._merger(t,e,i,n)}})}function ei(){return ut.merge({},[].slice.call(arguments),{merger:function(t,e,i,n){var a=e[t]||{},o=i[t];"scales"===t?e[t]=ti(a,o):"scale"===t?e[t]=ut.merge(a,[He.getScaleDefaults(o.type),o]):ut._merger(t,e,i,n)}})}function ii(t){return"top"===t||"bottom"===t}st._set("global",{elements:{},events:["mousemove","mouseout","click","touchstart","touchmove"],hover:{onHover:null,mode:"nearest",intersect:!0,animationDuration:400},onClick:null,maintainAspectRatio:!0,responsive:!0,responsiveAnimationDuration:0});var ni=function(t,e){return this.construct(t,e),this};ut.extend(ni.prototype,{construct:function(t,e){var i=this;e=function(t){var e=(t=t||{}).data=t.data||{};return e.datasets=e.datasets||[],e.labels=e.labels||[],t.options=ei(st.global,st[t.type],t.options||{}),t}(e);var n=Ve.acquireContext(t,e),a=n&&n.canvas,o=a&&a.height,r=a&&a.width;i.id=ut.uid(),i.ctx=n,i.canvas=a,i.config=e,i.width=r,i.height=o,i.aspectRatio=o?r/o:null,i.options=e.options,i._bufferedRender=!1,i.chart=i,i.controller=i,ni.instances[i.id]=i,Object.defineProperty(i,"data",{get:function(){return i.config.data},set:function(t){i.config.data=t}}),n&&a?(i.initialize(),i.update()):console.error("Failed to create chart: can't acquire context from the given item")},initialize:function(){var t=this;return Ee.notify(t,"beforeInit"),ut.retinaScale(t,t.options.devicePixelRatio),t.bindEvents(),t.options.responsive&&t.resize(!0),t.ensureScalesHaveIDs(),t.buildOrUpdateScales(),t.initToolTip(),Ee.notify(t,"afterInit"),t},clear:function(){return ut.canvas.clear(this),this},stop:function(){return bt.cancelAnimation(this),this},resize:function(t){var e=this,i=e.options,n=e.canvas,a=i.maintainAspectRatio&&e.aspectRatio||null,o=Math.max(0,Math.floor(ut.getMaximumWidth(n))),r=Math.max(0,Math.floor(a?o/a:ut.getMaximumHeight(n)));if((e.width!==o||e.height!==r)&&(n.width=e.width=o,n.height=e.height=r,n.style.width=o+"px",n.style.height=r+"px",ut.retinaScale(e,i.devicePixelRatio),!t)){var s={width:o,height:r};Ee.notify(e,"resize",[s]),i.onResize&&i.onResize(e,s),e.stop(),e.update({duration:i.responsiveAnimationDuration})}},ensureScalesHaveIDs:function(){var t=this.options,e=t.scales||{},i=t.scale;ut.each(e.xAxes,function(t,e){t.id=t.id||"x-axis-"+e}),ut.each(e.yAxes,function(t,e){t.id=t.id||"y-axis-"+e}),i&&(i.id=i.id||"scale")},buildOrUpdateScales:function(){var t=this,e=t.options,i=t.scales||{},n=[],a=Object.keys(i).reduce(function(t,e){return t[e]=!1,t},{});e.scales&&(n=n.concat((e.scales.xAxes||[]).map(function(t){return{options:t,dtype:"category",dposition:"bottom"}}),(e.scales.yAxes||[]).map(function(t){return{options:t,dtype:"linear",dposition:"left"}}))),e.scale&&n.push({options:e.scale,dtype:"radialLinear",isDefault:!0,dposition:"chartArea"}),ut.each(n,function(e){var n=e.options,o=n.id,r=Qe(n.type,e.dtype);ii(n.position)!==ii(e.dposition)&&(n.position=e.dposition),a[o]=!0;var s=null;if(o in i&&i[o].type===r)(s=i[o]).options=n,s.ctx=t.ctx,s.chart=t;else{var l=He.getScaleConstructor(r);if(!l)return;s=new l({id:o,type:r,options:n,ctx:t.ctx,chart:t}),i[s.id]=s}s.mergeTicksOptions(),e.isDefault&&(t.scale=s)}),ut.each(a,function(t,e){t||delete i[e]}),t.scales=i,He.addScalesToLayout(this)},buildOrUpdateControllers:function(){var t=this,e=[];return ut.each(t.data.datasets,function(i,n){var a=t.getDatasetMeta(n),o=i.type||t.config.type;if(a.type&&a.type!==o&&(t.destroyDatasetMeta(n),a=t.getDatasetMeta(n)),a.type=o,a.controller)a.controller.updateIndex(n),a.controller.linkScales();else{var r=ue[a.type];if(void 0===r)throw new Error('"'+a.type+'" is not a chart type.');a.controller=new r(t,n),e.push(a.controller)}},t),e},resetElements:function(){var t=this;ut.each(t.data.datasets,function(e,i){t.getDatasetMeta(i).controller.reset()},t)},reset:function(){this.resetElements(),this.tooltip.initialize()},update:function(t){var e,i,n=this;if(t&&"object"==typeof t||(t={duration:t,lazy:arguments[1]}),i=(e=n).options,ut.each(e.scales,function(t){ke.removeBox(e,t)}),i=ei(st.global,st[e.config.type],i),e.options=e.config.options=i,e.ensureScalesHaveIDs(),e.buildOrUpdateScales(),e.tooltip._options=i.tooltips,e.tooltip.initialize(),Ee._invalidate(n),!1!==Ee.notify(n,"beforeUpdate")){n.tooltip._data=n.data;var a=n.buildOrUpdateControllers();ut.each(n.data.datasets,function(t,e){n.getDatasetMeta(e).controller.buildOrUpdateElements()},n),n.updateLayout(),n.options.animation&&n.options.animation.duration&&ut.each(a,function(t){t.reset()}),n.updateDatasets(),n.tooltip.initialize(),n.lastActive=[],Ee.notify(n,"afterUpdate"),n._bufferedRender?n._bufferedRequest={duration:t.duration,easing:t.easing,lazy:t.lazy}:n.render(t)}},updateLayout:function(){!1!==Ee.notify(this,"beforeLayout")&&(ke.update(this,this.width,this.height),Ee.notify(this,"afterScaleUpdate"),Ee.notify(this,"afterLayout"))},updateDatasets:function(){if(!1!==Ee.notify(this,"beforeDatasetsUpdate")){for(var t=0,e=this.data.datasets.length;t<e;++t)this.updateDataset(t);Ee.notify(this,"afterDatasetsUpdate")}},updateDataset:function(t){var e=this.getDatasetMeta(t),i={meta:e,index:t};!1!==Ee.notify(this,"beforeDatasetUpdate",[i])&&(e.controller.update(),Ee.notify(this,"afterDatasetUpdate",[i]))},render:function(t){var e=this;t&&"object"==typeof t||(t={duration:t,lazy:arguments[1]});var i=e.options.animation,n=Qe(t.duration,i&&i.duration),a=t.lazy;if(!1!==Ee.notify(e,"beforeRender")){var o=function(t){Ee.notify(e,"afterRender"),ut.callback(i&&i.onComplete,[t],e)};if(i&&n){var r=new vt({numSteps:n/16.66,easing:t.easing||i.easing,render:function(t,e){var i=ut.easing.effects[e.easing],n=e.currentStep,a=n/e.numSteps;t.draw(i(a),a,n)},onAnimationProgress:i.onProgress,onAnimationComplete:o});bt.addAnimation(e,r,n,a)}else e.draw(),o(new vt({numSteps:0,chart:e}));return e}},draw:function(t){var e=this;e.clear(),ut.isNullOrUndef(t)&&(t=1),e.transition(t),e.width<=0||e.height<=0||!1!==Ee.notify(e,"beforeDraw",[t])&&(ut.each(e.boxes,function(t){t.draw(e.chartArea)},e),e.drawDatasets(t),e._drawTooltip(t),Ee.notify(e,"afterDraw",[t]))},transition:function(t){for(var e=0,i=(this.data.datasets||[]).length;e<i;++e)this.isDatasetVisible(e)&&this.getDatasetMeta(e).controller.transition(t);this.tooltip.transition(t)},drawDatasets:function(t){var e=this;if(!1!==Ee.notify(e,"beforeDatasetsDraw",[t])){for(var i=(e.data.datasets||[]).length-1;i>=0;--i)e.isDatasetVisible(i)&&e.drawDataset(i,t);Ee.notify(e,"afterDatasetsDraw",[t])}},drawDataset:function(t,e){var i=this.getDatasetMeta(t),n={meta:i,index:t,easingValue:e};!1!==Ee.notify(this,"beforeDatasetDraw",[n])&&(i.controller.draw(e),Ee.notify(this,"afterDatasetDraw",[n]))},_drawTooltip:function(t){var e=this.tooltip,i={tooltip:e,easingValue:t};!1!==Ee.notify(this,"beforeTooltipDraw",[i])&&(e.draw(),Ee.notify(this,"afterTooltipDraw",[i]))},getElementAtEvent:function(t){return ve.modes.single(this,t)},getElementsAtEvent:function(t){return ve.modes.label(this,t,{intersect:!0})},getElementsAtXAxis:function(t){return ve.modes["x-axis"](this,t,{intersect:!0})},getElementsAtEventForMode:function(t,e,i){var n=ve.modes[e];return"function"==typeof n?n(this,t,i):[]},getDatasetAtEvent:function(t){return ve.modes.dataset(this,t,{intersect:!0})},getDatasetMeta:function(t){var e=this.data.datasets[t];e._meta||(e._meta={});var i=e._meta[this.id];return i||(i=e._meta[this.id]={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null}),i},getVisibleDatasetCount:function(){for(var t=0,e=0,i=this.data.datasets.length;e<i;++e)this.isDatasetVisible(e)&&t++;return t},isDatasetVisible:function(t){var e=this.getDatasetMeta(t);return"boolean"==typeof e.hidden?!e.hidden:!this.data.datasets[t].hidden},generateLegend:function(){return this.options.legendCallback(this)},destroyDatasetMeta:function(t){var e=this.id,i=this.data.datasets[t],n=i._meta&&i._meta[e];n&&(n.controller.destroy(),delete i._meta[e])},destroy:function(){var t,e,i=this,n=i.canvas;for(i.stop(),t=0,e=i.data.datasets.length;t<e;++t)i.destroyDatasetMeta(t);n&&(i.unbindEvents(),ut.canvas.clear(i),Ve.releaseContext(i.ctx),i.canvas=null,i.ctx=null),Ee.notify(i,"destroy"),delete ni.instances[i.id]},toBase64Image:function(){return this.canvas.toDataURL.apply(this.canvas,arguments)},initToolTip:function(){var t=this;t.tooltip=new Je({_chart:t,_chartInstance:t,_data:t.data,_options:t.options.tooltips},t)},bindEvents:function(){var t=this,e=t._listeners={},i=function(){t.eventHandler.apply(t,arguments)};ut.each(t.options.events,function(n){Ve.addEventListener(t,n,i),e[n]=i}),t.options.responsive&&(i=function(){t.resize()},Ve.addEventListener(t,"resize",i),e.resize=i)},unbindEvents:function(){var t=this,e=t._listeners;e&&(delete t._listeners,ut.each(e,function(e,i){Ve.removeEventListener(t,i,e)}))},updateHoverStyle:function(t,e,i){var n,a,o,r=i?"setHoverStyle":"removeHoverStyle";for(a=0,o=t.length;a<o;++a)(n=t[a])&&this.getDatasetMeta(n._datasetIndex).controller[r](n)},eventHandler:function(t){var e=this,i=e.tooltip;if(!1!==Ee.notify(e,"beforeEvent",[t])){e._bufferedRender=!0,e._bufferedRequest=null;var n=e.handleEvent(t);i&&(n=i._start?i.handleEvent(t):n|i.handleEvent(t)),Ee.notify(e,"afterEvent",[t]);var a=e._bufferedRequest;return a?e.render(a):n&&!e.animating&&(e.stop(),e.render({duration:e.options.hover.animationDuration,lazy:!0})),e._bufferedRender=!1,e._bufferedRequest=null,e}},handleEvent:function(t){var e,i=this,n=i.options||{},a=n.hover;return i.lastActive=i.lastActive||[],"mouseout"===t.type?i.active=[]:i.active=i.getElementsAtEventForMode(t,a.mode,a),ut.callback(n.onHover||n.hover.onHover,[t.native,i.active],i),"mouseup"!==t.type&&"click"!==t.type||n.onClick&&n.onClick.call(i,t.native,i.active),i.lastActive.length&&i.updateHoverStyle(i.lastActive,a.mode,!1),i.active.length&&a.mode&&i.updateHoverStyle(i.active,a.mode,!0),e=!ut.arrayEquals(i.active,i.lastActive),i.lastActive=i.active,e}}),ni.instances={};var ai=ni;ni.Controller=ni,ni.types={},ut.configMerge=ei,ut.scaleMerge=ti;function oi(){throw new Error("This method is not implemented: either no adapter can be found or an incomplete integration was provided.")}function ri(t){this.options=t||{}}ut.extend(ri.prototype,{formats:oi,parse:oi,format:oi,add:oi,diff:oi,startOf:oi,endOf:oi,_create:function(t){return t}}),ri.override=function(t){ut.extend(ri.prototype,t)};var si={_date:ri},li={formatters:{values:function(t){return ut.isArray(t)?t:""+t},linear:function(t,e,i){var n=i.length>3?i[2]-i[1]:i[1]-i[0];Math.abs(n)>1&&t!==Math.floor(t)&&(n=t-Math.floor(t));var a=ut.log10(Math.abs(n)),o="";if(0!==t)if(Math.max(Math.abs(i[0]),Math.abs(i[i.length-1]))<1e-4){var r=ut.log10(Math.abs(t));o=t.toExponential(Math.floor(r)-Math.floor(a))}else{var s=-1*Math.floor(a);s=Math.max(Math.min(s,20),0),o=t.toFixed(s)}else o="0";return o},logarithmic:function(t,e,i){var n=t/Math.pow(10,Math.floor(ut.log10(t)));return 0===t?"0":1===n||2===n||5===n||0===e||e===i.length-1?t.toExponential():""}}},di=ut.valueOrDefault,ui=ut.valueAtIndexOrDefault;function hi(t){var e,i,n=[];for(e=0,i=t.length;e<i;++e)n.push(t[e].label);return n}function ci(t,e,i){return ut.isArray(e)?ut.longestText(t,i,e):t.measureText(e).width}st._set("scale",{display:!0,position:"left",offset:!1,gridLines:{display:!0,color:"rgba(0, 0, 0, 0.1)",lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickMarkLength:10,zeroLineWidth:1,zeroLineColor:"rgba(0,0,0,0.25)",zeroLineBorderDash:[],zeroLineBorderDashOffset:0,offsetGridLines:!1,borderDash:[],borderDashOffset:0},scaleLabel:{display:!1,labelString:"",padding:{top:4,bottom:4}},ticks:{beginAtZero:!1,minRotation:0,maxRotation:50,mirror:!1,padding:0,reverse:!1,display:!0,autoSkip:!0,autoSkipPadding:0,labelOffset:0,callback:li.formatters.values,minor:{},major:{}}});var fi=pt.extend({getPadding:function(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}},getTicks:function(){return this._ticks},mergeTicksOptions:function(){var t=this.options.ticks;for(var e in!1===t.minor&&(t.minor={display:!1}),!1===t.major&&(t.major={display:!1}),t)"major"!==e&&"minor"!==e&&(void 0===t.minor[e]&&(t.minor[e]=t[e]),void 0===t.major[e]&&(t.major[e]=t[e]))},beforeUpdate:function(){ut.callback(this.options.beforeUpdate,[this])},update:function(t,e,i){var n,a,o,r,s,l,d=this;for(d.beforeUpdate(),d.maxWidth=t,d.maxHeight=e,d.margins=ut.extend({left:0,right:0,top:0,bottom:0},i),d._maxLabelLines=0,d.longestLabelWidth=0,d.longestTextCache=d.longestTextCache||{},d.beforeSetDimensions(),d.setDimensions(),d.afterSetDimensions(),d.beforeDataLimits(),d.determineDataLimits(),d.afterDataLimits(),d.beforeBuildTicks(),s=d.buildTicks()||[],s=d.afterBuildTicks(s)||s,d.beforeTickToLabelConversion(),o=d.convertTicksToLabels(s)||d.ticks,d.afterTickToLabelConversion(),d.ticks=o,n=0,a=o.length;n<a;++n)r=o[n],(l=s[n])?l.label=r:s.push(l={label:r,major:!1});return d._ticks=s,d.beforeCalculateTickRotation(),d.calculateTickRotation(),d.afterCalculateTickRotation(),d.beforeFit(),d.fit(),d.afterFit(),d.afterUpdate(),d.minSize},afterUpdate:function(){ut.callback(this.options.afterUpdate,[this])},beforeSetDimensions:function(){ut.callback(this.options.beforeSetDimensions,[this])},setDimensions:function(){var t=this;t.isHorizontal()?(t.width=t.maxWidth,t.left=0,t.right=t.width):(t.height=t.maxHeight,t.top=0,t.bottom=t.height),t.paddingLeft=0,t.paddingTop=0,t.paddingRight=0,t.paddingBottom=0},afterSetDimensions:function(){ut.callback(this.options.afterSetDimensions,[this])},beforeDataLimits:function(){ut.callback(this.options.beforeDataLimits,[this])},determineDataLimits:ut.noop,afterDataLimits:function(){ut.callback(this.options.afterDataLimits,[this])},beforeBuildTicks:function(){ut.callback(this.options.beforeBuildTicks,[this])},buildTicks:ut.noop,afterBuildTicks:function(t){var e=this;return ut.isArray(t)&&t.length?ut.callback(e.options.afterBuildTicks,[e,t]):(e.ticks=ut.callback(e.options.afterBuildTicks,[e,e.ticks])||e.ticks,t)},beforeTickToLabelConversion:function(){ut.callback(this.options.beforeTickToLabelConversion,[this])},convertTicksToLabels:function(){var t=this.options.ticks;this.ticks=this.ticks.map(t.userCallback||t.callback,this)},afterTickToLabelConversion:function(){ut.callback(this.options.afterTickToLabelConversion,[this])},beforeCalculateTickRotation:function(){ut.callback(this.options.beforeCalculateTickRotation,[this])},calculateTickRotation:function(){var t=this,e=t.ctx,i=t.options.ticks,n=hi(t._ticks),a=ut.options._parseFont(i);e.font=a.string;var o=i.minRotation||0;if(n.length&&t.options.display&&t.isHorizontal())for(var r,s=ut.longestText(e,a.string,n,t.longestTextCache),l=s,d=t.getPixelForTick(1)-t.getPixelForTick(0)-6;l>d&&o<i.maxRotation;){var u=ut.toRadians(o);if(r=Math.cos(u),Math.sin(u)*s>t.maxHeight){o--;break}o++,l=r*s}t.labelRotation=o},afterCalculateTickRotation:function(){ut.callback(this.options.afterCalculateTickRotation,[this])},beforeFit:function(){ut.callback(this.options.beforeFit,[this])},fit:function(){var t=this,e=t.minSize={width:0,height:0},i=hi(t._ticks),n=t.options,a=n.ticks,o=n.scaleLabel,r=n.gridLines,s=t._isVisible(),l=n.position,d=t.isHorizontal(),u=ut.options._parseFont,h=u(a),c=n.gridLines.tickMarkLength;if(e.width=d?t.isFullWidth()?t.maxWidth-t.margins.left-t.margins.right:t.maxWidth:s&&r.drawTicks?c:0,e.height=d?s&&r.drawTicks?c:0:t.maxHeight,o.display&&s){var f=u(o),g=ut.options.toPadding(o.padding),p=f.lineHeight+g.height;d?e.height+=p:e.width+=p}if(a.display&&s){var m=ut.longestText(t.ctx,h.string,i,t.longestTextCache),v=ut.numberOfLabelLines(i),b=.5*h.size,x=t.options.ticks.padding;if(t._maxLabelLines=v,t.longestLabelWidth=m,d){var y=ut.toRadians(t.labelRotation),k=Math.cos(y),w=Math.sin(y)*m+h.lineHeight*v+b;e.height=Math.min(t.maxHeight,e.height+w+x),t.ctx.font=h.string;var M,_,C=ci(t.ctx,i[0],h.string),S=ci(t.ctx,i[i.length-1],h.string),P=t.getPixelForTick(0)-t.left,I=t.right-t.getPixelForTick(i.length-1);0!==t.labelRotation?(M="bottom"===l?k*C:k*b,_="bottom"===l?k*b:k*S):(M=C/2,_=S/2),t.paddingLeft=Math.max(M-P,0)+3,t.paddingRight=Math.max(_-I,0)+3}else a.mirror?m=0:m+=x+b,e.width=Math.min(t.maxWidth,e.width+m),t.paddingTop=h.size/2,t.paddingBottom=h.size/2}t.handleMargins(),t.width=e.width,t.height=e.height},handleMargins:function(){var t=this;t.margins&&(t.paddingLeft=Math.max(t.paddingLeft-t.margins.left,0),t.paddingTop=Math.max(t.paddingTop-t.margins.top,0),t.paddingRight=Math.max(t.paddingRight-t.margins.right,0),t.paddingBottom=Math.max(t.paddingBottom-t.margins.bottom,0))},afterFit:function(){ut.callback(this.options.afterFit,[this])},isHorizontal:function(){return"top"===this.options.position||"bottom"===this.options.position},isFullWidth:function(){return this.options.fullWidth},getRightValue:function(t){if(ut.isNullOrUndef(t))return NaN;if(("number"==typeof t||t instanceof Number)&&!isFinite(t))return NaN;if(t)if(this.isHorizontal()){if(void 0!==t.x)return this.getRightValue(t.x)}else if(void 0!==t.y)return this.getRightValue(t.y);return t},getLabelForIndex:ut.noop,getPixelForValue:ut.noop,getValueForPixel:ut.noop,getPixelForTick:function(t){var e=this,i=e.options.offset;if(e.isHorizontal()){var n=(e.width-(e.paddingLeft+e.paddingRight))/Math.max(e._ticks.length-(i?0:1),1),a=n*t+e.paddingLeft;i&&(a+=n/2);var o=e.left+a;return o+=e.isFullWidth()?e.margins.left:0}var r=e.height-(e.paddingTop+e.paddingBottom);return e.top+t*(r/(e._ticks.length-1))},getPixelForDecimal:function(t){var e=this;if(e.isHorizontal()){var i=(e.width-(e.paddingLeft+e.paddingRight))*t+e.paddingLeft,n=e.left+i;return n+=e.isFullWidth()?e.margins.left:0}return e.top+t*e.height},getBasePixel:function(){return this.getPixelForValue(this.getBaseValue())},getBaseValue:function(){var t=this.min,e=this.max;return this.beginAtZero?0:t<0&&e<0?e:t>0&&e>0?t:0},_autoSkip:function(t){var e,i,n=this,a=n.isHorizontal(),o=n.options.ticks.minor,r=t.length,s=!1,l=o.maxTicksLimit,d=n._tickSize()*(r-1),u=a?n.width-(n.paddingLeft+n.paddingRight):n.height-(n.paddingTop+n.PaddingBottom),h=[];for(d>u&&(s=1+Math.floor(d/u)),r>l&&(s=Math.max(s,1+Math.floor(r/l))),e=0;e<r;e++)i=t[e],s>1&&e%s>0&&delete i.label,h.push(i);return h},_tickSize:function(){var t=this,e=t.isHorizontal(),i=t.options.ticks.minor,n=ut.toRadians(t.labelRotation),a=Math.abs(Math.cos(n)),o=Math.abs(Math.sin(n)),r=i.autoSkipPadding||0,s=t.longestLabelWidth+r||0,l=ut.options._parseFont(i),d=t._maxLabelLines*l.lineHeight+r||0;return e?d*a>s*o?s/a:d/o:d*o<s*a?d/a:s/o},_isVisible:function(){var t,e,i,n=this.chart,a=this.options.display;if("auto"!==a)return!!a;for(t=0,e=n.data.datasets.length;t<e;++t)if(n.isDatasetVisible(t)&&((i=n.getDatasetMeta(t)).xAxisID===this.id||i.yAxisID===this.id))return!0;return!1},draw:function(t){var e=this,i=e.options;if(e._isVisible()){var n,a,o,r=e.chart,s=e.ctx,l=st.global.defaultFontColor,d=i.ticks.minor,u=i.ticks.major||d,h=i.gridLines,c=i.scaleLabel,f=i.position,g=0!==e.labelRotation,p=d.mirror,m=e.isHorizontal(),v=ut.options._parseFont,b=d.display&&d.autoSkip?e._autoSkip(e.getTicks()):e.getTicks(),x=di(d.fontColor,l),y=v(d),k=y.lineHeight,w=di(u.fontColor,l),M=v(u),_=d.padding,C=d.labelOffset,S=h.drawTicks?h.tickMarkLength:0,P=di(c.fontColor,l),I=v(c),A=ut.options.toPadding(c.padding),D=ut.toRadians(e.labelRotation),T=[],F=h.drawBorder?ui(h.lineWidth,0,0):0,L=ut._alignPixel;"top"===f?(n=L(r,e.bottom,F),a=e.bottom-S,o=n-F/2):"bottom"===f?(n=L(r,e.top,F),a=n+F/2,o=e.top+S):"left"===f?(n=L(r,e.right,F),a=e.right-S,o=n-F/2):(n=L(r,e.left,F),a=n+F/2,o=e.left+S);if(ut.each(b,function(n,s){if(!ut.isNullOrUndef(n.label)){var l,d,u,c,v,b,x,y,w,M,P,I,A,R,O,z,B=n.label;s===e.zeroLineIndex&&i.offset===h.offsetGridLines?(l=h.zeroLineWidth,d=h.zeroLineColor,u=h.zeroLineBorderDash||[],c=h.zeroLineBorderDashOffset||0):(l=ui(h.lineWidth,s),d=ui(h.color,s),u=h.borderDash||[],c=h.borderDashOffset||0);var N=ut.isArray(B)?B.length:1,W=function(t,e,i){var n=t.getPixelForTick(e);return i&&(1===t.getTicks().length?n-=t.isHorizontal()?Math.max(n-t.left,t.right-n):Math.max(n-t.top,t.bottom-n):n-=0===e?(t.getPixelForTick(1)-n)/2:(n-t.getPixelForTick(e-1))/2),n}(e,s,h.offsetGridLines);if(m){var V=S+_;W<e.left-1e-7&&(d="rgba(0,0,0,0)"),v=x=w=P=L(r,W,l),b=a,y=o,A=e.getPixelForTick(s)+C,"top"===f?(M=L(r,t.top,F)+F/2,I=t.bottom,O=((g?1:.5)-N)*k,z=g?"left":"center",R=e.bottom-V):(M=t.top,I=L(r,t.bottom,F)-F/2,O=(g?0:.5)*k,z=g?"right":"center",R=e.top+V)}else{var E=(p?0:S)+_;W<e.top-1e-7&&(d="rgba(0,0,0,0)"),v=a,x=o,b=y=M=I=L(r,W,l),R=e.getPixelForTick(s)+C,O=(1-N)*k/2,"left"===f?(w=L(r,t.left,F)+F/2,P=t.right,z=p?"left":"right",A=e.right-E):(w=t.left,P=L(r,t.right,F)-F/2,z=p?"right":"left",A=e.left+E)}T.push({tx1:v,ty1:b,tx2:x,ty2:y,x1:w,y1:M,x2:P,y2:I,labelX:A,labelY:R,glWidth:l,glColor:d,glBorderDash:u,glBorderDashOffset:c,rotation:-1*D,label:B,major:n.major,textOffset:O,textAlign:z})}}),ut.each(T,function(t){var e=t.glWidth,i=t.glColor;if(h.display&&e&&i&&(s.save(),s.lineWidth=e,s.strokeStyle=i,s.setLineDash&&(s.setLineDash(t.glBorderDash),s.lineDashOffset=t.glBorderDashOffset),s.beginPath(),h.drawTicks&&(s.moveTo(t.tx1,t.ty1),s.lineTo(t.tx2,t.ty2)),h.drawOnChartArea&&(s.moveTo(t.x1,t.y1),s.lineTo(t.x2,t.y2)),s.stroke(),s.restore()),d.display){s.save(),s.translate(t.labelX,t.labelY),s.rotate(t.rotation),s.font=t.major?M.string:y.string,s.fillStyle=t.major?w:x,s.textBaseline="middle",s.textAlign=t.textAlign;var n=t.label,a=t.textOffset;if(ut.isArray(n))for(var o=0;o<n.length;++o)s.fillText(""+n[o],0,a),a+=k;else s.fillText(n,0,a);s.restore()}}),c.display){var R,O,z=0,B=I.lineHeight/2;if(m)R=e.left+(e.right-e.left)/2,O="bottom"===f?e.bottom-B-A.bottom:e.top+B+A.top;else{var N="left"===f;R=N?e.left+B+A.top:e.right-B-A.top,O=e.top+(e.bottom-e.top)/2,z=N?-.5*Math.PI:.5*Math.PI}s.save(),s.translate(R,O),s.rotate(z),s.textAlign="center",s.textBaseline="middle",s.fillStyle=P,s.font=I.string,s.fillText(c.labelString,0,0),s.restore()}if(F){var W,V,E,H,j=F,q=ui(h.lineWidth,b.length-1,0);m?(W=L(r,e.left,j)-j/2,V=L(r,e.right,q)+q/2,E=H=n):(E=L(r,e.top,j)-j/2,H=L(r,e.bottom,q)+q/2,W=V=n),s.lineWidth=F,s.strokeStyle=ui(h.color,0),s.beginPath(),s.moveTo(W,E),s.lineTo(V,H),s.stroke()}}}}),gi=fi.extend({getLabels:function(){var t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels},determineDataLimits:function(){var t,e=this,i=e.getLabels();e.minIndex=0,e.maxIndex=i.length-1,void 0!==e.options.ticks.min&&(t=i.indexOf(e.options.ticks.min),e.minIndex=-1!==t?t:e.minIndex),void 0!==e.options.ticks.max&&(t=i.indexOf(e.options.ticks.max),e.maxIndex=-1!==t?t:e.maxIndex),e.min=i[e.minIndex],e.max=i[e.maxIndex]},buildTicks:function(){var t=this,e=t.getLabels();t.ticks=0===t.minIndex&&t.maxIndex===e.length-1?e:e.slice(t.minIndex,t.maxIndex+1)},getLabelForIndex:function(t,e){var i=this,n=i.chart;return n.getDatasetMeta(e).controller._getValueScaleId()===i.id?i.getRightValue(n.data.datasets[e].data[t]):i.ticks[t-i.minIndex]},getPixelForValue:function(t,e){var i,n=this,a=n.options.offset,o=Math.max(n.maxIndex+1-n.minIndex-(a?0:1),1);if(null!=t&&(i=n.isHorizontal()?t.x:t.y),void 0!==i||void 0!==t&&isNaN(e)){t=i||t;var r=n.getLabels().indexOf(t);e=-1!==r?r:e}if(n.isHorizontal()){var s=n.width/o,l=s*(e-n.minIndex);return a&&(l+=s/2),n.left+l}var d=n.height/o,u=d*(e-n.minIndex);return a&&(u+=d/2),n.top+u},getPixelForTick:function(t){return this.getPixelForValue(this.ticks[t],t+this.minIndex,null)},getValueForPixel:function(t){var e=this,i=e.options.offset,n=Math.max(e._ticks.length-(i?0:1),1),a=e.isHorizontal(),o=(a?e.width:e.height)/n;return t-=a?e.left:e.top,i&&(t-=o/2),(t<=0?0:Math.round(t/o))+e.minIndex},getBasePixel:function(){return this.bottom}}),pi={position:"bottom"};gi._defaults=pi;var mi=ut.noop,vi=ut.isNullOrUndef;var bi=fi.extend({getRightValue:function(t){return"string"==typeof t?+t:fi.prototype.getRightValue.call(this,t)},handleTickRangeOptions:function(){var t=this,e=t.options.ticks;if(e.beginAtZero){var i=ut.sign(t.min),n=ut.sign(t.max);i<0&&n<0?t.max=0:i>0&&n>0&&(t.min=0)}var a=void 0!==e.min||void 0!==e.suggestedMin,o=void 0!==e.max||void 0!==e.suggestedMax;void 0!==e.min?t.min=e.min:void 0!==e.suggestedMin&&(null===t.min?t.min=e.suggestedMin:t.min=Math.min(t.min,e.suggestedMin)),void 0!==e.max?t.max=e.max:void 0!==e.suggestedMax&&(null===t.max?t.max=e.suggestedMax:t.max=Math.max(t.max,e.suggestedMax)),a!==o&&t.min>=t.max&&(a?t.max=t.min+1:t.min=t.max-1),t.min===t.max&&(t.max++,e.beginAtZero||t.min--)},getTickLimit:function(){var t,e=this.options.ticks,i=e.stepSize,n=e.maxTicksLimit;return i?t=Math.ceil(this.max/i)-Math.floor(this.min/i)+1:(t=this._computeTickLimit(),n=n||11),n&&(t=Math.min(n,t)),t},_computeTickLimit:function(){return Number.POSITIVE_INFINITY},handleDirectionalChanges:mi,buildTicks:function(){var t=this,e=t.options.ticks,i=t.getTickLimit(),n={maxTicks:i=Math.max(2,i),min:e.min,max:e.max,precision:e.precision,stepSize:ut.valueOrDefault(e.fixedStepSize,e.stepSize)},a=t.ticks=function(t,e){var i,n,a,o,r=[],s=t.stepSize,l=s||1,d=t.maxTicks-1,u=t.min,h=t.max,c=t.precision,f=e.min,g=e.max,p=ut.niceNum((g-f)/d/l)*l;if(p<1e-14&&vi(u)&&vi(h))return[f,g];(o=Math.ceil(g/p)-Math.floor(f/p))>d&&(p=ut.niceNum(o*p/d/l)*l),s||vi(c)?i=Math.pow(10,ut._decimalPlaces(p)):(i=Math.pow(10,c),p=Math.ceil(p*i)/i),n=Math.floor(f/p)*p,a=Math.ceil(g/p)*p,s&&(!vi(u)&&ut.almostWhole(u/p,p/1e3)&&(n=u),!vi(h)&&ut.almostWhole(h/p,p/1e3)&&(a=h)),o=(a-n)/p,o=ut.almostEquals(o,Math.round(o),p/1e3)?Math.round(o):Math.ceil(o),n=Math.round(n*i)/i,a=Math.round(a*i)/i,r.push(vi(u)?n:u);for(var m=1;m<o;++m)r.push(Math.round((n+m*p)*i)/i);return r.push(vi(h)?a:h),r}(n,t);t.handleDirectionalChanges(),t.max=ut.max(a),t.min=ut.min(a),e.reverse?(a.reverse(),t.start=t.max,t.end=t.min):(t.start=t.min,t.end=t.max)},convertTicksToLabels:function(){var t=this;t.ticksAsNumbers=t.ticks.slice(),t.zeroLineIndex=t.ticks.indexOf(0),fi.prototype.convertTicksToLabels.call(t)}}),xi={position:"left",ticks:{callback:li.formatters.linear}},yi=bi.extend({determineDataLimits:function(){var t=this,e=t.options,i=t.chart,n=i.data.datasets,a=t.isHorizontal();function o(e){return a?e.xAxisID===t.id:e.yAxisID===t.id}t.min=null,t.max=null;var r=e.stacked;if(void 0===r&&ut.each(n,function(t,e){if(!r){var n=i.getDatasetMeta(e);i.isDatasetVisible(e)&&o(n)&&void 0!==n.stack&&(r=!0)}}),e.stacked||r){var s={};ut.each(n,function(n,a){var r=i.getDatasetMeta(a),l=[r.type,void 0===e.stacked&&void 0===r.stack?a:"",r.stack].join(".");void 0===s[l]&&(s[l]={positiveValues:[],negativeValues:[]});var d=s[l].positiveValues,u=s[l].negativeValues;i.isDatasetVisible(a)&&o(r)&&ut.each(n.data,function(i,n){var a=+t.getRightValue(i);isNaN(a)||r.data[n].hidden||(d[n]=d[n]||0,u[n]=u[n]||0,e.relativePoints?d[n]=100:a<0?u[n]+=a:d[n]+=a)})}),ut.each(s,function(e){var i=e.positiveValues.concat(e.negativeValues),n=ut.min(i),a=ut.max(i);t.min=null===t.min?n:Math.min(t.min,n),t.max=null===t.max?a:Math.max(t.max,a)})}else ut.each(n,function(e,n){var a=i.getDatasetMeta(n);i.isDatasetVisible(n)&&o(a)&&ut.each(e.data,function(e,i){var n=+t.getRightValue(e);isNaN(n)||a.data[i].hidden||(null===t.min?t.min=n:n<t.min&&(t.min=n),null===t.max?t.max=n:n>t.max&&(t.max=n))})});t.min=isFinite(t.min)&&!isNaN(t.min)?t.min:0,t.max=isFinite(t.max)&&!isNaN(t.max)?t.max:1,this.handleTickRangeOptions()},_computeTickLimit:function(){var t;return this.isHorizontal()?Math.ceil(this.width/40):(t=ut.options._parseFont(this.options.ticks),Math.ceil(this.height/t.lineHeight))},handleDirectionalChanges:function(){this.isHorizontal()||this.ticks.reverse()},getLabelForIndex:function(t,e){return+this.getRightValue(this.chart.data.datasets[e].data[t])},getPixelForValue:function(t){var e=this,i=e.start,n=+e.getRightValue(t),a=e.end-i;return e.isHorizontal()?e.left+e.width/a*(n-i):e.bottom-e.height/a*(n-i)},getValueForPixel:function(t){var e=this,i=e.isHorizontal(),n=i?e.width:e.height,a=(i?t-e.left:e.bottom-t)/n;return e.start+(e.end-e.start)*a},getPixelForTick:function(t){return this.getPixelForValue(this.ticksAsNumbers[t])}}),ki=xi;yi._defaults=ki;var wi=ut.valueOrDefault;var Mi={position:"left",ticks:{callback:li.formatters.logarithmic}};function _i(t,e){return ut.isFinite(t)&&t>=0?t:e}var Ci=fi.extend({determineDataLimits:function(){var t=this,e=t.options,i=t.chart,n=i.data.datasets,a=t.isHorizontal();function o(e){return a?e.xAxisID===t.id:e.yAxisID===t.id}t.min=null,t.max=null,t.minNotZero=null;var r=e.stacked;if(void 0===r&&ut.each(n,function(t,e){if(!r){var n=i.getDatasetMeta(e);i.isDatasetVisible(e)&&o(n)&&void 0!==n.stack&&(r=!0)}}),e.stacked||r){var s={};ut.each(n,function(n,a){var r=i.getDatasetMeta(a),l=[r.type,void 0===e.stacked&&void 0===r.stack?a:"",r.stack].join(".");i.isDatasetVisible(a)&&o(r)&&(void 0===s[l]&&(s[l]=[]),ut.each(n.data,function(e,i){var n=s[l],a=+t.getRightValue(e);isNaN(a)||r.data[i].hidden||a<0||(n[i]=n[i]||0,n[i]+=a)}))}),ut.each(s,function(e){if(e.length>0){var i=ut.min(e),n=ut.max(e);t.min=null===t.min?i:Math.min(t.min,i),t.max=null===t.max?n:Math.max(t.max,n)}})}else ut.each(n,function(e,n){var a=i.getDatasetMeta(n);i.isDatasetVisible(n)&&o(a)&&ut.each(e.data,function(e,i){var n=+t.getRightValue(e);isNaN(n)||a.data[i].hidden||n<0||(null===t.min?t.min=n:n<t.min&&(t.min=n),null===t.max?t.max=n:n>t.max&&(t.max=n),0!==n&&(null===t.minNotZero||n<t.minNotZero)&&(t.minNotZero=n))})});this.handleTickRangeOptions()},handleTickRangeOptions:function(){var t=this,e=t.options.ticks;t.min=_i(e.min,t.min),t.max=_i(e.max,t.max),t.min===t.max&&(0!==t.min&&null!==t.min?(t.min=Math.pow(10,Math.floor(ut.log10(t.min))-1),t.max=Math.pow(10,Math.floor(ut.log10(t.max))+1)):(t.min=1,t.max=10)),null===t.min&&(t.min=Math.pow(10,Math.floor(ut.log10(t.max))-1)),null===t.max&&(t.max=0!==t.min?Math.pow(10,Math.floor(ut.log10(t.min))+1):10),null===t.minNotZero&&(t.min>0?t.minNotZero=t.min:t.max<1?t.minNotZero=Math.pow(10,Math.floor(ut.log10(t.max))):t.minNotZero=1)},buildTicks:function(){var t=this,e=t.options.ticks,i=!t.isHorizontal(),n={min:_i(e.min),max:_i(e.max)},a=t.ticks=function(t,e){var i,n,a=[],o=wi(t.min,Math.pow(10,Math.floor(ut.log10(e.min)))),r=Math.floor(ut.log10(e.max)),s=Math.ceil(e.max/Math.pow(10,r));0===o?(i=Math.floor(ut.log10(e.minNotZero)),n=Math.floor(e.minNotZero/Math.pow(10,i)),a.push(o),o=n*Math.pow(10,i)):(i=Math.floor(ut.log10(o)),n=Math.floor(o/Math.pow(10,i)));var l=i<0?Math.pow(10,Math.abs(i)):1;do{a.push(o),10==++n&&(n=1,l=++i>=0?1:l),o=Math.round(n*Math.pow(10,i)*l)/l}while(i<r||i===r&&n<s);var d=wi(t.max,o);return a.push(d),a}(n,t);t.max=ut.max(a),t.min=ut.min(a),e.reverse?(i=!i,t.start=t.max,t.end=t.min):(t.start=t.min,t.end=t.max),i&&a.reverse()},convertTicksToLabels:function(){this.tickValues=this.ticks.slice(),fi.prototype.convertTicksToLabels.call(this)},getLabelForIndex:function(t,e){return+this.getRightValue(this.chart.data.datasets[e].data[t])},getPixelForTick:function(t){return this.getPixelForValue(this.tickValues[t])},_getFirstTickValue:function(t){var e=Math.floor(ut.log10(t));return Math.floor(t/Math.pow(10,e))*Math.pow(10,e)},getPixelForValue:function(t){var e,i,n,a,o,r=this,s=r.options.ticks,l=s.reverse,d=ut.log10,u=r._getFirstTickValue(r.minNotZero),h=0;return t=+r.getRightValue(t),l?(n=r.end,a=r.start,o=-1):(n=r.start,a=r.end,o=1),r.isHorizontal()?(e=r.width,i=l?r.right:r.left):(e=r.height,o*=-1,i=l?r.top:r.bottom),t!==n&&(0===n&&(e-=h=wi(s.fontSize,st.global.defaultFontSize),n=u),0!==t&&(h+=e/(d(a)-d(n))*(d(t)-d(n))),i+=o*h),i},getValueForPixel:function(t){var e,i,n,a,o=this,r=o.options.ticks,s=r.reverse,l=ut.log10,d=o._getFirstTickValue(o.minNotZero);if(s?(i=o.end,n=o.start):(i=o.start,n=o.end),o.isHorizontal()?(e=o.width,a=s?o.right-t:t-o.left):(e=o.height,a=s?t-o.top:o.bottom-t),a!==i){if(0===i){var u=wi(r.fontSize,st.global.defaultFontSize);a-=u,e-=u,i=d}a*=l(n)-l(i),a/=e,a=Math.pow(10,l(i)+a)}return a}}),Si=Mi;Ci._defaults=Si;var Pi=ut.valueOrDefault,Ii=ut.valueAtIndexOrDefault,Ai=ut.options.resolve,Di={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,color:"rgba(0, 0, 0, 0.1)",lineWidth:1,borderDash:[],borderDashOffset:0},gridLines:{circular:!1},ticks:{showLabelBackdrop:!0,backdropColor:"rgba(255,255,255,0.75)",backdropPaddingY:2,backdropPaddingX:2,callback:li.formatters.linear},pointLabels:{display:!0,fontSize:10,callback:function(t){return t}}};function Ti(t){var e=t.options;return e.angleLines.display||e.pointLabels.display?t.chart.data.labels.length:0}function Fi(t){var e=t.ticks;return e.display&&t.display?Pi(e.fontSize,st.global.defaultFontSize)+2*e.backdropPaddingY:0}function Li(t,e,i,n,a){return t===n||t===a?{start:e-i/2,end:e+i/2}:t<n||t>a?{start:e-i,end:e}:{start:e,end:e+i}}function Ri(t){return 0===t||180===t?"center":t<180?"left":"right"}function Oi(t,e,i,n){var a,o,r=i.y+n/2;if(ut.isArray(e))for(a=0,o=e.length;a<o;++a)t.fillText(e[a],i.x,r),r+=n;else t.fillText(e,i.x,r)}function zi(t,e,i){90===t||270===t?i.y-=e.h/2:(t>270||t<90)&&(i.y-=e.h)}function Bi(t){return ut.isNumber(t)?t:0}var Ni=bi.extend({setDimensions:function(){var t=this;t.width=t.maxWidth,t.height=t.maxHeight,t.paddingTop=Fi(t.options)/2,t.xCenter=Math.floor(t.width/2),t.yCenter=Math.floor((t.height-t.paddingTop)/2),t.drawingArea=Math.min(t.height-t.paddingTop,t.width)/2},determineDataLimits:function(){var t=this,e=t.chart,i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;ut.each(e.data.datasets,function(a,o){if(e.isDatasetVisible(o)){var r=e.getDatasetMeta(o);ut.each(a.data,function(e,a){var o=+t.getRightValue(e);isNaN(o)||r.data[a].hidden||(i=Math.min(o,i),n=Math.max(o,n))})}}),t.min=i===Number.POSITIVE_INFINITY?0:i,t.max=n===Number.NEGATIVE_INFINITY?0:n,t.handleTickRangeOptions()},_computeTickLimit:function(){return Math.ceil(this.drawingArea/Fi(this.options))},convertTicksToLabels:function(){var t=this;bi.prototype.convertTicksToLabels.call(t),t.pointLabels=t.chart.data.labels.map(t.options.pointLabels.callback,t)},getLabelForIndex:function(t,e){return+this.getRightValue(this.chart.data.datasets[e].data[t])},fit:function(){var t=this.options;t.display&&t.pointLabels.display?function(t){var e,i,n,a=ut.options._parseFont(t.options.pointLabels),o={l:0,r:t.width,t:0,b:t.height-t.paddingTop},r={};t.ctx.font=a.string,t._pointLabelSizes=[];var s,l,d,u=Ti(t);for(e=0;e<u;e++){n=t.getPointPosition(e,t.drawingArea+5),s=t.ctx,l=a.lineHeight,d=t.pointLabels[e]||"",i=ut.isArray(d)?{w:ut.longestText(s,s.font,d),h:d.length*l}:{w:s.measureText(d).width,h:l},t._pointLabelSizes[e]=i;var h=t.getIndexAngle(e),c=ut.toDegrees(h)%360,f=Li(c,n.x,i.w,0,180),g=Li(c,n.y,i.h,90,270);f.start<o.l&&(o.l=f.start,r.l=h),f.end>o.r&&(o.r=f.end,r.r=h),g.start<o.t&&(o.t=g.start,r.t=h),g.end>o.b&&(o.b=g.end,r.b=h)}t.setReductions(t.drawingArea,o,r)}(this):this.setCenterPoint(0,0,0,0)},setReductions:function(t,e,i){var n=this,a=e.l/Math.sin(i.l),o=Math.max(e.r-n.width,0)/Math.sin(i.r),r=-e.t/Math.cos(i.t),s=-Math.max(e.b-(n.height-n.paddingTop),0)/Math.cos(i.b);a=Bi(a),o=Bi(o),r=Bi(r),s=Bi(s),n.drawingArea=Math.min(Math.floor(t-(a+o)/2),Math.floor(t-(r+s)/2)),n.setCenterPoint(a,o,r,s)},setCenterPoint:function(t,e,i,n){var a=this,o=a.width-e-a.drawingArea,r=t+a.drawingArea,s=i+a.drawingArea,l=a.height-a.paddingTop-n-a.drawingArea;a.xCenter=Math.floor((r+o)/2+a.left),a.yCenter=Math.floor((s+l)/2+a.top+a.paddingTop)},getIndexAngle:function(t){return t*(2*Math.PI/Ti(this))+(this.chart.options&&this.chart.options.startAngle?this.chart.options.startAngle:0)*Math.PI*2/360},getDistanceFromCenterForValue:function(t){var e=this;if(null===t)return 0;var i=e.drawingArea/(e.max-e.min);return e.options.ticks.reverse?(e.max-t)*i:(t-e.min)*i},getPointPosition:function(t,e){var i=this.getIndexAngle(t)-Math.PI/2;return{x:Math.cos(i)*e+this.xCenter,y:Math.sin(i)*e+this.yCenter}},getPointPositionForValue:function(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))},getBasePosition:function(){var t=this.min,e=this.max;return this.getPointPositionForValue(0,this.beginAtZero?0:t<0&&e<0?e:t>0&&e>0?t:0)},draw:function(){var t=this,e=t.options,i=e.gridLines,n=e.ticks;if(e.display){var a=t.ctx,o=this.getIndexAngle(0),r=ut.options._parseFont(n);(e.angleLines.display||e.pointLabels.display)&&function(t){var e=t.ctx,i=t.options,n=i.angleLines,a=i.gridLines,o=i.pointLabels,r=Pi(n.lineWidth,a.lineWidth),s=Pi(n.color,a.color),l=Fi(i);e.save(),e.lineWidth=r,e.strokeStyle=s,e.setLineDash&&(e.setLineDash(Ai([n.borderDash,a.borderDash,[]])),e.lineDashOffset=Ai([n.borderDashOffset,a.borderDashOffset,0]));var d=t.getDistanceFromCenterForValue(i.ticks.reverse?t.min:t.max),u=ut.options._parseFont(o);e.font=u.string,e.textBaseline="middle";for(var h=Ti(t)-1;h>=0;h--){if(n.display&&r&&s){var c=t.getPointPosition(h,d);e.beginPath(),e.moveTo(t.xCenter,t.yCenter),e.lineTo(c.x,c.y),e.stroke()}if(o.display){var f=0===h?l/2:0,g=t.getPointPosition(h,d+f+5),p=Ii(o.fontColor,h,st.global.defaultFontColor);e.fillStyle=p;var m=t.getIndexAngle(h),v=ut.toDegrees(m);e.textAlign=Ri(v),zi(v,t._pointLabelSizes[h],g),Oi(e,t.pointLabels[h]||"",g,u.lineHeight)}}e.restore()}(t),ut.each(t.ticks,function(e,s){if(s>0||n.reverse){var l=t.getDistanceFromCenterForValue(t.ticksAsNumbers[s]);if(i.display&&0!==s&&function(t,e,i,n){var a,o=t.ctx,r=e.circular,s=Ti(t),l=Ii(e.color,n-1),d=Ii(e.lineWidth,n-1);if((r||s)&&l&&d){if(o.save(),o.strokeStyle=l,o.lineWidth=d,o.setLineDash&&(o.setLineDash(e.borderDash||[]),o.lineDashOffset=e.borderDashOffset||0),o.beginPath(),r)o.arc(t.xCenter,t.yCenter,i,0,2*Math.PI);else{a=t.getPointPosition(0,i),o.moveTo(a.x,a.y);for(var u=1;u<s;u++)a=t.getPointPosition(u,i),o.lineTo(a.x,a.y)}o.closePath(),o.stroke(),o.restore()}}(t,i,l,s),n.display){var d=Pi(n.fontColor,st.global.defaultFontColor);if(a.font=r.string,a.save(),a.translate(t.xCenter,t.yCenter),a.rotate(o),n.showLabelBackdrop){var u=a.measureText(e).width;a.fillStyle=n.backdropColor,a.fillRect(-u/2-n.backdropPaddingX,-l-r.size/2-n.backdropPaddingY,u+2*n.backdropPaddingX,r.size+2*n.backdropPaddingY)}a.textAlign="center",a.textBaseline="middle",a.fillStyle=d,a.fillText(e,0,-l),a.restore()}}})}}}),Wi=Di;Ni._defaults=Wi;var Vi=ut.valueOrDefault,Ei=Number.MIN_SAFE_INTEGER||-9007199254740991,Hi=Number.MAX_SAFE_INTEGER||9007199254740991,ji={millisecond:{common:!0,size:1,steps:[1,2,5,10,20,50,100,250,500]},second:{common:!0,size:1e3,steps:[1,2,5,10,15,30]},minute:{common:!0,size:6e4,steps:[1,2,5,10,15,30]},hour:{common:!0,size:36e5,steps:[1,2,3,6,12]},day:{common:!0,size:864e5,steps:[1,2,5]},week:{common:!1,size:6048e5,steps:[1,2,3,4]},month:{common:!0,size:2628e6,steps:[1,2,3]},quarter:{common:!1,size:7884e6,steps:[1,2,3,4]},year:{common:!0,size:3154e7}},qi=Object.keys(ji);function Yi(t,e){return t-e}function Ui(t){var e,i,n,a={},o=[];for(e=0,i=t.length;e<i;++e)a[n=t[e]]||(a[n]=!0,o.push(n));return o}function Xi(t,e,i,n){var a=function(t,e,i){for(var n,a,o,r=0,s=t.length-1;r>=0&&r<=s;){if(a=t[(n=r+s>>1)-1]||null,o=t[n],!a)return{lo:null,hi:o};if(o[e]<i)r=n+1;else{if(!(a[e]>i))return{lo:a,hi:o};s=n-1}}return{lo:o,hi:null}}(t,e,i),o=a.lo?a.hi?a.lo:t[t.length-2]:t[0],r=a.lo?a.hi?a.hi:t[t.length-1]:t[1],s=r[e]-o[e],l=s?(i-o[e])/s:0,d=(r[n]-o[n])*l;return o[n]+d}function Ki(t,e){var i=t._adapter,n=t.options.time,a=n.parser,o=a||n.format,r=e;return"function"==typeof a&&(r=a(r)),ut.isFinite(r)||(r="string"==typeof o?i.parse(r,o):i.parse(r)),null!==r?+r:(a||"function"!=typeof o||(r=o(e),ut.isFinite(r)||(r=i.parse(r))),r)}function Gi(t,e){if(ut.isNullOrUndef(e))return null;var i=t.options.time,n=Ki(t,t.getRightValue(e));return null===n?n:(i.round&&(n=+t._adapter.startOf(n,i.round)),n)}function Zi(t){for(var e=qi.indexOf(t)+1,i=qi.length;e<i;++e)if(ji[qi[e]].common)return qi[e]}function $i(t,e,i,n){var a,o=t._adapter,r=t.options,s=r.time,l=s.unit||function(t,e,i,n){var a,o,r,s=qi.length;for(a=qi.indexOf(t);a<s-1;++a)if(r=(o=ji[qi[a]]).steps?o.steps[o.steps.length-1]:Hi,o.common&&Math.ceil((i-e)/(r*o.size))<=n)return qi[a];return qi[s-1]}(s.minUnit,e,i,n),d=Zi(l),u=Vi(s.stepSize,s.unitStepSize),h="week"===l&&s.isoWeekday,c=r.ticks.major.enabled,f=ji[l],g=e,p=i,m=[];for(u||(u=function(t,e,i,n){var a,o,r,s=e-t,l=ji[i],d=l.size,u=l.steps;if(!u)return Math.ceil(s/(n*d));for(a=0,o=u.length;a<o&&(r=u[a],!(Math.ceil(s/(d*r))<=n));++a);return r}(e,i,l,n)),h&&(g=+o.startOf(g,"isoWeek",h),p=+o.startOf(p,"isoWeek",h)),g=+o.startOf(g,h?"day":l),(p=+o.startOf(p,h?"day":l))<i&&(p=+o.add(p,1,l)),a=g,c&&d&&!h&&!s.round&&(a=+o.startOf(a,d),a=+o.add(a,~~((g-a)/(f.size*u))*u,l));a<p;a=+o.add(a,u,l))m.push(+a);return m.push(+a),m}var Ji=fi.extend({initialize:function(){this.mergeTicksOptions(),fi.prototype.initialize.call(this)},update:function(){var t=this.options,e=t.time||(t.time={}),i=this._adapter=new si._date(t.adapters.date);return e.format&&console.warn("options.time.format is deprecated and replaced by options.time.parser."),ut.mergeIf(e.displayFormats,i.formats()),fi.prototype.update.apply(this,arguments)},getRightValue:function(t){return t&&void 0!==t.t&&(t=t.t),fi.prototype.getRightValue.call(this,t)},determineDataLimits:function(){var t,e,i,n,a,o,r=this,s=r.chart,l=r._adapter,d=r.options.time,u=d.unit||"day",h=Hi,c=Ei,f=[],g=[],p=[],m=s.data.labels||[];for(t=0,i=m.length;t<i;++t)p.push(Gi(r,m[t]));for(t=0,i=(s.data.datasets||[]).length;t<i;++t)if(s.isDatasetVisible(t))if(a=s.data.datasets[t].data,ut.isObject(a[0]))for(g[t]=[],e=0,n=a.length;e<n;++e)o=Gi(r,a[e]),f.push(o),g[t][e]=o;else{for(e=0,n=p.length;e<n;++e)f.push(p[e]);g[t]=p.slice(0)}else g[t]=[];p.length&&(p=Ui(p).sort(Yi),h=Math.min(h,p[0]),c=Math.max(c,p[p.length-1])),f.length&&(f=Ui(f).sort(Yi),h=Math.min(h,f[0]),c=Math.max(c,f[f.length-1])),h=Gi(r,d.min)||h,c=Gi(r,d.max)||c,h=h===Hi?+l.startOf(Date.now(),u):h,c=c===Ei?+l.endOf(Date.now(),u)+1:c,r.min=Math.min(h,c),r.max=Math.max(h+1,c),r._horizontal=r.isHorizontal(),r._table=[],r._timestamps={data:f,datasets:g,labels:p}},buildTicks:function(){var t,e,i,n=this,a=n.min,o=n.max,r=n.options,s=r.time,l=[],d=[];switch(r.ticks.source){case"data":l=n._timestamps.data;break;case"labels":l=n._timestamps.labels;break;case"auto":default:l=$i(n,a,o,n.getLabelCapacity(a))}for("ticks"===r.bounds&&l.length&&(a=l[0],o=l[l.length-1]),a=Gi(n,s.min)||a,o=Gi(n,s.max)||o,t=0,e=l.length;t<e;++t)(i=l[t])>=a&&i<=o&&d.push(i);return n.min=a,n.max=o,n._unit=s.unit||function(t,e,i,n,a){var o,r;for(o=qi.length-1;o>=qi.indexOf(i);o--)if(r=qi[o],ji[r].common&&t._adapter.diff(a,n,r)>=e.length)return r;return qi[i?qi.indexOf(i):0]}(n,d,s.minUnit,n.min,n.max),n._majorUnit=Zi(n._unit),n._table=function(t,e,i,n){if("linear"===n||!t.length)return[{time:e,pos:0},{time:i,pos:1}];var a,o,r,s,l,d=[],u=[e];for(a=0,o=t.length;a<o;++a)(s=t[a])>e&&s<i&&u.push(s);for(u.push(i),a=0,o=u.length;a<o;++a)l=u[a+1],r=u[a-1],s=u[a],void 0!==r&&void 0!==l&&Math.round((l+r)/2)===s||d.push({time:s,pos:a/(o-1)});return d}(n._timestamps.data,a,o,r.distribution),n._offsets=function(t,e,i,n,a){var o,r,s=0,l=0;return a.offset&&e.length&&(a.time.min||(o=Xi(t,"time",e[0],"pos"),s=1===e.length?1-o:(Xi(t,"time",e[1],"pos")-o)/2),a.time.max||(r=Xi(t,"time",e[e.length-1],"pos"),l=1===e.length?r:(r-Xi(t,"time",e[e.length-2],"pos"))/2)),{start:s,end:l}}(n._table,d,0,0,r),r.ticks.reverse&&d.reverse(),function(t,e,i){var n,a,o,r,s=[];for(n=0,a=e.length;n<a;++n)o=e[n],r=!!i&&o===+t._adapter.startOf(o,i),s.push({value:o,major:r});return s}(n,d,n._majorUnit)},getLabelForIndex:function(t,e){var i=this,n=i._adapter,a=i.chart.data,o=i.options.time,r=a.labels&&t<a.labels.length?a.labels[t]:"",s=a.datasets[e].data[t];return ut.isObject(s)&&(r=i.getRightValue(s)),o.tooltipFormat?n.format(Ki(i,r),o.tooltipFormat):"string"==typeof r?r:n.format(Ki(i,r),o.displayFormats.datetime)},tickFormatFunction:function(t,e,i,n){var a=this._adapter,o=this.options,r=o.time.displayFormats,s=r[this._unit],l=this._majorUnit,d=r[l],u=+a.startOf(t,l),h=o.ticks.major,c=h.enabled&&l&&d&&t===u,f=a.format(t,n||(c?d:s)),g=c?h:o.ticks.minor,p=Vi(g.callback,g.userCallback);return p?p(f,e,i):f},convertTicksToLabels:function(t){var e,i,n=[];for(e=0,i=t.length;e<i;++e)n.push(this.tickFormatFunction(t[e].value,e,t));return n},getPixelForOffset:function(t){var e=this,i=e.options.ticks.reverse,n=e._horizontal?e.width:e.height,a=e._horizontal?i?e.right:e.left:i?e.bottom:e.top,o=Xi(e._table,"time",t,"pos"),r=n*(e._offsets.start+o)/(e._offsets.start+1+e._offsets.end);return i?a-r:a+r},getPixelForValue:function(t,e,i){var n=null;if(void 0!==e&&void 0!==i&&(n=this._timestamps.datasets[i][e]),null===n&&(n=Gi(this,t)),null!==n)return this.getPixelForOffset(n)},getPixelForTick:function(t){var e=this.getTicks();return t>=0&&t<e.length?this.getPixelForOffset(e[t].value):null},getValueForPixel:function(t){var e=this,i=e._horizontal?e.width:e.height,n=e._horizontal?e.left:e.top,a=(i?(t-n)/i:0)*(e._offsets.start+1+e._offsets.start)-e._offsets.end,o=Xi(e._table,"pos",a,"time");return e._adapter._create(o)},getLabelWidth:function(t){var e=this.options.ticks,i=this.ctx.measureText(t).width,n=ut.toRadians(e.maxRotation),a=Math.cos(n),o=Math.sin(n);return i*a+Vi(e.fontSize,st.global.defaultFontSize)*o},getLabelCapacity:function(t){var e=this,i=e.options.time.displayFormats.millisecond,n=e.tickFormatFunction(t,0,[],i),a=e.getLabelWidth(n),o=e.isHorizontal()?e.width:e.height,r=Math.floor(o/a);return r>0?r:1}}),Qi={position:"bottom",distribution:"linear",bounds:"data",adapters:{},time:{parser:!1,format:!1,unit:!1,round:!1,displayFormat:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{autoSkip:!1,source:"auto",major:{enabled:!1}}};Ji._defaults=Qi;var tn={category:gi,linear:yi,logarithmic:Ci,radialLinear:Ni,time:Ji},en={datetime:"MMM D, YYYY, h:mm:ss a",millisecond:"h:mm:ss.SSS a",second:"h:mm:ss a",minute:"h:mm a",hour:"hA",day:"MMM D",week:"ll",month:"MMM YYYY",quarter:"[Q]Q - YYYY",year:"YYYY"};si._date.override("function"==typeof t?{_id:"moment",formats:function(){return en},parse:function(e,i){return"string"==typeof e&&"string"==typeof i?e=t(e,i):e instanceof t||(e=t(e)),e.isValid()?e.valueOf():null},format:function(e,i){return t(e).format(i)},add:function(e,i,n){return t(e).add(i,n).valueOf()},diff:function(e,i,n){return t.duration(t(e).diff(t(i))).as(n)},startOf:function(e,i,n){return e=t(e),"isoWeek"===i?e.isoWeekday(n).valueOf():e.startOf(i).valueOf()},endOf:function(e,i){return t(e).endOf(i).valueOf()},_create:function(e){return t(e)}}:{}),st._set("global",{plugins:{filler:{propagate:!0}}});var nn={dataset:function(t){var e=t.fill,i=t.chart,n=i.getDatasetMeta(e),a=n&&i.isDatasetVisible(e)&&n.dataset._children||[],o=a.length||0;return o?function(t,e){return e<o&&a[e]._view||null}:null},boundary:function(t){var e=t.boundary,i=e?e.x:null,n=e?e.y:null;return function(t){return{x:null===i?t.x:i,y:null===n?t.y:n}}}};function an(t,e,i){var n,a=t._model||{},o=a.fill;if(void 0===o&&(o=!!a.backgroundColor),!1===o||null===o)return!1;if(!0===o)return"origin";if(n=parseFloat(o,10),isFinite(n)&&Math.floor(n)===n)return"-"!==o[0]&&"+"!==o[0]||(n=e+n),!(n===e||n<0||n>=i)&&n;switch(o){case"bottom":return"start";case"top":return"end";case"zero":return"origin";case"origin":case"start":case"end":return o;default:return!1}}function on(t){var e,i=t.el._model||{},n=t.el._scale||{},a=t.fill,o=null;if(isFinite(a))return null;if("start"===a?o=void 0===i.scaleBottom?n.bottom:i.scaleBottom:"end"===a?o=void 0===i.scaleTop?n.top:i.scaleTop:void 0!==i.scaleZero?o=i.scaleZero:n.getBasePosition?o=n.getBasePosition():n.getBasePixel&&(o=n.getBasePixel()),null!=o){if(void 0!==o.x&&void 0!==o.y)return o;if(ut.isFinite(o))return{x:(e=n.isHorizontal())?o:null,y:e?null:o}}return null}function rn(t,e,i){var n,a=t[e].fill,o=[e];if(!i)return a;for(;!1!==a&&-1===o.indexOf(a);){if(!isFinite(a))return a;if(!(n=t[a]))return!1;if(n.visible)return a;o.push(a),a=n.fill}return!1}function sn(t){var e=t.fill,i="dataset";return!1===e?null:(isFinite(e)||(i="boundary"),nn[i](t))}function ln(t){return t&&!t.skip}function dn(t,e,i,n,a){var o;if(n&&a){for(t.moveTo(e[0].x,e[0].y),o=1;o<n;++o)ut.canvas.lineTo(t,e[o-1],e[o]);for(t.lineTo(i[a-1].x,i[a-1].y),o=a-1;o>0;--o)ut.canvas.lineTo(t,i[o],i[o-1],!0)}}var un={id:"filler",afterDatasetsUpdate:function(t,e){var i,n,a,o,r=(t.data.datasets||[]).length,s=e.propagate,l=[];for(n=0;n<r;++n)o=null,(a=(i=t.getDatasetMeta(n)).dataset)&&a._model&&a instanceof Wt.Line&&(o={visible:t.isDatasetVisible(n),fill:an(a,n,r),chart:t,el:a}),i.$filler=o,l.push(o);for(n=0;n<r;++n)(o=l[n])&&(o.fill=rn(l,n,s),o.boundary=on(o),o.mapper=sn(o))},beforeDatasetDraw:function(t,e){var i=e.meta.$filler;if(i){var n=t.ctx,a=i.el,o=a._view,r=a._children||[],s=i.mapper,l=o.backgroundColor||st.global.defaultColor;s&&l&&r.length&&(ut.canvas.clipArea(n,t.chartArea),function(t,e,i,n,a,o){var r,s,l,d,u,h,c,f=e.length,g=n.spanGaps,p=[],m=[],v=0,b=0;for(t.beginPath(),r=0,s=f+!!o;r<s;++r)u=i(d=e[l=r%f]._view,l,n),h=ln(d),c=ln(u),h&&c?(v=p.push(d),b=m.push(u)):v&&b&&(g?(h&&p.push(d),c&&m.push(u)):(dn(t,p,m,v,b),v=b=0,p=[],m=[]));dn(t,p,m,v,b),t.closePath(),t.fillStyle=a,t.fill()}(n,r,s,o,l,a._loop),ut.canvas.unclipArea(n))}}},hn=ut.noop,cn=ut.valueOrDefault;function fn(t,e){return t.usePointStyle&&t.boxWidth>e?e:t.boxWidth}st._set("global",{legend:{display:!0,position:"top",fullWidth:!0,reverse:!1,weight:1e3,onClick:function(t,e){var i=e.datasetIndex,n=this.chart,a=n.getDatasetMeta(i);a.hidden=null===a.hidden?!n.data.datasets[i].hidden:null,n.update()},onHover:null,onLeave:null,labels:{boxWidth:40,padding:10,generateLabels:function(t){var e=t.data;return ut.isArray(e.datasets)?e.datasets.map(function(e,i){return{text:e.label,fillStyle:ut.isArray(e.backgroundColor)?e.backgroundColor[0]:e.backgroundColor,hidden:!t.isDatasetVisible(i),lineCap:e.borderCapStyle,lineDash:e.borderDash,lineDashOffset:e.borderDashOffset,lineJoin:e.borderJoinStyle,lineWidth:e.borderWidth,strokeStyle:e.borderColor,pointStyle:e.pointStyle,datasetIndex:i}},this):[]}}},legendCallback:function(t){var e=[];e.push('<ul class="'+t.id+'-legend">');for(var i=0;i<t.data.datasets.length;i++)e.push('<li><span style="background-color:'+t.data.datasets[i].backgroundColor+'"></span>'),t.data.datasets[i].label&&e.push(t.data.datasets[i].label),e.push("</li>");return e.push("</ul>"),e.join("")}});var gn=pt.extend({initialize:function(t){ut.extend(this,t),this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1},beforeUpdate:hn,update:function(t,e,i){var n=this;return n.beforeUpdate(),n.maxWidth=t,n.maxHeight=e,n.margins=i,n.beforeSetDimensions(),n.setDimensions(),n.afterSetDimensions(),n.beforeBuildLabels(),n.buildLabels(),n.afterBuildLabels(),n.beforeFit(),n.fit(),n.afterFit(),n.afterUpdate(),n.minSize},afterUpdate:hn,beforeSetDimensions:hn,setDimensions:function(){var t=this;t.isHorizontal()?(t.width=t.maxWidth,t.left=0,t.right=t.width):(t.height=t.maxHeight,t.top=0,t.bottom=t.height),t.paddingLeft=0,t.paddingTop=0,t.paddingRight=0,t.paddingBottom=0,t.minSize={width:0,height:0}},afterSetDimensions:hn,beforeBuildLabels:hn,buildLabels:function(){var t=this,e=t.options.labels||{},i=ut.callback(e.generateLabels,[t.chart],t)||[];e.filter&&(i=i.filter(function(i){return e.filter(i,t.chart.data)})),t.options.reverse&&i.reverse(),t.legendItems=i},afterBuildLabels:hn,beforeFit:hn,fit:function(){var t=this,e=t.options,i=e.labels,n=e.display,a=t.ctx,o=ut.options._parseFont(i),r=o.size,s=t.legendHitBoxes=[],l=t.minSize,d=t.isHorizontal();if(d?(l.width=t.maxWidth,l.height=n?10:0):(l.width=n?10:0,l.height=t.maxHeight),n)if(a.font=o.string,d){var u=t.lineWidths=[0],h=0;a.textAlign="left",a.textBaseline="top",ut.each(t.legendItems,function(t,e){var n=fn(i,r)+r/2+a.measureText(t.text).width;(0===e||u[u.length-1]+n+i.padding>l.width)&&(h+=r+i.padding,u[u.length-(e>0?0:1)]=i.padding),s[e]={left:0,top:0,width:n,height:r},u[u.length-1]+=n+i.padding}),l.height+=h}else{var c=i.padding,f=t.columnWidths=[],g=i.padding,p=0,m=0,v=r+c;ut.each(t.legendItems,function(t,e){var n=fn(i,r)+r/2+a.measureText(t.text).width;e>0&&m+v>l.height-c&&(g+=p+i.padding,f.push(p),p=0,m=0),p=Math.max(p,n),m+=v,s[e]={left:0,top:0,width:n,height:r}}),g+=p,f.push(p),l.width+=g}t.width=l.width,t.height=l.height},afterFit:hn,isHorizontal:function(){return"top"===this.options.position||"bottom"===this.options.position},draw:function(){var t=this,e=t.options,i=e.labels,n=st.global,a=n.defaultColor,o=n.elements.line,r=t.width,s=t.lineWidths;if(e.display){var l,d=t.ctx,u=cn(i.fontColor,n.defaultFontColor),h=ut.options._parseFont(i),c=h.size;d.textAlign="left",d.textBaseline="middle",d.lineWidth=.5,d.strokeStyle=u,d.fillStyle=u,d.font=h.string;var f=fn(i,c),g=t.legendHitBoxes,p=t.isHorizontal();l=p?{x:t.left+(r-s[0])/2+i.padding,y:t.top+i.padding,line:0}:{x:t.left+i.padding,y:t.top+i.padding,line:0};var m=c+i.padding;ut.each(t.legendItems,function(n,u){var h=d.measureText(n.text).width,v=f+c/2+h,b=l.x,x=l.y;p?u>0&&b+v+i.padding>t.left+t.minSize.width&&(x=l.y+=m,l.line++,b=l.x=t.left+(r-s[l.line])/2+i.padding):u>0&&x+m>t.top+t.minSize.height&&(b=l.x=b+t.columnWidths[l.line]+i.padding,x=l.y=t.top+i.padding,l.line++),function(t,i,n){if(!(isNaN(f)||f<=0)){d.save();var r=cn(n.lineWidth,o.borderWidth);if(d.fillStyle=cn(n.fillStyle,a),d.lineCap=cn(n.lineCap,o.borderCapStyle),d.lineDashOffset=cn(n.lineDashOffset,o.borderDashOffset),d.lineJoin=cn(n.lineJoin,o.borderJoinStyle),d.lineWidth=r,d.strokeStyle=cn(n.strokeStyle,a),d.setLineDash&&d.setLineDash(cn(n.lineDash,o.borderDash)),e.labels&&e.labels.usePointStyle){var s=f*Math.SQRT2/2,l=t+f/2,u=i+c/2;ut.canvas.drawPoint(d,n.pointStyle,s,l,u)}else 0!==r&&d.strokeRect(t,i,f,c),d.fillRect(t,i,f,c);d.restore()}}(b,x,n),g[u].left=b,g[u].top=x,function(t,e,i,n){var a=c/2,o=f+a+t,r=e+a;d.fillText(i.text,o,r),i.hidden&&(d.beginPath(),d.lineWidth=2,d.moveTo(o,r),d.lineTo(o+n,r),d.stroke())}(b,x,n,h),p?l.x+=v+i.padding:l.y+=m})}},_getLegendItemAt:function(t,e){var i,n,a,o=this;if(t>=o.left&&t<=o.right&&e>=o.top&&e<=o.bottom)for(a=o.legendHitBoxes,i=0;i<a.length;++i)if(t>=(n=a[i]).left&&t<=n.left+n.width&&e>=n.top&&e<=n.top+n.height)return o.legendItems[i];return null},handleEvent:function(t){var e,i=this,n=i.options,a="mouseup"===t.type?"click":t.type;if("mousemove"===a){if(!n.onHover&&!n.onLeave)return}else{if("click"!==a)return;if(!n.onClick)return}e=i._getLegendItemAt(t.x,t.y),"click"===a?e&&n.onClick&&n.onClick.call(i,t.native,e):(n.onLeave&&e!==i._hoveredItem&&(i._hoveredItem&&n.onLeave.call(i,t.native,i._hoveredItem),i._hoveredItem=e),n.onHover&&e&&n.onHover.call(i,t.native,e))}});function pn(t,e){var i=new gn({ctx:t.ctx,options:e,chart:t});ke.configure(t,i,e),ke.addBox(t,i),t.legend=i}var mn={id:"legend",_element:gn,beforeInit:function(t){var e=t.options.legend;e&&pn(t,e)},beforeUpdate:function(t){var e=t.options.legend,i=t.legend;e?(ut.mergeIf(e,st.global.legend),i?(ke.configure(t,i,e),i.options=e):pn(t,e)):i&&(ke.removeBox(t,i),delete t.legend)},afterEvent:function(t,e){var i=t.legend;i&&i.handleEvent(e)}},vn=ut.noop;st._set("global",{title:{display:!1,fontStyle:"bold",fullWidth:!0,padding:10,position:"top",text:"",weight:2e3}});var bn=pt.extend({initialize:function(t){ut.extend(this,t),this.legendHitBoxes=[]},beforeUpdate:vn,update:function(t,e,i){var n=this;return n.beforeUpdate(),n.maxWidth=t,n.maxHeight=e,n.margins=i,n.beforeSetDimensions(),n.setDimensions(),n.afterSetDimensions(),n.beforeBuildLabels(),n.buildLabels(),n.afterBuildLabels(),n.beforeFit(),n.fit(),n.afterFit(),n.afterUpdate(),n.minSize},afterUpdate:vn,beforeSetDimensions:vn,setDimensions:function(){var t=this;t.isHorizontal()?(t.width=t.maxWidth,t.left=0,t.right=t.width):(t.height=t.maxHeight,t.top=0,t.bottom=t.height),t.paddingLeft=0,t.paddingTop=0,t.paddingRight=0,t.paddingBottom=0,t.minSize={width:0,height:0}},afterSetDimensions:vn,beforeBuildLabels:vn,buildLabels:vn,afterBuildLabels:vn,beforeFit:vn,fit:function(){var t=this,e=t.options,i=e.display,n=t.minSize,a=ut.isArray(e.text)?e.text.length:1,o=ut.options._parseFont(e),r=i?a*o.lineHeight+2*e.padding:0;t.isHorizontal()?(n.width=t.maxWidth,n.height=r):(n.width=r,n.height=t.maxHeight),t.width=n.width,t.height=n.height},afterFit:vn,isHorizontal:function(){var t=this.options.position;return"top"===t||"bottom"===t},draw:function(){var t=this,e=t.ctx,i=t.options;if(i.display){var n,a,o,r=ut.options._parseFont(i),s=r.lineHeight,l=s/2+i.padding,d=0,u=t.top,h=t.left,c=t.bottom,f=t.right;e.fillStyle=ut.valueOrDefault(i.fontColor,st.global.defaultFontColor),e.font=r.string,t.isHorizontal()?(a=h+(f-h)/2,o=u+l,n=f-h):(a="left"===i.position?h+l:f-l,o=u+(c-u)/2,n=c-u,d=Math.PI*("left"===i.position?-.5:.5)),e.save(),e.translate(a,o),e.rotate(d),e.textAlign="center",e.textBaseline="middle";var g=i.text;if(ut.isArray(g))for(var p=0,m=0;m<g.length;++m)e.fillText(g[m],0,p,n),p+=s;else e.fillText(g,0,0,n);e.restore()}}});function xn(t,e){var i=new bn({ctx:t.ctx,options:e,chart:t});ke.configure(t,i,e),ke.addBox(t,i),t.titleBlock=i}var yn={},kn=un,wn=mn,Mn={id:"title",_element:bn,beforeInit:function(t){var e=t.options.title;e&&xn(t,e)},beforeUpdate:function(t){var e=t.options.title,i=t.titleBlock;e?(ut.mergeIf(e,st.global.title),i?(ke.configure(t,i,e),i.options=e):xn(t,e)):i&&(ke.removeBox(t,i),delete t.titleBlock)}};for(var _n in yn.filler=kn,yn.legend=wn,yn.title=Mn,ai.helpers=ut,function(){function t(t,e,i){var n;return"string"==typeof t?(n=parseInt(t,10),-1!==t.indexOf("%")&&(n=n/100*e.parentNode[i])):n=t,n}function e(t){return null!=t&&"none"!==t}function i(i,n,a){var o=document.defaultView,r=ut._getParentNode(i),s=o.getComputedStyle(i)[n],l=o.getComputedStyle(r)[n],d=e(s),u=e(l),h=Number.POSITIVE_INFINITY;return d||u?Math.min(d?t(s,i,a):h,u?t(l,r,a):h):"none"}ut.where=function(t,e){if(ut.isArray(t)&&Array.prototype.filter)return t.filter(e);var i=[];return ut.each(t,function(t){e(t)&&i.push(t)}),i},ut.findIndex=Array.prototype.findIndex?function(t,e,i){return t.findIndex(e,i)}:function(t,e,i){i=void 0===i?t:i;for(var n=0,a=t.length;n<a;++n)if(e.call(i,t[n],n,t))return n;return-1},ut.findNextWhere=function(t,e,i){ut.isNullOrUndef(i)&&(i=-1);for(var n=i+1;n<t.length;n++){var a=t[n];if(e(a))return a}},ut.findPreviousWhere=function(t,e,i){ut.isNullOrUndef(i)&&(i=t.length);for(var n=i-1;n>=0;n--){var a=t[n];if(e(a))return a}},ut.isNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},ut.almostEquals=function(t,e,i){return Math.abs(t-e)<i},ut.almostWhole=function(t,e){var i=Math.round(t);return i-e<t&&i+e>t},ut.max=function(t){return t.reduce(function(t,e){return isNaN(e)?t:Math.max(t,e)},Number.NEGATIVE_INFINITY)},ut.min=function(t){return t.reduce(function(t,e){return isNaN(e)?t:Math.min(t,e)},Number.POSITIVE_INFINITY)},ut.sign=Math.sign?function(t){return Math.sign(t)}:function(t){return 0==(t=+t)||isNaN(t)?t:t>0?1:-1},ut.log10=Math.log10?function(t){return Math.log10(t)}:function(t){var e=Math.log(t)*Math.LOG10E,i=Math.round(e);return t===Math.pow(10,i)?i:e},ut.toRadians=function(t){return t*(Math.PI/180)},ut.toDegrees=function(t){return t*(180/Math.PI)},ut._decimalPlaces=function(t){if(ut.isFinite(t)){for(var e=1,i=0;Math.round(t*e)/e!==t;)e*=10,i++;return i}},ut.getAngleFromPoint=function(t,e){var i=e.x-t.x,n=e.y-t.y,a=Math.sqrt(i*i+n*n),o=Math.atan2(n,i);return o<-.5*Math.PI&&(o+=2*Math.PI),{angle:o,distance:a}},ut.distanceBetweenPoints=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},ut.aliasPixel=function(t){return t%2==0?0:.5},ut._alignPixel=function(t,e,i){var n=t.currentDevicePixelRatio,a=i/2;return Math.round((e-a)*n)/n+a},ut.splineCurve=function(t,e,i,n){var a=t.skip?e:t,o=e,r=i.skip?e:i,s=Math.sqrt(Math.pow(o.x-a.x,2)+Math.pow(o.y-a.y,2)),l=Math.sqrt(Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2)),d=s/(s+l),u=l/(s+l),h=n*(d=isNaN(d)?0:d),c=n*(u=isNaN(u)?0:u);return{previous:{x:o.x-h*(r.x-a.x),y:o.y-h*(r.y-a.y)},next:{x:o.x+c*(r.x-a.x),y:o.y+c*(r.y-a.y)}}},ut.EPSILON=Number.EPSILON||1e-14,ut.splineCurveMonotone=function(t){var e,i,n,a,o,r,s,l,d,u=(t||[]).map(function(t){return{model:t._model,deltaK:0,mK:0}}),h=u.length;for(e=0;e<h;++e)if(!(n=u[e]).model.skip){if(i=e>0?u[e-1]:null,(a=e<h-1?u[e+1]:null)&&!a.model.skip){var c=a.model.x-n.model.x;n.deltaK=0!==c?(a.model.y-n.model.y)/c:0}!i||i.model.skip?n.mK=n.deltaK:!a||a.model.skip?n.mK=i.deltaK:this.sign(i.deltaK)!==this.sign(n.deltaK)?n.mK=0:n.mK=(i.deltaK+n.deltaK)/2}for(e=0;e<h-1;++e)n=u[e],a=u[e+1],n.model.skip||a.model.skip||(ut.almostEquals(n.deltaK,0,this.EPSILON)?n.mK=a.mK=0:(o=n.mK/n.deltaK,r=a.mK/n.deltaK,(l=Math.pow(o,2)+Math.pow(r,2))<=9||(s=3/Math.sqrt(l),n.mK=o*s*n.deltaK,a.mK=r*s*n.deltaK)));for(e=0;e<h;++e)(n=u[e]).model.skip||(i=e>0?u[e-1]:null,a=e<h-1?u[e+1]:null,i&&!i.model.skip&&(d=(n.model.x-i.model.x)/3,n.model.controlPointPreviousX=n.model.x-d,n.model.controlPointPreviousY=n.model.y-d*n.mK),a&&!a.model.skip&&(d=(a.model.x-n.model.x)/3,n.model.controlPointNextX=n.model.x+d,n.model.controlPointNextY=n.model.y+d*n.mK))},ut.nextItem=function(t,e,i){return i?e>=t.length-1?t[0]:t[e+1]:e>=t.length-1?t[t.length-1]:t[e+1]},ut.previousItem=function(t,e,i){return i?e<=0?t[t.length-1]:t[e-1]:e<=0?t[0]:t[e-1]},ut.niceNum=function(t,e){var i=Math.floor(ut.log10(t)),n=t/Math.pow(10,i);return(e?n<1.5?1:n<3?2:n<7?5:10:n<=1?1:n<=2?2:n<=5?5:10)*Math.pow(10,i)},ut.requestAnimFrame="undefined"==typeof window?function(t){t()}:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},ut.getRelativePosition=function(t,e){var i,n,a=t.originalEvent||t,o=t.target||t.srcElement,r=o.getBoundingClientRect(),s=a.touches;s&&s.length>0?(i=s[0].clientX,n=s[0].clientY):(i=a.clientX,n=a.clientY);var l=parseFloat(ut.getStyle(o,"padding-left")),d=parseFloat(ut.getStyle(o,"padding-top")),u=parseFloat(ut.getStyle(o,"padding-right")),h=parseFloat(ut.getStyle(o,"padding-bottom")),c=r.right-r.left-l-u,f=r.bottom-r.top-d-h;return{x:i=Math.round((i-r.left-l)/c*o.width/e.currentDevicePixelRatio),y:n=Math.round((n-r.top-d)/f*o.height/e.currentDevicePixelRatio)}},ut.getConstraintWidth=function(t){return i(t,"max-width","clientWidth")},ut.getConstraintHeight=function(t){return i(t,"max-height","clientHeight")},ut._calculatePadding=function(t,e,i){return(e=ut.getStyle(t,e)).indexOf("%")>-1?i*parseInt(e,10)/100:parseInt(e,10)},ut._getParentNode=function(t){var e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e},ut.getMaximumWidth=function(t){var e=ut._getParentNode(t);if(!e)return t.clientWidth;var i=e.clientWidth,n=i-ut._calculatePadding(e,"padding-left",i)-ut._calculatePadding(e,"padding-right",i),a=ut.getConstraintWidth(t);return isNaN(a)?n:Math.min(n,a)},ut.getMaximumHeight=function(t){var e=ut._getParentNode(t);if(!e)return t.clientHeight;var i=e.clientHeight,n=i-ut._calculatePadding(e,"padding-top",i)-ut._calculatePadding(e,"padding-bottom",i),a=ut.getConstraintHeight(t);return isNaN(a)?n:Math.min(n,a)},ut.getStyle=function(t,e){return t.currentStyle?t.currentStyle[e]:document.defaultView.getComputedStyle(t,null).getPropertyValue(e)},ut.retinaScale=function(t,e){var i=t.currentDevicePixelRatio=e||"undefined"!=typeof window&&window.devicePixelRatio||1;if(1!==i){var n=t.canvas,a=t.height,o=t.width;n.height=a*i,n.width=o*i,t.ctx.scale(i,i),n.style.height||n.style.width||(n.style.height=a+"px",n.style.width=o+"px")}},ut.fontString=function(t,e,i){return e+" "+t+"px "+i},ut.longestText=function(t,e,i,n){var a=(n=n||{}).data=n.data||{},o=n.garbageCollect=n.garbageCollect||[];n.font!==e&&(a=n.data={},o=n.garbageCollect=[],n.font=e),t.font=e;var r=0;ut.each(i,function(e){null!=e&&!0!==ut.isArray(e)?r=ut.measureText(t,a,o,r,e):ut.isArray(e)&&ut.each(e,function(e){null==e||ut.isArray(e)||(r=ut.measureText(t,a,o,r,e))})});var s=o.length/2;if(s>i.length){for(var l=0;l<s;l++)delete a[o[l]];o.splice(0,s)}return r},ut.measureText=function(t,e,i,n,a){var o=e[a];return o||(o=e[a]=t.measureText(a).width,i.push(a)),o>n&&(n=o),n},ut.numberOfLabelLines=function(t){var e=1;return ut.each(t,function(t){ut.isArray(t)&&t.length>e&&(e=t.length)}),e},ut.color=X?function(t){return t instanceof CanvasGradient&&(t=st.global.defaultColor),X(t)}:function(t){return console.error("Color.js not found!"),t},ut.getHoverColor=function(t){return t instanceof CanvasPattern||t instanceof CanvasGradient?t:ut.color(t).saturate(.5).darken(.1).rgbString()}}(),ai._adapters=si,ai.Animation=vt,ai.animationService=bt,ai.controllers=ue,ai.DatasetController=Mt,ai.defaults=st,ai.Element=pt,ai.elements=Wt,ai.Interaction=ve,ai.layouts=ke,ai.platform=Ve,ai.plugins=Ee,ai.Scale=fi,ai.scaleService=He,ai.Ticks=li,ai.Tooltip=Je,ai.helpers.each(tn,function(t,e){ai.scaleService.registerScaleType(e,t,t._defaults)}),yn)yn.hasOwnProperty(_n)&&ai.plugins.register(yn[_n]);ai.platform.initialize();var Cn=ai;return"undefined"!=typeof window&&(window.Chart=ai),ai.Chart=ai,ai.Legend=yn.legend._element,ai.Title=yn.title._element,ai.pluginService=ai.plugins,ai.PluginBase=ai.Element.extend({}),ai.canvasHelpers=ai.helpers.canvas,ai.layoutService=ai.layouts,ai.LinearScaleBase=bi,ai.helpers.each(["Bar","Bubble","Doughnut","Line","PolarArea","Radar","Scatter"],function(t){ai[t]=function(e,i){return new ai(e,ai.helpers.merge(i||{},{type:t.charAt(0).toLowerCase()+t.slice(1)}))}}),Cn});

/*!
 * chartjs-plugin-datalabels v0.6.0
 * https://chartjs-plugin-datalabels.netlify.com
 * (c) 2019 Chart.js Contributors
 * Released under the MIT license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js")):"function"==typeof define&&define.amd?define(["chart.js"],e):(t=t||self).ChartDataLabels=e(t.Chart)}(this,function(t){"use strict";var e=(t=t&&t.hasOwnProperty("default")?t.default:t).helpers,r=function(){if("undefined"!=typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;var t=window.screen;if(t)return(t.deviceXDPI||1)/(t.logicalXDPI||1)}return 1}(),n={toTextLines:function(t){var r,n=[];for(t=[].concat(t);t.length;)"string"==typeof(r=t.pop())?n.unshift.apply(n,r.split("\n")):Array.isArray(r)?t.push.apply(t,r):e.isNullOrUndef(t)||n.unshift(""+r);return n},toFontString:function(t){return!t||e.isNullOrUndef(t.size)||e.isNullOrUndef(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family},textSize:function(t,e,r){var n,i=[].concat(e),a=i.length,o=t.font,l=0;for(t.font=r.string,n=0;n<a;++n)l=Math.max(t.measureText(i[n]).width,l);return t.font=o,{height:a*r.lineHeight,width:l}},parseFont:function(r){var i=t.defaults.global,a=e.valueOrDefault(r.size,i.defaultFontSize),o={family:e.valueOrDefault(r.family,i.defaultFontFamily),lineHeight:e.options.toLineHeight(r.lineHeight,a),size:a,style:e.valueOrDefault(r.style,i.defaultFontStyle),weight:e.valueOrDefault(r.weight,null),string:""};return o.string=n.toFontString(o),o},bound:function(t,e,r){return Math.max(t,Math.min(e,r))},arrayDiff:function(t,e){var r,n,i,a,o=t.slice(),l=[];for(r=0,i=e.length;r<i;++r)a=e[r],-1===(n=o.indexOf(a))?l.push([a,1]):o.splice(n,1);for(r=0,i=o.length;r<i;++r)l.push([o[r],-1]);return l},rasterize:function(t){return Math.round(t*r)/r}};function i(t,e){var r=e.x,n=e.y;if(null===r)return{x:0,y:-1};if(null===n)return{x:1,y:0};var i=t.x-r,a=t.y-n,o=Math.sqrt(i*i+a*a);return{x:o?i/o:0,y:o?a/o:-1}}var a=0,o=1,l=2,s=4,u=8;function d(t,e,r){var n=a;return t<r.left?n|=o:t>r.right&&(n|=l),e<r.top?n|=u:e>r.bottom&&(n|=s),n}function f(t,e){var r,n,i=e.anchor,a=t;return e.clamp&&(a=function(t,e){for(var r,n,i,a=t.x0,f=t.y0,c=t.x1,h=t.y1,x=d(a,f,e),y=d(c,h,e);x|y&&!(x&y);)(r=x||y)&u?(n=a+(c-a)*(e.top-f)/(h-f),i=e.top):r&s?(n=a+(c-a)*(e.bottom-f)/(h-f),i=e.bottom):r&l?(i=f+(h-f)*(e.right-a)/(c-a),n=e.right):r&o&&(i=f+(h-f)*(e.left-a)/(c-a),n=e.left),r===x?x=d(a=n,f=i,e):y=d(c=n,h=i,e);return{x0:a,x1:c,y0:f,y1:h}}(a,e.area)),"start"===i?(r=a.x0,n=a.y0):"end"===i?(r=a.x1,n=a.y1):(r=(a.x0+a.x1)/2,n=(a.y0+a.y1)/2),function(t,e,r,n,i){switch(i){case"center":r=n=0;break;case"bottom":r=0,n=1;break;case"right":r=1,n=0;break;case"left":r=-1,n=0;break;case"top":r=0,n=-1;break;case"start":r=-r,n=-n;break;case"end":break;default:i*=Math.PI/180,r=Math.cos(i),n=Math.sin(i)}return{x:t,y:e,vx:r,vy:n}}(r,n,t.vx,t.vy,e.align)}var c={arc:function(t,e){var r=(t.startAngle+t.endAngle)/2,n=Math.cos(r),i=Math.sin(r),a=t.innerRadius,o=t.outerRadius;return f({x0:t.x+n*a,y0:t.y+i*a,x1:t.x+n*o,y1:t.y+i*o,vx:n,vy:i},e)},point:function(t,e){var r=i(t,e.origin),n=r.x*t.radius,a=r.y*t.radius;return f({x0:t.x-n,y0:t.y-a,x1:t.x+n,y1:t.y+a,vx:r.x,vy:r.y},e)},rect:function(t,e){var r=i(t,e.origin),n=t.x,a=t.y,o=0,l=0;return t.horizontal?(n=Math.min(t.x,t.base),o=Math.abs(t.base-t.x)):(a=Math.min(t.y,t.base),l=Math.abs(t.base-t.y)),f({x0:n,y0:a+l,x1:n+o,y1:a,vx:r.x,vy:r.y},e)},fallback:function(t,e){var r=i(t,e.origin);return f({x0:t.x,y0:t.y,x1:t.x,y1:t.y,vx:r.x,vy:r.y},e)}},h=t.helpers,x=n.rasterize;function y(t){var e=t._model.horizontal,r=t._scale||e&&t._xScale||t._yScale;if(!r)return null;if(void 0!==r.xCenter&&void 0!==r.yCenter)return{x:r.xCenter,y:r.yCenter};var n=r.getBasePixel();return e?{x:n,y:null}:{x:null,y:n}}function v(t,e,r){var n=t.shadowBlur,i=r.stroked,a=x(r.x),o=x(r.y),l=x(r.w);i&&t.strokeText(e,a,o,l),r.filled&&(n&&i&&(t.shadowBlur=0),t.fillText(e,a,o,l),n&&i&&(t.shadowBlur=n))}var _=function(t,e,r,n){var i=this;i._config=t,i._index=n,i._model=null,i._rects=null,i._ctx=e,i._el=r};h.extend(_.prototype,{_modelize:function(e,r,i,a){var o,l=this._index,s=h.options.resolve,u=n.parseFont(s([i.font,{}],a,l)),d=s([i.color,t.defaults.global.defaultFontColor],a,l);return{align:s([i.align,"center"],a,l),anchor:s([i.anchor,"center"],a,l),area:a.chart.chartArea,backgroundColor:s([i.backgroundColor,null],a,l),borderColor:s([i.borderColor,null],a,l),borderRadius:s([i.borderRadius,0],a,l),borderWidth:s([i.borderWidth,0],a,l),clamp:s([i.clamp,!1],a,l),clip:s([i.clip,!1],a,l),color:d,display:e,font:u,lines:r,offset:s([i.offset,0],a,l),opacity:s([i.opacity,1],a,l),origin:y(this._el),padding:h.options.toPadding(s([i.padding,0],a,l)),positioner:(o=this._el,o instanceof t.elements.Arc?c.arc:o instanceof t.elements.Point?c.point:o instanceof t.elements.Rectangle?c.rect:c.fallback),rotation:s([i.rotation,0],a,l)*(Math.PI/180),size:n.textSize(this._ctx,r,u),textAlign:s([i.textAlign,"start"],a,l),textShadowBlur:s([i.textShadowBlur,0],a,l),textShadowColor:s([i.textShadowColor,d],a,l),textStrokeColor:s([i.textStrokeColor,d],a,l),textStrokeWidth:s([i.textStrokeWidth,0],a,l)}},update:function(t){var e,r,i,a=this,o=null,l=null,s=a._index,u=a._config,d=h.options.resolve([u.display,!0],t,s);d&&(e=t.dataset.data[s],r=h.valueOrDefault(h.callback(u.formatter,[e,t]),e),(i=h.isNullOrUndef(r)?[]:n.toTextLines(r)).length&&(l=function(t){var e=t.borderWidth||0,r=t.padding,n=t.size.height,i=t.size.width,a=-i/2,o=-n/2;return{frame:{x:a-r.left-e,y:o-r.top-e,w:i+r.width+2*e,h:n+r.height+2*e},text:{x:a,y:o,w:i,h:n}}}(o=a._modelize(d,i,u,t)))),a._model=o,a._rects=l},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(t,e){var r,i=t.ctx,a=this._model,o=this._rects;this.visible()&&(i.save(),a.clip&&(r=a.area,i.beginPath(),i.rect(r.left,r.top,r.right-r.left,r.bottom-r.top),i.clip()),i.globalAlpha=n.bound(0,a.opacity,1),i.translate(x(e.x),x(e.y)),i.rotate(a.rotation),function(t,e,r){var n=r.backgroundColor,i=r.borderColor,a=r.borderWidth;(n||i&&a)&&(t.beginPath(),h.canvas.roundedRect(t,x(e.x)+a/2,x(e.y)+a/2,x(e.w)-a,x(e.h)-a,r.borderRadius),t.closePath(),n&&(t.fillStyle=n,t.fill()),i&&a&&(t.strokeStyle=i,t.lineWidth=a,t.lineJoin="miter",t.stroke()))}(i,o.frame,a),function(t,e,r,n){var i,a=n.textAlign,o=n.color,l=!!o,s=n.font,u=e.length,d=n.textStrokeColor,f=n.textStrokeWidth,c=d&&f;if(u&&(l||c))for(r=function(t,e,r){var n=r.lineHeight,i=t.w,a=t.x;return"center"===e?a+=i/2:"end"!==e&&"right"!==e||(a+=i),{h:n,w:i,x:a,y:t.y+n/2}}(r,a,s),t.font=s.string,t.textAlign=a,t.textBaseline="middle",t.shadowBlur=n.textShadowBlur,t.shadowColor=n.textShadowColor,l&&(t.fillStyle=o),c&&(t.lineJoin="round",t.lineWidth=f,t.strokeStyle=d),i=0,u=e.length;i<u;++i)v(t,e[i],{stroked:c,filled:l,w:r.w,x:r.x,y:r.y+r.h*i})}(i,a.lines,o.text,a),i.restore())}});var b=t.helpers,p=Number.MIN_SAFE_INTEGER||-9007199254740991,g=Number.MAX_SAFE_INTEGER||9007199254740991;function m(t,e,r){var n=Math.cos(r),i=Math.sin(r),a=e.x,o=e.y;return{x:a+n*(t.x-a)-i*(t.y-o),y:o+i*(t.x-a)+n*(t.y-o)}}function w(t,e){var r,n,i,a,o,l=g,s=p,u=e.origin;for(r=0;r<t.length;++r)i=(n=t[r]).x-u.x,a=n.y-u.y,o=e.vx*i+e.vy*a,l=Math.min(l,o),s=Math.max(s,o);return{min:l,max:s}}function k(t,e){var r=e.x-t.x,n=e.y-t.y,i=Math.sqrt(r*r+n*n);return{vx:(e.x-t.x)/i,vy:(e.y-t.y)/i,origin:t,ln:i}}var M=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};function S(t,e,r){var n=e.positioner(t,e),i=n.vx,a=n.vy;if(!i&&!a)return{x:n.x,y:n.y};var o=r.w,l=r.h,s=e.rotation,u=Math.abs(o/2*Math.cos(s))+Math.abs(l/2*Math.sin(s)),d=Math.abs(o/2*Math.sin(s))+Math.abs(l/2*Math.cos(s)),f=1/Math.max(Math.abs(i),Math.abs(a));return u*=i*f,d*=a*f,u+=e.offset*i,d+=e.offset*a,{x:n.x+u,y:n.y+d}}b.extend(M.prototype,{center:function(){var t=this._rect;return{x:t.x+t.w/2,y:t.y+t.h/2}},update:function(t,e,r){this._rotation=r,this._rect={x:e.x+t.x,y:e.y+t.y,w:e.w,h:e.h}},contains:function(t){var e=this._rect;return!((t=m(t,this.center(),-this._rotation)).x<e.x-1||t.y<e.y-1||t.x>e.x+e.w+2||t.y>e.y+e.h+2)},intersects:function(t){var e,r,n,i=this._points(),a=t._points(),o=[k(i[0],i[1]),k(i[0],i[3])];for(this._rotation!==t._rotation&&o.push(k(a[0],a[1]),k(a[0],a[3])),e=0;e<o.length;++e)if(r=w(i,o[e]),n=w(a,o[e]),r.max<n.min||n.max<r.min)return!1;return!0},_points:function(){var t=this._rect,e=this._rotation,r=this.center();return[m({x:t.x,y:t.y},r,e),m({x:t.x+t.w,y:t.y},r,e),m({x:t.x+t.w,y:t.y+t.h},r,e),m({x:t.x,y:t.y+t.h},r,e)]}});var C={prepare:function(t){var e,r,n,i,a,o=[];for(e=0,n=t.length;e<n;++e)for(r=0,i=t[e].length;r<i;++r)a=t[e][r],o.push(a),a.$layout={_box:new M,_hidable:!1,_visible:!0,_set:e,_idx:r};return o.sort(function(t,e){var r=t.$layout,n=e.$layout;return r._idx===n._idx?r._set-n._set:n._idx-r._idx}),this.update(o),o},update:function(t){var e,r,n,i,a,o=!1;for(e=0,r=t.length;e<r;++e)i=(n=t[e]).model(),(a=n.$layout)._hidable=i&&"auto"===i.display,a._visible=n.visible(),o|=a._hidable;o&&function(t){var e,r,n,i,a,o;for(e=0,r=t.length;e<r;++e)(i=(n=t[e]).$layout)._visible&&(a=n.geometry(),o=S(n._el._model,n.model(),a),i._box.update(o,a,n.rotation()));(function(t,e){var r,n,i,a;for(r=t.length-1;r>=0;--r)for(i=t[r].$layout,n=r-1;n>=0&&i._visible;--n)(a=t[n].$layout)._visible&&i._box.intersects(a._box)&&e(i,a)})(t,function(t,e){var r=t._hidable,n=e._hidable;r&&n||n?e._visible=!1:r&&(t._visible=!1)})}(t)},lookup:function(t,e){var r,n;for(r=t.length-1;r>=0;--r)if((n=t[r].$layout)&&n._visible&&n._box.contains(e))return{dataset:n._set,label:t[r]};return null},draw:function(t,e){var r,n,i,a,o,l;for(r=0,n=e.length;r<n;++r)(a=(i=e[r]).$layout)._visible&&(o=i.geometry(),l=S(i._el._view,i.model(),o),a._box.update(l,o,i.rotation()),i.draw(t,l))}},z=t.helpers,A={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:function(t){if(z.isNullOrUndef(t))return null;var e,r,n,i=t;if(z.isObject(t))if(z.isNullOrUndef(t.label))if(z.isNullOrUndef(t.r))for(i="",n=0,r=(e=Object.keys(t)).length;n<r;++n)i+=(0!==n?", ":"")+e[n]+": "+t[e[n]];else i=t.r;else i=t.label;return""+i},listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},O=t.helpers,D="$datalabels";function $(t,e,r){var n=e&&e[r.dataset];if(n){var i=r.label,a=i.$context;!0===O.callback(n,[a])&&(t[D]._dirty=!0,i.update(a))}}function P(t,e){var r,n,i=t[D],a=i._listeners;if(a.enter||a.leave){if("mousemove"===e.type)n=C.lookup(i._labels,e);else if("mouseout"!==e.type)return;r=i._hovered,i._hovered=n,function(t,e,r,n){var i,a;(r||n)&&(r?n?r.label!==n.label&&(a=i=!0):a=!0:i=!0,a&&$(t,e.leave,r),i&&$(t,e.enter,n))}(t,a,r,n)}}t.defaults.global.plugins.datalabels=A;var N={id:"datalabels",beforeInit:function(t){t[D]={_actives:[]}},beforeUpdate:function(t){var e=t[D];e._listened=!1,e._listeners={},e._datasets=[],e._labels=[]},afterDatasetUpdate:function(t,e,r){var n,i,a,o=e.index,l=t[D],s=l._datasets[o]=[],u=t.isDatasetVisible(o),d=t.data.datasets[o],f=function(t,e){var r=t.datalabels;return!1===r?null:(!0===r&&(r={}),O.merge({},[e,r]))}(d,r),c=e.meta.data||[],h=c.length,x=t.ctx;for(x.save(),n=0;n<h;++n)i=c[n],u&&i&&!i.hidden&&!i._model.skip?(s.push(a=new _(f,x,i,n)),a.update(a.$context={active:!1,chart:t,dataIndex:n,dataset:d,datasetIndex:o})):a=null,i[D]=a;x.restore(),O.merge(l._listeners,f.listeners||{},{merger:function(t,r,n){r[t]=r[t]||{},r[t][e.index]=n[t],l._listened=!0}})},afterUpdate:function(t,e){t[D]._labels=C.prepare(t[D]._datasets,e)},afterDatasetsDraw:function(t){C.draw(t,t[D]._labels)},beforeEvent:function(t,e){if(t[D]._listened)switch(e.type){case"mousemove":case"mouseout":P(t,e);break;case"click":!function(t,e){var r=t[D],n=r._listeners.click,i=n&&C.lookup(r._labels,e);i&&$(t,n,i)}(t,e)}},afterEvent:function(e){var r,i,a,o,l=e[D],s=l._actives,u=l._actives=e.lastActive||[],d=n.arrayDiff(s,u);for(r=0,i=d.length;r<i;++r)(a=d[r])[1]&&(o=a[0][D])&&(o.$context.active=1===a[1],o.update(o.$context));(l._dirty||d.length)&&(C.update(l._labels),function(e){if(!e.animating){for(var r=t.animationService.animations,n=0,i=r.length;n<i;++n)if(r[n].chart===e)return;e.render({duration:1,lazy:!0})}}(e)),delete l._dirty}};return t.plugins.register(N),N});

var CHANGE_BTN;
var RADIO_BTN;
var PAYFORM;
var PAYDATE_TEMP;
$(document).ready(function(){
    initFancy();

    $('[js-change-amount]').on('keyup change', function () {
        $(this).siblings('[js-change-amount-btn]').addClass('block');
    })

    $('[js-change-amount-btn]').on('click', function (event) {
        event.preventDefault();
        CHANGE_BTN = $(this);
        $(this).closest('[js-change-amount-form]').trigger('submit');
    })

    $('[js-change-amount-form]').on('submit', function (event) {
        event.preventDefault();
        updateSum($(this).serializeObject());
    });

    //обновление статуса
    $('[js-status]').on('change', function (event) {
        event.preventDefault();
        RADIO_BTN = $(this);
        $(this).closest('[js-status-form]').trigger('submit');
    });

    $('[js-status-form]').on('submit', function (event) {
        event.preventDefault();
        updateStatus($(this).serializeObject());
    });

    //обновление типа оплаты
    $('[js-change-pm-selector]').on('change', function (event) {
        event.preventDefault();

        $(this).removeClassWild("column_pmethod_*");
        var pm = $('option:selected', this).attr('value');
        var code = $('option:selected', this).attr('data-code');
        $(this).addClass("column_pmethod_" + code);

        $(this).closest('[js-change-pm-form]').trigger('submit');
    });

    $('[js-change-pm-form]').on('submit', function (event) {
        event.preventDefault();
        updatePaymentMethod($(this).serializeObject());
    });

    $('[js-pay-date]').on('click', function () {
        PAYFORM = $(this).closest('[js-pay-form]');
        PAYDATE_TEMP = $(this).val();
    });
    $('[js-pay-date]').on('keydown', function (event) {
        return false;
    });
    $('[js-pay-form]').submit(function (event) {
        event.preventDefault();
        updateBillPayDate($(this).serializeObject());
    });
    initDatePicker();
})
function updateBillPayDate(formData) {
    $('[js-pay-date]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateBillPayDate",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-pay-date]').prop("disabled", false);
        },
        error: function (data) {
            PAYFORM.find('[js-pay-date]').val(PAYDATE_TEMP);
            $('[js-pay-date]').prop("disabled", false);
        }
    });
}
function updateStatus(formData) {
    $('[js-status]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateStatus",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            var form = RADIO_BTN.closest('[js-status-form]');
            form.closest('.body__row').find('.column_bstatus').removeClassWild('column_bstatus_*');
            if (formData['status'] === "2") {
                form.closest('.body__row').find('.column_bstatus').addClass('column_bstatus_checked');
            } else {
                form.closest('.body__row').find('.column_bstatus').addClass('column_bstatus_unchecked');
            }

            $('[js-status]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-status]').prop("disabled", false);
        }
    });
}

function updateSum(formData) {
    $('[js-change-amount-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateSum",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            CHANGE_BTN.removeClass('block');
            $('[js-change-amount-btn]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-change-amount-btn]').prop("disabled", false);
        }
    });
}

function updatePaymentMethod(formData) {
    $('[js-change-pm-selector]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updatePaymentMethod",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-change-pm-selector]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-change-pm-selector]').prop("disabled", false);
        }
    });
}
function initDatePicker() {
    $('.datepicker-here-b').datepicker({
        autoClose: true,
        onSelect: function(formattedDate, date, inst) {
            PAYFORM.trigger('submit');
        }
    });
}
function initFancy() {
    $('[data-fancybox]').fancybox({
        infobar: false,
        buttons: [
            "close"
        ],
    });
}
$(document).ready(function(){
    const $filterForm = $('[tr-filter-form]');
    const $filterFormBtn = $('[tr-filter-form-btn]');
    const $filter = $('[tr-filter]');
    const $filterOpenBtn = $('[tr-filter-btn]');
    const $filterCloseBtn = $('[tr-filter-close-btn]');

    $filterOpenBtn.on('click', function() {
        $('body').addClass('hiddenOverflow');
        $filter.addClass('is-open');
    });

    $filterCloseBtn.on('click', function() {
        $('body').removeClass('hiddenOverflow');
        $filter.removeClass('is-open');
        resetFilter($filterFromBack);
    });

    $filterFormBtn.on('click', function(event) {
        event.preventDefault();
        $filterForm.trigger('submit');
    });

    $('.datepicker-here-f').datepicker({
        autoClose: true
    });
});

//список фильтр
var $filterFromBack;
function setFilter(filter) {
    $filterFromBack = filter;
}

function resetFilter(filter) {
    $('#idManager option:selected').removeAttr('selected');
    $('#idManager').val(filter.idManager);

    $('#course option:selected').removeAttr('selected');
    $('#course').val(filter.course);

    $('#status option:selected').removeAttr('selected');
    $('#status').val(filter.status);

    $('#paymentMethod option:selected').removeAttr('selected');
    $('#paymentMethod').val(filter.paymentMethod);

    $('#paidFrom').val(filter.paidFrom);
    $('#paidTo').val(filter.paidTo);

    $('#payDateFrom').val(filter.payDateFrom);
    $('#payDateTo').val(filter.payDateTo);

    $('#client').val(filter.client);
    $('#accountNumber').val(filter.accountNumber);
    $('#transactionNumber').val(filter.transactionNumber);

    $('input:checkbox[name="empties"]').prop("checked", false).attr("checked", false).removeAttr("checked");
    $.each(filter.statuses, function(index, value) {
        $('input:checkbox[name="empties"]').filter('[value="' + value + '"]').attr('checked', true).prop("checked", true);
    });
}


$(document).on('click', '[js-copy-link]', function(event){
    var $tmp = $("<textarea>");
    $("body").append($tmp);
    $tmp.val($(this).attr('data-link')).select();
    document.execCommand("copy");
    $tmp.remove();
});

var ENABLE_MESSAGE = 'Уже доступно';

//client main page
function getCountdownOnUserCoursesPage() {
    var timeInfos = document.getElementsByClassName('clientTimeInfo');
    for (var i = 0; i < timeInfos.length; i++) {
        var fullTimeSpan = timeInfos[i].getElementsByClassName('countdown')[0];
        var fullStartTime = Number(fullTimeSpan.getAttribute('data-startDate'));
        startCountdown(fullTimeSpan.id, fullStartTime, actionOnTimerRunOutOnUserCoursesPage);
    }
}

//course overview
function getCountdownOnUserModulesPage() {
    var fullTimeSpan = document.getElementsByClassName('countdown')[0];
    var fullStartTime = Number(fullTimeSpan.getAttribute('data-startDate'));
    startCountdown(fullTimeSpan.id, fullStartTime, actionOnTimerRunOutOnUserModulesPage);
}

function actionOnTimerRunOutOnUserModulesPage() {
    location.reload();
    return ENABLE_MESSAGE;
}

function actionOnTimerRunOutOnUserCoursesPage() {
    return ENABLE_MESSAGE;
}

/*Отсчёт оставшегося до старта потока времени.
@timerId - id элемента для вывода отсчёта
@fullStartTime - время старта потока, до которого нужно отсчитывать
@action - какое действие должно выполниться по истечении времени.*/
function startCountdown(timerId, fullStartTime, action) {
    var timerShow = document.getElementById(timerId);
    var ms_left = fullStartTime - new Date();
    if (ms_left <= 0) {
        timerShow.innerHTML = ENABLE_MESSAGE;
    } else {
        var str_timer = buildTimerString(new Date(ms_left));
        timerShow.innerHTML = str_timer;
        // Запуск интервала таймера
        setInterval(function () {
            ms_left = fullStartTime - new Date();
            if (ms_left <= 0) {
                clearInterval(this);
                timerShow.innerHTML = action();
            } else {
                str_timer = buildTimerString(new Date(ms_left));
                timerShow.innerHTML = str_timer;
            }
        }, 1000);
    }
}

//формирует строку для вывода таймера.
function buildTimerString(inputDate) {
    var resultString = '';
    var datePoint = inputDate.getUTCFullYear() - 1970;
    resultString += subBuildTimerString(datePoint) + ' : ';

    datePoint = inputDate.getUTCMonth();
    resultString += subBuildTimerString(datePoint) + ' : ';

    datePoint = inputDate.getUTCDate() - 1;
    resultString += subBuildTimerString(datePoint) + ' : ';

    datePoint = inputDate.getUTCHours();
    resultString += subBuildTimerString(datePoint) + ' : ';

    datePoint = inputDate.getUTCMinutes();
    resultString += subBuildTimerString(datePoint) + ' : ';

    datePoint = inputDate.getUTCSeconds();
    resultString += subBuildTimerString(datePoint);

    return resultString;
}

/*Если показатель меньше десяти- приводит к виду '0X'
@datePoint - составная даты(год, или месяц, или день и т.д.)*/
function subBuildTimerString(datePoint) {
    if (Number(datePoint) >= 10) {
        return datePoint;
    } else {
        return ('0' + datePoint);
    }
}
$(document).on('click', '[js-update-course]', function(event){
    setCourseInfo($(this));
});
function setCourseInfo(btn) {
    var formData = new FormData();
    formData.set('id', btn.data('course'));

    $('[js-update-course]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getCourse",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setCourseSelectors(btn);
            $('[up-course-id]').val(data.id);

            $('[current-course]').attr('current-course', data.id);

            $('[up-course-name]').val(data.name);
            $('[up-course-price]').val(data.price);
            $("input[up-course-theme][value=" + data.theme + "]").prop("checked", true);
            $('[up-course-bg]').val(data.backgroundColor);

            if(!data.isUsed) {
                $('[update-footer]').html($('[update-footer]').html() +
                    '<button delete-course type="button" class="button button_white button_right">' +
                    '    <span>Удалить</span>' +
                    '</button>');
            }

            $('[js-menu-update]').addClass('is-open');
            checkBodyHidden();
            $('[js-update-course]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-course]').prop("disabled", false);
        }
    });
}
$(document).on('click', '[delete-course]', function(event){
    var formData = new FormData();
    var currentId = $('[up-course-id]').val();
    formData.set('id', currentId);

    $('[delete-course]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "deleteCourse",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[data-course="' + currentId + '"]').remove();
            closeUpdateCourseMenu();

            $('[delete-course]').prop("disabled", false);
        },
        error: function (data) {
            $('[delete-course]').prop("disabled", false);
        }
    });
});
$(document).on('click', '[js-menu-update-close-btn]', function(event){
    closeUpdateCourseMenu();
});
function closeUpdateCourseMenu() {
    $('[js-menu-update]').removeClass('is-open');
    $('[js-update-form]').trigger('reset');

    $('.js-labelFile').removeClass('has-file');
    $('.js-fileName').html('Загрузите изображение (290x240px)');

    $('[delete-course]').remove();

    //сбросить табы
    $('[js-update-form]').find('[js-tab]').trigger('click');

    resetCourseSelectors();
    checkBodyHidden();
}

$(document).on('click', '[js-create-course]', function(event){
    $('[js-menu-course]').addClass('is-open');
    setCourseSelectors($(this));
    checkBodyHidden();
});

$(document).on('click', '[js-menu-course-close-btn]', function(event){
    closeCourseMenu();
});

function closeCourseMenu() {
    $('[js-menu-course]').removeClass('is-open');
    $('[js-course-form]').trigger('reset');
    resetCourseSelectors();
    checkBodyHidden();
}
$(document).on('click', '[js-update]', function(event){
    event.preventDefault();
    $('[js-update-form]').trigger('submit');
});
$(document).on('submit', '[js-update-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-update-form]')[0]);
        updateCourse(formData);
    }
});
function updateCourse(formData) {
    $('[js-update]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "updateCourse",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateCourseBlock(data);

            closeUpdateCourseMenu();

            $('[js-update]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update]').prop("disabled", false);
        }
    });
}
function updateCourseBlock(data) {
    var prodBlock = createCourse(data);

    var product = $('[js-tab-panel][data-type!="all"]').find('.product-block[data-course="' + data.id + '"]');
    var productCommon = $('[js-tab-panel][data-type="all"]').find('.product-block[data-course="' + data.id + '"]');

    productCommon.replaceWith(prodBlock);

    if (product.data('project') === data.idProject &&  product.data('type') === data.idCourseType) {
        product.replaceWith(prodBlock);
    } else {
        product.remove();
        addCourse(data)
    }
}

function addCourse(data) {
    var productList = $('.products[data-project="' + data.idProject + '"]').find('[js-tab-panel][data-type="' + data.idCourseType + '"]').find('.products__list');

    productList.html( createCourse(data)
        + productList.html());
}
function addCourseToCommon(data) {
    var productList = $('.products[data-project="' + data.idProject + '"]').find('[js-tab-panel][data-type="all"]').find('.products__list');

    productList.html( createCourse(data)
        + productList.html());
}
function createCourse(data) {
    return '<div js-update-course data-course="' + data.id + '" data-project="' + data.idProject + '" data-type="' + data.idCourseType + '" class="product-block" style="background: ' + data.backgroundColor + ';">' +
        '                 <div class="product-block__wrapper ' + data.theme + '" >'
        + (data.backgroundImage !== null ?
            '                    <div class="product-block__background">' +
            '                       <img src="/' + data.backgroundImage + '" alt="">' +
            '                     </div>' : '' ) +
        '                     <div class="product-block__title">' + data.name + '</div>' +
        '                     <div class="product-block__type">' + data.courseType + '</div>' +
        '                     <div class="product-block__price">' + numberWithSpaces(data.price) + ' ₽</div>' +
        '                 </div>' +
        '              </div>';
}

$(document).on('click', '[js-save-course]', function(event){
    event.preventDefault();
    $('[js-course-form]').trigger('submit');
});

$(document).on('submit', '[js-course-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-course-form]')[0]);
        saveCourse(formData);
    }
});

function saveCourse(formData) {
    $('[js-save-course]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveCourse",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            addCourse(data);
            addCourseToCommon(data);

            closeCourseMenu();

            $('[js-save-course]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-course]').prop("disabled", false);
        }
    });
}

function setCourseSelectors(btn) {
    $('[course-project]').val(btn.data('project'));

    var attr = btn.attr('data-type');
    if (typeof attr !== typeof undefined && attr !== false) {
        $('[course-type]').val(btn.data('type'));
    }
}

function resetCourseSelectors() {
    $('[course-type]option:selected').removeAttr('selected');
    $('[course-project]option:selected').removeAttr('selected');
}

$(document).on('change', '[js-bg-default]', function(event){
    var isChecked = $(this).is(':checked');
    $("[js-bg-default]").prop("checked", false).attr("checked", false).removeAttr("checked");

    if (isChecked) {
        $(this).prop("checked", true);
    }
});


!function(t,e,i){!function(){var s,a,n,h="2.2.3",o="datepicker",r=".datepicker-here",c=!1,d='<div class="datepicker"><i class="datepicker--pointer"></i><nav class="datepicker--nav"></nav><div class="datepicker--content"></div></div>',l={classes:"",inline:!1,language:"ru",startDate:new Date,firstDay:"",weekends:[6,0],dateFormat:"",altField:"",altFieldDateFormat:"@",toggleSelected:!0,keyboardNav:!0,position:"bottom left",offset:12,view:"days",minView:"days",showOtherMonths:!0,selectOtherMonths:!0,moveToOtherMonthsOnSelect:!0,showOtherYears:!0,selectOtherYears:!0,moveToOtherYearsOnSelect:!0,minDate:"",maxDate:"",disableNavWhenOutOfRange:!0,multipleDates:!1,multipleDatesSeparator:",",range:!1,todayButton:!1,clearButton:!1,showEvent:"focus",autoClose:!1,monthsField:"monthsShort",prevHtml:'<svg><path d="M 17,12 l -5,5 l 5,5"></path></svg>',nextHtml:'<svg><path d="M 14,12 l 5,5 l -5,5"></path></svg>',navTitles:{days:"MM, <i>yyyy</i>",months:"yyyy",years:"yyyy1 - yyyy2"},timepicker:!1,onlyTimepicker:!1,dateTimeSeparator:" ",timeFormat:"",minHours:0,maxHours:24,minMinutes:0,maxMinutes:59,hoursStep:1,minutesStep:1,onSelect:"",onShow:"",onHide:"",onChangeMonth:"",onChangeYear:"",onChangeDecade:"",onChangeView:"",onRenderCell:""},u={ctrlRight:[17,39],ctrlUp:[17,38],ctrlLeft:[17,37],ctrlDown:[17,40],shiftRight:[16,39],shiftUp:[16,38],shiftLeft:[16,37],shiftDown:[16,40],altUp:[18,38],altRight:[18,39],altLeft:[18,37],altDown:[18,40],ctrlShiftUp:[16,17,38]},m=function(t,a){this.el=t,this.$el=e(t),this.opts=e.extend(!0,{},l,a,this.$el.data()),s==i&&(s=e("body")),this.opts.startDate||(this.opts.startDate=new Date),"INPUT"==this.el.nodeName&&(this.elIsInput=!0),this.opts.altField&&(this.$altField="string"==typeof this.opts.altField?e(this.opts.altField):this.opts.altField),this.inited=!1,this.visible=!1,this.silent=!1,this.currentDate=this.opts.startDate,this.currentView=this.opts.view,this._createShortCuts(),this.selectedDates=[],this.views={},this.keys=[],this.minRange="",this.maxRange="",this._prevOnSelectValue="",this.init()};n=m,n.prototype={VERSION:h,viewIndexes:["days","months","years"],init:function(){c||this.opts.inline||!this.elIsInput||this._buildDatepickersContainer(),this._buildBaseHtml(),this._defineLocale(this.opts.language),this._syncWithMinMaxDates(),this.elIsInput&&(this.opts.inline||(this._setPositionClasses(this.opts.position),this._bindEvents()),this.opts.keyboardNav&&!this.opts.onlyTimepicker&&this._bindKeyboardEvents(),this.$datepicker.on("mousedown",this._onMouseDownDatepicker.bind(this)),this.$datepicker.on("mouseup",this._onMouseUpDatepicker.bind(this))),this.opts.classes&&this.$datepicker.addClass(this.opts.classes),this.opts.timepicker&&(this.timepicker=new e.fn.datepicker.Timepicker(this,this.opts),this._bindTimepickerEvents()),this.opts.onlyTimepicker&&this.$datepicker.addClass("-only-timepicker-"),this.views[this.currentView]=new e.fn.datepicker.Body(this,this.currentView,this.opts),this.views[this.currentView].show(),this.nav=new e.fn.datepicker.Navigation(this,this.opts),this.view=this.currentView,this.$el.on("clickCell.adp",this._onClickCell.bind(this)),this.$datepicker.on("mouseenter",".datepicker--cell",this._onMouseEnterCell.bind(this)),this.$datepicker.on("mouseleave",".datepicker--cell",this._onMouseLeaveCell.bind(this)),this.inited=!0},_createShortCuts:function(){this.minDate=this.opts.minDate?this.opts.minDate:new Date(-86399999136e5),this.maxDate=this.opts.maxDate?this.opts.maxDate:new Date(86399999136e5)},_bindEvents:function(){this.$el.on(this.opts.showEvent+".adp",this._onShowEvent.bind(this)),this.$el.on("mouseup.adp",this._onMouseUpEl.bind(this)),this.$el.on("blur.adp",this._onBlur.bind(this)),this.$el.on("keyup.adp",this._onKeyUpGeneral.bind(this)),e(t).on("resize.adp",this._onResize.bind(this)),e("body").on("mouseup.adp",this._onMouseUpBody.bind(this))},_bindKeyboardEvents:function(){this.$el.on("keydown.adp",this._onKeyDown.bind(this)),this.$el.on("keyup.adp",this._onKeyUp.bind(this)),this.$el.on("hotKey.adp",this._onHotKey.bind(this))},_bindTimepickerEvents:function(){this.$el.on("timeChange.adp",this._onTimeChange.bind(this))},isWeekend:function(t){return-1!==this.opts.weekends.indexOf(t)},_defineLocale:function(t){"string"==typeof t?(this.loc=e.fn.datepicker.language[t],this.loc||(console.warn("Can't find language \""+t+'" in Datepicker.language, will use "ru" instead'),this.loc=e.extend(!0,{},e.fn.datepicker.language.ru)),this.loc=e.extend(!0,{},e.fn.datepicker.language.ru,e.fn.datepicker.language[t])):this.loc=e.extend(!0,{},e.fn.datepicker.language.ru,t),this.opts.dateFormat&&(this.loc.dateFormat=this.opts.dateFormat),this.opts.timeFormat&&(this.loc.timeFormat=this.opts.timeFormat),""!==this.opts.firstDay&&(this.loc.firstDay=this.opts.firstDay),this.opts.timepicker&&(this.loc.dateFormat=[this.loc.dateFormat,this.loc.timeFormat].join(this.opts.dateTimeSeparator)),this.opts.onlyTimepicker&&(this.loc.dateFormat=this.loc.timeFormat);var i=this._getWordBoundaryRegExp;(this.loc.timeFormat.match(i("aa"))||this.loc.timeFormat.match(i("AA")))&&(this.ampm=!0)},_buildDatepickersContainer:function(){c=!0,s.append('<div class="datepickers-container" id="datepickers-container"></div>'),a=e("#datepickers-container")},_buildBaseHtml:function(){var t,i=e('<div class="datepicker-inline">');t="INPUT"==this.el.nodeName?this.opts.inline?i.insertAfter(this.$el):a:i.appendTo(this.$el),this.$datepicker=e(d).appendTo(t),this.$content=e(".datepicker--content",this.$datepicker),this.$nav=e(".datepicker--nav",this.$datepicker)},_triggerOnChange:function(){if(!this.selectedDates.length){if(""===this._prevOnSelectValue)return;return this._prevOnSelectValue="",this.opts.onSelect("","",this)}var t,e=this.selectedDates,i=n.getParsedDate(e[0]),s=this,a=new Date(i.year,i.month,i.date,i.hours,i.minutes);t=e.map(function(t){return s.formatDate(s.loc.dateFormat,t)}).join(this.opts.multipleDatesSeparator),(this.opts.multipleDates||this.opts.range)&&(a=e.map(function(t){var e=n.getParsedDate(t);return new Date(e.year,e.month,e.date,e.hours,e.minutes)})),this._prevOnSelectValue=t,this.opts.onSelect(t,a,this)},next:function(){var t=this.parsedDate,e=this.opts;switch(this.view){case"days":this.date=new Date(t.year,t.month+1,1),e.onChangeMonth&&e.onChangeMonth(this.parsedDate.month,this.parsedDate.year);break;case"months":this.date=new Date(t.year+1,t.month,1),e.onChangeYear&&e.onChangeYear(this.parsedDate.year);break;case"years":this.date=new Date(t.year+10,0,1),e.onChangeDecade&&e.onChangeDecade(this.curDecade)}},prev:function(){var t=this.parsedDate,e=this.opts;switch(this.view){case"days":this.date=new Date(t.year,t.month-1,1),e.onChangeMonth&&e.onChangeMonth(this.parsedDate.month,this.parsedDate.year);break;case"months":this.date=new Date(t.year-1,t.month,1),e.onChangeYear&&e.onChangeYear(this.parsedDate.year);break;case"years":this.date=new Date(t.year-10,0,1),e.onChangeDecade&&e.onChangeDecade(this.curDecade)}},formatDate:function(t,e){e=e||this.date;var i,s=t,a=this._getWordBoundaryRegExp,h=this.loc,o=n.getLeadingZeroNum,r=n.getDecade(e),c=n.getParsedDate(e),d=c.fullHours,l=c.hours,u=t.match(a("aa"))||t.match(a("AA")),m="am",p=this._replacer;switch(this.opts.timepicker&&this.timepicker&&u&&(i=this.timepicker._getValidHoursFromDate(e,u),d=o(i.hours),l=i.hours,m=i.dayPeriod),!0){case/@/.test(s):s=s.replace(/@/,e.getTime());case/aa/.test(s):s=p(s,a("aa"),m);case/AA/.test(s):s=p(s,a("AA"),m.toUpperCase());case/dd/.test(s):s=p(s,a("dd"),c.fullDate);case/d/.test(s):s=p(s,a("d"),c.date);case/DD/.test(s):s=p(s,a("DD"),h.days[c.day]);case/D/.test(s):s=p(s,a("D"),h.daysShort[c.day]);case/mm/.test(s):s=p(s,a("mm"),c.fullMonth);case/m/.test(s):s=p(s,a("m"),c.month+1);case/MM/.test(s):s=p(s,a("MM"),this.loc.months[c.month]);case/M/.test(s):s=p(s,a("M"),h.monthsShort[c.month]);case/ii/.test(s):s=p(s,a("ii"),c.fullMinutes);case/i/.test(s):s=p(s,a("i"),c.minutes);case/hh/.test(s):s=p(s,a("hh"),d);case/h/.test(s):s=p(s,a("h"),l);case/yyyy/.test(s):s=p(s,a("yyyy"),c.year);case/yyyy1/.test(s):s=p(s,a("yyyy1"),r[0]);case/yyyy2/.test(s):s=p(s,a("yyyy2"),r[1]);case/yy/.test(s):s=p(s,a("yy"),c.year.toString().slice(-2))}return s},_replacer:function(t,e,i){return t.replace(e,function(t,e,s,a){return e+i+a})},_getWordBoundaryRegExp:function(t){var e="\\s|\\.|-|/|\\\\|,|\\$|\\!|\\?|:|;";return new RegExp("(^|>|"+e+")("+t+")($|<|"+e+")","g")},selectDate:function(t){var e=this,i=e.opts,s=e.parsedDate,a=e.selectedDates,h=a.length,o="";if(Array.isArray(t))return void t.forEach(function(t){e.selectDate(t)});if(t instanceof Date){if(this.lastSelectedDate=t,this.timepicker&&this.timepicker._setTime(t),e._trigger("selectDate",t),this.timepicker&&(t.setHours(this.timepicker.hours),t.setMinutes(this.timepicker.minutes)),"days"==e.view&&t.getMonth()!=s.month&&i.moveToOtherMonthsOnSelect&&(o=new Date(t.getFullYear(),t.getMonth(),1)),"years"==e.view&&t.getFullYear()!=s.year&&i.moveToOtherYearsOnSelect&&(o=new Date(t.getFullYear(),0,1)),o&&(e.silent=!0,e.date=o,e.silent=!1,e.nav._render()),i.multipleDates&&!i.range){if(h===i.multipleDates)return;e._isSelected(t)||e.selectedDates.push(t)}else i.range?2==h?(e.selectedDates=[t],e.minRange=t,e.maxRange=""):1==h?(e.selectedDates.push(t),e.maxRange?e.minRange=t:e.maxRange=t,n.bigger(e.maxRange,e.minRange)&&(e.maxRange=e.minRange,e.minRange=t),e.selectedDates=[e.minRange,e.maxRange]):(e.selectedDates=[t],e.minRange=t):e.selectedDates=[t];e._setInputValue(),i.onSelect&&e._triggerOnChange(),i.autoClose&&!this.timepickerIsActive&&(i.multipleDates||i.range?i.range&&2==e.selectedDates.length&&e.hide():e.hide()),e.views[this.currentView]._render()}},removeDate:function(t){var e=this.selectedDates,i=this;if(t instanceof Date)return e.some(function(s,a){return n.isSame(s,t)?(e.splice(a,1),i.selectedDates.length?i.lastSelectedDate=i.selectedDates[i.selectedDates.length-1]:(i.minRange="",i.maxRange="",i.lastSelectedDate=""),i.views[i.currentView]._render(),i._setInputValue(),i.opts.onSelect&&i._triggerOnChange(),!0):void 0})},today:function(){this.silent=!0,this.view=this.opts.minView,this.silent=!1,this.date=new Date,this.opts.todayButton instanceof Date&&this.selectDate(this.opts.todayButton)},clear:function(){this.selectedDates=[],this.minRange="",this.maxRange="",this.views[this.currentView]._render(),this._setInputValue(),this.opts.onSelect&&this._triggerOnChange()},update:function(t,i){var s=arguments.length,a=this.lastSelectedDate;return 2==s?this.opts[t]=i:1==s&&"object"==typeof t&&(this.opts=e.extend(!0,this.opts,t)),this._createShortCuts(),this._syncWithMinMaxDates(),this._defineLocale(this.opts.language),this.nav._addButtonsIfNeed(),this.opts.onlyTimepicker||this.nav._render(),this.views[this.currentView]._render(),this.elIsInput&&!this.opts.inline&&(this._setPositionClasses(this.opts.position),this.visible&&this.setPosition(this.opts.position)),this.opts.classes&&this.$datepicker.addClass(this.opts.classes),this.opts.onlyTimepicker&&this.$datepicker.addClass("-only-timepicker-"),this.opts.timepicker&&(a&&this.timepicker._handleDate(a),this.timepicker._updateRanges(),this.timepicker._updateCurrentTime(),a&&(a.setHours(this.timepicker.hours),a.setMinutes(this.timepicker.minutes))),this._setInputValue(),this},_syncWithMinMaxDates:function(){var t=this.date.getTime();this.silent=!0,this.minTime>t&&(this.date=this.minDate),this.maxTime<t&&(this.date=this.maxDate),this.silent=!1},_isSelected:function(t,e){var i=!1;return this.selectedDates.some(function(s){return n.isSame(s,t,e)?(i=s,!0):void 0}),i},_setInputValue:function(){var t,e=this,i=e.opts,s=e.loc.dateFormat,a=i.altFieldDateFormat,n=e.selectedDates.map(function(t){return e.formatDate(s,t)});i.altField&&e.$altField.length&&(t=this.selectedDates.map(function(t){return e.formatDate(a,t)}),t=t.join(this.opts.multipleDatesSeparator),this.$altField.val(t)),n=n.join(this.opts.multipleDatesSeparator),this.$el.val(n)},_isInRange:function(t,e){var i=t.getTime(),s=n.getParsedDate(t),a=n.getParsedDate(this.minDate),h=n.getParsedDate(this.maxDate),o=new Date(s.year,s.month,a.date).getTime(),r=new Date(s.year,s.month,h.date).getTime(),c={day:i>=this.minTime&&i<=this.maxTime,month:o>=this.minTime&&r<=this.maxTime,year:s.year>=a.year&&s.year<=h.year};return e?c[e]:c.day},_getDimensions:function(t){var e=t.offset();return{width:t.outerWidth(),height:t.outerHeight(),left:e.left,top:e.top}},_getDateFromCell:function(t){var e=this.parsedDate,s=t.data("year")||e.year,a=t.data("month")==i?e.month:t.data("month"),n=t.data("date")||1;return new Date(s,a,n)},_setPositionClasses:function(t){t=t.split(" ");var e=t[0],i=t[1],s="datepicker -"+e+"-"+i+"- -from-"+e+"-";this.visible&&(s+=" active"),this.$datepicker.removeAttr("class").addClass(s)},setPosition:function(t){t=t||this.opts.position;var e,i,s=this._getDimensions(this.$el),a=this._getDimensions(this.$datepicker),n=t.split(" "),h=this.opts.offset,o=n[0],r=n[1];switch(o){case"top":e=s.top-a.height-h;break;case"right":i=s.left+s.width+h;break;case"bottom":e=s.top+s.height+h;break;case"left":i=s.left-a.width-h}switch(r){case"top":e=s.top;break;case"right":i=s.left+s.width-a.width;break;case"bottom":e=s.top+s.height-a.height;break;case"left":i=s.left;break;case"center":/left|right/.test(o)?e=s.top+s.height/2-a.height/2:i=s.left+s.width/2-a.width/2}this.$datepicker.css({left:i,top:e})},show:function(){var t=this.opts.onShow;this.setPosition(this.opts.position),this.$datepicker.addClass("active"),this.visible=!0,t&&this._bindVisionEvents(t)},hide:function(){var t=this.opts.onHide;this.$datepicker.removeClass("active").css({left:"-100000px"}),this.focused="",this.keys=[],this.inFocus=!1,this.visible=!1,this.$el.blur(),t&&this._bindVisionEvents(t)},down:function(t){this._changeView(t,"down")},up:function(t){this._changeView(t,"up")},_bindVisionEvents:function(t){this.$datepicker.off("transitionend.dp"),t(this,!1),this.$datepicker.one("transitionend.dp",t.bind(this,this,!0))},_changeView:function(t,e){t=t||this.focused||this.date;var i="up"==e?this.viewIndex+1:this.viewIndex-1;i>2&&(i=2),0>i&&(i=0),this.silent=!0,this.date=new Date(t.getFullYear(),t.getMonth(),1),this.silent=!1,this.view=this.viewIndexes[i]},_handleHotKey:function(t){var e,i,s,a=n.getParsedDate(this._getFocusedDate()),h=this.opts,o=!1,r=!1,c=!1,d=a.year,l=a.month,u=a.date;switch(t){case"ctrlRight":case"ctrlUp":l+=1,o=!0;break;case"ctrlLeft":case"ctrlDown":l-=1,o=!0;break;case"shiftRight":case"shiftUp":r=!0,d+=1;break;case"shiftLeft":case"shiftDown":r=!0,d-=1;break;case"altRight":case"altUp":c=!0,d+=10;break;case"altLeft":case"altDown":c=!0,d-=10;break;case"ctrlShiftUp":this.up()}s=n.getDaysCount(new Date(d,l)),i=new Date(d,l,u),u>s&&(u=s),i.getTime()<this.minTime?i=this.minDate:i.getTime()>this.maxTime&&(i=this.maxDate),this.focused=i,e=n.getParsedDate(i),o&&h.onChangeMonth&&h.onChangeMonth(e.month,e.year),r&&h.onChangeYear&&h.onChangeYear(e.year),c&&h.onChangeDecade&&h.onChangeDecade(this.curDecade)},_registerKey:function(t){var e=this.keys.some(function(e){return e==t});e||this.keys.push(t)},_unRegisterKey:function(t){var e=this.keys.indexOf(t);this.keys.splice(e,1)},_isHotKeyPressed:function(){var t,e=!1,i=this,s=this.keys.sort();for(var a in u)t=u[a],s.length==t.length&&t.every(function(t,e){return t==s[e]})&&(i._trigger("hotKey",a),e=!0);return e},_trigger:function(t,e){this.$el.trigger(t,e)},_focusNextCell:function(t,e){e=e||this.cellType;var i=n.getParsedDate(this._getFocusedDate()),s=i.year,a=i.month,h=i.date;if(!this._isHotKeyPressed()){switch(t){case 37:"day"==e?h-=1:"","month"==e?a-=1:"","year"==e?s-=1:"";break;case 38:"day"==e?h-=7:"","month"==e?a-=3:"","year"==e?s-=4:"";break;case 39:"day"==e?h+=1:"","month"==e?a+=1:"","year"==e?s+=1:"";break;case 40:"day"==e?h+=7:"","month"==e?a+=3:"","year"==e?s+=4:""}var o=new Date(s,a,h);o.getTime()<this.minTime?o=this.minDate:o.getTime()>this.maxTime&&(o=this.maxDate),this.focused=o}},_getFocusedDate:function(){var t=this.focused||this.selectedDates[this.selectedDates.length-1],e=this.parsedDate;if(!t)switch(this.view){case"days":t=new Date(e.year,e.month,(new Date).getDate());break;case"months":t=new Date(e.year,e.month,1);break;case"years":t=new Date(e.year,0,1)}return t},_getCell:function(t,i){i=i||this.cellType;var s,a=n.getParsedDate(t),h='.datepicker--cell[data-year="'+a.year+'"]';switch(i){case"month":h='[data-month="'+a.month+'"]';break;case"day":h+='[data-month="'+a.month+'"][data-date="'+a.date+'"]'}return s=this.views[this.currentView].$el.find(h),s.length?s:e("")},destroy:function(){var t=this;t.$el.off(".adp").data("datepicker",""),t.selectedDates=[],t.focused="",t.views={},t.keys=[],t.minRange="",t.maxRange="",t.opts.inline||!t.elIsInput?t.$datepicker.closest(".datepicker-inline").remove():t.$datepicker.remove()},_handleAlreadySelectedDates:function(t,e){this.opts.range?this.opts.toggleSelected?this.removeDate(e):2!=this.selectedDates.length&&this._trigger("clickCell",e):this.opts.toggleSelected&&this.removeDate(e),this.opts.toggleSelected||(this.lastSelectedDate=t,this.opts.timepicker&&(this.timepicker._setTime(t),this.timepicker.update()))},_onShowEvent:function(t){this.visible||this.show()},_onBlur:function(){!this.inFocus&&this.visible&&this.hide()},_onMouseDownDatepicker:function(t){this.inFocus=!0},_onMouseUpDatepicker:function(t){this.inFocus=!1,t.originalEvent.inFocus=!0,t.originalEvent.timepickerFocus||this.$el.focus()},_onKeyUpGeneral:function(t){var e=this.$el.val();e||this.clear()},_onResize:function(){this.visible&&this.setPosition()},_onMouseUpBody:function(t){t.originalEvent.inFocus||this.visible&&!this.inFocus&&this.hide()},_onMouseUpEl:function(t){t.originalEvent.inFocus=!0,setTimeout(this._onKeyUpGeneral.bind(this),4)},_onKeyDown:function(t){var e=t.which;if(this._registerKey(e),e>=37&&40>=e&&(t.preventDefault(),this._focusNextCell(e)),13==e&&this.focused){if(this._getCell(this.focused).hasClass("-disabled-"))return;if(this.view!=this.opts.minView)this.down();else{var i=this._isSelected(this.focused,this.cellType);if(!i)return this.timepicker&&(this.focused.setHours(this.timepicker.hours),this.focused.setMinutes(this.timepicker.minutes)),void this.selectDate(this.focused);this._handleAlreadySelectedDates(i,this.focused)}}27==e&&this.hide()},_onKeyUp:function(t){var e=t.which;this._unRegisterKey(e)},_onHotKey:function(t,e){this._handleHotKey(e)},_onMouseEnterCell:function(t){var i=e(t.target).closest(".datepicker--cell"),s=this._getDateFromCell(i);this.silent=!0,this.focused&&(this.focused=""),i.addClass("-focus-"),this.focused=s,this.silent=!1,this.opts.range&&1==this.selectedDates.length&&(this.minRange=this.selectedDates[0],this.maxRange="",n.less(this.minRange,this.focused)&&(this.maxRange=this.minRange,this.minRange=""),this.views[this.currentView]._update())},_onMouseLeaveCell:function(t){var i=e(t.target).closest(".datepicker--cell");i.removeClass("-focus-"),this.silent=!0,this.focused="",this.silent=!1},_onTimeChange:function(t,e,i){var s=new Date,a=this.selectedDates,n=!1;a.length&&(n=!0,s=this.lastSelectedDate),s.setHours(e),s.setMinutes(i),n||this._getCell(s).hasClass("-disabled-")?(this._setInputValue(),this.opts.onSelect&&this._triggerOnChange()):this.selectDate(s)},_onClickCell:function(t,e){this.timepicker&&(e.setHours(this.timepicker.hours),e.setMinutes(this.timepicker.minutes)),this.selectDate(e)},set focused(t){if(!t&&this.focused){var e=this._getCell(this.focused);e.length&&e.removeClass("-focus-")}this._focused=t,this.opts.range&&1==this.selectedDates.length&&(this.minRange=this.selectedDates[0],this.maxRange="",n.less(this.minRange,this._focused)&&(this.maxRange=this.minRange,this.minRange="")),this.silent||(this.date=t)},get focused(){return this._focused},get parsedDate(){return n.getParsedDate(this.date)},set date(t){return t instanceof Date?(this.currentDate=t,this.inited&&!this.silent&&(this.views[this.view]._render(),this.nav._render(),this.visible&&this.elIsInput&&this.setPosition()),t):void 0},get date(){return this.currentDate},set view(t){return this.viewIndex=this.viewIndexes.indexOf(t),this.viewIndex<0?void 0:(this.prevView=this.currentView,this.currentView=t,this.inited&&(this.views[t]?this.views[t]._render():this.views[t]=new e.fn.datepicker.Body(this,t,this.opts),this.views[this.prevView].hide(),this.views[t].show(),this.nav._render(),this.opts.onChangeView&&this.opts.onChangeView(t),this.elIsInput&&this.visible&&this.setPosition()),t)},get view(){return this.currentView},get cellType(){return this.view.substring(0,this.view.length-1)},get minTime(){var t=n.getParsedDate(this.minDate);return new Date(t.year,t.month,t.date).getTime()},get maxTime(){var t=n.getParsedDate(this.maxDate);return new Date(t.year,t.month,t.date).getTime()},get curDecade(){return n.getDecade(this.date)}},n.getDaysCount=function(t){return new Date(t.getFullYear(),t.getMonth()+1,0).getDate()},n.getParsedDate=function(t){return{year:t.getFullYear(),month:t.getMonth(),fullMonth:t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,date:t.getDate(),fullDate:t.getDate()<10?"0"+t.getDate():t.getDate(),day:t.getDay(),hours:t.getHours(),fullHours:t.getHours()<10?"0"+t.getHours():t.getHours(),minutes:t.getMinutes(),fullMinutes:t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()}},n.getDecade=function(t){var e=10*Math.floor(t.getFullYear()/10);return[e,e+9]},n.template=function(t,e){return t.replace(/#\{([\w]+)\}/g,function(t,i){return e[i]||0===e[i]?e[i]:void 0})},n.isSame=function(t,e,i){if(!t||!e)return!1;var s=n.getParsedDate(t),a=n.getParsedDate(e),h=i?i:"day",o={day:s.date==a.date&&s.month==a.month&&s.year==a.year,month:s.month==a.month&&s.year==a.year,year:s.year==a.year};return o[h]},n.less=function(t,e,i){return t&&e?e.getTime()<t.getTime():!1},n.bigger=function(t,e,i){return t&&e?e.getTime()>t.getTime():!1},n.getLeadingZeroNum=function(t){return parseInt(t)<10?"0"+t:t},n.resetTime=function(t){return"object"==typeof t?(t=n.getParsedDate(t),new Date(t.year,t.month,t.date)):void 0},e.fn.datepicker=function(t){return this.each(function(){if(e.data(this,o)){var i=e.data(this,o);i.opts=e.extend(!0,i.opts,t),i.update()}else e.data(this,o,new m(this,t))})},e.fn.datepicker.Constructor=m,e.fn.datepicker.language={ru:{days:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],daysShort:["Вос","Пон","Вто","Сре","Чет","Пят","Суб"],daysMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthsShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],today:"Сегодня",clear:"Очистить",dateFormat:"dd.mm.yyyy",timeFormat:"hh:ii",firstDay:1}},e(function(){e(r).datepicker()})}(),function(){var t={days:'<div class="datepicker--days datepicker--body"><div class="datepicker--days-names"></div><div class="datepicker--cells datepicker--cells-days"></div></div>',months:'<div class="datepicker--months datepicker--body"><div class="datepicker--cells datepicker--cells-months"></div></div>',years:'<div class="datepicker--years datepicker--body"><div class="datepicker--cells datepicker--cells-years"></div></div>'},s=e.fn.datepicker,a=s.Constructor;s.Body=function(t,i,s){this.d=t,this.type=i,this.opts=s,this.$el=e(""),this.opts.onlyTimepicker||this.init()},s.Body.prototype={init:function(){this._buildBaseHtml(),this._render(),this._bindEvents()},_bindEvents:function(){this.$el.on("click",".datepicker--cell",e.proxy(this._onClickCell,this))},_buildBaseHtml:function(){this.$el=e(t[this.type]).appendTo(this.d.$content),this.$names=e(".datepicker--days-names",this.$el),this.$cells=e(".datepicker--cells",this.$el)},_getDayNamesHtml:function(t,e,s,a){return e=e!=i?e:t,s=s?s:"",a=a!=i?a:0,a>7?s:7==e?this._getDayNamesHtml(t,0,s,++a):(s+='<div class="datepicker--day-name'+(this.d.isWeekend(e)?" -weekend-":"")+'">'+this.d.loc.daysMin[e]+"</div>",this._getDayNamesHtml(t,++e,s,++a))},_getCellContents:function(t,e){var i="datepicker--cell datepicker--cell-"+e,s=new Date,n=this.d,h=a.resetTime(n.minRange),o=a.resetTime(n.maxRange),r=n.opts,c=a.getParsedDate(t),d={},l=c.date;switch(e){case"day":n.isWeekend(c.day)&&(i+=" -weekend-"),c.month!=this.d.parsedDate.month&&(i+=" -other-month-",r.selectOtherMonths||(i+=" -disabled-"),r.showOtherMonths||(l=""));break;case"month":l=n.loc[n.opts.monthsField][c.month];break;case"year":var u=n.curDecade;l=c.year,(c.year<u[0]||c.year>u[1])&&(i+=" -other-decade-",r.selectOtherYears||(i+=" -disabled-"),r.showOtherYears||(l=""))}return r.onRenderCell&&(d=r.onRenderCell(t,e)||{},l=d.html?d.html:l,i+=d.classes?" "+d.classes:""),r.range&&(a.isSame(h,t,e)&&(i+=" -range-from-"),a.isSame(o,t,e)&&(i+=" -range-to-"),1==n.selectedDates.length&&n.focused?((a.bigger(h,t)&&a.less(n.focused,t)||a.less(o,t)&&a.bigger(n.focused,t))&&(i+=" -in-range-"),a.less(o,t)&&a.isSame(n.focused,t)&&(i+=" -range-from-"),a.bigger(h,t)&&a.isSame(n.focused,t)&&(i+=" -range-to-")):2==n.selectedDates.length&&a.bigger(h,t)&&a.less(o,t)&&(i+=" -in-range-")),a.isSame(s,t,e)&&(i+=" -current-"),n.focused&&a.isSame(t,n.focused,e)&&(i+=" -focus-"),n._isSelected(t,e)&&(i+=" -selected-"),(!n._isInRange(t,e)||d.disabled)&&(i+=" -disabled-"),{html:l,classes:i}},_getDaysHtml:function(t){var e=a.getDaysCount(t),i=new Date(t.getFullYear(),t.getMonth(),1).getDay(),s=new Date(t.getFullYear(),t.getMonth(),e).getDay(),n=i-this.d.loc.firstDay,h=6-s+this.d.loc.firstDay;n=0>n?n+7:n,h=h>6?h-7:h;for(var o,r,c=-n+1,d="",l=c,u=e+h;u>=l;l++)r=t.getFullYear(),o=t.getMonth(),d+=this._getDayHtml(new Date(r,o,l));return d},_getDayHtml:function(t){var e=this._getCellContents(t,"day");return'<div class="'+e.classes+'" data-date="'+t.getDate()+'" data-month="'+t.getMonth()+'" data-year="'+t.getFullYear()+'">'+e.html+"</div>"},_getMonthsHtml:function(t){for(var e="",i=a.getParsedDate(t),s=0;12>s;)e+=this._getMonthHtml(new Date(i.year,s)),s++;return e},_getMonthHtml:function(t){var e=this._getCellContents(t,"month");return'<div class="'+e.classes+'" data-month="'+t.getMonth()+'">'+e.html+"</div>"},_getYearsHtml:function(t){var e=(a.getParsedDate(t),a.getDecade(t)),i=e[0]-1,s="",n=i;for(n;n<=e[1]+1;n++)s+=this._getYearHtml(new Date(n,0));return s},_getYearHtml:function(t){var e=this._getCellContents(t,"year");return'<div class="'+e.classes+'" data-year="'+t.getFullYear()+'">'+e.html+"</div>"},_renderTypes:{days:function(){var t=this._getDayNamesHtml(this.d.loc.firstDay),e=this._getDaysHtml(this.d.currentDate);this.$cells.html(e),this.$names.html(t)},months:function(){var t=this._getMonthsHtml(this.d.currentDate);this.$cells.html(t)},years:function(){var t=this._getYearsHtml(this.d.currentDate);this.$cells.html(t)}},_render:function(){this.opts.onlyTimepicker||this._renderTypes[this.type].bind(this)()},_update:function(){var t,i,s,a=e(".datepicker--cell",this.$cells),n=this;a.each(function(a,h){i=e(this),s=n.d._getDateFromCell(e(this)),t=n._getCellContents(s,n.d.cellType),i.attr("class",t.classes)})},show:function(){this.opts.onlyTimepicker||(this.$el.addClass("active"),this.acitve=!0)},hide:function(){this.$el.removeClass("active"),this.active=!1},_handleClick:function(t){var e=t.data("date")||1,i=t.data("month")||0,s=t.data("year")||this.d.parsedDate.year,a=this.d;if(a.view!=this.opts.minView)return void a.down(new Date(s,i,e));var n=new Date(s,i,e),h=this.d._isSelected(n,this.d.cellType);return h?void a._handleAlreadySelectedDates.bind(a,h,n)():void a._trigger("clickCell",n)},_onClickCell:function(t){var i=e(t.target).closest(".datepicker--cell");i.hasClass("-disabled-")||this._handleClick.bind(this)(i)}}}(),function(){var t='<div class="datepicker--nav-action" data-action="prev">#{prevHtml}</div><div class="datepicker--nav-title">#{title}</div><div class="datepicker--nav-action" data-action="next">#{nextHtml}</div>',i='<div class="datepicker--buttons"></div>',s='<span class="datepicker--button" data-action="#{action}">#{label}</span>',a=e.fn.datepicker,n=a.Constructor;a.Navigation=function(t,e){this.d=t,this.opts=e,this.$buttonsContainer="",this.init()},a.Navigation.prototype={init:function(){this._buildBaseHtml(),this._bindEvents()},_bindEvents:function(){this.d.$nav.on("click",".datepicker--nav-action",e.proxy(this._onClickNavButton,this)),this.d.$nav.on("click",".datepicker--nav-title",e.proxy(this._onClickNavTitle,this)),this.d.$datepicker.on("click",".datepicker--button",e.proxy(this._onClickNavButton,this))},_buildBaseHtml:function(){this.opts.onlyTimepicker||this._render(),this._addButtonsIfNeed()},_addButtonsIfNeed:function(){this.opts.todayButton&&this._addButton("today"),this.opts.clearButton&&this._addButton("clear")},_render:function(){var i=this._getTitle(this.d.currentDate),s=n.template(t,e.extend({title:i},this.opts));this.d.$nav.html(s),"years"==this.d.view&&e(".datepicker--nav-title",this.d.$nav).addClass("-disabled-"),this.setNavStatus()},_getTitle:function(t){return this.d.formatDate(this.opts.navTitles[this.d.view],t)},_addButton:function(t){this.$buttonsContainer.length||this._addButtonsContainer();var i={action:t,label:this.d.loc[t]},a=n.template(s,i);e("[data-action="+t+"]",this.$buttonsContainer).length||this.$buttonsContainer.append(a)},_addButtonsContainer:function(){this.d.$datepicker.append(i),this.$buttonsContainer=e(".datepicker--buttons",this.d.$datepicker)},setNavStatus:function(){if((this.opts.minDate||this.opts.maxDate)&&this.opts.disableNavWhenOutOfRange){var t=this.d.parsedDate,e=t.month,i=t.year,s=t.date;switch(this.d.view){case"days":this.d._isInRange(new Date(i,e-1,1),"month")||this._disableNav("prev"),this.d._isInRange(new Date(i,e+1,1),"month")||this._disableNav("next");break;case"months":this.d._isInRange(new Date(i-1,e,s),"year")||this._disableNav("prev"),this.d._isInRange(new Date(i+1,e,s),"year")||this._disableNav("next");break;case"years":var a=n.getDecade(this.d.date);this.d._isInRange(new Date(a[0]-1,0,1),"year")||this._disableNav("prev"),this.d._isInRange(new Date(a[1]+1,0,1),"year")||this._disableNav("next")}}},_disableNav:function(t){e('[data-action="'+t+'"]',this.d.$nav).addClass("-disabled-")},_activateNav:function(t){e('[data-action="'+t+'"]',this.d.$nav).removeClass("-disabled-")},_onClickNavButton:function(t){var i=e(t.target).closest("[data-action]"),s=i.data("action");this.d[s]()},_onClickNavTitle:function(t){return e(t.target).hasClass("-disabled-")?void 0:"days"==this.d.view?this.d.view="months":void(this.d.view="years")}}}(),function(){var t='<div class="datepicker--time"><div class="datepicker--time-current">   <span class="datepicker--time-current-hours">#{hourVisible}</span>   <span class="datepicker--time-current-colon">:</span>   <span class="datepicker--time-current-minutes">#{minValue}</span></div><div class="datepicker--time-sliders">   <div class="datepicker--time-row">      <input type="range" name="hours" value="#{hourValue}" min="#{hourMin}" max="#{hourMax}" step="#{hourStep}"/>   </div>   <div class="datepicker--time-row">      <input type="range" name="minutes" value="#{minValue}" min="#{minMin}" max="#{minMax}" step="#{minStep}"/>   </div></div></div>',i=e.fn.datepicker,s=i.Constructor;i.Timepicker=function(t,e){this.d=t,this.opts=e,this.init()},i.Timepicker.prototype={init:function(){var t="input";this._setTime(this.d.date),this._buildHTML(),navigator.userAgent.match(/trident/gi)&&(t="change"),this.d.$el.on("selectDate",this._onSelectDate.bind(this)),this.$ranges.on(t,this._onChangeRange.bind(this)),this.$ranges.on("mouseup",this._onMouseUpRange.bind(this)),this.$ranges.on("mousemove focus ",this._onMouseEnterRange.bind(this)),this.$ranges.on("mouseout blur",this._onMouseOutRange.bind(this))},_setTime:function(t){var e=s.getParsedDate(t);this._handleDate(t),this.hours=e.hours<this.minHours?this.minHours:e.hours,this.minutes=e.minutes<this.minMinutes?this.minMinutes:e.minutes},_setMinTimeFromDate:function(t){this.minHours=t.getHours(),this.minMinutes=t.getMinutes(),this.d.lastSelectedDate&&this.d.lastSelectedDate.getHours()>t.getHours()&&(this.minMinutes=this.opts.minMinutes)},_setMaxTimeFromDate:function(t){
this.maxHours=t.getHours(),this.maxMinutes=t.getMinutes(),this.d.lastSelectedDate&&this.d.lastSelectedDate.getHours()<t.getHours()&&(this.maxMinutes=this.opts.maxMinutes)},_setDefaultMinMaxTime:function(){var t=23,e=59,i=this.opts;this.minHours=i.minHours<0||i.minHours>t?0:i.minHours,this.minMinutes=i.minMinutes<0||i.minMinutes>e?0:i.minMinutes,this.maxHours=i.maxHours<0||i.maxHours>t?t:i.maxHours,this.maxMinutes=i.maxMinutes<0||i.maxMinutes>e?e:i.maxMinutes},_validateHoursMinutes:function(t){this.hours<this.minHours?this.hours=this.minHours:this.hours>this.maxHours&&(this.hours=this.maxHours),this.minutes<this.minMinutes?this.minutes=this.minMinutes:this.minutes>this.maxMinutes&&(this.minutes=this.maxMinutes)},_buildHTML:function(){var i=s.getLeadingZeroNum,a={hourMin:this.minHours,hourMax:i(this.maxHours),hourStep:this.opts.hoursStep,hourValue:this.hours,hourVisible:i(this.displayHours),minMin:this.minMinutes,minMax:i(this.maxMinutes),minStep:this.opts.minutesStep,minValue:i(this.minutes)},n=s.template(t,a);this.$timepicker=e(n).appendTo(this.d.$datepicker),this.$ranges=e('[type="range"]',this.$timepicker),this.$hours=e('[name="hours"]',this.$timepicker),this.$minutes=e('[name="minutes"]',this.$timepicker),this.$hoursText=e(".datepicker--time-current-hours",this.$timepicker),this.$minutesText=e(".datepicker--time-current-minutes",this.$timepicker),this.d.ampm&&(this.$ampm=e('<span class="datepicker--time-current-ampm">').appendTo(e(".datepicker--time-current",this.$timepicker)).html(this.dayPeriod),this.$timepicker.addClass("-am-pm-"))},_updateCurrentTime:function(){var t=s.getLeadingZeroNum(this.displayHours),e=s.getLeadingZeroNum(this.minutes);this.$hoursText.html(t),this.$minutesText.html(e),this.d.ampm&&this.$ampm.html(this.dayPeriod)},_updateRanges:function(){this.$hours.attr({min:this.minHours,max:this.maxHours}).val(this.hours),this.$minutes.attr({min:this.minMinutes,max:this.maxMinutes}).val(this.minutes)},_handleDate:function(t){this._setDefaultMinMaxTime(),t&&(s.isSame(t,this.d.opts.minDate)?this._setMinTimeFromDate(this.d.opts.minDate):s.isSame(t,this.d.opts.maxDate)&&this._setMaxTimeFromDate(this.d.opts.maxDate)),this._validateHoursMinutes(t)},update:function(){this._updateRanges(),this._updateCurrentTime()},_getValidHoursFromDate:function(t,e){var i=t,a=t;t instanceof Date&&(i=s.getParsedDate(t),a=i.hours);var n=e||this.d.ampm,h="am";if(n)switch(!0){case 0==a:a=12;break;case 12==a:h="pm";break;case a>11:a-=12,h="pm"}return{hours:a,dayPeriod:h}},set hours(t){this._hours=t;var e=this._getValidHoursFromDate(t);this.displayHours=e.hours,this.dayPeriod=e.dayPeriod},get hours(){return this._hours},_onChangeRange:function(t){var i=e(t.target),s=i.attr("name");this.d.timepickerIsActive=!0,this[s]=i.val(),this._updateCurrentTime(),this.d._trigger("timeChange",[this.hours,this.minutes]),this._handleDate(this.d.lastSelectedDate),this.update()},_onSelectDate:function(t,e){this._handleDate(e),this.update()},_onMouseEnterRange:function(t){var i=e(t.target).attr("name");e(".datepicker--time-current-"+i,this.$timepicker).addClass("-focus-")},_onMouseOutRange:function(t){var i=e(t.target).attr("name");this.d.inFocus||e(".datepicker--time-current-"+i,this.$timepicker).removeClass("-focus-")},_onMouseUpRange:function(t){this.d.timepickerIsActive=!1}}}()}(window,jQuery);
//кнопка открытия карточки клиента
$(document).on('click', '[js-client-card]', function(event){

    var clientId = $(this).find('[js-client-id]').val();

    $('[js-client-card]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/clients/getClientInfo",
        data: JSON.stringify(clientId),
        dataType: 'json',
        cache: false,
        success: function (data) {
            setClientCardInfo(data);
            $('[js-client-card]').prop("disabled", false);
        },
        error : function (data) {
            $('[js-client-card]').prop("disabled", false);
        }
    });
});


var $CLIENT;
//заполение информации о клиенте в карточке клиента
function setClientCardInfo(data) {
    $('[js-client-card-name]').val(data.name);
    $('[js-client-card-date]').text(data.createDate);
    $('[js-client-card-manager]').text(data.manager);
    $('[js-client-card-link]').val(data.link);
    $('[js-client-card-phone]').val(data.phone);
    $('[js-client-card-email]').val(data.email);
    $('[js-client-card-comment]').val(data.comment);
    $('[js-client-card-id]').val(data.id);

    $('[js-client-name-copy]').text(data.name);
    $('[js-client-name-copy]').attr('data-link', data.name);

    var registerInfoBtn = $('[js-register-info-btn]');
    var registerInfo = $('[js-register-info]');
    var registerInfoContainer = $('[js-register-info-container]');
    var copyRegisterInfo = $('[js-copy-register-info]');
    registerInfoBtn.unbind('click');
    copyRegisterInfo.unbind('click');
    if (data.idUser != 0){
        registerInfoBtn.addClass('hide');
        registerInfo.removeClass('hide')
        $('[js-client-url]').html(window.location.origin + '/login');
        $('[js-client-login]').html(data.userLogin);
        $('[js-client-password]').html(data.userPassword);
    }else{
        registerInfoBtn.removeClass('hide');
        registerInfoBtn.click(function () {
            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: "/api/clients/createUser",
                data: JSON.stringify(data.id),
                dataType: 'json',
                cache: false,
                success: function (userData) {
                    registerInfoBtn.addClass('hide');
                    registerInfo.removeClass('hide');
                    $('[js-client-login]').html(userData.username);
                    $('[js-client-password]').html(userData.password);
                },
                error : function (userData) {

                }
            });
        });
        registerInfo.addClass('hide');
    }
    // событие нажатия кнопки сгенерировать

    copyRegisterInfo.click(function () {
        var childs = Array.from(registerInfoContainer.children());
        var copiedText = '';
        childs.forEach(function (value, index, array) {
            var elem = $(value);
            if (elem.hasClass('client-card__register-info-label') ||
                elem.hasClass('client-card__register-info-value')){
                copiedText += elem.text().trim() + '\n';
            }
        });
        var $tmp = $("<textarea>");
        $("body").append($tmp);
        $tmp.val(copiedText).select();
        document.execCommand("copy");
        $tmp.remove();
    });

    setIdClient(data.id);
    //обновление карточек сделок
    updateDealCard($CLIENT);

    $('[js-menu-client-card]').addClass('is-open');
    checkBodyHidden()
}

function setIdClient(id) {
    $('[js-deal-form-client]').val(id);
    $CLIENT = id;
}

//обновление цены/получено по сделке на фронте
function updateDealPriceOnList(value) {
    var dealRow = $('[data-deal="' + value.id + '"]');

    var colPaid = dealRow.find('.column-paid');
    colPaid.removeClassWild('column-paid_*');
    if (value.price <= value.paid) {
        colPaid.addClass('column-paid_green');
    }

    dealRow.find('[data-deal-price]').html(value.price);
    dealRow.find('[data-deal-paid]').html(value.paid + ' ₽');
}

$(document).on('change paste keyup', '[js-menu-search-input]', function(event) {
    $('[js-create-client]').attr('disabled', 'disabled');
});

$(document).on('change paste keyup', '[check-required]', function(event) {
    var requiredType = $(this).attr('check-required'),
        inputs = $('[check-required="' + requiredType + '"]'),
        isRequired = true;

    $.each(inputs, function(index, input) {
        if ($.trim(input.value) !== '') {
            isRequired = false
        }
    })

    if (isRequired) {
        $('[check-required="' + requiredType + '"]').attr('required', 'required');
    } else {
        $('[check-required="' + requiredType + '"]').removeAttr('required');
    }
});

var OLD_SELECTOR_VALUE = 0;
$(document).on('focusin', '[check-target-status]', function(event) {
    OLD_SELECTOR_VALUE = $('option:selected', this).val();
});

$(document).on('change', '[check-target-status]', function(event) {
    if ($('option:selected', this).val() == 1) {
        $(this).closest('form').find('[not-target]').removeClass('is-open').addClass('menu-input_close');
    } else if (OLD_SELECTOR_VALUE == 1) {
        $(this).closest('form').find('[not-target]').removeClass('menu-input_close').addClass('is-open');
        checkUpdateDealProductTypes();
    }
});

$(document).on('change', '[check-social]', function(event) {
    if ($('option:selected', this).val() == 2) {
        $(this).closest('form').find('[whatsap-required]').find('.menu-input__title').html('ID рекламной кампании / Смайлик + база *');
        $(this).closest('form').find('[whatsap-required]').find('input').attr('required', 'required');
    } else {
        $(this).closest('form').find('[whatsap-required]').find('.menu-input__title').html('ID рекламной кампании / Смайлик + база');
        $(this).closest('form').find('[whatsap-required]').find('input').removeAttr('required');
    }
});


function resetSearchClientMenu() {
    $('[js-menu-search-input]').val('');
    $('[js-create-client]').attr('disabled', 'disabled');
}

//кнопка открытия создания клиента
$(document).on('click', '[js-create-client]', function(event) {
    $('[js-create-client-form]').trigger('reset');

    var searchValue = $('[js-menu-search-input]').val();

    var emailPattern = /^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i;
    var phonePattern = /[^\d]/g;
    var vkPattern = "vk.com";

    if (emailPattern.test(searchValue)) {
        $('[js-create-client-email]').val(searchValue).trigger('change');
    } else if (searchValue.replace(phonePattern, '').length === 11) {
        $('[js-create-client-phone]').val(searchValue).trigger('change');
    } else if (searchValue.includes(vkPattern)) {
        $('[js-create-client-link]').val(searchValue).trigger('change');
    } else {
        $('[js-create-client-name]').val(searchValue);
    }

    $('[check-required="client-info"]').trigger('change');

    $('[js-menu-create-client]').addClass('is-open');
    checkBodyHidden();
});


function resetCreateDealForm() {
    $('[js-deal-form-kind-block]').removeClass('is-open');
    $('[js-deal-form-kind]').html('');
    $('[js-deal-form-mailing-block]').removeClass('is-open');
    $('[js-deal-form-mailing]').prop("checked", false);
    $('[js-deal-form-trial]').prop("checked", false);
    $('[product-block]').addClass('menu-input_close');
    $('[trial-block]').addClass('menu-input_close');
    $('[product-category-block]').addClass('menu-input_close');
    $('[js-deal-form-reminder-block]').removeClass('is-open');
    $('[js-deal-form-reminder-btn]').addClass('is-open');
    $('[js-deal-form-reminder]').prop("checked", false);
    $('[js-deal-form]').trigger('reset');

    $('[check-target-status]').val("1").trigger('change');

    checkCreateDealProductTypes();
}

function checkCreateDealProductTypes() {
    if ($('[product-types] option').length <= 2) {
        $('[product-types-block]').removeClass('is-open');

        var optionVal = $('[product-types] option:last').val();
        $('[product-types]').val(optionVal).trigger('change');
    } else {
        $('[product-types-block]').addClass('is-open');
    }
}


function setUpdateDealInfo(data) {
    $('#js-update-form-deal-status option:selected').removeAttr('selected');
    $('#js-update-form-deal-social option:selected').removeAttr('selected');
    $('#js-update-form-deal-pr option:selected').removeAttr('selected');
    $('#js-update-form-deal-pr option:first').prop('selected', true);
    $('#js-update-form-deal-sale-type option:selected').removeAttr('selected');
    $('#js-update-form-deal-sale-type option:first').prop('selected', true);
    $('#u-product-types option:selected').removeAttr('selected');
    $('#u-product-types option:first').prop('selected', true);
    $('#u-product-category option:selected').removeAttr('selected');
    $('#u-product-category option:first').prop('selected', true);

    $('[u-product-category-block]').addClass('menu-input_close');
    $('[u-product-block]').addClass('menu-input_close');
    $('[u-trial-block]').addClass('menu-input_close');
    $('[u-start-date-block]').addClass('menu-input_close');

    $('[js-update-form-kind-block]').removeClass('is-open');
    $('[js-update-form-kind]').html('');
    $('[js-update-form-deal-mailing]').prop("checked", false);
    $('[js-update-form-deal-reminder]').prop("checked", false);
    $('[js-update-form-deal-price]').val(0);

    $("#js-update-form-deal-status").val(data.status).trigger('change');
    $("#js-update-form-deal-social").val(data.social).trigger('change');
    $('[js-update-form-deal-deal-date]').val(data.dealDate);
    $('[js-update-form-deal-tag]').val(data.tag);
    $('[js-update-form-deal-comment]').val(data.comment);

    $('[js-update-form-deal-client]').val(data.idClient);
    $('[js-update-form-deal-manager]').val(data.idManager);
    $('[js-update-form-deal-id]').val(data.id);

    $("#js-update-form-deal-sale-type").val(data.type);

    if (data.type === 'traffic') {
        $('[js-update-form-deal-mailing-block]').addClass('is-open');
        if (data.isMailing) {
            $('[js-update-form-deal-mailing]').prop("checked", true);
        } else {
            $('[js-update-form-deal-mailing]').prop("checked", false);
        }
    } else {
        $('[js-update-form-deal-mailing-block]').removeClass('is-open');
        $('[js-update-form-deal-mailing]').prop('checked', false);
    }

    if (data.reminder) {
        $('[js-update-form-deal-reminder-block]').addClass('is-open');
        $('[js-update-form-deal-reminder-btn]').removeClass('is-open');
        $('[js-update-form-deal-reminder]').prop("checked", true);
        $('[js-update-form-deal-reminder-date]').val(data.reminderDate);
        $('[js-update-form-deal-reminder-msg]').val(data.reminderMessage);
    } else {
        $('[js-update-form-deal-reminder-block]').removeClass('is-open');
        $('[js-update-form-deal-reminder-btn]').addClass('is-open');
        $('[js-update-form-deal-reminder]').prop("checked", false);
        $('[js-update-form-deal-reminder-date]').val('');
        $('[js-update-form-deal-reminder-msg]').val('');
    }


    if (data.status !== 1) {

        if (data.idSaleType == 3) {
            createProductOptions($productMap[data.idProductCategory], 'js-update-form-deal-pr');
            $('[u-product-category-block]').removeClass('menu-input_close');
            $("#u-product-category").val(data.idProductCategory);
            $('[u-trial-block]').addClass('menu-input_close');
        } else {
            createProductOptions($coursesList, 'js-update-form-deal-pr');
            $('[u-start-date-block]').removeClass('menu-input_close');
            $('[js-update-form-deal-start-date]').html('<option value="' + data.idStream + '">' + data.startDate + '</option>');
            setUpdateStreams(data.idProduct);
            $('[u-trial-block]').removeClass('menu-input_close');
        }

        if ($('#u-product-types option').length > 2) {
            $('[u-product-types-block]').addClass('is-open');
        } else {
            $('[u-product-types-block]').removeClass('is-open');
        }
        $('#u-product-types [data-id="' + data.idSaleType +'"]').prop('selected', true);
        $('#js-update-form-deal-pr [data-id="' + data.idProduct +'"]').prop('selected', true);

        $('[u-product-block]').removeClass('menu-input_close');

        var list = createKindList(data.course);
        if (list.length > 0) {
            $('[js-update-form-kind]').html(createKindOptions(list));
            $('[js-update-form-kind]').val(data.kind);
            $('[js-update-form-kind-block]').addClass('is-open');
        }

        $('[js-update-form-deal-trial]').prop('checked', data.trial);
        $('[js-update-form-deal-price]').val(data.price);
        $('[js-deal-open-lessons]').prop('checked', data.allModulesHomeworkAllowed);

        $('[js-update-form-deal-product-type]').val(data.product);
        $('[js-update-form-deal-product-id]').val(data.idProduct);
    }

    $('[js-menu-update-deal]').addClass('is-open');

    checkBodyHidden();
}

function checkUpdateDealProductTypes() {
    if ($('#u-product-types option').length <= 2) {
        $('[u-product-types-block]').removeClass('is-open');

        var optionVal = $('#u-product-types option:last').val();
        $('#u-product-types').val(optionVal).trigger('change');
    } else {
        $('[u-product-types-block]').addClass('is-open');
    }
}

$(document).on('click', '.datepicker-here', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).on('click', '.datepicker-here-deal', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).on('click', '.datepicker-here-cs', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).on('click', '.datepicker-here-pay', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});

//список способов оплаты
var $paymentMethodList;
function setPaymentMethodList(paymentMethodList) {
    $paymentMethodList = paymentMethodList;
}
//список статусов
var $statusesList;
function setStatusesList(statusesList) {
    $statusesList = statusesList;
}


//изменение чекера напоминания при редактировании сделки
$(document).on('click', '[js-update-open-reminder]', function(event) {
    $('[js-update-form-deal-reminder-btn]').removeClass('is-open');
    $('[js-update-form-deal-reminder-block]').addClass('is-open');
    $('[js-update-form-deal-reminder-date]').val('');
    $('[js-update-form-deal-reminder-msg]').val('');
    $('[js-update-form-deal-reminder]').prop("checked", true);
});
//изменение чекера напоминания при редактировании сделки закрытие
$(document).on('click', '[js-update-close-reminder]', function(event) {
    $('[js-update-form-deal-reminder-btn]').addClass('is-open');
    $('[js-update-form-deal-reminder-block]').removeClass('is-open');
    $('[js-update-form-deal-reminder-date]').val('—');
    $('[js-update-form-deal-reminder-msg]').val('');
    $('[js-update-form-deal-reminder]').prop("checked", false);
});
//в меню редактирования
$(document).on('change', '[js-update-form-deal-sale-type]', function(event) {
    if ($(this).val() === 'traffic') {
        $('[js-update-form-deal-mailing-block]').addClass('is-open');
    } else {
        $('[js-update-form-deal-mailing-block]').removeClass('is-open');
        $('[js-update-form-deal-mailing]').prop('checked', false);
    }
});
//в меню редактирования
$(document).on('change', '[js-update-form-deal-pr]', function(event) {
    $('[js-update-form-deal-price]').val($('option:selected', this).attr('data-price'));
    $('[js-update-form-deal-product-type]').val($('option:selected', this).attr('data-type'));

    $('[js-update-form-deal-product-id]').val($('option:selected', this).attr('data-id'));

    $list = createKindList($('option:selected', this).val());
    if ($list.length > 0) {
        $('[js-update-form-kind]').html(createKindOptions($list));
        $('[js-update-form-kind-block]').addClass('is-open');
    } else {
        $('[js-update-form-kind-block]').removeClass('is-open');
        $('[js-update-form-kind]').html('');
    }

    if ($('[u-product-types]').val() == 'курс' ) {
        setStreams($('[js-update-form-deal-start-date]'), $('option:selected', this).attr('data-id'));
    }
});

//в меню создания
$(document).on('change', '[js-deal-form-sale-type]', function(event) {
    if ($(this).val() === 'traffic') {
        $('[js-deal-form-mailing-block]').addClass('is-open');
        checkBodyHidden()
    } else {
        $('[js-deal-form-mailing-block]').removeClass('is-open');
        $('[js-deal-form-mailing]').prop('checked', false);
        checkBodyHidden()
    }
});
//в меню создания
$(document).on('change', '[js-deal-form-product]', function(event) {
    $('[js-deal-form-price]').val($('option:selected', this).attr('data-price'));
    $('[js-deal-form-product-type]').val($('option:selected', this).attr('data-type'));
    $('[js-deal-form-product-id]').val($('option:selected', this).attr('data-id'));

    $list = createKindList($('option:selected', this).val());
    if ($list.length > 0) {
        $('[js-deal-form-kind]').html(createKindOptions($list));
        $('[js-deal-form-kind-block]').addClass('is-open');
    } else {
        $('[js-deal-form-kind-block]').removeClass('is-open');
        $('[js-deal-form-kind]').html('');
    }

    if ($('[product-types]').val() == 'курс' ) {
        setStreams($('[js-deal-form-start-date]'), $('option:selected', this).attr('data-id'));
    }
});

function setStreams(selector, idCourse){
    var formData = new FormData();
    formData.set('idCourse', Number(idCourse));

    $.ajax({
        type: "POST",
        url: "/transactions/getStreamsByIdCourse",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var seloption = '<option value="" disabled selected>Выберите дату старта</option>';
            $.each(data, function(index, stream){
                seloption += '<option value="' + stream.id + '">' + stream.startDate + '</option>';
            });

            selector.html(seloption);
        },
        error: function (data) {
        }
    });
}


$(document).ready(function() {
    $('.datepicker-here-deal').datepicker({
        autoClose: true,
        maxDate: new Date(),
        todayButton: true
    });

    $('.datepicker-here').datepicker({
        autoClose: true,
        todayButton: true
    });

    const $menuClientCard = $('[js-menu-client-card]');
    const $menuClientCardCloseBtn = $('[js-menu-client-card-close-btn]');
    //закрытие карточки клиента
    $menuClientCardCloseBtn.on('click', function () {
        // $menuSearch.removeClass('is-open');
        $menuCreateClient.removeClass('is-open');
        $menuClientCard.removeClass('is-open');
        closeEdit();
        checkBodyHidden();
    });



    const $menuUpdateDeal = $('[js-menu-update-deal]');
    const $menuUpdateDealCloseBtn = $('[js-menu-update-deal-close-btn]');
    //закрытие редактирование сделки
    $menuUpdateDealCloseBtn.on('click', function() {
        $menuUpdateDeal.removeClass('is-open');
        checkBodyHidden()
    });


    const $menuBillsCloseBtn = $('[js-menu-bills-close-btn]');
    const $menuBills = $('[js-menu-bills]');
    //закрытие меню счетов
    $menuBillsCloseBtn.on('click', function() {
        $menuBills.removeClass('is-open');
        checkBodyHidden();
        BILLS_TEMP_INFO = {};
    });

    const $menuSearchCloseBtn = $('[js-menu-search-close-btn]');
    const $menuSearch = $('[js-menu-search]');

    $menuSearchCloseBtn.on('click', function() {
        $menuSearch.removeClass('is-open');
        checkBodyHidden()
    });

    const $menuUpdateReminderCloseBtn = $('[js-menu-update-reminder-close-btn]');
    const $menuUpdateReminder = $('[js-menu-update-reminder]');

    $menuUpdateReminderCloseBtn.on('click', function() {
        clearReminderForm();
        $menuUpdateReminder.removeClass('is-open');
        checkBodyHidden();
    });


    const $menuCreateClientCloseBtn = $('[js-menu-create-client-close-btn]');
    const $menuCreateClient = $('[js-menu-create-client]');

    $menuCreateClientCloseBtn.on('click', function() {
        $('js-create-client-form').submit('reset');
        $menuCreateClient.removeClass('is-open');
        checkBodyHidden()
    });

    const $menuCreateDealCloseBtn = $('[js-menu-create-deal-close-btn]');
    const $menuCreateDeal = $('[js-menu-create-deal]');

    $menuCreateDealCloseBtn.on('click', function() {
        $menuCreateDeal.removeClass('is-open');
        checkBodyHidden();
    });

    const $menuBillCloseBtn = $('[js-menu-bill-close-btn]');
    const $menuBill = $('[js-menu-bill]');

    $menuBillCloseBtn.on('click', function() {
        $menuBill.removeClass('is-open');
        $('[js-bill-form]').submit('reset');
        checkBodyHidden()
    });

    initDatePickerPayDate();
});

$(document).on('submit', '[js-bill-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        saveBill($(this).serializeObject());
    }
});
function saveBill(billDate) {
    $('[js-save-bill]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/bills/saveBill",
        data: JSON.stringify(billDate),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard($CLIENT);
            $('[js-menu-bill]').removeClass('is-open');
            checkBodyHidden()
            $('[js-bill-form]').trigger('reset');

            $('[js-save-bill]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-bill]').prop("disabled", false);
        }
    });
}

$(document).on('click', '[js-save-bills]', function(event) {
    event.preventDefault();
    $('[js-bills-form]').trigger('submit');
});

$(document).on('submit', '[js-bills-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var billData = $(this).serializeObject();
        saveBillWithUpdate(billData);
    }
});
function saveBillWithUpdate(billData) {
    $('[js-save-bills]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/bills/saveBill",
        data: JSON.stringify(billData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard($CLIENT);
            billData['id'] = billData.idDeal;
            openBills(billData);
            $('[js-bills-form]').trigger('reset');

            $('[js-save-bills]').prop("disabled", false);
            BILLS_TEMP_INFO = {};
        },
        error: function (data) {
            $('[js-save-bills]').prop("disabled", false);
        }
    });
}

$(document).on('click', '[js-create-deal]', function(event) {
    resetCreateDealForm();

    $('[js-menu-create-deal]').addClass('is-open');
    checkBodyHidden()
});

$(document).on('click', '[close-dialog]', function(event) {
    removeAcceptBtnAttribute($(this).siblings('[accept-dialog]'));
    $(this).closest('.dialog').removeClass('is-open');
});

$(document).on('change', '[js-form-status]', function(event) {
    var form = $(this).parent($('[js-status-form]'));
    form.removeClassWild("deal-status__form_*");
    form.addClass("deal-status__form_" + ($('option:selected', this).attr('data-code')));

    var data = form.serializeObject();

    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/updateDealStatus",
        data: JSON.stringify(data),
        dataType: 'json',
        cache: false,
        success: function (data) {
        },
        error: function (data) {
        }
    });

});

$(document).on('change', '[js-deal-form-status]', function(event){
    var form = $(this).parent($('[js-deal-status-form]'));
    form.removeClassWild("deal__select_*");
    var code = $('option:selected', this).attr('data-code');
    form.addClass("deal__select_" + code);

    var formData = form.serializeObject();
    formData['code'] = code;

    $('[js-deal-form-status]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/updateDealStatus",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealStatusOnList(formData);
            $('[js-deal-form-status]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-deal-form-status]').prop("disabled", false);
        }
    });
});

//обновление статуса сделки на фронте
function updateDealStatusOnList(value) {
    var dealRow = $('[data-deal="' + value.id + '"]');
    var select = dealRow.find('[js-form-status]');
    var form = select.parent($('form'));
    form.removeClassWild("deal-status__form_*").addClass("deal-status__form_" + value.code);
    $(select).find('option:selected').removeAttr('selected');
    $(select).val(value.status);
}

//кнопка открытия поиска клиента
$(document).on('click', '[js-search-client]', function(event) {
    resetSearchClientMenu();

    $('[js-menu-search]').addClass('is-open');
    checkBodyHidden();
});


//кнопка создания клиента
$(document).on('click', '[js-create-client-btn]', function(event) {
    event.preventDefault();
    $('[js-menu-search]').removeClass('is-open');
    $('[js-create-client-form]').trigger('submit');
});

$(document).on('submit', '[js-create-client-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        createClientCard();
    }
});
var CLIENT_DATA;
function createClientCard() {
    var cardInfo = {}
    cardInfo["name"] = $('[js-create-client-name]').val();
    cardInfo["createDate"] = $('[js-create-client-date]').val();
    cardInfo["idManager"] = $('[js-create-client-manager]').val();
    cardInfo["link"] = $('[js-create-client-link]').val();
    cardInfo["phone"] = $('[js-create-client-phone]').val();
    cardInfo["email"] = $('[js-create-client-email]').val();
    // cardInfo["comment"] = $('[js-create-client-comment]').val();

    $('[js-create-client-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/clients/saveClientInfo",
        data: JSON.stringify(cardInfo),
        dataType: 'json',
        cache: false,
        success: function (data) {
            setClientCardInfo(data);
            // $('[js-create-client-form]').trigger('reset');
            $('[js-create-client-btn]').prop("disabled", false);
        },
        error: function (data) {
            CLIENT_DATA = data;
            $('[dialog]').find('.dialog__title').html('Хотите использовать его?');
            $('[dialog]').find('.dialog__text').html('В базе данных найден клиент с такими же данными');
            $('[dialog]').find('[accept-dialog]').attr('use-client', '');
            $('[dialog]').addClass('is-open');

            $('[js-create-client-btn]').prop("disabled", false);
        }
    });
}
$(document).on('click', '[use-client]', function(event) {
    event.preventDefault();
    $('[dialog]').removeClass('is-open');
    removeAcceptBtnAttribute($(this));

    $('[js-client-card-name]').val(CLIENT_DATA.responseJSON.name);
    $('[js-client-card-date]').text(CLIENT_DATA.responseJSON.createDate);
    $('[js-client-card-manager]').text(CLIENT_DATA.responseJSON.manager);
    $('[js-client-card-link]').val(CLIENT_DATA.responseJSON.link);
    $('[js-client-card-phone]').val(CLIENT_DATA.responseJSON.phone);
    $('[js-client-card-email]').val(CLIENT_DATA.responseJSON.email);
    $('[js-client-card-comment]').val(CLIENT_DATA.responseJSON.comment);
    $('[js-client-card-id]').val(CLIENT_DATA.responseJSON.id);

    $('[js-client-name-copy]').text(CLIENT_DATA.responseJSON.name);
    $('[js-client-name-copy]').attr('data-link', CLIENT_DATA.responseJSON.name);

    setIdClient(CLIENT_DATA.responseJSON.id);
    updateDealCard($CLIENT);
    $('[js-menu-client-card]').addClass('is-open');
    checkBodyHidden();
    $('[js-create-client-form]').trigger('reset');
});

//форма поиска клиента
$(document).on('submit', '[js-menu-search-form]', function(event) {
    event.preventDefault();
    var searchValue = $('[js-menu-search-input]').val();

    if ($.trim(searchValue) !== '') {
        var search = {}
        search["search"] = searchValue;
        $('[js-menu-search-input]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/api/clients/searchClients",
            data: JSON.stringify(search),
            dataType: 'json',
            cache: false,
            success: function (data) {
                $('[js-client-card-list]').html('');

                if (data.length === 0) {
                    $('[js-create-client]').prop('disabled', false);
                } else {
                    $('[js-create-client]').prop('disabled', true);

                    $.each(data, function(index, value) {
                        var response = $("<div/>").attr("js-client-card", "").attr("class", "client-card")
                            .append($("<input/>").attr("type", "hidden").attr("class", "js-client-id-l").attr("js-client-id", "").val(value.id))
                            .append($("<div/>").attr("class", "client-card__title").html(value.name))
                            .append($("<div/>").attr("class", "client-card__info")
                                .append($("<div/>").attr("class", "client-card__info-link").html(value.link))
                                .append($("<div/>").attr("class", "client-card__info-phone").html(value.phone)));
                        $('[js-client-card-list]').append(response);
                    });
                }

                $('[js-menu-search-input]').prop("disabled", false);
            },
            error: function (data) {
                $('[js-menu-search-input]').prop("disabled", false);
            }
        });
    }
});
//
// //кнопка открытия карточки клиента
// $(document).on('click', '[js-client-card]', function(event){
//     var clientId = $(this).find('[js-client-id]').val();
//
//     $('[js-client-card]').prop("disabled", true);
//     $.ajax({
//         type: "POST",
//         contentType: "application/json",
//         url: "/api/clients/getClientInfo",
//         data: JSON.stringify(clientId),
//         dataType: 'json',
//         cache: false,
//         success: function (data) {
//             setClientCardInfo(data);
//             $('[js-client-card]').prop("disabled", false);
//         },
//         error : function (data) {
//             $('[js-client-card]').prop("disabled", false);
//         }
//     });
// });
//
// var $CLIENT;
// //заполение информации о клиенте в карточке клиента
// function setClientCardInfo(data) {
//     $('[js-client-card-name]').val(data.name);
//     $('[js-client-card-date]').text(data.createDate);
//     $('[js-client-card-manager]').text(data.manager);
//     $('[js-client-card-link]').val(data.link);
//     $('[js-client-card-phone]').val(data.phone);
//     $('[js-client-card-email]').val(data.email);
//     $('[js-client-card-comment]').val(data.comment);
//     $('[js-client-card-id]').val(data.id);
//
//     $('[js-client-name-copy]').text(data.name);
//     $('[js-client-name-copy]').attr('data-link', data.name);
//
//     setIdClient(data.id);
//     //обновление карточек сделок
//     updateDealCard($CLIENT);
//
//     $('[js-menu-client-card]').addClass('is-open');
//     checkBodyHidden()
// }
//
// function setIdClient(id) {
//     $('[js-deal-form-client]').val(id);
//     $CLIENT = id;
// }

//обновление карточек сделок
function updateDealCard(idClient) {
    if (typeof idClient !== "undefined") {
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/api/deals/getManagerDeals",
            data: JSON.stringify(idClient),
            dataType: 'json',
            cache: false,
            success: function (data) {
                var $dealList = $('[js-deals-list]');
                $dealList.html('');
                $.each(data, function(index, value) {
                    // установка значения в списке
                    updateDealPriceOnList(value);

                    // установка значения в в меню
                    var seloption = "";
                    $.each($statusesList, function(index, value2){
                        seloption += '<option js-deal-form-status value="'+ value2.id +'" data-code="'+
                            value2.code + '" ' + (value2.id === value.status ? 'selected="selected" ': '') +'">' + value2.title + '</option>';
                    });

                    var reminder = "";
                    if (value.reminder) {
                        reminder += '<div class="menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-violet">' +
                            '<div class="deal__comment" title="' + value.reminderMessage + '">' + value.reminderMessage + '</div></div>';
                    } else {
                        reminder += '<div class="menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-empty">' +
                            '<div class="deal__comment">Нет напоминаний</div></div>';
                    }

                    var response = $("<div/>").attr("class", "deal deal_told deal_white")
                        .append($("<div/>").attr("class", "deal-wrapper")
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_bordered deal__wrapper_column")
                                .append($("<div/>").attr("class", "deal__title").html(value.status === 1 ? 'Целевая заявка' : value.course))
                                .append($("<div/>").attr("class", "deal__subtitle")
                                    .append($("<div/>").attr("class", value.kind !== null ? "deal__kind deal__kind_del" : "deal__kind").html(value.kind))
                                    .append($("<div/>").attr("class", "deal__date").html(value.createDate)))
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_overflow deal__wrapper_bordered c-tooltip").attr('js-deal-id', value.id)
                                .append($("<div/>").attr("class", "c-tooltip__wrapper")
                                    .append($("<div/>").attr("class", "c-tooltip__text").html(value.managerAccessName)))
                                .append($("<div/>").attr("class", "deal__social")
                                    .append($("<div/>").attr("class", "deal-social deal-social_" + value.socialCode)))
                                .append($("<div/>").attr("class", "deal__manager").html(value.managerName))
                                .append($("<div/>").attr("class", "deal__sale-type").html(value.type))
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_between deal__wrapper_bordered ")
                                .append($("<div/>").attr("class", "deal__sum")
                                    .append($("<div/>").attr("class", "deal__sum-title").html("Стоимость"))
                                    .append($("<div/>").attr("class", "deal__sum-value").html(value.price))
                                )
                                .append($("<div/>").attr("class", "deal__sum")
                                    .append($("<div/>").attr("class", "deal__sum-title").html("Получено"))
                                    .append($("<div/>").attr("class", "deal__sum-value deal__sum-value_blue").html(value.paid))
                                )
                                .append((value.isEditable && value.status !== 1) ?
                                    $("<div/>").attr("class", "deal_bill")
                                    .append($("<form/>").attr("js-add-bill-form", "").attr("action", "#").attr("class", value.isHidden ? "hidden-deal" : "")
                                        .append($("<input/>").attr("type", "hidden").attr("name", "id").val(value.id))
                                        .append($("<button/>").attr("js-add-bill-button", "").attr("class", "add-btn"))
                                    ) : ''
                                )
                            )
                            .append((value.isEditable && value.status !== 1) ?
                                $("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                                .append($("<form/>").attr("js-deal-status-form","").attr("class", "deal__select deal__select_" + value.statusCode)
                                    .append($("<input/>").attr("name", "id").attr("type", "hidden").val(value.id))
                                    .append($("<select/>").attr("class","deal-select menu-input__input_select").attr("name","status").attr("js-deal-form-status","").html(seloption))
                                ) :
                                $("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                                    .append($("<div/>").attr("class", "deal__select deal__select_" + value.statusCode)
                                        .append($("<div/>").attr("class","deal-select menu-input__input_select").html(value.statusName))
                                    )
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                                .append($("<div/>").attr("class", "deal__reminder")
                                    .append($("<div/>").attr("class", (value.reminder) ?
                                        (value.reminderExpiration) ? "deal__reminder-title deal-reminder deal-reminder_red " :
                                            (value.reminderToday) ? "deal__reminder-title deal-reminder deal-reminder_green " : "deal__reminder-title deal-reminder deal-reminder_gray " : "deal__reminder-title deal__reminder-title_left")
                                        .html((value.reminder) ? value.reminderDate : "Нет напоминания"))
                                    .append((value.isEditable && value.status !== 1) ?
                                        $("<div/>").attr("class", "add-reminder")
                                            .append($("<form/>").attr("js-add-reminder-form", "").attr("action", "#")
                                                .append($("<input/>").attr("type", "hidden").attr("name", "idDeal").val(value.id))
                                                .append($("<button/>").attr("js-add-reminder-button", "").attr("class", "add-btn"))
                                            ) : ''
                                    )
                                )
                            )
                            .append( (value.isEditable) ?
                                $("<div/>").attr("class", "deal__wrapper deal__wrapper_column")
                                .append($("<form/>").attr("class", "button_full").attr("action", "#").attr("js-update-deal-form", "")
                                    .append($("<input/>").attr("name", "id").attr("type", "hidden").val(value.id))
                                    .append($("<button/>").attr("type", "button").attr("class", "button button_white button_full").attr("js-update-deal-btn", "").html("Редактировать сделку"))
                                )

                                .append(
                                    (value.isHidden)
                                        ?
                                        $("<form/>").attr("class", "button_full").attr("action", "#").attr("js-reveal-deal-form", "")
                                            .append($("<input/>").attr("data-hide-deal", value.id).attr("name", "id").attr("type", "hidden").val(value.id))
                                            .append(
                                                $("<button/>").attr("type", "button").attr("class", "button button_red button_full").attr("js-reveal-deal-btn", "")
                                                    .append($("<span/>").attr("class", "hidden-btn hidden-btn_left hidden-btn_reveal").html("Восстановить сделку"))
                                            )
                                        :
                                        $("<form/>").attr("class", "button_full").attr("action", "#").attr("js-hide-deal-form", "")
                                            .append($("<input/>").attr("data-hide-deal", value.id).attr("name", "id").attr("type", "hidden").val(value.id))
                                            .append($("<button/>").attr("type", "button").attr("class", "button button_red button_full").attr("js-hide-deal-btn", "")
                                                .append($("<span/>").attr("class", "hidden-btn hidden-btn_left hidden-btn_hide").html("Скрыть сделку")))
                                ) :
                                $("<div/>").attr("class", "deal__wrapper deal__wrapper_column")
                                    .append($("<form/>").attr("class", "button_full").attr("action", "#").attr("js-view-deal-form", "")
                                        .append($("<input/>").attr("name", "id").attr("type", "hidden").val(value.id))
                                        .append($("<button/>").attr("type", "button").attr("class", "button button_white button_full").attr("js-view-deal-btn", "").html("Посмотреть сделку"))
                                    )
                            )
                        );
                    $dealList.append(response);
                    loadModules(idClient, value.id);
                });

                var $createDealBlock = $("<div/>").attr("js-create-deal", "").attr("class", "deal deal_told deal_create")
                    .append($("<div/>").attr("class", "deal__btm-message").html('Добавить сделку'));

                $dealList.append($createDealBlock);
            }
        });

    }
}
function loadModules(idClient, idDeal){
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/getDealsModulesInfo",
        data: JSON.stringify(idDeal),
        dataType: 'json',
        cache: false,
        success: function (data) {
            if (data.modules.length > 0){
                $modulesRoot = $("<div/>").attr("class", "deal__access-lessons ");
                $lessons = $("<div/>").attr("class", "deal__lessons");
                $.each(data.modules, function(index, value) {
                    $lessons.append($("<div/>").attr('js-module', value.idModule).attr('js-module-deal', idDeal).attr('js-module-client', idClient).attr('js-allowed', data.allowed).attr("class", "deal__lessons-item " + (value.enabled ? 'deal__lessons-item_active' : '')).html(value.number));
                });
                $access = $("<div/>").attr("class", "deal__access")
                    .append($("<div/>").attr("class", "deal__access-text")).html('Доступ к продукту')
                    .append($("<div/>").attr("class", "deal__access-btn slide-toggle " + (data.allowed ? 'slide-toggle_active' : '')).attr("js-id-deal-toggle", idDeal)
                        .append($("<div/>").attr("class", "slide-toggle__thumb")));
                $modulesRoot.append($access);
                $modulesRoot.append($lessons);

                $modulesRoot.insertAfter($('[js-deal-id='+idDeal+']'));
                $(".slide-toggle[js-id-deal-toggle="+idDeal+"]").click(function (event) {
                    var toggle = $(this);
                    var idDeal = toggle.attr('js-id-deal-toggle');
                    var allowed = toggle.hasClass('slide-toggle_active');
                    if (allowed){
                        toggle.removeClass('slide-toggle_active');
                    }else{
                        toggle.addClass('slide-toggle_active');
                        $('.deal__lessons-item[js-module-deal='+idDeal+']').toggleClass('deal__lessons-item_active', true)
                    }
                    changeAllowed(idDeal, idClient, !allowed);
                });
                $('.deal__lessons-item[js-module-deal='+idDeal+']').click(function (event){
                    var $this = $(this);
                    var idModule = $this.attr('js-module');
                    var idDeal = $this.attr('js-module-deal');
                    var allowed = $(".slide-toggle[js-id-deal-toggle="+idDeal+"]").hasClass('slide-toggle_active');
                    var idClient = $this.attr('js-module-client');
                    var enabled = $this.hasClass('deal__lessons-item_active');
                    if (allowed){
                        if (enabled){
                            $this.removeClass('deal__lessons-item_active');
                        }else{
                            $this.addClass('deal__lessons-item_active');
                        }
                        changeEnabledModule(idClient, idDeal, idModule, !enabled);
                    }
                });
            }
        }
    });
}

function changeAllowed(idDeal, idClient, allowed){
    console.log('Change allowed', idDeal, idClient, allowed);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/changeModulesAllowed",
        data: JSON.stringify({id: idDeal, idClient: idClient, value: allowed}),
        dataType: 'json',
        cache: false,
        success: function (data) {
            console.log(data);
        }
    });
}

function changeEnabledModule(idClient, idDeal, idModule, enabled){
    console.log('Change enabled', idClient, idDeal, idModule, enabled);

    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/changeModulesEnabled",
        data: JSON.stringify({idDeal: idDeal, idModule: idModule, idClient: idClient, value: enabled}),
        dataType: 'json',
        cache: false,
        success: function (data) {
            console.log(data);
        }
    });
}
// //обновление цены/получено по сделке на фронте
// function updateDealPriceOnList(value) {
//     var dealRow = $('[data-deal="' + value.id + '"]');
//
//     var colPaid = dealRow.find('.column-paid');
//     colPaid.removeClassWild('column-paid_*');
//     if (value.price <= value.paid) {
//         colPaid.addClass('column-paid_green');
//     }
//
//     dealRow.find('[data-deal-price]').html(value.price);
//     dealRow.find('[data-deal-paid]').html(value.paid + ' ₽');
// }
//кнопка добавления напоминания
$(document).on('click', '[js-add-reminder-button]', function(event) {
    event.preventDefault();
    $(this).closest('[js-add-reminder-form]').trigger('submit');
});
//form'a напоминания
$(document).on('submit', '[js-add-reminder-form]', function(event) {
    event.preventDefault();
    openUpdateReminder($(this).find('[name="idDeal"]').val());
});
function openUpdateReminder(idDeal) {
    $('[js-add-reminder-button]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/getReminder",
        data: JSON.stringify(idDeal),
        dataType: 'json',
        cache: false,
        success: function (data) {
            openReminderMenu(data);

            $('[js-add-reminder-button]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-reminder-button]').prop("disabled", false);
        }
    });
}
function openReminderMenu(data) {
    $('[js-update-form-reminder-id-deal]').val(data.idDeal);
    $('[js-update-form-reminder-date]').val(data.reminderDate);
    $('[js-update-form-reminder-msg]').html(data.reminderMessage);

    if (data.reminder) {
        $('[js-delete-reminder-block]').addClass('is-open');
    }

    $('[js-menu-update-reminder]').addClass('is-open');
    checkBodyHidden();
}
function clearReminderForm() {
    $('[js-update-form-reminder]').trigger('reset');
    $('[js-update-form-reminder-msg]').html('');
    $('[js-delete-reminder-block]').removeClass('is-open');
}

$(document).on('click', '[js-delete-reminder]', function (event) {
    event.preventDefault();

    var idDeal = $(this).closest('[js-update-form-reminder]').find('[name="idDeal"]').val();

    $('[js-delete-reminder]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/deleteReminder",
        data: JSON.stringify(idDeal),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard($CLIENT);

            $('[data-deal="' + idDeal + '"]').find('[data-deal-reminder]').html('<div class="reminder"></div>');

            clearReminderForm();
            $('[js-menu-update-reminder]').removeClass('is-open');
            checkBodyHidden();

            $('[js-delete-reminder]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-delete-reminder]').prop("disabled", false);
        }
    });

})
$(document).on('click', '[js-update-reminder]', function (event) {
   event.preventDefault();
   $('[js-update-form-reminder]').trigger('submit');

});
$(document).on('submit', '[js-update-form-reminder]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        updateReminder(formData);
    }
});
function updateReminder(formData) {
    $('[js-update-reminder]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/saveReminder",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard($CLIENT);
            updateReminderOnList(data);
            clearReminderForm();
            $('[js-menu-update-reminder]').removeClass('is-open');
            checkBodyHidden();

            $('[js-update-reminder]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-reminder]').prop("disabled", false);
        }
    });
}
function updateReminderOnList(value) {
    var dealRow = $('[data-deal="' + value.idDeal + '"]');

    var reminder = '';
    if (value.reminder) {
        reminder += '<div class="reminder-wrapper">' +
            '<div class="reminder-date" >' + value.reminderDate + '</div>' +
            '<div class="reminder-msg">' + value.reminderMessage + '</div>' +
            '</div>';
    }
    reminder += '<div class="reminder ' + (value.reminder ? (value.reminderExpiration ? 'reminder_red' : (value.reminderToday ? 'reminder_green' : 'reminder_gray')) : '') + '"></div>';
    if (value.reminder) {
        reminder += '<div class="reminder-d">' + value.reminderDate + '</div>';
    }

    dealRow.find('[data-deal-reminder]').html(reminder);
}

//скрыть сделкуedit-bill-accept
var HIDE_DEAL_FORM;
$(document).on('click', '[js-hide-deal-btn]', function(event) {
    event.preventDefault();
    $('[dialog]').find('.dialog__title').html('Вы действительно хотите скрыть сделку?');
    $('[dialog]').find('.dialog__text').html('В данном случае информация о сделке не будет учитываться');
    $('[dialog]').find('[accept-dialog]').attr('hide-deal', '');
    $('[dialog]').addClass('is-open');
    HIDE_DEAL_FORM =  $(this).closest('[js-hide-deal-form]');
});

$(document).on('click', '[hide-deal]', function(event) {
    event.preventDefault();
    $('[dialog]').removeClass('is-open');
    removeAcceptBtnAttribute($(this));
    HIDE_DEAL_FORM.trigger('submit');
});

$(document).on('submit', '[js-hide-deal-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        hideDeal(formData);
    }
});
function hideDeal(formData) {
    $('[js-hide-deal-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/hideDeal",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-hide-deal-btn]').prop("disabled", false);
            $('[data-hide-deal="' + formData.id + '"]').closest('.deal').remove();
            $('[data-hide-deal="' + formData.id + '"]').closest('.custom-table__body-row').remove();
        },
        error: function (data) {
            $('[js-hide-deal-btn]').prop("disabled", false);
        }
    });
}

$(document).on('click', '[js-update-deal-btn]', function(event) {
    event.preventDefault();
    $(this).closest('[js-update-deal-form]').trigger('submit');
});

$(document).on('submit', '[js-update-deal-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        setDealInfo(formData);
    }
});

function setDealInfo(data) {
    $('[js-update-deal-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/getDeal",
        data: JSON.stringify(data),
        dataType: 'json',
        cache: false,
        success: function (data) {
            setUpdateDealInfo(data);
            $('[js-update-deal-btn]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-deal-btn]').prop("disabled", false);
        }
    });
}

function setUpdateStreams(idCourse){
    var formData = new FormData();
    formData.set('idCourse', Number(idCourse));

    $.ajax({
        type: "POST",
        url: "/transactions/getStreamsByIdCourse",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var seloption = '';
            $.each(data, function(index, stream){
                seloption += '<option value="' + stream.id + '">' + stream.startDate + '</option>';
            });

            $('[js-update-form-deal-start-date]').append(seloption);
        },
        error: function (data) {
        }
    });
}

$(document).on('click', '[js-update-deal]', function(event) {
    event.preventDefault();
    $('[js-update-form-deal]').trigger('submit');
});

$(document).on('submit', '[js-update-form-deal]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        updateDeal(formData);
    }
});

function updateDeal(formData) {
    $('[js-update-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/updateDeal",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard(data.idClient);
            $('[js-menu-update-deal]').removeClass('is-open');
            checkBodyHidden();
            updateDealAfterUpdateOnList(data);
            $('[js-update-deal]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-deal]').prop("disabled", false);
        }
    });
}

function updateDealAfterUpdateOnList(value) {
    var dealRow = $('[data-deal="' + value.id + '"]');
    dealRow.find('[data-deal-date-deal]').html(value.dealDate);

    dealRow.find('[data-deal-social]').removeClassWild("deal-social_*").addClass("deal-social_" + value.socialCode).addClass("deal-social_big");

    var course = value.course != null ? (value.course + (value.kind !== null && value.kind !== '' ? ' (' + value.kind + ')' : '')) : 'Целевая заявка' ;
    dealRow.find('[data-deal-course]').attr('title', course).html(course);
    dealRow.find('[data-deal-type]').html(value.type);
    dealRow.find('[data-deal-price]').html(value.price);

    var colPaid = dealRow.find('.column-paid');
    colPaid.removeClassWild('column-paid_*');
    if (value.price <= dealRow.find('[data-deal-paid]').html().replace(/\D+/g,"")) {
        colPaid.addClass('column-paid_green');
    }

    dealRow.find('[data-deal-start-date]').html(value.startDate);
    if (value.tag === null) {
        dealRow.find('[data-deal-tag]').html('<div>—</div>');
    } else {
        dealRow.find('[data-deal-tag]').html('<div title="' + value.tag + '" class="column-msg">' + value.tag + '</div>');
    }
    dealRow.find('[data-deal-mailing]').html(value.coupling);

    var select = dealRow.find('[js-form-status]');
    var form = select.parent($('form'));
    form.removeClassWild("deal-status__form_*").addClass("deal-status__form_" + value.statusCode);
    select.on('change', function (event) {
        event.preventDefault();
    });
    $("#" + $(select).attr('id') + " option:selected").removeAttr('selected');
    $("#" + $(select).attr('id')).val(value.status);

    var reminder = '';
    if (value.reminder) {
        reminder += '<div class="reminder-wrapper">' +
            '<div class="reminder-date" >' + value.reminderDate + '</div>' +
            '<div class="reminder-msg">' + value.reminderMessage + '</div>' +
            '</div>';
    }
    reminder += '<div class="reminder ' + (value.reminder ? (value.reminderExpiration ? 'reminder_red' : (value.reminderToday ? 'reminder_green' : 'reminder_gray')) : '') + '"></div>';
    if (value.reminder) {
        reminder += '<div class="reminder-d">' + value.reminderDate + '</div>';
    }

    dealRow.find('[data-deal-reminder]').html(reminder);

}

$(document).on('submit', '[js-add-bill-form]', function(event) {
    event.preventDefault();
    openBills($(this).serializeObject());
});
function openBills(formData) {
    $('[js-add-bill-form]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/bills/getManagerBills",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-bills-deal-id]').val(formData.id);
            createBills(data);
            $('[js-menu-bills]').addClass('is-open');
            checkBodyHidden();
            $('[js-add-bill-form]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-bill-form]').prop("disabled", false);
        }
    });
}

function createBills(billList) {
    $('[js-bills-body]').html('');

    if (billList.length > 0) {
        $('[js-bills]').addClass('is-open');
    } else {
        $('[js-bills]').removeClass('is-open');
    }
    // checkBodyHidden();
    $.each(billList, function(index, value) {
        var response = "";
        response += '<div class="div-table__body-row">';

        // установка значения в в меню
        var seloption = "";
        $.each($paymentMethodList, function(index, value2){
            seloption += '<option value="'+ value2.title +'" data-code="' + value2.code + '">' + value2.title + '</option>';
        });

        //если статус 1 проверено, то зеленая иначе можно редактировать
        if (value.status === 2) {
            response += '<div class="div-table__body-col div-table__body-col_exxsmall div-table__body-col_center">' +
                '<div class="column_bstatus column_bstatus_checked"></div>' +
                '</div>';
        } else {
            response += '<div class="div-table__body-col div-table__body-col_exxsmall div-table__body-col_center">' +
                '<div class="column_bstatus column_bstatus_unchecked"></div>' +
                '</div>';
        }

        response += '<div class="div-table__body-col div-table__body-col_medium">' +
            '<div class="column-text">' + value.manager + '</div>' +
            '</div>';

        response += '<form b-update-bill-form action="#" class="edit-form-bill">' +
            '<input type="hidden" b-id-bill value="' + value.id + '" name="id" required>' +
            '<input type="hidden" value="' + value.idDeal + '" name="idDeal" required>' +
            '<input type="hidden" b-pm value="' + value.paymentMethod + '" name="paymentMethod">' +
            '<input type="hidden" b-pm-code value="' + value.paymentMethodCode + '" name="paymentMethodCode">' +
            '<div class="div-table__body-col div-table__body-col_small">' + value.billDate + '</div>';

        // add сумму
        response += '<div class="div-table__body-col div-table__body-col_center div-table__body-col_xsmall">' +
            '<input b-sum disabled name="sum" class="menu-input__input menu-input__input_small editable" value="'+ value.sum +'" placeholder="0 ₽">' +
            '</div>';

        response += '<div class="div-table__body-col div-table__body-col_xxsmall">' +
            '<div b-pm-wrapper class="pmethod-wrapper disabled">' +
            '<select b-pm-selector disabled class="column_pmethod-select column_pmethod_' + value.paymentMethodCode + '">' +
            seloption +
            '</select>' +
            '</div>' +
            '</div>';

        // add номер счета
        response +=   '<div class="div-table__body-col div-table__body-col_medium  div-table__body-col_center div-table__body-col_r10">' +
            '<input b-account-number disabled name="accountNumber" class="menu-input__input menu-input__input_small editable" value="'+ (value.accountNumber === null ? '' : value.accountNumber) +'" placeholder="—">' +
            '</div>';

        response += '<div class="div-table__body-col col-pay-date div-table__body-col_center div-table__body-col_medium ">' +
            '<div class="menu-input__wrapper menu-input__wrapper_xsmall">' +
            '<input b-pay-date disabled name="payDate" ' +
            'class="datepicker-here-cs menu-input__input menu-input__input_small editable" autocomplete="off" value="' + (value.payDate === null ? '' : value.payDate) + '" data-autoclose="true" placeholder="—"/>' +
            '</div></div>';

        // add оплачен/выставлен
        if (value.payDate === null) {
            response += '<div class="div-table__body-col div-table__body-col_small col-status">Выставлен</div>';
        } else {
            response += '<div class="div-table__body-col div-table__body-col_small col-status div-table__body-col_green">Оплачен</div>';
        }

        // add тип оплаты
        response += '<div class="div-table__body-col div-table__body-col_small">' + (value.paymentType === 'Новый клиент' ? 'Первый' : 'Доплата') + '</div>';

        // add ссылка
        if (value.link !== null && value.link !== '') {
            response += '<div class="div-table__body-col div-table__body-col_xxsmall div-table__body-col_center">' +
                '<div class="column-links"><div js-copy-link data-link="' + value.link + '" class="column_mwidth column_mwidth-copy"></div>' +
                '<a js-open-link href="' + value.link + '" target="_blank" class="column_mwidth column_mwidth-open"></a></div></div>';
        } else {
            response += '<div class="div-table__body-col div-table__body-col_xxsmall">' +
                '<div>—</div></div>';
        }
        response += '</form>';

        // add коммент
        response += '<div data-bill-id="' + value.id + '" class="div-table__body-col div-table__body-col_medium div-table__body-col_center">' +
            '<div class="column-links">' +
            ((value.comment === null)
                ? '<div js-add-sms-check js-check-btn class="column_mwidth column_mwidth-large column_mwidth_bordered div-table__body-col_center column_mwidth-add-check"></div>'
                : '<div js-delete-sms-check js-check-btn title="' + value.comment + '" class="column_mwidth column_mwidth-large column_mwidth_bordered div-table__body-col_center column_mwidth-delete-check"></div>') +
            ((value.billImage !== null && value.billImage !== '')
                ? '<a class="column-img column_mwidth column-img_large div-table__body-col_center" data-fancybox="gallery" href="../' + value.billImage + '">' +
                '<img src="/' + value.billImage + '">' +
                '</a>'
                : '<form js-upload-bill-form action="#" class="column_mwidth column_mwidth-large div-table__body-col_center div-table__body-col_fl" enctype="multipart/form-data">' +
                '<input type="hidden" value="' + value.id + '" name="id" required>' +
                '<input type="hidden" value="false" name="isHidden" required>' +
                '<input type="hidden" value="' + value.idDeal + '" name="idDeal" required>' +
                '<input js-upload-bill accept="image/*,image/jpeg" class="input-file" name="file" type="file" id="file' + index + '"/>' +
                '<label for="file' + index + '" class="js-labelFile">' +
                '<span class="js-upload-file js-upload-file_small"></span>' +
                '</label>' +
                '</form>') +
            '</div>' +
            '</div>';

        response += '<div class="div-table__body-col div-table__body-col_center div-table__body-col_xxsmall">';

        if (value.status === 1 && value.isEditable) {
            response +=  '<div js-edit-btns class="column-links display-flex-none">' +
                '<div js-edit-bill-accept class="column_mwidth column_mwidth-accept"></div>' +
                '<div js-edit-bill-cancel class="column_mwidth column_mwidth-cancel"></div>' +
                '</div>' +
                '<div js-edit-menu class="column-links display-flex-none is-open">' +
                '<div js-edit-bill class="column_mwidth div-table__body-col_center column_mwidth-edit"></div>' +
                '<form js-delete-bill-form class="column-form" action="#">' +
                '<input type="hidden" value="' + value.id + '" name="id" required>' +
                '<button js-delete-bill type="button" class="column_mwidth column_mwidth-delete"></button>' +
                '</form>' +
                '</div>';
        }

        response += '</div>'+
            '</div>';

        $('[js-bills-body]').html($('[js-bills-body]').html() + response);
    });

    initDatePicker();
    initFancy();

    initEditBillForm();
    initCancelEditBill();
    initAcceptEditBill();
}

function initDatePickerPayDate() {
    $('.datepicker-here-pay').datepicker({
        autoClose: true,
        maxDate: new Date(),
        todayButton: true
    });
}
function initDatePicker() {
    $('.datepicker-here-cs').datepicker({
        autoClose: true,
        maxDate: new Date(),
        todayButton: true
    });
}
function initFancy() {
    $('[data-fancybox="gallery"]').fancybox({
        infobar: false,
        buttons: [
            "close"
        ],
    });
}
$(document).on('click', '[js-add-bill-up-client]', function(event) {
    var clientId = $(this).closest('.custom-table__body-row').find('[js-client-id]').val();
    var clientName = $(this).closest('.custom-table__body-row').find('[js-client-id]').siblings('span').html();

    setIdClient(clientId);

    $('[js-client-name-copy]').text(clientName);
    $('[js-client-name-copy]').attr('data-link', clientName);
});

$(document).on('change', '[js-upload-bill]', function(event) {
    var form = $(this).closest('[js-upload-bill-form]')
    var data = new FormData(form[0]);
    $('[js-upload-bill]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "/api/bills/uploadBill",
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 300000,
        success: function (data) {
            updateBillImageOnList(data);

            var formData = form.serializeObject();
            formData['id'] = formData.idDeal;
            openBills(formData);
            $('[js-upload-bill]').prop("disabled", false);
        },
        error: function (e) {
            console.log("ERROR : ", e);
            $('[js-upload-bill]').prop("disabled", false);
        }
    });
});
$(document).on('change', '[js-upload-bill-front]', function(event) {
    var form = $(this).closest('[js-upload-bill-form]')
    var data = new FormData(form[0]);
    $('[js-upload-bill-front]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "/api/bills/uploadBill",
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 300000,
        success: function (data) {
            updateBillImageOnList(data);
            $('[js-upload-bill-front]').prop("disabled", false);
        },
        error: function (e) {
            console.log("ERROR : ", e);
            $('[js-upload-bill-front]').prop("disabled", false);
        }
    });
});
function updateBillImageOnList(billData) {
    var imageBillForm = $('[js-upload-bill-form][bill-image="' + billData.id + '"]');
    imageBillForm.replaceWith('<a class="column-img column-img_mr5" data-fancybox="gallery' + billData.id + '" href="/' + billData.billImage + '">' +
        '  <img src="/' + billData.billImage + '"></a>');
}

//активация редактирования формы
var BILLS_INFO_TEMP = {};

$(document).on('click', '[edit-bill]', function(event) {
    event.preventDefault();
    $(this).closest('[edit-menu]').removeClass('is-open').siblings('[edit-btns]').addClass('is-open');
    var list = {};
    var pd = $(this).closest('.custom-table__body-row').find('[b-pay-date]');
    pd.removeAttr('disabled');
    list['payDate'] = pd.val();

    var s = $(this).closest('.custom-table__body-row').find('[b-sum]');
    list['sum'] = s.val();
    s.val(s.val().replace(' ₽','')).removeAttr('disabled');

    $(this).closest('.custom-table__body-row').find('[b-pm-wrapper]').removeClass('disabled');
    $(this).closest('.custom-table__body-row').find('[b-pm-selector]').removeAttr('disabled');
    var pm = $(this).closest('.custom-table__body-row').find('[b-pm]');
    list['paymentMethod'] = pm.val();
    var pmCode = $(this).closest('.custom-table__body-row').find('[b-pm-code]');
    list['paymentMethodCode'] = pmCode.val();

    var an = $(this).closest('.custom-table__body-row').find('[b-account-number]');
    an.removeAttr('disabled');
    list['accountNumber'] = an.val();

    BILLS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[b-id-bill]').val()] = list;
});

$(document).on('click', '[edit-bill-cancel]', function(event) {
    event.preventDefault();
    var values = BILLS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[b-id-bill]').val()];

    $(this).closest('.custom-table__body-row').find('[b-pay-date]').val(values.payDate).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[b-sum]').val(values.sum).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[b-account-number]').val(values.accountNumber).attr("disabled", true);

    $(this).closest('.custom-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
    $(this).closest('.custom-table__body-row').find('[b-pm-selector]')
        .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + values.paymentMethodCode).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[b-pm]').val(values.paymentMethod);
    $(this).closest('.custom-table__body-row').find('[b-pm-code]').val(values.paymentMethodCode);

    $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
    delete BILLS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[b-id-bill]').val()];
});

var ACCEPT_EDITE_BTN;
$(document).on('click', '[edit-bill-accept]', function(event) {
    event.preventDefault();
    ACCEPT_EDITE_BTN = $(this);

    var billData = new Object();
    billData.id = $(this).closest('.custom-table__body-row').find('[b-id-bill]').val();
    billData.idDeal = $(this).closest('.custom-table__body-row').find('[b-id-deal]').val();
    billData.paymentMethod = $(this).closest('.custom-table__body-row').find('[b-pm]').val();
    billData.paymentMethodCode = $(this).closest('.custom-table__body-row').find('[b-pm-code]').val();
    billData.sum = $(this).closest('.custom-table__body-row').find('[b-sum]').val();
    billData.accountNumber = $(this).closest('.custom-table__body-row').find('[b-account-number]').val();
    billData.payDate = $(this).closest('.custom-table__body-row').find('[b-pay-date]').val();

    $('[edit-bill-accept]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/bills/updateBill",
        data: JSON.stringify(billData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pay-date]').val(data.payDate).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-sum]').val(data.sum + ' ₽').attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-account-number]').val(data.accountNumber).attr("disabled", true);

            if(data.payDate === null || data.payDate === '') {
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('.column-bill__status').removeClass('column-bill__status_paid').html('Выставлен');
            } else {
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('.column-bill__status').addClass('column-bill__status_paid').html('Оплачен');
            }

            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-selector]')
                .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + data.paymentMethodCode).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm]').val(data.paymentMethod);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-code]').val(data.paymentMethodCode);


            ACCEPT_EDITE_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
            delete BILLS_INFO_TEMP[data.id];

            $('[edit-bill-accept]').prop("disabled", false);
        },
        error: function (data) {
            var values = BILLS_INFO_TEMP[billData.id];

            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pay-date]').val(values.payDate).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-sum]').val(values.sum).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-account-number]').val(values.accountNumber).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-selector]')
                .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + values.paymentMethodCode).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm]').val(values.paymentMethod);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-code]').val(values.paymentMethodCode);

            ACCEPT_EDITE_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
            delete BILLS_INFO_TEMP[data.id];
            $('[edit-bill-accept]').prop("disabled", false);
        }
    });
});


// сохранение сделки
var SAVE_DEAL_TYPE;
$(document).on('click', '[js-save-deal]', function(event) {
    event.preventDefault();
    SAVE_DEAL_TYPE = "s";
    $('[js-deal-form]').trigger('submit');
});
///сохранение сделки и открытие выставление счета
$(document).on('click', '[js-save-and-bill-deal]', function(event) {
    event.preventDefault();
    SAVE_DEAL_TYPE = "sb";
    $('[js-deal-form]').trigger('submit');
});


$(document).on('submit', '[js-deal-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var dealData = $(this).serializeObject();
        if (SAVE_DEAL_TYPE === 's') {
            createDeal(dealData);
        } else if (SAVE_DEAL_TYPE === 'sb') {
            createDealAndBill(dealData);
        }
    }
});

function createDeal(dealData) {
    $('[js-save-deal]').prop("disabled", true);
    $('[js-save-and-bill-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/saveDeal",
        data: JSON.stringify(dealData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard(dealData.idClient);
            $('[js-bill-deal-id]').val(data);
            $('[js-menu-create-deal]').removeClass('is-open');
            checkBodyHidden();

            // resetCreateDealForm();

            $('[js-save-deal]').prop("disabled", false);
            $('[js-save-and-bill-deal]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-deal]').prop("disabled", false);
            $('[js-save-and-bill-deal]').prop("disabled", false);
        }
    });
}
function createDealAndBill(dealData)    {
    $('[js-save-deal]').prop("disabled", true);
    $('[js-save-and-bill-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/saveDeal",
        data: JSON.stringify(dealData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard(dealData.idClient);
            $('[js-bill-deal-id]').val(data);
            $('[js-menu-create-deal]').removeClass('is-open');
            checkBodyHidden();

            // resetCreateDealForm();

            setBillInfo(dealData);
            $('[js-menu-bill]').addClass('is-open');
            checkBodyHidden();

            $('[js-save-deal]').prop("disabled", false);
            $('[js-save-and-bill-deal]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-deal]').prop("disabled", false);
            $('[js-save-and-bill-deal]').prop("disabled", false);
        }
    });
}
function setBillInfo(data) {
    $('[js-bill-info-product]').text(data.course);
    $('[js-bill-info-sum]').text(data.price);
    $('[js-bill-info-date]').text(data.dealDate);
}


$(document).on('change', '[product-types]', function(event) {
    $('[js-deal-form-price]').val(0);
    $('[js-deal-form-start-date]').html('<option value="" disabled selected>Выберите дату старта</option>');
    var idType = $('option:selected', this).attr('data-id');

    $('#product-category option:selected').removeAttr('selected');
    $('#product-category option:first').prop('selected', true);

    if (idType == 2) {
        createProductOptions($coursesList, 'js-deal-form-product');
        $('[product-block]').removeClass('menu-input_close');
        $('[trial-block]').removeClass('menu-input_close');
        $('[product-category-block]').addClass('menu-input_close');
        $('[start-date-block]').removeClass('menu-input_close');
    } else if (idType == 3) {
        createEmptyProductOptions('js-deal-form-product');
        $('[product-category-block]').removeClass('menu-input_close');
        $('[product-block]').addClass('menu-input_close');
        $('[trial-block]').addClass('menu-input_close');
        $('[start-date-block]').addClass('menu-input_close');
    } else {
        $('[product-block]').addClass('menu-input_close');
        $('[trial-block]').addClass('menu-input_close');
        $('[product-category-block]').addClass('menu-input_close');
        $('[start-date-block]').addClass('menu-input_close');
    }
});

//список курсов
var $coursesList;
function setCoursesList(coursesList) {
    $coursesList = coursesList;
}
function createProductOptions(list, ident) {
    var seloption = "";
    seloption += '<option value="" disabled selected>Выберите продукт</option>';
    $.each(list, function(index, value2){
        seloption += '<option data-id="'+ value2.id + '" value="'+ value2.name +'" data-type="'+ value2.type + '" data-price="' + value2.price + '"">' + value2.name + '</option>';
    });
    $('[' + ident + ']').html(seloption);
}
function createEmptyProductOptions(ident) {
    $('[' + ident + ']').html('<option value="" disabled selected>Выберите продукт</option>');
}

//список продуков по категориям
var $productMap;
function setProductMap(productMap) {
    $productMap = productMap;
}
$(document).on('change', '[product-category]', function(event) {
    $('[js-deal-form-price]').val(0);
    var idCategory = $('option:selected', this).val();
    createProductOptions($productMap[idCategory], 'js-deal-form-product');
    $('[product-block]').removeClass('menu-input_close');

});

$(document).on('change', '[u-product-category]', function(event) {
    $('[js-update-form-deal-price]').val(0);
    var idCategory = $('option:selected', this).val();
    createProductOptions($productMap[idCategory], 'js-update-form-deal-pr');
    $('[u-product-block]').removeClass('menu-input_close');

});
$(document).on('change', '[u-product-types]', function(event) {
    $('[js-update-form-deal-price]').val(0);
    $('[js-update-form-deal-start-date]').html('<option value="" disabled selected>Выберите дату старта</option>');
    var idType = $('option:selected', this).attr('data-id');

    $('#u-product-category option:selected').removeAttr('selected');
    $('#u-product-category option:first').prop('selected', true);
    $('#js-update-form-deal-pr option:selected').removeAttr('selected');
    $('#js-update-form-deal-pr option:first').prop('selected', true);

    if (idType == 2) {
        createProductOptions($coursesList, 'js-update-form-deal-pr');
        $('[u-product-block]').removeClass('menu-input_close');
        $('[u-trial-block]').removeClass('menu-input_close');
        $('[u-product-category-block]').addClass('menu-input_close');
        $('[u-start-date-block]').removeClass('menu-input_close');
    } else if (idType == 3) {
        createEmptyProductOptions('js-update-form-deal-pr');
        $('[u-product-category-block]').removeClass('menu-input_close');
        $('[u-product-block]').addClass('menu-input_close');
        $('[u-trial-block]').addClass('menu-input_close');
        $('[u-start-date-block]').addClass('menu-input_close');
    } else {
        $('[u-product-block]').addClass('menu-input_close');
        $('[u-trial-block]').addClass('menu-input_close');
        $('[u-product-category-block]').addClass('menu-input_close');
        $('[u-start-date-block]').removeClass('menu-input_close');
    }
});

var BlockEmbed = Quill.import('blots/block');

class IFrame extends BlockEmbed {
    static create(value) {
        let node = super.create(value);
        node.innerHTML = value;
        return node;
    }
}
IFrame.blotName = 'iframe';
IFrame.className = 'ql-iframe';
IFrame.tagName = 'div';

Quill.register({
    'formats/iframe': IFrame
});

var icons = Quill.import('ui/icons');
icons['iframe'] = '<i class="fa fa-bold" aria-hidden="true"></i>';


$(document).ready(function(){
    const toolbarOptions = [
        [{ 'header': [1, 2, 3, false] }],
        ['bold', 'italic', 'underline'],
        [{ 'list': 'bullet' }],
        [{ 'align': ['', 'center', 'right'] }],
        ['video'],
        ['iframe'],
        ['clean']
    ];
    const $hiddenEditor = $('#editor-hidden');

    var quill = new Quill('#editor', {
        theme: 'snow',
        modules: {
            toolbar: toolbarOptions
        }
    });

    quill.on('text-change', function(delta, oldDelta, source) {
        $hiddenEditor.val(quill.root.innerHTML);
    });
});

//список фильтр
var $typeList;
function setTypes(typeList) {
    $typeList = typeList;
}
$(document).on('change', '[u-upload-avatar]', function(event) {
    var form = $(this).closest('[u-upload-avatar-form]')
    var data = new FormData(form[0]);
    $('[js-upload-bill]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "/settings/users/uploadAvatar",
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 300000,
        success: function (data) {
            form.find('.avatar-upload__upload').removeClassWild("avatar-upload__upload_*");
            form.find('.avatar-upload__upload').html('<img src="/' + data + '" alt>');
            $('[u-upload-avatar]').prop("disabled", false);
        },
        error: function (data) {
            $('[u-upload-avatar]').prop("disabled", false);
        }
    });
});
$(document).on('change', '.indicated-select select', function(event) {
    var vl = $('option:selected', this).attr('value');
    $(this).closest('.indicated-select').removeClassWild("indicated-select_*").addClass('indicated-select_' + vl);
});

$(document).ready(function() {

    const $menuCreateUserBtn = $('[js-create-employee]');
    const $menuCreateUserCloseBtn = $('[js-menu-create-employee-close-btn]');
    const $menuCreateUser = $('[js-menu-create-employee]');

    const $saveUserBtn = $('[js-save-employee]');
    const $createUserForm = $('[js-employee-form]');

    $menuCreateUserBtn.on('click', function () {
        $menuCreateUser.addClass('is-open');
        checkBodyHidden()
    });

    $menuCreateUserCloseBtn.on('click', function() {
        $menuCreateUser.removeClass('is-open');
        $createUserForm.trigger('reset');
        checkBodyHidden()
    });

    $saveUserBtn.on('click', function(event) {
        event.preventDefault();
        $createUserForm.trigger('submit');
    });

    $createUserForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var userData = $createUserForm.serializeObject();
            createEmployee(userData);
        }
    });

    initDatePicker();
});

function createEmployee(userData) {
    $('[js-save-employee]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveEmployee",
        data: JSON.stringify(userData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            addRowToTable(data);
            $('[js-menu-create-employee]').removeClass('is-open');
            checkBodyHidden();
            $('[js-employee-form]').trigger('reset');
            $('[js-save-employee]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-employee]').prop("disabled", false);
        }
    });
}
function addRowToTable(data) {
    var seloption = "";
    $.each($typeList, function(index, value){
        seloption += '<option value="'+ value.id +'"' + (value.id === data.type ? 'selected="selected" ': '') +'">' + value.title + '</option>';
    });

    $('[table-body]').html(
        '<tr data-employee="' + data.idEmployee + '" class="custom-table__body-row">' +
        '                        <input type="hidden" u-id value="' + data.idEmployee + '" name="id" required>' +
        '                        <td class="custom-table__body-col">' + data.idEmployee + '</td>' +
        '                        <td class="custom-table__body-col">' +
        '                            <div class="avatar-upload">' +
        '                                <form u-upload-avatar-form action="#" enctype="multipart/form-data">' +
        '                                    <input type="hidden" value="' + data.idEmployee + '" name="id" required>' +
        '                                    <input u-upload-avatar accept="image/*,image/jpeg" class="input-file" name="file" type="file" id="avatar' + data.idEmployee + '">' +
        '                                    <label for="avatar' + data.idEmployee + '">' +
        '                                            <span class="avatar-upload__upload avatar-upload__upload_default-user"></span>' +
        '                                    </label>' +
        '                                </form>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_xlarge" >' +
        '                            <input u-name name="name"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + data.name + '"' +
        '                                   value="' + data.name + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-phone name="phone"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + data.phone + '"' +
        '                                   value="' + data.phone + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-link name="link"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + data.link + '"' +
        '                                   value="' + data.link + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-doorscardnumber name="doorsCardNumber"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + data.doorsCardNumber + '"' +
        '                                   value="' + data.doorsCardNumber + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_small">' +
        '                            <input u-birthday' +
        '                                   data-position="top left"' +
        '                                   name="birthday"' +
        '                                   class="datepicker-here-cs menu-input__input menu-input__input_small editable"' +
        '                                   autocomplete="off"' +
        '                                   value="' + data.birthday + '"' +
        '                                   disabled' +
        '                                   data-autoclose="true"' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col">' +
        '                            <div class="input-element__checkbox input-element__checkbox_mid">' +
        '                                <input u-ishaskey' +
        '                                       name="isHasKey"' +
        '                                       type="checkbox"' +
        '                                       class="checkbox"' +
        '                                       value="true"' +
        '                                       disabled' +
        '                                       id="key' + data.idEmployee + '"' +
                                              ((data.isHasKey) ? 'checked=checked' : '') +
        '                                  ">' +
        '                                <label class="checkbox-label checkbox-label_gray" for="key' + data.idEmployee +'"></label>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <div u-type-wrapper class="menu-input__wrapper menu-input__wrapper_select disabled">' +
        '                                <select u-type-selector disabled class="editable menu-input__input menu-input__input_medium menu-input__input_select menu-input__input_white">' +
        '                                    <option value="0" disabled>Выберите тип</option>' +
                                             seloption +
        '                                </select>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <div u-dismiss-wrapper class="indicated-select menu-input__wrapper menu-input__wrapper_select disabled indicated-select_' + data.isNotDisMiss + '">' +
        '                                <select u-dismiss-selector disabled class="editable menu-input__input menu-input__input_xsmall menu-input__input_select menu-input__input_white">' +
        '                                    <option value="true" selected=selected>Работает</option>' +
        '                                    <option value="false">Уволен</option>' +
        '                                </select>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_last">' +
        '                            <div edit-btns class="column-links display-flex-none">' +
        '                                <div edit-user-accept class="column_mwidth column_mwidth-accept"></div>' +
        '                                <div edit-user-cancel class="column_mwidth column_mwidth-cancel"></div>' +
        '                            </div>' +
        '                            <div edit-menu class="column-links display-flex-none is-open">' +
        '                                <div edit-user class="column_mwidth div-table__body-col_center column_mwidth-edit column_mwidth-edit-b"></div>' +
        '                            </div>' +
        '                        </td>' +
        '                    </tr>'
        + $('[table-body]').html()
    );

    initDatePicker();
}

function initDatePicker() {
    $('.datepicker-here-cs').datepicker({
        autoClose: true
    });
}

//активация редактирования формы
var USERS_INFO_TEMP = {};
$(document).on('click', '[edit-user]', function(event) {
    event.preventDefault();
    $(this).closest('[edit-menu]').removeClass('is-open').siblings('[edit-btns]').addClass('is-open');
    var list = {};

    var name = $(this).closest('.custom-table__body-row').find('[u-name]');
    // name.removeAttr('disabled');
    list['name'] = name.val();

    var phone = $(this).closest('.custom-table__body-row').find('[u-phone]');
    phone.removeAttr('disabled');
    list['phone'] = phone.val();

    var link = $(this).closest('.custom-table__body-row').find('[u-link]');
    link.removeAttr('disabled');
    list['link'] = link.val();

    var doorsCardNumber = $(this).closest('.custom-table__body-row').find('[u-doorscardnumber]');
    doorsCardNumber.removeAttr('disabled');
    list['doorsCardNumber'] = doorsCardNumber.val();

    var birthday = $(this).closest('.custom-table__body-row').find('[u-birthday]');
    birthday.removeAttr('disabled');
    list['birthday'] = birthday.val();

    var isHasKey = $(this).closest('.custom-table__body-row').find('[u-ishaskey]');
    isHasKey.removeAttr('disabled');
    list['isHasKey'] = isHasKey.prop('checked');

    $(this).closest('.custom-table__body-row').find('[u-type-wrapper]').removeClass('disabled');
    $(this).closest('.custom-table__body-row').find('[u-type-selector]').removeAttr('disabled');
    var type = $(this).closest('.custom-table__body-row').find('[u-type-selector]');
    list['type'] = type.val();

    $(this).closest('.custom-table__body-row').find('[u-dismiss-wrapper]').removeClass('disabled');
    $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]').removeAttr('disabled');
    var dismiss = $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]');
    list['dismiss'] = dismiss.val();

    $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
    USERS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[u-id]').val()] = list;
});
$(document).on('click', '[edit-user-cancel]', function(event) {
    event.preventDefault();
    var values = USERS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[u-id]').val()];

    $(this).closest('.custom-table__body-row').find('[u-name]').val(values.name).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-phone]').val(values.phone).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-link]').val(values.link).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-doorscardnumber]').val(values.doorsCardNumber).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-birthday]').val(values.birthday).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked', values.isHasKey).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-type-wrapper]').addClass('disabled');
    $(this).closest('.custom-table__body-row').find('[u-type-selector]').val(values.type).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-dismiss-wrapper]').removeClassWild("indicated-select_*").addClass('indicated-select_' + values.dismiss).addClass('disabled');
    $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]').val(values.dismiss).attr("disabled", true);

    $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
    delete USERS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[u-id]').val()];
});

var USERS_ACCEPT_BTN;
$(document).on('click', '[edit-user-accept]', function(event) {
    event.preventDefault();
    USERS_ACCEPT_BTN = $(this);

    var userData = new Object();
    userData.idEmployee = $(this).closest('.custom-table__body-row').find('[u-id]').val();
    userData.idCompany = $(this).closest('.custom-table__body-row').find('[u-id-company]').val();
    userData.name = $(this).closest('.custom-table__body-row').find('[u-name]').val();
    userData.phone = $(this).closest('.custom-table__body-row').find('[u-phone]').val();
    userData.link = $(this).closest('.custom-table__body-row').find('[u-link]').val();
    userData.doorsCardNumber = $(this).closest('.custom-table__body-row').find('[u-doorscardnumber]').val();
    userData.birthday = $(this).closest('.custom-table__body-row').find('[u-birthday]').val();
    userData.isHasKey = $(this).closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked');
    userData.type = $(this).closest('.custom-table__body-row').find('[u-type-selector]').val();
    userData.isNotDisMiss = $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]').val();

    $('[edit-user-accept]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/settings/users/update",
        data: JSON.stringify(userData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-name]').val(data.name).attr("disabled", true);
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-phone]').val(data.phone).attr("disabled", true);
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-link]').val(data.link).attr("disabled", true);
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-doorscardnumber]').val(data.doorsCardNumber).attr("disabled", true);
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-birthday]').val(data.birthday).attr("disabled", true);
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked', data.isHasKey).attr("disabled", true);

            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-wrapper]').addClass('disabled');
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-selector]').val(data.type).attr("disabled", true);
            if (typeof data.isNotDisMiss !== 'undefined') {
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-wrapper]').addClass('disabled');
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-selector]').val(data.isNotDisMiss.toString()).attr("disabled", true);

            }

            USERS_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
            delete USERS_INFO_TEMP[data.id];

            $('[edit-user-accept]').prop("disabled", false);
        },
        error: function (data) {
            var values = USERS_INFO_TEMP[userData.idEmployee];

            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-name]').val(values.name).attr("disabled", true);
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-phone]').val(values.phone).attr("disabled", true);
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-link]').val(values.link).attr("disabled", true);
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-doorscardnumber]').val(values.doorsCardNumber).attr("disabled", true);
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-birthday]').val(values.birthday).attr("disabled", true);
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked', values.isHasKey).attr("disabled", true);

            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-wrapper]').addClass('disabled');
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-selector]').val(values.type).attr("disabled", true);
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-wrapper]').addClass('disabled');
            USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-selector]').val(values.dismiss).attr("disabled", true);

            USERS_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');

            delete USERS_INFO_TEMP[data.id];
            $('[edit-user-accept]').prop("disabled", false);
        }
    });
});
//список фильтр
var $typeList;
function setTypes(typeList) {
    $typeList = typeList;
}
$(document).on('change', '[u-upload-avatar]', function(event) {
    var form = $(this).closest('[u-upload-avatar-form]')
    var data = new FormData(form[0]);
    $('[js-upload-bill]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "uploadAvatar",
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 300000,
        success: function (data) {
            form.find('.avatar-upload__upload').removeClassWild("avatar-upload__upload_*");
            form.find('.avatar-upload__upload').html('<img src="/' + data + '" alt>');
            $('[u-upload-avatar]').prop("disabled", false);
        },
        error: function (data) {
            $('[u-upload-avatar]').prop("disabled", false);
        }
    });
});
$(document).on('change', '.indicated-select select', function(event) {
    var vl = $('option:selected', this).attr('value');
    $(this).closest('.indicated-select').removeClassWild("indicated-select_*").addClass('indicated-select_' + vl);
});



$(document).on('click', '[js-create-examiner]', function(event) {
    $('[js-menu-create-examiner]').addClass('is-open');
    addTypeOptions($(this).siblings('[department]').attr("department"));
    addIdDepartment($(this).siblings('[department]').attr("id-department"));
    checkBodyHidden();
});

$(document).on('click', '[js-menu-create-examiner-close-btn]', function(event) {
    $('[js-menu-create-examiner]').removeClass('is-open');
    $('[js-examiner-form]').trigger('reset');
    checkBodyHidden();
});

$(document).on('click', '[js-save-examiner]', function(event) {
    event.preventDefault();
    $('[js-examiner-form]').trigger('submit');
});
$(document).on('submit', '[js-examiner-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var userData = new FormData($('[js-examiner-form]')[0]);
        createEmployee(userData, true);
    }
});

$(document).ready(function() {

    const $menuCreateUserBtn = $('[js-create-employee]');
    const $menuCreateUserCloseBtn = $('[js-menu-create-employee-close-btn]');
    const $menuCreateUser = $('[js-menu-create-employee]');

    const $saveUserBtn = $('[js-save-employee]');
    const $createUserForm = $('[js-employee-form]');

    $menuCreateUserBtn.on('click', function () {
        $menuCreateUser.addClass('is-open');
        var dep = $(this).siblings('[department]').attr("department");
        if (dep === 'supervision'){
            $('[js-supervisor-password-item]').show();
            $('[js-supervisor-login-item]').show();
        }else{
            $('[js-supervisor-password-item]').hide();
            $('[js-supervisor-login-item]').hide();
        }
        addTypeOptions(dep);
        addIdDepartment($(this).siblings('[department]').attr("id-department"));
        checkBodyHidden()
    });

    $menuCreateUserCloseBtn.on('click', function() {
        $menuCreateUser.removeClass('is-open');
        $createUserForm.trigger('reset');
        checkBodyHidden()
    });

    $saveUserBtn.on('click', function(event) {
        event.preventDefault();
        $createUserForm.trigger('submit');
    });

    $createUserForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            // var userData = $createUserForm.serializeObject();
            var userData = new FormData($('[js-employee-form]')[0]);
            createEmployee(userData, false);
        }
    });

    initDatePicker();
});

function createEmployee(userData, needLogin) {
    $('[js-save-employee]').prop("disabled", true);
    $('[js-save-examiner]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveEmployee",
        data: userData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            addRowToTable(data, needLogin);

            $('[js-menu-create-employee]').removeClass('is-open');
            $('[js-menu-create-examiner]').removeClass('is-open');
            checkBodyHidden();

            $('[js-employee-form]').trigger('reset');
            $('[js-examiner-form]').trigger('reset');

            $('[js-save-employee]').prop("disabled", false);
            $('[js-save-examiner]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-employee]').prop("disabled", false);
            $('[js-save-examiner]').prop("disabled", false);
        }
    });
}

function addTypeOptions(department) {
    var seloption = '<option value="" disabled selected>Выберите статус</option>';
    var arr = $typeList['' + department + ''];
    $.each(arr, function(index, value){
        seloption += '<option value="'+ value.id +'">' + value.title + '</option>';
    });

    $('[js-employee-form-type]').html(seloption);
}
function addIdDepartment(idDepartment) {
    $('[js-employee-dep]').val(idDepartment);
}
function addRowToTable(data, needLogin) {
    var seloption = "";
    var arr = $typeList['' + data.department + ''];
    $.each(arr, function(index, value){
        seloption += '<option value="'+ value.id +'" ' + (value.id === data.type ? 'selected="selected" ': '') +'>' + value.title + '</option>';
    });
    var table = $('[id-department=' + data.idDepartment + ']').closest('.content-main__panel').find('[table-body]');

    table.html(
        '<tr data-employee="' + data.idEmployee + '" class="custom-table__body-row">' +
        '                        <input type="hidden" u-id value="' + data.idEmployee + '" name="id" required>' +
        '                        <td class="custom-table__body-col">' + data.idEmployee + '</td>' +
        '                        <td class="custom-table__body-col">' +
        '                            <div class="avatar-upload">' +
        '                                <form u-upload-avatar-form action="#" enctype="multipart/form-data">' +
        '                                    <input type="hidden" value="' + data.idEmployee + '" name="id" required>' +
        '                                    <input u-upload-avatar accept="image/*,image/jpeg" class="input-file" name="file" type="file" id="avatar' + data.idEmployee + '">' +
        '                                    <label for="avatar' + data.idEmployee + '">' +
        '                                            <span class="avatar-upload__upload avatar-upload__upload_default-user"></span>' +
        '                                    </label>' +
        '                                </form>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_xlarge" >' +
        '                            <input u-name name="name"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + data.name + '"' +
        '                                   value="' + data.name + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        ((needLogin)
            ?         '                        <td class="custom-table__body-col custom-table__body-col_xlarge">' +
            '                            <input u-username name="user.username"' +
            '                                   class="menu-input__input menu-input__input_small editable"' +
            '                                   title="' + data.user.username + '"' +
            '                                   value="' + data.user.username + '"' +
            '                                   disabled' +
            '                                   placeholder="—"' +
            '                                   required>' +
            '                        </td>' +
            '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
            '                            <input u-password name="user.password"' +
            '                                   class="menu-input__input menu-input__input_small editable"' +
            '                                   value=""' +
            '                                   disabled' +
            '                                   placeholder="✱✱✱✱✱✱"' +
            '                                   required>' +
            '                        </td>'
            : '') +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-phone name="phone"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + data.phone + '"' +
        '                                   value="' + data.phone + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-link name="link"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + data.link + '"' +
        '                                   value="' + data.link + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-doorscardnumber name="doorsCardNumber"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + data.doorsCardNumber + '"' +
        '                                   value="' + data.doorsCardNumber + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_small">' +
        '                            <input u-birthday' +
        '                                   data-position="top left"' +
        '                                   name="birthday"' +
        '                                   class="datepicker-here-cs menu-input__input menu-input__input_small editable"' +
        '                                   autocomplete="off"' +
        '                                   value="' + data.birthday + '"' +
        '                                   disabled' +
        '                                   data-autoclose="true"' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col">' +
        '                            <div class="input-element__checkbox input-element__checkbox_mid">' +
        '                                <input u-ishaskey' +
        '                                       name="isHasKey"' +
        '                                       type="checkbox"' +
        '                                       class="checkbox"' +
        '                                       value="true"' +
        '                                       disabled' +
        '                                       id="key' + data.idEmployee + '"' +
                                              ((data.isHasKey) ? 'checked=checked' : '') +
        '                                  ">' +
        '                                <label class="checkbox-label checkbox-label_gray" for="key' + data.idEmployee +'"></label>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <div u-type-wrapper class="menu-input__wrapper menu-input__wrapper_select disabled">' +
        '                                <select u-type-selector disabled class="editable menu-input__input menu-input__input_medium menu-input__input_select menu-input__input_white">' +
        '                                    <option value="0" disabled>Выберите тип</option>' +
                                             seloption +
        '                                </select>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <div u-dismiss-wrapper class="indicated-select menu-input__wrapper menu-input__wrapper_select disabled indicated-select_' + data.isNotDisMiss + '">' +
        '                                <select u-dismiss-selector disabled class="editable menu-input__input menu-input__input_xsmall menu-input__input_select menu-input__input_white">' +
        '                                    <option value="true" selected=selected>Работает</option>' +
        '                                    <option value="false">Уволен</option>' +
        '                                </select>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_last">' +
        '                            <div edit-btns class="column-links display-flex-none">' +
        '                                <div edit-employee-accept class="column_mwidth column_mwidth-accept"></div>' +
        '                                <div edit-employee-cancel class="column_mwidth column_mwidth-cancel"></div>' +
        '                            </div>' +
        '                            <div edit-menu class="column-links display-flex-none is-open">' +
        '                                <div edit-employee class="column_mwidth div-table__body-col_center column_mwidth-edit column_mwidth-edit-b"></div>' +
        '                            </div>' +
        '                        </td>' +
        '                    </tr>'
        + table.html()
    );

    initDatePicker();
}

function initDatePicker() {
    $('.datepicker-here-e').datepicker({
        autoClose: true
    });
}

//активация редактирования формы
var EMPLOYEE_INFO_TEMP = {};
$(document).on('click', '[edit-employee]', function(event) {
    event.preventDefault();
    $(this).closest('[edit-menu]').removeClass('is-open').siblings('[edit-btns]').addClass('is-open');
    var list = {};

    var name = $(this).closest('.custom-table__body-row').find('[u-name]');
    // name.removeAttr('disabled');
    list['name'] = name.val();

    var username = $(this).closest('.custom-table__body-row').find('[u-username]');
    username.removeAttr('disabled');
    list['username'] = username.val();

    var password = $(this).closest('.custom-table__body-row').find('[u-password]');
    password.removeAttr('disabled');
    list['password'] = password.val();

    var phone = $(this).closest('.custom-table__body-row').find('[u-phone]');
    phone.removeAttr('disabled');
    list['phone'] = phone.val();

    var link = $(this).closest('.custom-table__body-row').find('[u-link]');
    link.removeAttr('disabled');
    list['link'] = link.val();

    var doorsCardNumber = $(this).closest('.custom-table__body-row').find('[u-doorscardnumber]');
    doorsCardNumber.removeAttr('disabled');
    list['doorsCardNumber'] = doorsCardNumber.val();

    var birthday = $(this).closest('.custom-table__body-row').find('[u-birthday]');
    birthday.removeAttr('disabled');
    list['birthday'] = birthday.val();

    var isHasKey = $(this).closest('.custom-table__body-row').find('[u-ishaskey]');
    isHasKey.removeAttr('disabled');
    list['isHasKey'] = isHasKey.prop('checked');

    $(this).closest('.custom-table__body-row').find('[u-type-wrapper]').removeClass('disabled');
    $(this).closest('.custom-table__body-row').find('[u-type-selector]').removeAttr('disabled');
    var type = $(this).closest('.custom-table__body-row').find('[u-type-selector]');
    list['type'] = type.val();

    $(this).closest('.custom-table__body-row').find('[u-dismiss-wrapper]').removeClass('disabled');
    $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]').removeAttr('disabled');
    var dismiss = $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]');
    list['dismiss'] = dismiss.val();

    $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
    EMPLOYEE_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[u-id]').val()] = list;
});
$(document).on('click', '[edit-employee-cancel]', function(event) {
    event.preventDefault();
    var values = EMPLOYEE_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[u-id]').val()];

    $(this).closest('.custom-table__body-row').find('[u-name]').val(values.name).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-username]').val(values.username).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-password]').val(values.password).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-phone]').val(values.phone).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-link]').val(values.link).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-doorscardnumber]').val(values.doorsCardNumber).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-birthday]').val(values.birthday).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked', values.isHasKey).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-type-wrapper]').addClass('disabled');
    $(this).closest('.custom-table__body-row').find('[u-type-selector]').val(values.type).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[u-dismiss-wrapper]').removeClassWild("indicated-select_*").addClass('indicated-select_' + values.dismiss).addClass('disabled');
    $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]').val(values.dismiss).attr("disabled", true);

    $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
    delete EMPLOYEE_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[u-id]').val()];
});

var EMPLOYEE_ACCEPT_BTN;
$(document).on('click', '[edit-employee-accept]', function(event) {
    event.preventDefault();
    EMPLOYEE_ACCEPT_BTN = $(this);

    var userData = new FormData();
    userData.set('idEmployee', $(this).closest('.custom-table__body-row').find('[u-id]').val());
    // userData.set('idCompany', $(this).closest('.custom-table__body-row').find('[u-id-company]').val());
    userData.set('name', $(this).closest('.custom-table__body-row').find('[u-name]').val());
    userData.set('user.username', $(this).closest('.custom-table__body-row').find('[u-username]').val());
    userData.set('user.password', $(this).closest('.custom-table__body-row').find('[u-password]').val());
    userData.set('phone', $(this).closest('.custom-table__body-row').find('[u-phone]').val());
    userData.set('link', $(this).closest('.custom-table__body-row').find('[u-link]').val());
    userData.set('doorsCardNumber', $(this).closest('.custom-table__body-row').find('[u-doorscardnumber]').val());
    userData.set('birthday', $(this).closest('.custom-table__body-row').find('[u-birthday]').val());
    userData.set('isHasKey', $(this).closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked'));
    userData.set('type', $(this).closest('.custom-table__body-row').find('[u-type-selector]').val());
    userData.set('isNotDisMiss', $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]').val());

    $('[edit-employee-accept]').prop("disabled", true);
    $.ajax({
        // type: "POST",
        // contentType: "application/json",
        // url: "update",
        // data: JSON.stringify(userData),
        // dataType: 'json',
        // cache: false,
        type: "POST",
        url: "update",
        data: userData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-name]').val(data.name).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-username]').val(data.username != null ? data.username : data.user.username).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-password]').val(data.password != null ? data.password : data.user.password).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-phone]').val(data.phone).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-link]').val(data.link).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-doorscardnumber]').val(data.doorsCardNumber).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-birthday]').val(data.birthday).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked', data.isHasKey).attr("disabled", true);

            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-wrapper]').addClass('disabled');
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-selector]').val(data.type).attr("disabled", true);
            if (typeof data.isNotDisMiss !== 'undefined') {
                EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-wrapper]').addClass('disabled');
                EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-selector]').val(data.isNotDisMiss.toString()).attr("disabled", true);

            }

            EMPLOYEE_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
            delete EMPLOYEE_INFO_TEMP[data.id];

            $('[edit-employee-accept]').prop("disabled", false);
        },
        error: function (data) {
            var values = EMPLOYEE_INFO_TEMP[userData.get('idEmployee')];

            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-name]').val(values.name).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-username]').val(values.username).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-password]').val(values.password).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-phone]').val(values.phone).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-link]').val(values.link).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-doorscardnumber]').val(values.doorsCardNumber).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-birthday]').val(values.birthday).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked', values.isHasKey).attr("disabled", true);

            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-wrapper]').addClass('disabled');
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-selector]').val(values.type).attr("disabled", true);
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-wrapper]').addClass('disabled');
            EMPLOYEE_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-selector]').val(values.dismiss).attr("disabled", true);

            EMPLOYEE_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');

            delete EMPLOYEE_INFO_TEMP[data.id];
            $('[edit-employee-accept]').prop("disabled", false);
        }
    });
});

/*! string-format-js - v0.1.6 - 2016-03-28 */!function(a,b){"use strict";var c=a.String;c.prototype.format||(c.prototype.format=function(){var a,c=this,d=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},e=function(){var a=function(a){var c=function(a){return new Array(a)};switch(!0){case/^#\{(\w+)\}*$/.test(a):this.formatter=function(a,b){var c=new RegExp("#{"+RegExp.$1+"}","g");return a.replace(c,b[RegExp.$1])};break;case/^([ds])$/.test(a):this.formatter=function(b,c){if("d"===RegExp.$1&&!d(c))throw new TypeError;return[b.substring(0,b.indexOf("%"+a)),c,b.substring(b.indexOf("%"+a)+a.length+1)].join("")};break;case/^(o)$/.test(a):this.formatter=function(b,c){if(!d(c))throw new TypeError;return b.replace("%"+a,parseInt(c).toString(8))};break;case/^(b)$/.test(a):this.formatter=function(b,c){if(!d(c))throw new TypeError;return b.replace("%"+a,parseInt(c).toString(2))};break;case/^([xX])$/.test(a):this.formatter=function(b,c){if(!d(c))throw new TypeError;var e=parseInt(c).toString(16);return"X"===a&&(e=e.toUpperCase()),b.replace("%"+a,e)};break;case/^(c)$/.test(a):this.formatter=function(b,c){if(!d(c))throw new TypeError;return b.replace("%"+a,String.fromCharCode(c))};break;case/^(u)$/.test(a):this.formatter=function(b,c){if(!d(c))throw new TypeError;return b.replace("%"+a,parseInt(c,10)>>>0)};break;case/^(-?)(\d*).?(\d?)(e)$/.test(a):this.formatter=function(e,f){if(!d(f))throw new TypeError;var g,h,i,j="-"===RegExp.$1,k=RegExp.$2,l=""!==RegExp.$3?RegExp.$3:b,m=f.toExponential(l);return""!==k&&(l!==b?(i=k-m.length,i>=0&&(m=j?m+c(i+1).join(" "):c(i+1).join(" ")+m)):(g=m.split("e")[0],h="e"+m.split("e")[1],i=k-(g.length+h.length),m=i>=0?g+c(i+1).join("0")+h:g.slice(0,i)+h)),e.replace("%"+a,m)};break;case/^(-?)(\d*).?(\d?)(f)$/.test(a):this.formatter=function(b,e){if(!d(e))throw new TypeError;var f,g,h="-"===RegExp.$1,i=RegExp.$2,j=RegExp.$3,k=".".length,l=e>0?Math.floor(e):Math.ceil(e),m=parseFloat(e).toFixed(""!==j?j:6);return""!==i&&(""!==j?(f=l.toString().length+k+parseInt(j,10),g=i-f,m=h?parseFloat(e).toFixed(j)+c(g+1).join(" "):c(g+1).join(" ")+parseFloat(e).toFixed(j)):m=parseFloat(e).toFixed(i-(l.toString().length+k))),b.replace("%"+a,m)};break;case/^([0\-]?)(\d+)d$/.test(a):this.formatter=function(b,e){if(!d(e))throw new TypeError;var f=RegExp.$2-e.toString().length,g="";switch(0>f&&(f=0),RegExp.$1){case"":g=(c(f+1).join(" ")+e).slice(-RegExp.$2);break;case"-":g=(e+c(f+1).join(" ")).slice(-RegExp.$2);break;case"0":g=(c(f+1).join("0")+e).slice(-RegExp.$2)}return b.replace("%"+a,g)};break;case/^(-?)(\d+)s$/.test(a):this.formatter=function(b,d){var e=RegExp.$2-d.toString().length,f="";switch(0>e&&(e=0),RegExp.$1){case"":f=(c(e+1).join(" ")+d).slice(-RegExp.$2);break;case"-":f=(d+c(e+1).join(" ")).slice(-RegExp.$2)}return[b.substring(0,b.indexOf("%"+a)),f,b.substring(b.indexOf("%"+a)+a.length+1)].join("")};break;case/^(-?\d*)\.(\d+)s$/.test(a):this.formatter=function(b,d){var e,f,g="";return""===RegExp.$1?g=d.slice(0,RegExp.$2):(d=d.slice(0,RegExp.$2),e=Math.abs(RegExp.$1),f=e-d.toString().length,g=-1!==RegExp.$1.indexOf("-")?(d+c(f+1).join(" ")).slice(-e):(c(f+1).join(" ")+d).slice(-e)),[b.substring(0,b.indexOf("%"+a)),g,b.substring(b.indexOf("%"+a)+a.length+1)].join("")};break;default:this.formatter=function(a,b){return a}}};return a.prototype={format:function(a,b){return this.formatter.call(this,a,b)}},a}(),f=Array.prototype.slice.call(arguments);if(1===f.length&&"object"==typeof f[0])for(a=0;a<Object.keys(f[0]).length;a+=1)c.match(/(#\{\w+\})/)&&(c=new e(RegExp.$1).format(c,f[0]));else for(a=0;a<f.length;a+=1)c.match(/%([.#0-9\-]*[bcdefosuxX])/)&&(c=new e(RegExp.$1).format(c,f[a]));return c})}("undefined"!=typeof global?global:window);
$(document).ready(function(){
    const $filterForm = $('[tr-filter-form]');
    const $filterFormBtn = $('[tr-filter-form-btn]');
    const $filter = $('[tr-filter]');
    const $filterOpenBtn = $('[tr-filter-btn]');
    const $filterCloseBtn = $('[tr-filter-close-btn]');

    $filterOpenBtn.on('click', function() {
        $('body').addClass('hiddenOverflow');
        $filter.addClass('is-open');
    });

    $filterCloseBtn.on('click', function() {
        $('body').removeClass('hiddenOverflow');
        $filter.removeClass('is-open');
        resetFilter(FILTER_FROM_BACK);
    });

    $filterFormBtn.on('click', function(event) {
        event.preventDefault();
        $filterForm.trigger('submit');
    });
});

//список фильтр
var FILTER_FROM_BACK;
function setFunnelFilter(filter) {
    FILTER_FROM_BACK = filter;
}

function resetFilter(filter) {
    $('#year option:selected').removeAttr('selected');
    $('#year').val(filter.year);

    $('#idManager option:selected').removeAttr('selected');
    $('#idManager').val(filter.idManager);

    $('#project option:selected').removeAttr('selected');
    $('#project').val(filter.project);

    $('#course option:selected').removeAttr('selected');
    $('#course').val(filter.course);

    $('#periodType option:selected').removeAttr('selected');
    $('#periodType').val(filter.periodType);

}

$(document).on('change', '[filter-parameter]', function() {
    $(this).closest('form').trigger('submit');
});




$(document).on('click', '[js-funnel-setting]', function() {
    $('[js-menu-funnel-setting]').addClass('is-open');
    checkBodyHidden();
});
$(document).on('click', '[js-menu-funnel-setting-close-btn]', function() {
    $('[js-menu-funnel-setting]').removeClass('is-open');
    checkBodyHidden();
});





function resetPlatform() {
    $('#platform option:selected').removeAttr('selected');
    $('#platform option:first').prop('selected', true);
}
function resetChannel() {
    $('#channel').html('<option value="all" selected>Все источники</option>');
}
function resetCommunity() {
    $('#community').val("Все аудитории");
    $('[js-communites]').val("Все аудитории");
}
function resetCommunityList() {
    $('[community-table]').html('<tr js-menu-purchase js-menu-purchase-all class="body__row body__row_small body__row_channel">' +
        '                                    <td class="body__cell body__cell_5p">' +
        '                                        <input js-menu-checker type="checkbox" id="Все аудитории" class="checkbox " name="communites" value="Все аудитории" checked/>' +
        '                                        <label class="checkbox-label" for="Все аудитории"></label>' +
        '                                    </td>' +
        '                                    <td class="body__cell body__cell_19p" js-menu-community>Все аудитории</td>' +
        '                                    <td class="body__cell body__cell_19p"></td>' +
        '                                </tr>' +
        '                                <tr js-menu-purchase class="body__row body__row_small body__row_channel">' +
        '                                    <td class="body__cell body__cell_5p">' +
        '                                        <input js-menu-checker type="checkbox" id="Неизвестно" class="checkbox " name="communites" value="unknown" checked/>' +
        '                                        <label class="checkbox-label" for="Неизвестно"></label>' +
        '                                    </td>' +
        '                                    <td class="body__cell body__cell_19p" js-menu-community>Неизвестно</td>' +
        '                                    <td class="body__cell body__cell_19p"></td>' +
        '                                </tr>');
}

$(document).on('change', '[js-advertiser]', function() {
    resetPlatform();
    resetChannel();
    resetCommunity();
});
$(document).on('change', '[js-project]', function() {
    resetPlatform();
    resetChannel();
    resetCommunity();
});
$(document).on('change', '[js-manager]', function() {
    resetPlatform();
    resetChannel();
    resetCommunity();
});
$(document).on('change', '[js-channel]', function() {
    if ($('#channel').val() !== 'all' && $('#channel').val() !== 'unknown') {
        $('#community').val("Выберите аудиторию");
    } else {
        resetCommunity();
    }
});
$(document).on('change', '[js-platform]', function() {
    if ($('option:selected', this).attr('value') === 'unknown') {
        $('#channel').html('<option value="unknown" selected>Неизвестно</option>');
        resetCommunity();
    } else {
        resetChannel();

        var formData = new FormData($('[funnel-filter-form]')[0]);
        setChannelByPlatform(formData);
    }

});
function setChannelByPlatform(formData) {
    $('[js-platform]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getChannels",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var currentOption = $('#channel').html();

            var seloption = "";
            $.each(data, function(index, value){
                seloption += '<option value="' + value + '">' + value + '</option>';
            });
            $('#channel').html(currentOption + seloption);

            $('[js-platform]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-platform]').prop("disabled", false);
        }
    });
}


$(document).on('click', '[js-community]', function() {
    resetCommunityList();
    if ($('#channel').val() !== 'all' && $('#channel').val() !== 'unknown') {
        var formData = new FormData($('[funnel-filter-form]')[0]);
        setCommunityByChannel(formData);
    }
});
function setCommunityByChannel(formData) {
    $('[js-community]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getCommunities",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var currentRows = $('[community-table]').html();

            var row = "";
            $.each(data, function(index, value){
                row += '<tr js-menu-purchase class="body__row body__row_small body__row_channel">' +
                    '                                    <td class="body__cell body__cell_5p">' +
                    '                                        <input js-menu-checker type="checkbox" id="' + value.name + '" class="checkbox" name="communites" value="' + value.name + '" checked/>' +
                    '                                        <label class="checkbox-label" for="' + value.name + '"></label>' +
                    '                                    </td>' +
                    '                                    <td class="body__cell body__cell_19p" js-menu-community >' + value.name + '</td>' +
                    '                                    <td class="body__cell body__cell_19p">' + value.link + '</td>' +
                    '                                </tr>';
            });
            $('[community-table]').html(currentRows + row);

            $('[js-menu]').addClass('is-open');
            checkBodyHidden();

            $('[js-community]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-community]').prop("disabled", false);
        }
    });
}
$(document).on('click', '[js-menu-close-btn]', function() {

    // var obj = $('[filter-form-communities]').serializeObject();

    var objs = [];
    $('[filter-form-communities]').find('tr:not(.none) [js-menu-checker]:checked').each(function () {
        objs.push($(this).val());
    });


    // var communites = obj['communites'];
    var communites = objs;

    if (jQuery.inArray("Все аудитории", communites) !== -1) {
        $('[js-communites]').val('Все аудитории');
    } else {
        $('[js-communites]').val(communites.toString());
    }

    showAll();
    $('[js-menu]').removeClass('is-open');
    checkBodyHidden();
});


$(document).on('keyup', '[js-menu-search]', function() {
    var $v = $(this).val().toLowerCase();

    $('[js-menu-purchase]').each(function () {
        if (!(~$(this).find('[js-menu-community]').text().toLowerCase().indexOf($v))) {
            $(this).addClass('none');
        } else {
            $(this).removeClass('none');
        }
    })
});


$(document).on('click', '[js-menu-purchase-all]', function() {
    let $attr = $(this).find('[js-menu-checker]').prop('checked');

    $('[js-menu-purchase]').each(function () {
        $(this).find('[js-menu-checker]').prop('checked', !$attr);
    })
});

$(document).on('click', '[js-menu-purchase]', function() {
    var $isAll = $(this).attr('js-menu-purchase-all');
    if (!(typeof $isAll !== typeof undefined && $isAll !== false)) {
        var $attr = $(this).find('[js-menu-checker]');
        $attr.prop('checked', !$attr.prop('checked'))
        $('[js-menu-purchase-all]').find('[js-menu-checker]').prop('checked', false)
        checkSelect();
        event.preventDefault();
    }
})

function checkSelect() {
    let $counter = $('[js-menu-purchase]').length - 1;
    var $s = 0;
    $('[js-menu-purchase]').each(function () {
        var $isAll = $(this).attr('js-menu-purchase-all');
        if (!(typeof $isAll !== typeof undefined && $isAll !== false)) {
            if ($(this).find('[js-menu-checker]').prop('checked')) {
                $s++;
            }
        }
    })

    if ($s == $counter) {
        $('[js-menu-purchase-all]').find('[js-menu-checker]').prop('checked', true);
    }
}

function showAll() {
    $('[js-menu-search]').val('');
    $('[js-menu-purchase]').each(function () {
        $(this).removeClass('none');
    })
}

$(document).on('click', '.datepicker-here', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).on('click', '.datepicker-here-deal', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).on('click', '.datepicker-here-cs', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).on('click', '.datepicker-here-pay', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});

//список способов оплаты
var $paymentMethodList;
function setPaymentMethodList(paymentMethodList) {
    $paymentMethodList = paymentMethodList;
}
//список статусов
var $statusesList;
function setStatusesList(statusesList) {
    $statusesList = statusesList;
}


//изменение чекера напоминания при редактировании сделки
$(document).on('click', '[js-update-open-reminder]', function(event) {
    $('[js-update-form-deal-reminder-btn]').removeClass('is-open');
    $('[js-update-form-deal-reminder-block]').addClass('is-open');
    $('[js-update-form-deal-reminder-date]').val('');
    $('[js-update-form-deal-reminder-msg]').val('');
    $('[js-update-form-deal-reminder]').prop("checked", true);
});
//изменение чекера напоминания при редактировании сделки закрытие
$(document).on('click', '[js-update-close-reminder]', function(event) {
    $('[js-update-form-deal-reminder-btn]').addClass('is-open');
    $('[js-update-form-deal-reminder-block]').removeClass('is-open');
    $('[js-update-form-deal-reminder-date]').val('—');
    $('[js-update-form-deal-reminder-msg]').val('');
    $('[js-update-form-deal-reminder]').prop("checked", false);
});
//в меню редактирования
$(document).on('change', '[js-update-form-deal-sale-type]', function(event) {
    if ($(this).val() === 'traffic') {
        $('[js-update-form-deal-mailing-block]').addClass('is-open');
    } else {
        $('[js-update-form-deal-mailing-block]').removeClass('is-open');
        $('[js-update-form-deal-mailing]').prop('checked', false);
    }
});
//в меню редактирования
$(document).on('change', '[js-update-form-deal-pr]', function(event) {
    $('[js-update-form-deal-price]').val($('option:selected', this).attr('data-price'));
    $('[js-update-form-deal-product-type]').val($('option:selected', this).attr('data-type'));

    $('[js-update-form-deal-product-id]').val($('option:selected', this).attr('data-id'));

    $list = createKindList($('option:selected', this).val());
    if ($list.length > 0) {
        $('[js-update-form-kind]').html(createKindOptions($list));
        $('[js-update-form-kind-block]').addClass('is-open');
    } else {
        $('[js-update-form-kind-block]').removeClass('is-open');
        $('[js-update-form-kind]').html('');
    }

    if ($('[u-product-types]').val() == 'курс' ) {
        setStreams($('[js-update-form-deal-start-date]'), $('option:selected', this).attr('data-id'));
    }
});

$(document).ready(function() {
    $('.datepicker-here-deal').datepicker({
        autoClose: true,
        maxDate: new Date(),
        todayButton: true
    });

    $('.datepicker-here').datepicker({
        autoClose: true,
        todayButton: true
    });

    const $menuClientCard = $('[js-menu-client-card]');
    const $menuClientCardCloseBtn = $('[js-menu-client-card-close-btn]');
    //закрытие карточки клиента
    $menuClientCardCloseBtn.on('click', function () {
        // $menuSearch.removeClass('is-open');
        $menuCreateClient.removeClass('is-open');
        $menuClientCard.removeClass('is-open');
        closeEdit();
        checkBodyHidden();
    });



    const $menuUpdateDeal = $('[js-menu-update-deal]');
    const $menuUpdateDealCloseBtn = $('[js-menu-update-deal-close-btn]');
    //закрытие редактирование сделки
    $menuUpdateDealCloseBtn.on('click', function() {
        $menuUpdateDeal.removeClass('is-open');
        checkBodyHidden()
    });


    const $menuUpdateReminderCloseBtn = $('[js-menu-update-reminder-close-btn]');
    const $menuUpdateReminder = $('[js-menu-update-reminder]');

    $menuUpdateReminderCloseBtn.on('click', function() {
        clearReminderForm();
        $menuUpdateReminder.removeClass('is-open');
        checkBodyHidden();
    });


    const $menuBillsCloseBtn = $('[js-menu-bills-close-btn]');
    const $menuBills = $('[js-menu-bills]');
    //закрытие меню счетов
    $menuBillsCloseBtn.on('click', function() {
        $menuBills.removeClass('is-open');
        checkBodyHidden();
        BILLS_TEMP_INFO = {};
    });

    const $menuCreateClientCloseBtn = $('[js-menu-create-client-close-btn]');
    const $menuCreateClient = $('[js-menu-create-client]');

    $menuCreateClientCloseBtn.on('click', function() {
        $('js-create-client-form').submit('reset');
        $menuCreateClient.removeClass('is-open');
        checkBodyHidden()
    });

    const $menuSearchCloseBtn = $('[js-menu-search-close-btn]');
    const $menuSearch = $('[js-menu-search]');

    $menuSearchCloseBtn.on('click', function() {
        $menuSearch.removeClass('is-open');
        checkBodyHidden()
    });

    const $menuCreateDealCloseBtn = $('[js-menu-create-deal-close-btn]');
    const $menuCreateDeal = $('[js-menu-create-deal]');

    $menuCreateDealCloseBtn.on('click', function() {
        $menuCreateDeal.removeClass('is-open');
        checkBodyHidden();
    });

    const $menuBillCloseBtn = $('[js-menu-bill-close-btn]');
    const $menuBill = $('[js-menu-bill]');

    $menuBillCloseBtn.on('click', function() {
        $menuBill.removeClass('is-open');
        $('[js-bill-form]').submit('reset');
        checkBodyHidden()
    });

    initDatePicker();
    initDatePickerPayDate();
});

$(document).on('click', '[close-dialog]', function(event) {
    $(this).closest('.dialog').removeClass('is-open');
});

$(document).on('click', '[js-edit-btn]', function(event) {
    $('[js-client-card-name]').removeAttr('disabled');
    $('[js-client-card-comment]').removeAttr('disabled');
    $('[js-client-card-link]').removeAttr('disabled');
    $('[js-client-card-phone]').removeAttr('disabled');
    $('[js-client-card-email]').removeAttr('disabled');
    $('[js-edit-footer]').addClass('is-open');
});

function closeEdit() {
    $('[js-client-card-name]').attr("disabled", true);
    $('[js-client-card-comment]').attr("disabled", true);
    $('[js-client-card-link]').attr("disabled", true);
    $('[js-client-card-phone]').attr("disabled", true);
    $('[js-client-card-email]').attr("disabled", true);
    $('[js-edit-footer]').removeClass('is-open');
}

$(document).on('change', '[js-form-status]', function(event) {
    var form = $(this).parent($('[js-status-form]'));
    form.removeClassWild("deal-status__form_*");
    form.addClass("deal-status__form_" + ($('option:selected', this).attr('data-code')));

    var data = form.serializeObject();

    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/updateDealStatus",
        data: JSON.stringify(data),
        dataType: 'json',
        cache: false,
        success: function (data) {
        },
        error: function (data) {
        }
    });

});

$(document).on('change', '[js-deal-form-status]', function(event){
    var form = $(this).parent($('[js-deal-status-form]'));
    form.removeClassWild("deal__select_*");
    var code = $('option:selected', this).attr('data-code');
    form.addClass("deal__select_" + code);

    var formData = form.serializeObject();
    formData['code'] = code;

    $('[js-deal-form-status]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/updateDealStatus",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealStatusOnList(formData);
            $('[js-deal-form-status]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-deal-form-status]').prop("disabled", false);
        }
    });
});

//обновление статуса сделки на фронте
function updateDealStatusOnList(value) {
    var dealRow = $('[data-deal="' + value.id + '"]');
    var select = dealRow.find('[js-form-status]');
    var form = select.parent($('form'));
    form.removeClassWild("deal-status__form_*").addClass("deal-status__form_" + value.code);
    $(select).find('option:selected').removeAttr('selected');
    $(select).val(value.status);
}

// //кнопка открытия карточки клиента
// $(document).on('click', '[js-client-card]', function(event){
//     var clientId = $(this).find('[js-client-id]').val();
//
//     $('[js-client-card]').prop("disabled", true);
//     $.ajax({
//         type: "POST",
//         contentType: "application/json",
//         url: "/api/clients/getClientInfo",
//         data: JSON.stringify(clientId),
//         dataType: 'json',
//         cache: false,
//         success: function (data) {
//             setClientCardInfo(data);
//             $('[js-client-card]').prop("disabled", false);
//         },
//         error : function (data) {
//             $('[js-client-card]').prop("disabled", false);
//         }
//     });
// });
//
// var $CLIENT;
// //заполение информации о клиенте в карточке клиента
// function setClientCardInfo(data) {
//     $('[js-client-card-name]').val(data.name);
//     $('[js-client-card-date]').text(data.createDate);
//     $('[js-client-card-manager]').text(data.manager);
//     $('[js-client-card-link]').val(data.link);
//     $('[js-client-card-phone]').val(data.phone);
//     $('[js-client-card-email]').val(data.email);
//     $('[js-client-card-comment]').val(data.comment);
//     $('[js-client-card-id]').val(data.id);
//
//     $('[js-client-name-copy]').text(data.name);
//     $('[js-client-name-copy]').attr('data-link', data.name);
//     setIdClient(data.id);
//     //обновление карточек сделок
//     updateDealCard($CLIENT);
//
//     $('[js-menu-client-card]').addClass('is-open');
//     checkBodyHidden()
//
// }
//
// function setIdClient(id) {
//     $('[js-deal-form-client]').val(id);
//     $CLIENT = id;
// }

//обновление карточек сделок
function updateDealCard(idClient) {
    if (typeof idClient !== "undefined") {
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/api/deals/getDealsByProjects",
            data: JSON.stringify(idClient),
            dataType: 'json',
            cache: false,
            success: function (data) {
                var $dealList = $('[js-deals-list]');
                $dealList.html('');
                $.each(data, function(index, value) {
                    // установка значения в списке
                    updateDealPriceOnList(value);

                    // установка значения в в меню
                    var seloption = "";
                    $.each($statusesList, function(index, value2){
                        seloption += '<option js-deal-form-status value="'+ value2.id +'" data-code="'+
                            value2.code + '" ' + (value2.id === value.status ? 'selected="selected" ': '') +'">' + value2.title + '</option>';
                    });

                    var reminder = "";
                    if (value.reminder) {
                        reminder += '<div class="menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-violet">' +
                            '<div class="deal__comment" title="' + value.reminderMessage + '">' + value.reminderMessage + '</div></div>';
                    } else {
                        reminder += '<div class="menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-empty">' +
                            '<div class="deal__comment">Нет напоминаний</div></div>';
                    }

                    var response = $("<div/>").attr("class", "deal deal_told deal_white")
                        .append($("<div/>").attr("class", "deal-wrapper")
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_bordered deal__wrapper_column")
                                .append($("<div/>").attr("class", "deal__title").html(value.status === 1 ? 'Целевая заявка' : value.course))
                                .append($("<div/>").attr("class", "deal__subtitle")
                                    .append($("<div/>").attr("class", value.kind !== null ? "deal__kind deal__kind_del" : "deal__kind").html(value.kind))
                                    .append($("<div/>").attr("class", "deal__date").html(value.createDate)))
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_overflow deal__wrapper_bordered c-tooltip").attr('js-deal-id', value.id)
                                .append($("<div/>").attr("class", "c-tooltip__wrapper")
                                    .append($("<div/>").attr("class", "c-tooltip__text").html(value.managerAccessName)))
                                .append($("<div/>").attr("class", "deal__social")
                                    .append($("<div/>").attr("class", "deal-social deal-social_" + value.socialCode)))
                                .append($("<div/>").attr("class", "deal__manager").html(value.managerName))
                                .append($("<div/>").attr("class", "deal__sale-type").html(value.type))
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_between deal__wrapper_bordered ")
                                .append($("<div/>").attr("class", "deal__sum")
                                    .append($("<div/>").attr("class", "deal__sum-title").html("Стоимость"))
                                    .append($("<div/>").attr("class", "deal__sum-value").html(value.price))
                                )
                                .append($("<div/>").attr("class", "deal__sum")
                                    .append($("<div/>").attr("class", "deal__sum-title").html("Получено"))
                                    .append($("<div/>").attr("class", "deal__sum-value deal__sum-value_blue").html(value.paid))
                                )
                                .append((value.isEditable && value.status !== 1) ?
                                    $("<div/>").attr("class", "deal_bill")
                                        .append($("<form/>").attr("js-add-bill-form", "").attr("action", "#").attr("class", value.isHidden ? "hidden-deal" : "")
                                            .append($("<input/>").attr("type", "hidden").attr("name", "id").val(value.id))
                                            .append($("<button/>").attr("js-add-bill-button", "").attr("class", "add-btn"))
                                        ) : ''
                                )
                            )
                            .append((value.status !== 1) ? $("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                                .append($("<form/>").attr("js-deal-status-form","").attr("class", "deal__select deal__select_" + value.statusCode)
                                    .append($("<input/>").attr("name", "id").attr("type", "hidden").val(value.id))
                                    .append($("<select/>").attr("class","deal-select menu-input__input_select").attr("name","status").attr("js-deal-form-status","").html(seloption))
                                ) :
                                $("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                                .append($("<div/>").attr("class", "deal__select deal__select_" + value.statusCode)
                                    .append($("<div/>").attr("class","deal-select menu-input__input_select").html(value.statusName))
                                )
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                                    .append($("<div/>").attr("class", "deal__reminder")
                                        .append($("<div/>").attr("class", (value.reminder) ?
                                            (value.reminderExpiration) ? "deal__reminder-title deal-reminder deal-reminder_red " :
                                                (value.reminderToday) ? "deal__reminder-title deal-reminder deal-reminder_green " : "deal__reminder-title deal-reminder deal-reminder_gray " : "deal__reminder-title deal__reminder-title_left")
                                            .html((value.reminder) ? value.reminderDate : "Нет напоминания"))
                                        .append((value.status !== 1) ?  $("<div/>").attr("class", "add-reminder")
                                            .append($("<form/>").attr("js-add-reminder-form", "").attr("action", "#")
                                                .append($("<input/>").attr("type", "hidden").attr("name", "idDeal").val(value.id))
                                                .append($("<button/>").attr("js-add-reminder-button", "").attr("class", "add-btn"))
                                            ) : ''
                                        )
                                    )
                                // .append(reminder)
                            )
                            // .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                            //     .append($("<div/>").attr("class", "deal__reminder")
                            //         .append($("<div/>").attr("class", "deal__reminder-title").html('Напоминание'))
                            //         .append($("<div/>").attr("class", "deal__reminder-date").html(value.reminderDate))
                            //     )
                            //     .append(reminder)
                            // )
                            // .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                            //     .append($("<div/>").attr("class", "menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-small")
                            //         .append($("<div/>").attr("class", "deal__comment").attr("title", value.comment).html(value.comment))
                            //     )
                            // )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column")
                                .append($("<form/>").attr("class", "button_full").attr("action", "#").attr("js-update-deal-form", "")
                                    .append($("<input/>").attr("name", "id").attr("type", "hidden").val(value.id))
                                    .append($("<button/>").attr("type", "button").attr("class", "button button_white button_full").attr("js-update-deal-btn", "").html("Редактировать сделку"))
                                )

                                .append(
                                    (value.isHidden)
                                        ?
                                        $("<form/>").attr("class", "button_full").attr("action", "#").attr("js-reveal-deal-form", "")
                                            .append($("<input/>").attr("data-hide-deal", value.id).attr("name", "id").attr("type", "hidden").val(value.id))
                                            .append(
                                                $("<button/>").attr("type", "button").attr("class", "button button_red button_full").attr("js-reveal-deal-btn", "")
                                                    .append($("<span/>").attr("class", "hidden-btn hidden-btn_left hidden-btn_reveal").html("Восстановить сделку"))
                                            )
                                        :
                                        $("<form/>").attr("class", "button_full").attr("action", "#").attr("js-hide-deal-form", "")
                                            .append($("<input/>").attr("data-hide-deal", value.id).attr("name", "id").attr("type", "hidden").val(value.id))
                                            .append($("<button/>").attr("type", "button").attr("class", "button button_red button_full").attr("js-hide-deal-btn", "")
                                                .append($("<span/>").attr("class", "hidden-btn hidden-btn_left hidden-btn_hide").html("Скрыть сделку")))
                                )
                            )
                        );
                    $dealList.append(response);
                    loadModules(idClient, value.id);
                });

                var $createDealBlock = $("<div/>").attr("js-create-deal", "").attr("class", "deal deal_told deal_create")
                    .append($("<div/>").attr("class", "deal__btm-message").html('Добавить сделку'));

                $dealList.append($createDealBlock);
            }
        });
    }
}

function loadModules(idClient, idDeal){
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/getDealsModulesInfo",
        data: JSON.stringify(idDeal),
        dataType: 'json',
        cache: false,
        success: function (data) {
            if (data.modules.length > 0){
                $modulesRoot = $("<div/>").attr("class", "deal__access-lessons ");
                $lessons = $("<div/>").attr("class", "deal__lessons");
                $.each(data.modules, function(index, value) {
                    $lessons.append($("<div/>").attr('js-module', value.idModule).attr('js-module-deal', idDeal).attr('js-module-client', idClient).attr('js-allowed', data.allowed).attr("class", "deal__lessons-item " + (value.enabled ? 'deal__lessons-item_active' : '')).html(value.number));
                });
                $access = $("<div/>").attr("class", "deal__access")
                    .append($("<div/>").attr("class", "deal__access-text")).html('Доступ к продукту')
                    .append($("<div/>").attr("class", "deal__access-btn slide-toggle " + (data.allowed ? 'slide-toggle_active' : '')).attr("js-id-deal-toggle", idDeal)
                        .append($("<div/>").attr("class", "slide-toggle__thumb")));
                $modulesRoot.append($access);
                $modulesRoot.append($lessons);

                $modulesRoot.insertAfter($('[js-deal-id='+idDeal+']'));
                $(".slide-toggle[js-id-deal-toggle="+idDeal+"]").click(function (event) {
                    var toggle = $(this);
                    var idDeal = toggle.attr('js-id-deal-toggle');
                    var allowed = toggle.hasClass('slide-toggle_active');
                    if (allowed){
                        toggle.removeClass('slide-toggle_active');
                    }else{
                        toggle.addClass('slide-toggle_active');
                    }
                    changeAllowed(idDeal, idClient, !allowed);
                });
                $('.deal__lessons-item[js-module-deal='+idDeal+']').click(function (event){
                    var $this = $(this);
                    var idModule = $this.attr('js-module');
                    var idDeal = $this.attr('js-module-deal');
                    var allowed = $(".slide-toggle[js-id-deal-toggle="+idDeal+"]").hasClass('slide-toggle_active');
                    var idClient = $this.attr('js-module-client');
                    var enabled = $this.hasClass('deal__lessons-item_active');
                    if (allowed){
                        if (enabled){
                            $this.removeClass('deal__lessons-item_active');
                        }else{
                            $this.addClass('deal__lessons-item_active');
                        }
                        changeEnabledModule(idClient, idDeal, idModule, !enabled);
                    }
                });
            }
        }
    });
}

function changeAllowed(idDeal, idClient, allowed){
    console.log('Change allowed', idDeal, idClient, allowed);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/changeModulesAllowed",
        data: JSON.stringify({id: idDeal, idClient: idClient, value: allowed}),
        dataType: 'json',
        cache: false,
        success: function (data) {
            console.log(data);
        }
    });
}

function changeEnabledModule(idClient, idDeal, idModule, enabled){
    console.log('Change enabled', idClient, idDeal, idModule, enabled);

    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/changeModulesEnabled",
        data: JSON.stringify({idDeal: idDeal, idModule: idModule, idClient: idClient, value: enabled}),
        dataType: 'json',
        cache: false,
        success: function (data) {
            console.log(data);
        }
    });
}
// //обновление цены/получено по сделке на фронте
// function updateDealPriceOnList(value) {
//     var dealRow = $('[data-deal="' + value.id + '"]');
//
//     var colPaid = dealRow.find('.column-paid');
//     colPaid.removeClassWild('column-paid_*');
//     if (value.price <= value.paid) {
//         colPaid.addClass('column-paid_green');
//     }
//
//     dealRow.find('[data-deal-price]').html(value.price);
//     dealRow.find('[data-deal-paid]').html(value.paid + ' ₽');
// }

//кнопка редактирования клиента
$(document).on('click', '[js-edit-client-btn]', function(event) {
    event.preventDefault();
    $(this).closest('[js-edit-client-form]').trigger('submit');
});
//form'a редактирование клиента
$(document).on('submit', '[js-edit-client-form]', function(event) {
    event.preventDefault();
    updateClient($(this).serializeObject());
});
function updateClient(formData) {
    $('[js-update-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/clients/updateClient",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            closeEdit();
            updateClientNameOnFront(data);
            updateClientLinkOnFront(data);
            updateClientPhoneOnFront(data);
            updateClientNameOnList(data);
            $('[js-update-deal]').prop("disabled", false);
            $('[js-client-name-copy]').text(data.name);
            $('[js-client-name-copy]').attr('data-link', data.name);
        },
        error: function (data) {
            $('[js-update-deal]').prop("disabled", false);
        }
    });
}
function updateClientNameOnFront(value) {
    var clientRow = $('[data-client="' + value.id + '"]');
    clientRow.siblings('span').html(value.name);
}
function updateClientLinkOnFront(value) {
    var clientCell = $('[data-link-client="' + value.id + '"]');
    if (value.link === null || value.link === '') {
        clientCell.html('<div>—</div>');
    } else {
        clientCell.html('<div class="column-links">' +
            '<div js-copy-link class="column_mwidth column_mwidth-copy" data-link="' + value.link + '"></div>' +
            '<a href="' + value.link + '" target="_blank" class="column_mwidth column_mwidth-open"></a>' +
            '</div>');
    }
}
function updateClientPhoneOnFront(value) {
    var clientCell = $('[data-phone-client="' + value.id + '"]');
    if (value.phone === null || value.phone === '') {
        clientCell.html('<div>—</div>');
    } else {
        clientCell.html('<div js-copy-link class="client-phone" data-link="' + value.phone + '">' + value.phone + '</div>');
    }
}

function updateClientNameOnList(value) {
    var clientCard = $('[value="' + value.id + '"].js-client-id-l');
    var card = clientCard.closest('[js-client-card]');
    card.find('.client-card__title').html(value.name);
    card.find('.client-card__info-link').html(value.link);
    card.find('.client-card__info-phone').html(value.phone);
}
//скрыть сделку
var HIDE_DEAL_FORM;
$(document).on('click', '[js-hide-deal-btn]', function(event) {
    event.preventDefault();
    $('[dialog]').find('.dialog__title').html('Вы действительно хотите скрыть сделку?');
    $('[dialog]').find('.dialog__text').html('В данном случае информация о сделке не будет учитываться');
    $('[dialog]').find('[accept-dialog]').attr('hide-deal', '');
    $('[dialog]').addClass('is-open');
    HIDE_DEAL_FORM =  $(this).closest('[js-hide-deal-form]');
});

$(document).on('click', '[hide-deal]', function(event) {
    event.preventDefault();
    $('[dialog]').removeClass('is-open');
    HIDE_DEAL_FORM.trigger('submit');
});

$(document).on('submit', '[js-hide-deal-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        hideDeal(formData);
    }
});
function hideDeal(formData) {
    $('[js-hide-deal-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/hideDeal",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-hide-deal-btn]').prop("disabled", false);
            updateHideForm(formData.id, true);
        },
        error: function (data) {
            $('[js-hide-deal-btn]').prop("disabled", false);
        }
    });
}
//раскрыть сделку
$(document).on('click', '[js-reveal-deal-btn]', function(event) {
    event.preventDefault();
    $(this).closest('[js-reveal-deal-form]').trigger('submit');
});

$(document).on('submit', '[js-reveal-deal-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        revealDeal(formData);
    }
});
function revealDeal(formData) {
    $('[js-reveal-deal-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/revealDeal",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-reveal-deal-btn]').prop("disabled", false);
            updateHideForm(formData.id, false);
        },
        error: function (data) {
            $('[js-reveal-deal-btn]').prop("disabled", false);
        }
    });
}
function updateHideForm(idDeal, isHide) {
    var el = $('[data-hide-deal="' + idDeal + '"]');
    var form = el.closest('form');

    var billForm = $('[js-add-bill-form]').find('input[name="id"][value="' + idDeal + '"]').closest('[js-add-bill-form]');
    if (isHide) {
        form.removeAttr("js-hide-deal-form").attr("js-reveal-deal-form",'');
        var btn = form.find('[js-hide-deal-btn]');
        btn.removeAttr("js-hide-deal-btn").attr("js-reveal-deal-btn",'');
        btn.find('.hidden-btn_hide').removeClass('hidden-btn_hide').addClass('hidden-btn_reveal');
        btn.find('span').html('Восстановить сделку');

        billForm.addClass("hidden-deal");
    } else {
        form.removeAttr("js-reveal-deal-form").attr("js-hide-deal-form",'');
        var btn = form.find('[js-reveal-deal-btn]');
        btn.removeAttr("js-reveal-deal-btn").attr("js-hide-deal-btn",'');
        btn.find('.hidden-btn_reveal').removeClass('hidden-btn_reveal').addClass('hidden-btn_hide');
        btn.find('span').html('Скрыть сделку');

        billForm.removeClass("hidden-deal");
    }
}

$(document).on('click', '[js-update-deal-btn]', function(event) {
    event.preventDefault();
    $(this).closest('[js-update-deal-form]').trigger('submit');
});

$(document).on('submit', '[js-update-deal-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        setDealInfo(formData);
    }
});

function setDealInfo(data) {
    $('[js-update-deal-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/getDeal",
        data: JSON.stringify(data),
        dataType: 'json',
        cache: false,
        success: function (data) {
            setUpdateDealInfo(data);
            $('[js-update-deal-btn]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-deal-btn]').prop("disabled", false);
        }
    });
}

function setUpdateStreams(idCourse){
    var formData = new FormData();
    formData.set('idCourse', Number(idCourse));

    $.ajax({
        type: "POST",
        url: "/head-manager-transactions/getStreamsByIdCourse",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var seloption = '';
            $.each(data, function(index, stream){
                seloption += '<option value="' + stream.id + '">' + stream.startDate + '</option>';
            });

            $('[js-update-form-deal-start-date]').append(seloption);
        },
        error: function (data) {
        }
    });
}


$(document).on('click', '[js-update-deal]', function(event) {
    event.preventDefault();
    $('[js-update-form-deal]').trigger('submit');
});

$(document).on('submit', '[js-update-form-deal]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        updateDeal(formData);
    }
});

function updateDeal(formData) {
    $('[js-update-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/updateDeal",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard(data.idClient);
            $('[js-menu-update-deal]').removeClass('is-open');
            checkBodyHidden()
            updateDealAfterUpdateOnList(data);
            $('[js-update-deal]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-deal]').prop("disabled", false);
        }
    });
}

function updateDealAfterUpdateOnList(value) {
    var dealRow = $('[data-deal="' + value.id + '"]');
    dealRow.find('[data-deal-date-deal]').html(value.dealDate);

    dealRow.find('[data-deal-social]').removeClassWild("deal-social_*").addClass("deal-social_" + value.socialCode).addClass("deal-social_big");

    var course = value.course != null ? (value.course + (value.kind !== null && value.kind !== '' ? ' (' + value.kind + ')' : '')) : 'Целевая заявка' ;
    dealRow.find('[data-deal-course]').attr('title', course).html(course);
    dealRow.find('[data-deal-type]').html(value.type);
    dealRow.find('[data-deal-price]').html(value.price);

    var colPaid = dealRow.find('.column-paid');
    colPaid.removeClassWild('column-paid_*');
    if (value.price <= dealRow.find('[data-deal-paid]').html().replace(/\D+/g,"")) {
        colPaid.addClass('column-paid_green');
    }

    dealRow.find('[data-deal-start-date]').html(value.startDate);
    if (value.tag === null) {
        dealRow.find('[data-deal-tag]').html('<div>—</div>');
    } else {
        dealRow.find('[data-deal-tag]').html('<div title="' + value.tag + '" class="column-msg">' + value.tag + '</div>');
    }
    dealRow.find('[data-deal-mailing]').html(value.coupling);

    var select = dealRow.find('[js-form-status]');
    var form = select.parent($('form'));
    form.removeClassWild("deal-status__form_*").addClass("deal-status__form_" + value.statusCode);
    select.on('change', function (event) {
        event.preventDefault();
    });
    $("#" + $(select).attr('id') + " option:selected").removeAttr('selected');
    $("#" + $(select).attr('id')).val(value.status);

    var reminder = '';
    if (value.reminder) {
        reminder += '<div class="reminder-wrapper">' +
            '<div class="reminder-date" >' + value.reminderDate + '</div>' +
            '<div class="reminder-msg">' + value.reminderMessage + '</div>' +
            '</div>';
    }
    reminder += '<div class="reminder ' + (value.reminder ? (value.reminderExpiration ? 'reminder_red' : (value.reminderToday ? 'reminder_green' : 'reminder_gray')) : '') + '"></div>';
    if (value.reminder) {
        reminder += '<div class="reminder-d">' + value.reminderDate + '</div>';
    }

    dealRow.find('[data-deal-reminder]').html(reminder);

}

var IS_HIDDEN_DEAL;
$(document).on('submit', '[js-add-bill-form]', function(event) {
    event.preventDefault();
    IS_HIDDEN_DEAL = $(this).hasClass("hidden-deal");
    openBillsRedirect($(this).serializeObject(), IS_HIDDEN_DEAL);
});
function openBillsRedirect(data, isHidden) {
    if (isHidden) {
        openBills(data, "/api/bills/getHeadManagerHiddenBills");
    } else {
        openBills(data, "/api/bills/getHeadManagerBills");
    }
}
function openBills(formData, queryLink) {
    $('[js-add-bill-form]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: queryLink,
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-bills-deal-id]').val(formData.id);
            createBills(data);
            $('[js-menu-bills]').addClass('is-open');
            checkBodyHidden()
            $('[js-add-bill-form]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-bill-form]').prop("disabled", false);
        }
    });
}

function createBills(billList) {
    $('[js-bills-body]').html('');

    if (billList.length > 0) {
        $('[js-bills]').addClass('is-open');
    } else {
        $('[js-bills]').removeClass('is-open');
    }
    checkBodyHidden()
    $.each(billList, function(index, value) {
        var response = "";
        response += '<div class="div-table__body-row">';

        // установка значения в в меню
        var seloption = "";
        $.each($paymentMethodList, function(index, value2){
            seloption += '<option value="'+ value2.title +'" data-code="' + value2.code + '">' + value2.title + '</option>';
        });

        //если статус 1 проверено, то зеленая иначе можно редактировать
        if (value.status === 2) {
            response += '<div class="div-table__body-col div-table__body-col_exxsmall div-table__body-col_center">' +
                '<div class="column_bstatus column_bstatus_checked"></div>' +
                '</div>';
        } else {
            response += '<div class="div-table__body-col div-table__body-col_exxsmall div-table__body-col_center">' +
                '<div class="column_bstatus column_bstatus_unchecked"></div>' +
                '</div>';
        }

        response += '<div class="div-table__body-col div-table__body-col_medium">' +
            '<div class="column-text">' + value.manager + '</div>' +
            '</div>';

        response += '<form b-update-bill-form action="#" class="edit-form-bill">' +
            '<input type="hidden" b-id-bill value="' + value.id + '" name="id" required>' +
            '<input type="hidden" value="' + value.idDeal + '" name="idDeal" required>' +
            '<input type="hidden" b-pm value="' + value.paymentMethod + '" name="paymentMethod">' +
            '<input type="hidden" b-pm-code value="' + value.paymentMethodCode + '" name="paymentMethodCode">' +
            '<div class="div-table__body-col div-table__body-col_small">' + value.billDate + '</div>';

        // add сумму
        response += '<div class="div-table__body-col div-table__body-col_center div-table__body-col_xsmall">' +
            '<input b-sum disabled name="sum" class="menu-input__input menu-input__input_small editable" value="'+ value.sum +'" placeholder="0 ₽">' +
            '</div>';

        response += '<div class="div-table__body-col div-table__body-col_xxsmall">' +
            '<div b-pm-wrapper class="pmethod-wrapper disabled">' +
            '<select b-pm-selector disabled class="column_pmethod-select column_pmethod_' + value.paymentMethodCode + '">' +
            seloption +
            '</select>' +
            '</div>' +
            '</div>';

        // add номер счета
        response +=   '<div class="div-table__body-col div-table__body-col_medium  div-table__body-col_center div-table__body-col_r10">' +
            '<input b-account-number disabled name="accountNumber" class="menu-input__input menu-input__input_small editable" value="'+ (value.accountNumber === null ? '' : value.accountNumber) +'" placeholder="—">' +
            '</div>';

        response += '<div class="div-table__body-col col-pay-date div-table__body-col_center div-table__body-col_medium ">' +
            '<div class="menu-input__wrapper menu-input__wrapper_xsmall">' +
            '<input b-pay-date disabled name="payDate" ' +
            'class="datepicker-here-cs menu-input__input menu-input__input_small editable" autocomplete="off" value="' + (value.payDate === null ? '' : value.payDate) + '" data-autoclose="true" placeholder="—"/>' +
            '</div></div>';

        // add оплачен/выставлен
        if (value.payDate === null) {
            response += '<div class="div-table__body-col div-table__body-col_small col-status">Выставлен</div>';
        } else {
            response += '<div class="div-table__body-col div-table__body-col_small col-status div-table__body-col_green">Оплачен</div>';
        }

        // add тип оплаты
        response += '<div class="div-table__body-col div-table__body-col_small">' + (value.paymentType === 'Новый клиент' ? 'Первый' : 'Доплата') + '</div>';

        // add ссылка
        if (value.link !== null && value.link !== '') {
            response += '<div class="div-table__body-col div-table__body-col_xxsmall div-table__body-col_center">' +
                '<div class="column-links"><div js-copy-link data-link="' + value.link + '" class="column_mwidth column_mwidth-copy"></div>' +
                '<a js-open-link href="' + value.link + '" target="_blank" class="column_mwidth column_mwidth-open"></a></div></div>';
        } else {
            response += '<div class="div-table__body-col div-table__body-col_xxsmall">' +
                '<div>—</div></div>';
        }
        response += '</form>';

        // add коммент
        response += '<div data-bill-id="' + value.id + '" class="div-table__body-col div-table__body-col_medium div-table__body-col_center">' +
            '<div class="column-links">' +
            ((value.comment === null)
                ? '<div js-add-sms-check js-check-btn class="column_mwidth column_mwidth-large column_mwidth_bordered div-table__body-col_center column_mwidth-add-check"></div>'
                : '<div js-delete-sms-check js-check-btn title="' + value.comment + '" class="column_mwidth column_mwidth-large column_mwidth_bordered div-table__body-col_center column_mwidth-delete-check"></div>') +
            ((value.billImage !== null && value.billImage !== '')
                ? '<a class="column-img column_mwidth column-img_large div-table__body-col_center" data-fancybox="gallery" href="../' + value.billImage + '">' +
                '<img src="/' + value.billImage + '">' +
                '</a>'
                : '<form js-upload-bill-form action="#" class="column_mwidth column_mwidth-large div-table__body-col_center div-table__body-col_fl" enctype="multipart/form-data">' +
                '<input type="hidden" value="' + value.id + '" name="id" required>' +
                '<input type="hidden" value="' + value.isHidden + '" name="isHidden" required>' +
                '<input type="hidden" value="' + value.idDeal + '" name="idDeal" required>' +
                '<input js-upload-bill accept="image/*,image/jpeg" class="input-file" name="file" type="file" id="file' + index + '"/>' +
                '<label for="file' + index + '" class="js-labelFile">' +
                '<span class="js-upload-file js-upload-file_small"></span>' +
                '</label>' +
                '</form>') +
            '</div>' +
            '</div>';

        response += '<div class="div-table__body-col div-table__body-col_center div-table__body-col_xxsmall">';

        if(value.isEditable) {
            response +=  '<div js-edit-btns class="column-links display-flex-none">' +
                '<div js-edit-bill-accept class="column_mwidth column_mwidth-accept"></div>' +
                '<div js-edit-bill-cancel class="column_mwidth column_mwidth-cancel"></div>' +
                '</div>' +
                '<div js-edit-menu class="column-links display-flex-none is-open">' +
                '<div js-edit-bill class="column_mwidth div-table__body-col_center column_mwidth-edit"></div>' +
                '<form js-delete-bill-form class="column-form" action="#">' +
                '<input type="hidden" value="' + value.id + '" name="id" required>' +
                '<button js-delete-bill type="button" class="column_mwidth column_mwidth-delete"></button>' +
                '</form>' +
                '</div>';
        }

        response += '</div>'+
            '</div>';

        $('[js-bills-body]').html($('[js-bills-body]').html() + response);
    });

    initDatePicker();
    initFancy();

    initEditBillForm();
    initCancelEditBill();
    initAcceptEditBill();
}
function initDatePickerPayDate() {
    $('.datepicker-here-pay').datepicker({
        autoClose: true,
        maxDate: new Date(),
        todayButton: true
    });
}
function initDatePicker() {
    $('.datepicker-here-cs').datepicker({
        autoClose: true,
        maxDate: new Date(),
        todayButton: true
    });
}
function initFancy() {
    $('[data-fancybox="gallery"]').fancybox({
        infobar: false,
        buttons: [
            "close"
        ],
    });
}
$(document).on('click', '[js-add-bill-up-client]', function(event) {
    var clientId = $(this).closest('.custom-table__body-row').find('[js-client-id]').val();
    var clientName = $(this).closest('.custom-table__body-row').find('[js-client-id]').siblings('span').html();

    setIdClient(clientId);

    $('[js-client-name-copy]').text(clientName);
    $('[js-client-name-copy]').attr('data-link', clientName);
});
$(document).on('change', '[js-upload-bill]', function(event) {
    var form = $(this).closest('[js-upload-bill-form]')
    var data = new FormData(form[0]);
    $('[js-upload-bill]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "/api/bills/uploadBill",
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 300000,
        success: function (data) {
            updateBillImageOnList(data);

            var formData = form.serializeObject();
            formData['id'] = formData.idDeal;

            if (data.isHidden) {
                openBills(formData, "/api/bills/getHiddenBills");
            } else {
                openBills(formData, "/api/bills/getBills");
            }

            $('[js-upload-bill]').prop("disabled", false);
        },
        error: function (e) {
            console.log("ERROR : ", e);
            $('[js-upload-bill]').prop("disabled", false);
        }
    });
});
$(document).on('change', '[js-upload-bill-front]', function(event) {
    var form = $(this).closest('[js-upload-bill-form]');
    var data = new FormData(form[0]);
    $('[js-upload-bill-front]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "/api/bills/uploadBill",
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 300000,
        success: function (data) {
            updateBillImageOnList(data);
            $('[js-upload-bill-front]').prop("disabled", false);
        },
        error: function (e) {
            console.log("ERROR : ", e);
            $('[js-upload-bill-front]').prop("disabled", false);
        }
    });
});
function updateBillImageOnList(billData) {
    var imageBillForm = $('[js-upload-bill-form][bill-image="' + billData.id + '"]');
    imageBillForm.replaceWith('<a class="column-img column-img_mr5" data-fancybox="gallery' + billData.id + '" href="/' + billData.billImage + '">' +
        '  <img src="/' + billData.billImage + '"></a>');
}

//активация редактирования формы
var BILLS_INFO_TEMP = {};

$(document).on('click', '[edit-bill]', function(event) {
    event.preventDefault();
    $(this).closest('[edit-menu]').removeClass('is-open').siblings('[edit-btns]').addClass('is-open');
    var list = {};
    var pd = $(this).closest('.custom-table__body-row').find('[b-pay-date]');
    pd.removeAttr('disabled');
    list['payDate'] = pd.val();

    var s = $(this).closest('.custom-table__body-row').find('[b-sum]');
    list['sum'] = s.val();
    s.val(s.val().replace(' ₽','')).removeAttr('disabled');

    $(this).closest('.custom-table__body-row').find('[b-pm-wrapper]').removeClass('disabled');
    $(this).closest('.custom-table__body-row').find('[b-pm-selector]').removeAttr('disabled');
    var pm = $(this).closest('.custom-table__body-row').find('[b-pm]');
    list['paymentMethod'] = pm.val();
    var pmCode = $(this).closest('.custom-table__body-row').find('[b-pm-code]');
    list['paymentMethodCode'] = pmCode.val();

    var an = $(this).closest('.custom-table__body-row').find('[b-account-number]');
    an.removeAttr('disabled');
    list['accountNumber'] = an.val();

    BILLS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[b-id-bill]').val()] = list;
});

$(document).on('click', '[edit-bill-cancel]', function(event) {
    event.preventDefault();
    var values = BILLS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[b-id-bill]').val()];

    $(this).closest('.custom-table__body-row').find('[b-pay-date]').val(values.payDate).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[b-sum]').val(values.sum).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[b-account-number]').val(values.accountNumber).attr("disabled", true);

    $(this).closest('.custom-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
    $(this).closest('.custom-table__body-row').find('[b-pm-selector]')
        .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + values.paymentMethodCode).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[b-pm]').val(values.paymentMethod);
    $(this).closest('.custom-table__body-row').find('[b-pm-code]').val(values.paymentMethodCode);

    $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
    delete BILLS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[b-id-bill]').val()];
});

var ACCEPT_EDITE_BTN;
$(document).on('click', '[edit-bill-accept]', function(event) {
    event.preventDefault();
    ACCEPT_EDITE_BTN = $(this);

    var billData = new Object();
    billData.id = $(this).closest('.custom-table__body-row').find('[b-id-bill]').val();
    billData.idDeal = $(this).closest('.custom-table__body-row').find('[b-id-deal]').val();
    billData.paymentMethod = $(this).closest('.custom-table__body-row').find('[b-pm]').val();
    billData.paymentMethodCode = $(this).closest('.custom-table__body-row').find('[b-pm-code]').val();
    billData.sum = $(this).closest('.custom-table__body-row').find('[b-sum]').val();
    billData.accountNumber = $(this).closest('.custom-table__body-row').find('[b-account-number]').val();
    billData.payDate = $(this).closest('.custom-table__body-row').find('[b-pay-date]').val();

    $('[edit-bill-accept]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/bills/updateBill",
        data: JSON.stringify(billData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pay-date]').val(data.payDate).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-sum]').val(data.sum + ' ₽').attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-account-number]').val(data.accountNumber).attr("disabled", true);

            if(data.payDate === null || data.payDate === '') {
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('.column-bill__status').removeClass('column-bill__status_paid').html('Выставлен');
            } else {
                ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('.column-bill__status').addClass('column-bill__status_paid').html('Оплачен');
            }

            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-selector]')
                .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + data.paymentMethodCode).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm]').val(data.paymentMethod);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-code]').val(data.paymentMethodCode);


            ACCEPT_EDITE_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
            delete BILLS_INFO_TEMP[data.id];

            $('[edit-bill-accept]').prop("disabled", false);
        },
        error: function (data) {
            var values = BILLS_INFO_TEMP[billData.id];

            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pay-date]').val(values.payDate).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-sum]').val(values.sum).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-account-number]').val(values.accountNumber).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-wrapper]').addClass('disabled');
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-selector]')
                .removeClassWild("column_pmethod_*").addClass("column_pmethod_" + values.paymentMethodCode).attr("disabled", true);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm]').val(values.paymentMethod);
            ACCEPT_EDITE_BTN.closest('.custom-table__body-row').find('[b-pm-code]').val(values.paymentMethodCode);

            ACCEPT_EDITE_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
            delete BILLS_INFO_TEMP[data.id];
            $('[edit-bill-accept]').prop("disabled", false);
        }
    });
});





//кнопка добавления напоминания
$(document).on('click', '[js-add-reminder-button]', function(event) {
    event.preventDefault();
    $(this).closest('[js-add-reminder-form]').trigger('submit');
});
//form'a напоминания
$(document).on('submit', '[js-add-reminder-form]', function(event) {
    event.preventDefault();
    openUpdateReminder($(this).find('[name="idDeal"]').val());
});
function openUpdateReminder(idDeal) {
    $('[js-add-reminder-button]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/getReminder",
        data: JSON.stringify(idDeal),
        dataType: 'json',
        cache: false,
        success: function (data) {
            openReminderMenu(data);

            $('[js-add-reminder-button]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-reminder-button]').prop("disabled", false);
        }
    });
}
function openReminderMenu(data) {
    $('[js-update-form-reminder-id-deal]').val(data.idDeal);
    $('[js-update-form-reminder-date]').val(data.reminderDate);
    $('[js-update-form-reminder-msg]').html(data.reminderMessage);

    if (data.reminder) {
        $('[js-delete-reminder-block]').addClass('is-open');
    }

    $('[js-menu-update-reminder]').addClass('is-open');
    checkBodyHidden();
}
function clearReminderForm() {
    $('[js-update-form-reminder]').trigger('reset');
    $('[js-update-form-reminder-msg]').html('');
    $('[js-delete-reminder-block]').removeClass('is-open');
}

$(document).on('click', '[js-delete-reminder]', function (event) {
    event.preventDefault();

    var idDeal = $(this).closest('[js-update-form-reminder]').find('[name="idDeal"]').val();

    $('[js-delete-reminder]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/deleteReminder",
        data: JSON.stringify(idDeal),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard($CLIENT);

            $('[data-deal="' + idDeal + '"]').find('[data-deal-reminder]').html('<div class="reminder"></div>');

            clearReminderForm();
            $('[js-menu-update-reminder]').removeClass('is-open');
            checkBodyHidden();

            $('[js-delete-reminder]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-delete-reminder]').prop("disabled", false);
        }
    });

})
$(document).on('click', '[js-update-reminder]', function (event) {
    event.preventDefault();
    $('[js-update-form-reminder]').trigger('submit');

});
$(document).on('submit', '[js-update-form-reminder]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        updateReminder(formData);
    }
});
function updateReminder(formData) {
    $('[js-update-reminder]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/saveReminder",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard($CLIENT);
            updateReminderOnList(data);
            clearReminderForm();
            $('[js-menu-update-reminder]').removeClass('is-open');
            checkBodyHidden();

            $('[js-update-reminder]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-reminder]').prop("disabled", false);
        }
    });
}
function updateReminderOnList(value) {
    var dealRow = $('[data-deal="' + value.idDeal + '"]');

    var reminder = '';
    if (value.reminder) {
        reminder += '<div class="reminder-wrapper">' +
            '<div class="reminder-date" >' + value.reminderDate + '</div>' +
            '<div class="reminder-msg">' + value.reminderMessage + '</div>' +
            '</div>';
    }
    reminder += '<div class="reminder ' + (value.reminder ? (value.reminderExpiration ? 'reminder_red' : (value.reminderToday ? 'reminder_green' : 'reminder_gray')) : '') + '"></div>';
    if (value.reminder) {
        reminder += '<div class="reminder-d">' + value.reminderDate + '</div>';
    }

    dealRow.find('[data-deal-reminder]').html(reminder);
}


//кнопка открытия поиска клиента
$(document).on('click', '[js-search-client]', function(event) {
    resetSearchClientMenu();

    $('[js-menu-search]').addClass('is-open');
    checkBodyHidden();
});


//кнопка создания клиента
$(document).on('click', '[js-create-client-btn]', function(event) {
    event.preventDefault();
    $('[js-menu-search]').removeClass('is-open');
    $('[js-create-client-form]').trigger('submit');
});

$(document).on('submit', '[js-create-client-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        createClientCard();
    }
});
var CLIENT_DATA;
function createClientCard() {
    var cardInfo = {}
    cardInfo["name"] = $('[js-create-client-name]').val();
    cardInfo["createDate"] = $('[js-create-client-date]').val();
    cardInfo["idManager"] = $('[js-create-client-manager]').val();
    cardInfo["link"] = $('[js-create-client-link]').val();
    cardInfo["phone"] = $('[js-create-client-phone]').val();
    cardInfo["email"] = $('[js-create-client-email]').val();
    // cardInfo["comment"] = $('[js-create-client-comment]').val();

    $('[js-create-client-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/clients/saveClientInfo",
        data: JSON.stringify(cardInfo),
        dataType: 'json',
        cache: false,
        success: function (data) {
            setClientCardInfo(data);
            // $('[js-create-client-form]').trigger('reset');
            $('[js-create-client-btn]').prop("disabled", false);
        },
        error: function (data) {
            CLIENT_DATA = data;
            $('[dialog]').find('.dialog__title').html('Хотите использовать его?');
            $('[dialog]').find('.dialog__text').html('В базе данных найден клиент с такими же данными');
            $('[dialog]').find('[accept-dialog]').attr('use-client', '');
            $('[dialog]').addClass('is-open');

            $('[js-create-client-btn]').prop("disabled", false);
        }
    });
}

//форма поиска клиента
$(document).on('submit', '[js-menu-search-form]', function(event) {
    event.preventDefault();
    var searchValue = $('[js-menu-search-input]').val();

    if ($.trim(searchValue) !== '') {
        var search = {}
        search["search"] = searchValue;
        $('[js-menu-search-input]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/api/clients/searchClients",
            data: JSON.stringify(search),
            dataType: 'json',
            cache: false,
            success: function (data) {
                $('[js-client-card-list]').html('');

                if (data.length === 0) {
                    $('[js-create-client]').prop('disabled', false);
                } else {
                    $('[js-create-client]').prop('disabled', true);

                    $.each(data, function (index, value) {
                        var response = $("<div/>").attr("js-client-card", "").attr("class", "client-card")
                            .append($("<input/>").attr("type", "hidden").attr("class", "js-client-id-l").attr("js-client-id", "").val(value.id))
                            .append($("<div/>").attr("class", "client-card__title").html(value.name))
                            .append($("<div/>").attr("class", "client-card__info")
                                .append($("<div/>").attr("class", "client-card__info-link").html(value.link))
                                .append($("<div/>").attr("class", "client-card__info-phone").html(value.phone)));
                        $('[js-client-card-list]').append(response);
                    });
                }

                $('[js-menu-search-input]').prop("disabled", false);
            },
            error: function (data) {
                $('[js-menu-search-input]').prop("disabled", false);
            }
        });
    }
});

$(document).on('click', '[js-create-deal]', function(event) {
    resetCreateDealForm();

    $('[js-menu-create-deal]').addClass('is-open');
    checkBodyHidden()
});

// сохранение сделки
var SAVE_DEAL_TYPE;
$(document).on('click', '[js-save-deal]', function(event) {
    event.preventDefault();
    SAVE_DEAL_TYPE = "s";
    $('[js-deal-form]').trigger('submit');
});
///сохранение сделки и открытие выставление счета
$(document).on('click', '[js-save-and-bill-deal]', function(event) {
    event.preventDefault();
    SAVE_DEAL_TYPE = "sb";
    $('[js-deal-form]').trigger('submit');
});


$(document).on('submit', '[js-deal-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var dealData = $(this).serializeObject();
        if (SAVE_DEAL_TYPE === 's') {
            createDeal(dealData);
        } else if (SAVE_DEAL_TYPE === 'sb') {
            createDealAndBill(dealData);
        }
    }
});

function createDeal(dealData) {
    $('[js-save-deal]').prop("disabled", true);
    $('[js-save-and-bill-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/saveDeal",
        data: JSON.stringify(dealData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard(dealData.idClient);
            $('[js-bill-deal-id]').val(data);
            $('[js-menu-create-deal]').removeClass('is-open');
            checkBodyHidden();

            // resetCreateDealForm();

            $('[js-save-deal]').prop("disabled", false);
            $('[js-save-and-bill-deal]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-deal]').prop("disabled", false);
            $('[js-save-and-bill-deal]').prop("disabled", false);
        }
    });
}
function createDealAndBill(dealData)    {
    $('[js-save-deal]').prop("disabled", true);
    $('[js-save-and-bill-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/saveDeal",
        data: JSON.stringify(dealData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard(dealData.idClient);
            $('[js-bill-deal-id]').val(data);
            $('[js-menu-create-deal]').removeClass('is-open');
            checkBodyHidden();

            // resetCreateDealForm();

            setBillInfo(dealData);
            $('[js-menu-bill]').addClass('is-open');
            checkBodyHidden();

            $('[js-save-deal]').prop("disabled", false);
            $('[js-save-and-bill-deal]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-deal]').prop("disabled", false);
            $('[js-save-and-bill-deal]').prop("disabled", false);
        }
    });
}
function setBillInfo(data) {
    $('[js-bill-info-product]').text(data.course);
    $('[js-bill-info-sum]').text(data.price);
    $('[js-bill-info-date]').text(data.dealDate);
}


//в меню создания
$(document).on('change', '[js-deal-form-sale-type]', function(event) {
    if ($(this).val() === 'traffic') {
        $('[js-deal-form-mailing-block]').addClass('is-open');
        checkBodyHidden()
    } else {
        $('[js-deal-form-mailing-block]').removeClass('is-open');
        $('[js-deal-form-mailing]').prop('checked', false);
        checkBodyHidden()
    }
});
//в меню создания
$(document).on('change', '[js-deal-form-product]', function(event) {
    $('[js-deal-form-price]').val($('option:selected', this).attr('data-price'));
    $('[js-deal-form-product-type]').val($('option:selected', this).attr('data-type'));
    $('[js-deal-form-product-id]').val($('option:selected', this).attr('data-id'));

    $list = createKindList($('option:selected', this).val());
    if ($list.length > 0) {
        $('[js-deal-form-kind]').html(createKindOptions($list));
        $('[js-deal-form-kind-block]').addClass('is-open');
    } else {
        $('[js-deal-form-kind-block]').removeClass('is-open');
        $('[js-deal-form-kind]').html('');
    }

    if ($('[product-types]').val() == 'курс' ) {
        setStreams($('[js-deal-form-start-date]'), $('option:selected', this).attr('data-id'));
    }
});


function setStreams(selector, idCourse){
    var formData = new FormData();
    formData.set('idCourse', Number(idCourse));

    $.ajax({
        type: "POST",
        url: "/head-manager-transactions/getStreamsByIdCourse",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var seloption = '<option value="" disabled selected>Выберите дату старта</option>';
            $.each(data, function(index, stream){
                seloption += '<option value="' + stream.id + '">' + stream.startDate + '</option>';
            });

            selector.html(seloption);
        },
        error: function (data) {
        }
    });
}

$(document).on('submit', '[js-bill-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        saveBill($(this).serializeObject());
    }
});
function saveBill(billDate) {
    $('[js-save-bill]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/bills/saveBill",
        data: JSON.stringify(billDate),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard($CLIENT);
            $('[js-menu-bill]').removeClass('is-open');
            checkBodyHidden()
            $('[js-bill-form]').trigger('reset');

            $('[js-save-bill]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-bill]').prop("disabled", false);
        }
    });
}


$(document).on('click', '[js-save-bills]', function(event) {
    event.preventDefault();
    $('[js-bills-form]').trigger('submit');
});

$(document).on('submit', '[js-bills-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var billData = $(this).serializeObject();
        saveBillWithUpdate(billData);
    }
});
function saveBillWithUpdate(billData) {
    $('[js-save-bills]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/bills/saveBill",
        data: JSON.stringify(billData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateDealCard($CLIENT);
            billData['id'] = billData.idDeal;
            openBillsRedirect(billData, IS_HIDDEN_DEAL);
            $('[js-bills-form]').trigger('reset');

            $('[js-save-bills]').prop("disabled", false);
            BILLS_TEMP_INFO = {};
        },
        error: function (data) {
            $('[js-save-bills]').prop("disabled", false);
        }
    });
}

$(document).on('change', '[product-types]', function(event) {
    $('[js-deal-form-price]').val(0);
    $('[js-deal-form-start-date]').val('');

    $('#product-category option:selected').removeAttr('selected');
    $('#product-category option:first').prop('selected', true);

    var idType = $('option:selected', this).attr('data-id');
    if (idType == 2) {
        createProductOptions($coursesList, 'js-deal-form-product');
        $('[product-block]').removeClass('menu-input_close');
        $('[trial-block]').removeClass('menu-input_close');
        $('[product-category-block]').addClass('menu-input_close');
        $('[start-date-block]').removeClass('menu-input_close');
    } else if (idType == 3) {
        createEmptyProductOptions('js-deal-form-product');
        $('[product-category-block]').removeClass('menu-input_close');
        $('[product-block]').addClass('menu-input_close');
        $('[trial-block]').addClass('menu-input_close');
        $('[start-date-block]').addClass('menu-input_close');
    } else {
        $('[product-block]').addClass('menu-input_close');
        $('[trial-block]').addClass('menu-input_close');
        $('[product-category-block]').addClass('menu-input_close');
        $('[start-date-block]').addClass('menu-input_close');
    }
});

//список курсов
var $coursesList;
function setCoursesList(coursesList) {
    $coursesList = coursesList;
}
function createProductOptions(list, ident) {
    var seloption = "";
    seloption += '<option value="" disabled selected>Выберите продукт</option>';
    $.each(list, function(index, value2){
        seloption += '<option data-id="'+ value2.id + '" value="'+ value2.name +'" data-type="'+ value2.type + '" data-price="' + value2.price + '"">' + value2.name + '</option>';
    });
    $('[' + ident + ']').html(seloption);
}
function createEmptyProductOptions(ident) {
    $('[' + ident + ']').html('<option value="" disabled selected>Выберите продукт</option>');
}

//список продуков по категориям
var $productMap;
function setProductMap(productMap) {
    $productMap = productMap;
}
$(document).on('change', '[product-category]', function(event) {
    $('[js-deal-form-price]').val(0);
    var idCategory = $('option:selected', this).val();
    createProductOptions($productMap[idCategory], 'js-deal-form-product');
    $('[product-block]').removeClass('menu-input_close');

});

$(document).on('change', '[u-product-category]', function(event) {
    $('[js-update-form-deal-price]').val(0);
    var idCategory = $('option:selected', this).val();
    createProductOptions($productMap[idCategory], 'js-update-form-deal-pr');
    $('[u-product-block]').removeClass('menu-input_close');

});
$(document).on('change', '[u-product-types]', function(event) {
    $('[js-update-form-deal-price]').val(0);
    $('[js-update-form-deal-start-date]').html('<option value="" disabled selected>Выберите дату старта</option>');

    $('#u-product-category option:selected').removeAttr('selected');
    $('#u-product-category option:first').prop('selected', true);
    $('#js-update-form-deal-pr option:selected').removeAttr('selected');
    $('#js-update-form-deal-pr option:first').prop('selected', true);

    var idType = $('option:selected', this).attr('data-id');
    if (idType == 2) {
        createProductOptions($coursesList, 'js-update-form-deal-pr');
        $('[u-product-block]').removeClass('menu-input_close');
        $('[u-trial-block]').removeClass('menu-input_close');
        $('[u-product-category-block]').addClass('menu-input_close');
        $('[u-start-date-block]').removeClass('menu-input_close');
    } else if (idType == 3) {
        createEmptyProductOptions('js-update-form-deal-pr');
        $('[u-product-category-block]').removeClass('menu-input_close');
        $('[u-product-block]').addClass('menu-input_close');
        $('[u-trial-block]').addClass('menu-input_close');
        $('[u-start-date-block]').addClass('menu-input_close');
    } else {
        $('[u-product-block]').addClass('menu-input_close');
        $('[u-trial-block]').addClass('menu-input_close');
        $('[u-product-category-block]').addClass('menu-input_close');
        $('[u-start-date-block]').removeClass('menu-input_close');
    }
});

$(document).ready(function(){
    const $filterForm = $('[tr-filter-form]');
    const $filterFormBtn = $('[tr-filter-form-btn]');
    const $filter = $('[tr-filter]');
    const $filterOpenBtn = $('[tr-filter-btn]');
    const $filterCloseBtn = $('[tr-filter-close-btn]');

    $filterOpenBtn.on('click', function() {
        $('body').addClass('hiddenOverflow');
        $filter.addClass('is-open');
    });

    $filterCloseBtn.on('click', function() {
        $('body').removeClass('hiddenOverflow');
        $filter.removeClass('is-open');
        resetFilter(FILTER_FROM_BACK);
    });

    $filterFormBtn.on('click', function(event) {
        event.preventDefault();
        $filterForm.trigger('submit');
    });

    $('.datepicker-here-f').datepicker({
        autoClose: true
    });


    const $searchClient = $('[search-client]');
    const $searchClientForm = $('[search-client-form]');
    const $searchClientBtn = $('[search-client-btn]');
    const $searchClientClear = $('[search-client-clear]');

    $searchClient.on('keyup', function () {
        $searchClientClear.removeClass('is-open');
        $searchClientBtn.addClass('is-open');
        $(this).addClass('active');
    });

    $searchClientBtn.on('click', function (event) {
        event.preventDefault();
        $searchClientForm.trigger('submit');
    });

    $searchClientClear.on('click', function (event) {
        event.preventDefault();
        $searchClient.val('');
        $searchClientForm.trigger('submit');
    });
});


var $filterFromBack;
function setFilter(filter) {
    $filterFromBack = filter;
}
$(document).on('click', '[rate-homework]', function(event){
    event.preventDefault();
    var json = new Object();
    json.id = Number($(this).closest('[data-homework]').data('homework'));

    getHomework(json, true);
});
function getHomework(json, isNeedFormBlocks) {
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getHomework",
        data: JSON.stringify(json),
        dataType: 'json',
        cache: false,
        success: function (data) {
            openHomework(data, isNeedFormBlocks);
        },
        error: function (data) {
        }
    });
}

$(document).on('click', '[view-homework]', function(event){
    event.preventDefault();
    var json = new Object();
    json.id = Number($(this).closest('[data-homework]').data('homework'));

    getHomework(json, false);
});
function openHomework(data, isNeedFormBlocks) {
    clearHomeworkForm();

    $('[h-rate-id]').val(data.id);
    setHomeworkComments(data);

    if(isNeedFormBlocks) {
        $('[rate-form-block]').addClass('is-open');
    } else {
        $('[rate-form-block]').removeClass('is-open');
    }

    $('[js-menu-rate-homework]').addClass('is-open');
    checkBodyHidden();
}
function clearHomeworkForm() {
    $('[rate-homework-form]').trigger('reset');
    $('[rate-comments]').html('');
    $('[upload-list]').html('');
    $('[rate-form-block]').removeClass('is-open');
}
function setHomeworkComments(data) {
    var commentsBlock = '';
    $.each(data.comments, function(index, comment){
        var isUserComment = comment.type == 'user';
        var filesBlock = '';
        $.each(comment.homeworkFiles, function(index2, file){
            if (file.type == 'jpeg' || file.type == 'jpg' || file.type == 'png') {
                filesBlock += '<div class="gallery__item">' +
                    '   <a href="/' + file.path + '" data-fancybox="' + file.name + '" class="gallery-item gallery-item_small">' +
                    '       <img class="gallery-item__preview" src="/' + file.path + '">' +
                    '   </a>' +
                    '</div>';
            } else if (file.type == 'doc' || file.type == 'pdf') {
                filesBlock +=
                '<a href="' + file.id + '/' + file.path +'" class="gallery__item">' +
                '   <div class="gallery-item gallery-item_small gallery-item_' + file.type + '">' +
                '       <div class="gallery-item__title">' + file.type + '</div>' +
                '       <div class="gallery-item__subtitle">' + file.name + '</div>' +
                '   </div>' +
                '</a>';
            }
        });

        commentsBlock += '<div class="comment comment_modal comment_large ' + (!isUserComment ? 'comment_right' : '') + '">' +
            '   <div class="comment__header -gap_2">' +
            '       <div class="comment__header-item">' +
            '           <div class="comment__title">' + (!isUserComment ? 'Ваш комментарий' : 'Комментарий пользователя') + '</div>' +
            '        </div>' +
            '    </div>' +
            '    <div class="comment__body comment__body_small ' + (!isUserComment ? 'comment__body_violet' : '') + '">' +
            '       <div class="comment__text comment__text_small">' + comment.text + '</div>' +
            '           <div class="gallery -gap-inner-top_1">' +
            '               <div class="gallery__wrapper gallery__wrapper_small custom-scroll">' +
            '                   <div class="gallery__list">' + filesBlock + '</div>' +
            '               </div>' +
            '           </div>' +
            '       </div>' +
            '   </div>' +
            '</div>'
    });

    $('[rate-comments]').html(commentsBlock);

}
$(document).on('click', '[js-menu-rate-homework-close-btn]', function(event){
    closeRateHomework();
});

function closeRateHomework() {
    $('[js-menu-rate-homework]').removeClass('is-open');
    checkBodyHidden();
}

$(document).on('click', '[rate-homework-btn]', function(event) {
    event.preventDefault();
    $('[rate-homework-form]').trigger('submit');
});

$(document).on('submit', '[rate-homework-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[rate-homework-form]')[0]);
        setFilesToFormData(formData);
        saveRate(formData);
    }
});

function saveRate(formData) {
    $('[save-homework-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveRateHomework",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            changeRatedCounter();
            updateHomeworkRow(data);

            closeRateHomework();

            $('[save-homework-btn]').prop("disabled", false);
        },
        error: function (data) {
            closeRateHomework();
            $('[save-homework-btn]').prop("disabled", false);
        }
    });
}

function changeRatedCounter() {
    var ratedCounter = Number($('[rated-counter]').html()) + 1;
    $('[rated-counter]').html(ratedCounter);
}

function updateHomeworkRow(data) {
    var homeworkRow = $('[data-homework="' + data.id + '"]');
    homeworkRow.find('[homework-rate]').html(
        '<div class="homework-rate">' +
        '   <div class="homework-rate__wrapper">' +
        '       <div class="homework-rate__score">' + data.rate  + '</div>' +
        '   </div>' +
        '</div>');
    homeworkRow.find('[homework-status]').html(
        '<div view-homework class="btn btn_rated">' +
        '   <div class="btn__content btn__content_small">' +
        '       <span class="btn__title btn__title_xsmall">' +
        '           <span class="btn_title-text btn_title-text_small">Проверено</span>' +
        '       </span>' +
        '   </div>' +
        '</div>');
}
$(document).on('click', '[save-homework]', function (event) {
    event.preventDefault();
    $('[save-homework-form]').trigger('submit');
});

$(document).on('submit', '[save-homework-form]', function (event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[save-homework-form]')[0]);
        setFilesToFormData(formData);
        saveHomework(formData);
    }
});

function saveHomework(formData) {
    $('[save-homework]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveHomework",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[save-homework]').prop("disabled", false);
            $('  <div class="content-element">\n' +
                '                        <div class="content-element__wrapper">\n' +
                '                            <div class="homework-accepted">\n' +
                '                                <div class="homework-accepted__content">\n' +
                '                                    Спасибо! Ваше домашнее задание принято на проверку, ответ получите в скором времени!\n' +
                '                                </div>\n' +
                '                            </div>\n' +
                '                        </div>\n' +
                '                    </div>').insertAfter($('[save-homework-form]'));
            $('[js-hide-on-complete]').remove();
        },
        error: function (data) {
            $('[save-homework]').prop("disabled", false);
        }
    });
}

/*! jQuery v3.4.1 | (c) JS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],E=C.document,r=Object.getPrototypeOf,s=t.slice,g=t.concat,u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},x=function(e){return null!=e&&e===e.window},c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.4.1",k=function(e,t){return new k.fn.init(e,t)},p=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function d(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}k.fn=k.prototype={jquery:f,constructor:k,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=k.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return k.each(this,e)},map:function(n){return this.pushStack(k.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},k.extend=k.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(k.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||k.isPlainObject(n)?n:{},i=!1,a[t]=k.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},k.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=v.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t){b(e,{nonce:t&&t.nonce})},each:function(e,t){var n,r=0;if(d(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(p,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(d(Object(e))?k.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(d(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g.apply([],a)},guid:1,support:y}),"function"==typeof Symbol&&(k.fn[Symbol.iterator]=t[Symbol.iterator]),k.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var h=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,k="sizzle"+1*new Date,m=n.document,S=0,r=0,p=ue(),x=ue(),N=ue(),A=ue(),D=function(e,t){return e===t&&(l=!0),0},j={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",$=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",F=new RegExp(M+"+","g"),B=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp($),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+$),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),ne=function(e,t,n){var r="0x"+t-65536;return r!=r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(m.childNodes),m.childNodes),t[m.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&((e?e.ownerDocument||e:m)!==C&&T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!A[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&U.test(t)){(s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=k),o=(l=h(t)).length;while(o--)l[o]="#"+s+" "+xe(l[o]);c=l.join(","),f=ee.test(t)&&ye(e.parentNode)||e}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){A(t,!0)}finally{s===k&&e.removeAttribute("id")}}}return g(t.replace(B,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[k]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:m;return r!==C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),m!==C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=k,!C.getElementsByName||!C.getElementsByName(k).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){a.appendChild(e).innerHTML="<a id='"+k+"'></a><select id='"+k+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+k+"-]").length||v.push("~="),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+k+"+*").length||v.push(".#.+[+~]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",$)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},D=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e===C||e.ownerDocument===m&&y(m,e)?-1:t===C||t.ownerDocument===m&&y(m,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e===C?-1:t===C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]===m?-1:s[r]===m?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if((e.ownerDocument||e)!==C&&T(e),d.matchesSelector&&E&&!A[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){A(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!==C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!==C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&j.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(D),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=p[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&p(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(F," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===S&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[S,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===S&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[S,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[k]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace(B,"$1"));return s[k]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[S,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[k]||(e[k]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===S&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[k]&&(v=Ce(v)),y&&!y[k]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[k]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(B,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(B," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=N[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[k]?i.push(a):o.push(a);(a=N(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=S+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t===C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument===C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(S=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(S=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=k.split("").sort(D).join("")===k,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);k.find=h,k.expr=h.selectors,k.expr[":"]=k.expr.pseudos,k.uniqueSort=k.unique=h.uniqueSort,k.text=h.getText,k.isXMLDoc=h.isXML,k.contains=h.contains,k.escapeSelector=h.escape;var T=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&k(e).is(n))break;r.push(e)}return r},S=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},N=k.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var D=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?k.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?k.grep(e,function(e){return e===n!==r}):"string"!=typeof n?k.grep(e,function(e){return-1<i.call(n,e)!==r}):k.filter(n,e,r)}k.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?k.find.matchesSelector(r,e)?[r]:[]:k.find.matches(e,k.grep(t,function(e){return 1===e.nodeType}))},k.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(k(e).filter(function(){for(t=0;t<r;t++)if(k.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)k.find(e,i[t],n);return 1<r?k.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&N.test(e)?k(e):e||[],!1).length}});var q,L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(k.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||q,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:L.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof k?t[0]:t,k.merge(this,k.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),D.test(r[1])&&k.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(k):k.makeArray(e,this)}).prototype=k.fn,q=k(E);var H=/^(?:parents|prev(?:Until|All))/,O={children:!0,contents:!0,next:!0,prev:!0};function P(e,t){while((e=e[t])&&1!==e.nodeType);return e}k.fn.extend({has:function(e){var t=k(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(k.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&k(e);if(!N.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&k.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?k.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(k(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(k.uniqueSort(k.merge(this.get(),k(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),k.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return T(e,"parentNode")},parentsUntil:function(e,t,n){return T(e,"parentNode",n)},next:function(e){return P(e,"nextSibling")},prev:function(e){return P(e,"previousSibling")},nextAll:function(e){return T(e,"nextSibling")},prevAll:function(e){return T(e,"previousSibling")},nextUntil:function(e,t,n){return T(e,"nextSibling",n)},prevUntil:function(e,t,n){return T(e,"previousSibling",n)},siblings:function(e){return S((e.parentNode||{}).firstChild,e)},children:function(e){return S(e.firstChild)},contents:function(e){return"undefined"!=typeof e.contentDocument?e.contentDocument:(A(e,"template")&&(e=e.content||e),k.merge([],e.childNodes))}},function(r,i){k.fn[r]=function(e,t){var n=k.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=k.filter(t,n)),1<this.length&&(O[r]||k.uniqueSort(n),H.test(r)&&n.reverse()),this.pushStack(n)}});var R=/[^\x20\t\r\n\f]+/g;function M(e){return e}function I(e){throw e}function W(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}k.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},k.each(e.match(R)||[],function(e,t){n[t]=!0}),n):k.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){k.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return k.each(arguments,function(e,t){var n;while(-1<(n=k.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<k.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},k.extend({Deferred:function(e){var o=[["notify","progress",k.Callbacks("memory"),k.Callbacks("memory"),2],["resolve","done",k.Callbacks("once memory"),k.Callbacks("once memory"),0,"resolved"],["reject","fail",k.Callbacks("once memory"),k.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return k.Deferred(function(r){k.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,M,s),l(u,o,I,s)):(u++,t.call(e,l(u,o,M,s),l(u,o,I,s),l(u,o,M,o.notifyWith))):(a!==M&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){k.Deferred.exceptionHook&&k.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==I&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(k.Deferred.getStackHook&&(t.stackTrace=k.Deferred.getStackHook()),C.setTimeout(t))}}return k.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:M,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:M)),o[2][3].add(l(0,e,m(n)?n:I))}).promise()},promise:function(e){return null!=e?k.extend(e,a):a}},s={};return k.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=k.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(W(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)W(i[t],a(t),o.reject);return o.promise()}});var $=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;k.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&$.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},k.readyException=function(e){C.setTimeout(function(){throw e})};var F=k.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),k.ready()}k.fn.ready=function(e){return F.then(e)["catch"](function(e){k.readyException(e)}),this},k.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--k.readyWait:k.isReady)||(k.isReady=!0)!==e&&0<--k.readyWait||F.resolveWith(E,[k])}}),k.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(k.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var _=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)_(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(k(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},z=/^-ms-/,U=/-([a-z])/g;function X(e,t){return t.toUpperCase()}function V(e){return e.replace(z,"ms-").replace(U,X)}var G=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function Y(){this.expando=k.expando+Y.uid++}Y.uid=1,Y.prototype={cache:function(e){var t=e[this.expando];return t||(t={},G(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[V(t)]=n;else for(r in t)i[V(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][V(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(V):(t=V(t))in r?[t]:t.match(R)||[]).length;while(n--)delete r[t[n]]}(void 0===t||k.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!k.isEmptyObject(t)}};var Q=new Y,J=new Y,K=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Z=/[A-Z]/g;function ee(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(Z,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:K.test(i)?JSON.parse(i):i)}catch(e){}J.set(e,t,n)}else n=void 0;return n}k.extend({hasData:function(e){return J.hasData(e)||Q.hasData(e)},data:function(e,t,n){return J.access(e,t,n)},removeData:function(e,t){J.remove(e,t)},_data:function(e,t,n){return Q.access(e,t,n)},_removeData:function(e,t){Q.remove(e,t)}}),k.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=J.get(o),1===o.nodeType&&!Q.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=V(r.slice(5)),ee(o,r,i[r]));Q.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){J.set(this,n)}):_(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=J.get(o,n))?t:void 0!==(t=ee(o,n))?t:void 0;this.each(function(){J.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){J.remove(this,e)})}}),k.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Q.get(e,t),n&&(!r||Array.isArray(n)?r=Q.access(e,t,k.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=k.queue(e,t),r=n.length,i=n.shift(),o=k._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){k.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Q.get(e,n)||Q.access(e,n,{empty:k.Callbacks("once memory").add(function(){Q.remove(e,[t+"queue",n])})})}}),k.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?k.queue(this[0],t):void 0===n?this:this.each(function(){var e=k.queue(this,t,n);k._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&k.dequeue(this,t)})},dequeue:function(e){return this.each(function(){k.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=k.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Q.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var te=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ne=new RegExp("^(?:([+-])=|)("+te+")([a-z%]*)$","i"),re=["Top","Right","Bottom","Left"],ie=E.documentElement,oe=function(e){return k.contains(e.ownerDocument,e)},ae={composed:!0};ie.getRootNode&&(oe=function(e){return k.contains(e.ownerDocument,e)||e.getRootNode(ae)===e.ownerDocument});var se=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&oe(e)&&"none"===k.css(e,"display")},ue=function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];for(o in i=n.apply(e,r||[]),t)e.style[o]=a[o];return i};function le(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return k.css(e,t,"")},u=s(),l=n&&n[3]||(k.cssNumber[t]?"":"px"),c=e.nodeType&&(k.cssNumber[t]||"px"!==l&&+u)&&ne.exec(k.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)k.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,k.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ce={};function fe(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Q.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&se(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ce[s])||(o=a.body.appendChild(a.createElement(s)),u=k.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ce[s]=u)))):"none"!==n&&(l[c]="none",Q.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}k.fn.extend({show:function(){return fe(this,!0)},hide:function(){return fe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){se(this)?k(this).show():k(this).hide()})}});var pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i,ge={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?k.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Q.set(e[n],"globalEval",!t||Q.get(t[n],"globalEval"))}ge.optgroup=ge.option,ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td;var me,xe,be=/<|&#?\w+;/;function we(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))k.merge(p,o.nodeType?[o]:o);else if(be.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+k.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;k.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<k.inArray(o,r))i&&i.push(o);else if(l=oe(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}me=E.createDocumentFragment().appendChild(E.createElement("div")),(xe=E.createElement("input")).setAttribute("type","radio"),xe.setAttribute("checked","checked"),xe.setAttribute("name","t"),me.appendChild(xe),y.checkClone=me.cloneNode(!0).cloneNode(!0).lastChild.checked,me.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!me.cloneNode(!0).lastChild.defaultValue;var Te=/^key/,Ce=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ee=/^([^.]*)(?:\.(.+)|)/;function ke(){return!0}function Se(){return!1}function Ne(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ae(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ae(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Se;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return k().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=k.guid++)),e.each(function(){k.event.add(this,t,i,r,n)})}function De(e,i,o){o?(Q.set(e,i,!1),k.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Q.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(k.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Q.set(this,i,r),t=o(this,i),this[i](),r!==(n=Q.get(this,i))||t?Q.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n.value}else r.length&&(Q.set(this,i,{value:k.event.trigger(k.extend(r[0],k.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Q.get(e,i)&&k.event.add(e,i,ke)}k.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Q.get(t);if(v){n.handler&&(n=(o=n).handler,i=o.selector),i&&k.find.matchesSelector(ie,i),n.guid||(n.guid=k.guid++),(u=v.events)||(u=v.events={}),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof k&&k.event.triggered!==e.type?k.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(R)||[""]).length;while(l--)d=g=(s=Ee.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=k.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=k.event.special[d]||{},c=k.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&k.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),k.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Q.hasData(e)&&Q.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(R)||[""]).length;while(l--)if(d=g=(s=Ee.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=k.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||k.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)k.event.remove(e,d+t[l],n,r,!0);k.isEmptyObject(u)&&Q.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=k.event.fix(e),u=new Array(arguments.length),l=(Q.get(this,"events")||{})[s.type]||[],c=k.event.special[s.type]||{};for(u[0]=s,t=1;t<arguments.length;t++)u[t]=arguments[t];if(s.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,s)){a=k.event.handlers.call(this,s,l),t=0;while((i=a[t++])&&!s.isPropagationStopped()){s.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!s.isImmediatePropagationStopped())s.rnamespace&&!1!==o.namespace&&!s.rnamespace.test(o.namespace)||(s.handleObj=o,s.data=o.data,void 0!==(r=((k.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,u))&&!1===(s.result=r)&&(s.preventDefault(),s.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,s),s.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<k(i,this).index(l):k.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(k.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[k.expando]?e:new k.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&De(t,"click",ke),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&De(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Q.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},k.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},k.Event=function(e,t){if(!(this instanceof k.Event))return new k.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?ke:Se,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&k.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[k.expando]=!0},k.Event.prototype={constructor:k.Event,isDefaultPrevented:Se,isPropagationStopped:Se,isImmediatePropagationStopped:Se,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=ke,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=ke,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=ke,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},k.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Te.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ce.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},k.event.addProp),k.each({focus:"focusin",blur:"focusout"},function(e,t){k.event.special[e]={setup:function(){return De(this,e,Ne),!1},trigger:function(){return De(this,e),!0},delegateType:t}}),k.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){k.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||k.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),k.fn.extend({on:function(e,t,n,r){return Ae(this,e,t,n,r)},one:function(e,t,n,r){return Ae(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,k(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Se),this.each(function(){k.event.remove(this,e,n,t)})}});var je=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,qe=/<script|<style|<link/i,Le=/checked\s*(?:[^=]|=\s*.checked.)/i,He=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Oe(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&k(e).children("tbody")[0]||e}function Pe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Re(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Me(e,t){var n,r,i,o,a,s,u,l;if(1===t.nodeType){if(Q.hasData(e)&&(o=Q.access(e),a=Q.set(t,o),l=o.events))for(i in delete a.handle,a.events={},l)for(n=0,r=l[i].length;n<r;n++)k.event.add(t,i,l[i][n]);J.hasData(e)&&(s=J.access(e),u=k.extend({},s),J.set(t,u))}}function Ie(n,r,i,o){r=g.apply([],r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Le.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),Ie(t,r,i,o)});if(f&&(t=(e=we(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=k.map(ve(e,"script"),Pe)).length;c<f;c++)u=e,c!==p&&(u=k.clone(u,!0,!0),s&&k.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,k.map(a,Re),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Q.access(u,"globalEval")&&k.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?k._evalUrl&&!u.noModule&&k._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")}):b(u.textContent.replace(He,""),u,l))}return n}function We(e,t,n){for(var r,i=t?k.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||k.cleanData(ve(r)),r.parentNode&&(n&&oe(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}k.extend({htmlPrefilter:function(e){return e.replace(je,"<$1></$2>")},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=oe(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||k.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Me(o[r],a[r]);else Me(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=k.event.special,o=0;void 0!==(n=e[o]);o++)if(G(n)){if(t=n[Q.expando]){if(t.events)for(r in t.events)i[r]?k.event.remove(n,r):k.removeEvent(n,r,t.handle);n[Q.expando]=void 0}n[J.expando]&&(n[J.expando]=void 0)}}}),k.fn.extend({detach:function(e){return We(this,e,!0)},remove:function(e){return We(this,e)},text:function(e){return _(this,function(e){return void 0===e?k.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Ie(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Oe(this,e).appendChild(e)})},prepend:function(){return Ie(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Oe(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Ie(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Ie(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(k.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return k.clone(this,e,t)})},html:function(e){return _(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!qe.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=k.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(k.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return Ie(this,arguments,function(e){var t=this.parentNode;k.inArray(this,n)<0&&(k.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),k.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){k.fn[e]=function(e){for(var t,n=[],r=k(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),k(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var $e=new RegExp("^("+te+")(?!px)[a-z%]+$","i"),Fe=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Be=new RegExp(re.join("|"),"i");function _e(e,t,n){var r,i,o,a,s=e.style;return(n=n||Fe(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||oe(e)||(a=k.style(e,t)),!y.pixelBoxStyles()&&$e.test(a)&&Be.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(u){s.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",u.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ie.appendChild(s).appendChild(u);var e=C.getComputedStyle(u);n="1%"!==e.top,a=12===t(e.marginLeft),u.style.right="60%",o=36===t(e.right),r=36===t(e.width),u.style.position="absolute",i=12===t(u.offsetWidth/3),ie.removeChild(s),u=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s=E.createElement("div"),u=E.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===u.style.backgroundClip,k.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),a},scrollboxSize:function(){return e(),i}}))}();var Ue=["Webkit","Moz","ms"],Xe=E.createElement("div").style,Ve={};function Ge(e){var t=k.cssProps[e]||Ve[e];return t||(e in Xe?e:Ve[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Ue.length;while(n--)if((e=Ue[n]+t)in Xe)return e}(e)||e)}var Ye=/^(none|table(?!-c[ea]).+)/,Qe=/^--/,Je={position:"absolute",visibility:"hidden",display:"block"},Ke={letterSpacing:"0",fontWeight:"400"};function Ze(e,t,n){var r=ne.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function et(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=k.css(e,n+re[a],!0,i)),r?("content"===n&&(u-=k.css(e,"padding"+re[a],!0,i)),"margin"!==n&&(u-=k.css(e,"border"+re[a]+"Width",!0,i))):(u+=k.css(e,"padding"+re[a],!0,i),"padding"!==n?u+=k.css(e,"border"+re[a]+"Width",!0,i):s+=k.css(e,"border"+re[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function tt(e,t,n){var r=Fe(e),i=(!y.boxSizingReliable()||n)&&"border-box"===k.css(e,"boxSizing",!1,r),o=i,a=_e(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if($e.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||"auto"===a||!parseFloat(a)&&"inline"===k.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===k.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+et(e,t,n||(i?"border":"content"),o,r,a)+"px"}function nt(e,t,n,r,i){return new nt.prototype.init(e,t,n,r,i)}k.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=_e(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=V(t),u=Qe.test(t),l=e.style;if(u||(t=Ge(s)),a=k.cssHooks[t]||k.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=ne.exec(n))&&i[1]&&(n=le(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(k.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=V(t);return Qe.test(t)||(t=Ge(s)),(a=k.cssHooks[t]||k.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=_e(e,t,r)),"normal"===i&&t in Ke&&(i=Ke[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),k.each(["height","width"],function(e,u){k.cssHooks[u]={get:function(e,t,n){if(t)return!Ye.test(k.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?tt(e,u,n):ue(e,Je,function(){return tt(e,u,n)})},set:function(e,t,n){var r,i=Fe(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===k.css(e,"boxSizing",!1,i),s=n?et(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-et(e,u,"border",!1,i)-.5)),s&&(r=ne.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=k.css(e,u)),Ze(0,t,s)}}}),k.cssHooks.marginLeft=ze(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(_e(e,"marginLeft"))||e.getBoundingClientRect().left-ue(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),k.each({margin:"",padding:"",border:"Width"},function(i,o){k.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+re[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(k.cssHooks[i+o].set=Ze)}),k.fn.extend({css:function(e,t){return _(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Fe(e),i=t.length;a<i;a++)o[t[a]]=k.css(e,t[a],!1,r);return o}return void 0!==n?k.style(e,t,n):k.css(e,t)},e,t,1<arguments.length)}}),((k.Tween=nt).prototype={constructor:nt,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||k.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(k.cssNumber[n]?"":"px")},cur:function(){var e=nt.propHooks[this.prop];return e&&e.get?e.get(this):nt.propHooks._default.get(this)},run:function(e){var t,n=nt.propHooks[this.prop];return this.options.duration?this.pos=t=k.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):nt.propHooks._default.set(this),this}}).init.prototype=nt.prototype,(nt.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=k.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){k.fx.step[e.prop]?k.fx.step[e.prop](e):1!==e.elem.nodeType||!k.cssHooks[e.prop]&&null==e.elem.style[Ge(e.prop)]?e.elem[e.prop]=e.now:k.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=nt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},k.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},k.fx=nt.prototype.init,k.fx.step={};var rt,it,ot,at,st=/^(?:toggle|show|hide)$/,ut=/queueHooks$/;function lt(){it&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(lt):C.setTimeout(lt,k.fx.interval),k.fx.tick())}function ct(){return C.setTimeout(function(){rt=void 0}),rt=Date.now()}function ft(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=re[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function pt(e,t,n){for(var r,i=(dt.tweeners[t]||[]).concat(dt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function dt(o,e,t){var n,a,r=0,i=dt.prefilters.length,s=k.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=rt||ct(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:k.extend({},e),opts:k.extend(!0,{specialEasing:{},easing:k.easing._default},t),originalProperties:e,originalOptions:t,startTime:rt||ct(),duration:t.duration,tweens:[],createTween:function(e,t){var n=k.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=V(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=k.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=dt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(k._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return k.map(c,pt,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),k.fx.timer(k.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}k.Animation=k.extend(dt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return le(n.elem,e,ne.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(R);for(var n,r=0,i=e.length;r<i;r++)n=e[r],dt.tweeners[n]=dt.tweeners[n]||[],dt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&se(e),v=Q.get(e,"fxshow");for(r in n.queue||(null==(a=k._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,k.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],st.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||k.style(e,r)}if((u=!k.isEmptyObject(t))||!k.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Q.get(e,"display")),"none"===(c=k.css(e,"display"))&&(l?c=l:(fe([e],!0),l=e.style.display||l,c=k.css(e,"display"),fe([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===k.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Q.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&fe([e],!0),p.done(function(){for(r in g||fe([e]),Q.remove(e,"fxshow"),d)k.style(e,r,d[r])})),u=pt(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?dt.prefilters.unshift(e):dt.prefilters.push(e)}}),k.speed=function(e,t,n){var r=e&&"object"==typeof e?k.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return k.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in k.fx.speeds?r.duration=k.fx.speeds[r.duration]:r.duration=k.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&k.dequeue(this,r.queue)},r},k.fn.extend({fadeTo:function(e,t,n,r){return this.filter(se).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=k.isEmptyObject(t),o=k.speed(e,n,r),a=function(){var e=dt(this,k.extend({},t),o);(i||Q.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&!1!==i&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=k.timers,r=Q.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&ut.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||k.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Q.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=k.timers,o=n?n.length:0;for(t.finish=!0,k.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),k.each(["toggle","show","hide"],function(e,r){var i=k.fn[r];k.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(ft(r,!0),e,t,n)}}),k.each({slideDown:ft("show"),slideUp:ft("hide"),slideToggle:ft("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){k.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),k.timers=[],k.fx.tick=function(){var e,t=0,n=k.timers;for(rt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||k.fx.stop(),rt=void 0},k.fx.timer=function(e){k.timers.push(e),k.fx.start()},k.fx.interval=13,k.fx.start=function(){it||(it=!0,lt())},k.fx.stop=function(){it=null},k.fx.speeds={slow:600,fast:200,_default:400},k.fn.delay=function(r,e){return r=k.fx&&k.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},ot=E.createElement("input"),at=E.createElement("select").appendChild(E.createElement("option")),ot.type="checkbox",y.checkOn=""!==ot.value,y.optSelected=at.selected,(ot=E.createElement("input")).value="t",ot.type="radio",y.radioValue="t"===ot.value;var ht,gt=k.expr.attrHandle;k.fn.extend({attr:function(e,t){return _(this,k.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){k.removeAttr(this,e)})}}),k.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?k.prop(e,t,n):(1===o&&k.isXMLDoc(e)||(i=k.attrHooks[t.toLowerCase()]||(k.expr.match.bool.test(t)?ht:void 0)),void 0!==n?null===n?void k.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=k.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(R);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),ht={set:function(e,t,n){return!1===t?k.removeAttr(e,n):e.setAttribute(n,n),n}},k.each(k.expr.match.bool.source.match(/\w+/g),function(e,t){var a=gt[t]||k.find.attr;gt[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=gt[o],gt[o]=r,r=null!=a(e,t,n)?o:null,gt[o]=i),r}});var vt=/^(?:input|select|textarea|button)$/i,yt=/^(?:a|area)$/i;function mt(e){return(e.match(R)||[]).join(" ")}function xt(e){return e.getAttribute&&e.getAttribute("class")||""}function bt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(R)||[]}k.fn.extend({prop:function(e,t){return _(this,k.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[k.propFix[e]||e]})}}),k.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&k.isXMLDoc(e)||(t=k.propFix[t]||t,i=k.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=k.find.attr(e,"tabindex");return t?parseInt(t,10):vt.test(e.nodeName)||yt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),y.optSelected||(k.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),k.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){k.propFix[this.toLowerCase()]=this}),k.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){k(this).addClass(t.call(this,e,xt(this)))});if((e=bt(t)).length)while(n=this[u++])if(i=xt(n),r=1===n.nodeType&&" "+mt(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=mt(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){k(this).removeClass(t.call(this,e,xt(this)))});if(!arguments.length)return this.attr("class","");if((e=bt(t)).length)while(n=this[u++])if(i=xt(n),r=1===n.nodeType&&" "+mt(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=mt(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){k(this).toggleClass(i.call(this,e,xt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=k(this),r=bt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=xt(this))&&Q.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":Q.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+mt(xt(n))+" ").indexOf(t))return!0;return!1}});var wt=/\r/g;k.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,k(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=k.map(t,function(e){return null==e?"":e+""})),(r=k.valHooks[this.type]||k.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=k.valHooks[t.type]||k.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(wt,""):null==e?"":e:void 0}}),k.extend({valHooks:{option:{get:function(e){var t=k.find.attr(e,"value");return null!=t?t:mt(k.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=k(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=k.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<k.inArray(k.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),k.each(["radio","checkbox"],function(){k.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<k.inArray(k(e).val(),t)}},y.checkOn||(k.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;var Tt=/^(?:focusinfocus|focusoutblur)$/,Ct=function(e){e.stopPropagation()};k.extend(k.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!Tt.test(d+k.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[k.expando]?e:new k.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:k.makeArray(t,[e]),c=k.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,Tt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Q.get(o,"events")||{})[e.type]&&Q.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&G(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!G(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),k.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,Ct),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,Ct),k.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=k.extend(new k.Event,n,{type:e,isSimulated:!0});k.event.trigger(r,null,t)}}),k.fn.extend({trigger:function(e,t){return this.each(function(){k.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return k.event.trigger(e,t,n,!0)}}),y.focusin||k.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){k.event.simulate(r,e.target,k.event.fix(e))};k.event.special[r]={setup:function(){var e=this.ownerDocument||this,t=Q.access(e,r);t||e.addEventListener(n,i,!0),Q.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this,t=Q.access(e,r)-1;t?Q.access(e,r,t):(e.removeEventListener(n,i,!0),Q.remove(e,r))}}});var Et=C.location,kt=Date.now(),St=/\?/;k.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||k.error("Invalid XML: "+e),t};var Nt=/\[\]$/,At=/\r?\n/g,Dt=/^(?:submit|button|image|reset|file)$/i,jt=/^(?:input|select|textarea|keygen)/i;function qt(n,e,r,i){var t;if(Array.isArray(e))k.each(e,function(e,t){r||Nt.test(n)?i(n,t):qt(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)qt(n+"["+t+"]",e[t],r,i)}k.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!k.isPlainObject(e))k.each(e,function(){i(this.name,this.value)});else for(n in e)qt(n,e[n],t,i);return r.join("&")},k.fn.extend({serialize:function(){return k.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=k.prop(this,"elements");return e?k.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!k(this).is(":disabled")&&jt.test(this.nodeName)&&!Dt.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=k(this).val();return null==n?null:Array.isArray(n)?k.map(n,function(e){return{name:t.name,value:e.replace(At,"\r\n")}}):{name:t.name,value:n.replace(At,"\r\n")}}).get()}});var Lt=/%20/g,Ht=/#.*$/,Ot=/([?&])_=[^&]*/,Pt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Rt=/^(?:GET|HEAD)$/,Mt=/^\/\//,It={},Wt={},$t="*/".concat("*"),Ft=E.createElement("a");function Bt(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(R)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function _t(t,i,o,a){var s={},u=t===Wt;function l(e){var r;return s[e]=!0,k.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function zt(e,t){var n,r,i=k.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&k.extend(!0,e,r),e}Ft.href=Et.href,k.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":$t,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":k.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?zt(zt(e,k.ajaxSettings),t):zt(k.ajaxSettings,e)},ajaxPrefilter:Bt(It),ajaxTransport:Bt(Wt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=k.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?k(y):k.event,x=k.Deferred(),b=k.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=Pt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||Et.href)+"").replace(Mt,Et.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(R)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Ft.protocol+"//"+Ft.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=k.param(v.data,v.traditional)),_t(It,v,t,T),h)return T;for(i in(g=k.event&&v.global)&&0==k.active++&&k.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Rt.test(v.type),f=v.url.replace(Ht,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Lt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(St.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Ot,"$1"),o=(St.test(f)?"&":"?")+"_="+kt+++o),v.url=f+o),v.ifModified&&(k.lastModified[f]&&T.setRequestHeader("If-Modified-Since",k.lastModified[f]),k.etag[f]&&T.setRequestHeader("If-None-Match",k.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+$t+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=_t(Wt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(k.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(k.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--k.active||k.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return k.get(e,t,n,"json")},getScript:function(e,t){return k.get(e,void 0,t,"script")}}),k.each(["get","post"],function(e,i){k[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),k.ajax(k.extend({url:e,type:i,dataType:r,data:t,success:n},k.isPlainObject(e)&&e))}}),k._evalUrl=function(e,t){return k.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){k.globalEval(e,t)}})},k.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=k(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){k(this).wrapInner(n.call(this,e))}):this.each(function(){var e=k(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){k(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){k(this).replaceWith(this.childNodes)}),this}}),k.expr.pseudos.hidden=function(e){return!k.expr.pseudos.visible(e)},k.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},k.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Ut={0:200,1223:204},Xt=k.ajaxSettings.xhr();y.cors=!!Xt&&"withCredentials"in Xt,y.ajax=Xt=!!Xt,k.ajaxTransport(function(i){var o,a;if(y.cors||Xt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Ut[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),k.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),k.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return k.globalEval(e),e}}}),k.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),k.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=k("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var Vt,Gt=[],Yt=/(=)\?(?=&|$)|\?\?/;k.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Gt.pop()||k.expando+"_"+kt++;return this[e]=!0,e}}),k.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Yt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Yt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Yt,"$1"+r):!1!==e.jsonp&&(e.url+=(St.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||k.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?k(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Gt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((Vt=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Vt.childNodes.length),k.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=D.exec(e))?[t.createElement(i[1])]:(i=we([e],t,o),o&&o.length&&k(o).remove(),k.merge([],i.childNodes)));var r,i,o},k.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=mt(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&k.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?k("<div>").append(k.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},k.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){k.fn[t]=function(e){return this.on(t,e)}}),k.expr.pseudos.animated=function(t){return k.grep(k.timers,function(e){return t===e.elem}).length},k.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=k.css(e,"position"),c=k(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=k.css(e,"top"),u=k.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,k.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},k.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){k.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===k.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===k.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=k(e).offset()).top+=k.css(e,"borderTopWidth",!0),i.left+=k.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-k.css(r,"marginTop",!0),left:t.left-i.left-k.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===k.css(e,"position"))e=e.offsetParent;return e||ie})}}),k.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;k.fn[t]=function(e){return _(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),k.each(["top","left"],function(e,n){k.cssHooks[n]=ze(y.pixelPosition,function(e,t){if(t)return t=_e(e,n),$e.test(t)?k(e).position()[n]+"px":t})}),k.each({Height:"height",Width:"width"},function(a,s){k.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){k.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return _(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?k.css(e,t,i):k.style(e,t,n,i)},s,n?e:void 0,n)}})}),k.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){k.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}}),k.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),k.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),k.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||k.guid++,i},k.holdReady=function(e){e?k.readyWait++:k.ready(!0)},k.isArray=Array.isArray,k.parseJSON=JSON.parse,k.nodeName=A,k.isFunction=m,k.isWindow=x,k.camelCase=V,k.type=w,k.now=Date.now,k.isNumeric=function(e){var t=k.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},"function"==typeof define&&define.amd&&define("jquery",[],function(){return k});var Qt=C.jQuery,Jt=C.$;return k.noConflict=function(e){return C.$===k&&(C.$=Jt),e&&C.jQuery===k&&(C.jQuery=Qt),k},e||(C.jQuery=C.$=k),k});
/*! jQuery UI - v1.12.1 - 2016-09-14
* http://jqueryui.com
* Includes: widget.js, position.js, data.js, disable-selection.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js, focusable.js, form-reset-mixin.js, jquery-1-7.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/accordion.js, widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js, widgets/draggable.js, widgets/droppable.js, widgets/menu.js, widgets/mouse.js, widgets/progressbar.js, widgets/resizable.js, widgets/selectable.js, widgets/selectmenu.js, widgets/slider.js, widgets/sortable.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

(function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){function e(t){for(var e=t.css("visibility");"inherit"===e;)t=t.parent(),e=t.css("visibility");return"hidden"!==e}function i(t){for(var e,i;t.length&&t[0]!==document;){if(e=t.css("position"),("absolute"===e||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}function s(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=n(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",i,function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,o)}function o(){t.datepicker._isDisabledDatepicker(m.inline?m.dpDiv.parent()[0]:m.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function a(e,i){t.extend(e,i);for(var s in i)null==i[s]&&(e[s]=i[s]);return e}function r(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.ui.version="1.12.1";var h=0,l=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(a){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},h=e.split(".")[0];e=e.split(".")[1];var l=h+"-"+e;return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][l.toLowerCase()]=function(e){return!!t.data(e,l)},t[h]=t[h]||{},n=t[h][e],o=t[h][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}(),void 0):(r[e]=s,void 0)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},r,{constructor:o,namespace:h,widgetName:e,widgetFullName:l}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var i,s,n=l.call(arguments,1),o=0,a=n.length;a>o;o++)for(i in n[o])s=n[o][i],n[o].hasOwnProperty(i)&&void 0!==s&&(e[i]=t.isPlainObject(s)?t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(n){var o="string"==typeof n,a=l.call(arguments,1),r=this;return o?this.length||"instance"!==n?this.each(function(){var i,o=t.data(this,s);return"instance"===n?(r=o,!1):o?t.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,a),i!==o&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; "+"attempted to call method '"+n+"'")}):r=void 0:(a.length&&(n=t.widget.extend.apply(null,[n].concat(a))),this.each(function(){var e=t.data(this,s);e?(e.option(n||{}),e._init&&e._init()):t.data(this,s,new i(n,this))})),r}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=h++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},s=e.split("."),e=s.shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,o){var a,r;for(r=0;i.length>r;r++)a=n.classesElementLookup[i[r]]||t(),a=e.add?t(t.unique(a.get().concat(e.element.get()))):t(a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return o.element.toggleClass(this._classes(o),s),this},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+o.eventNamespace,c=h[2];c?n.on(l,c,r):i.on(l,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function s(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var n,o=Math.max,a=Math.abs,r=/left|center|right/,h=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/,d=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return t("body").append(s),e=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType,o=!s&&!n;return{element:i,isWindow:s,isDocument:n,offset:o?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var u,p,f,g,m,_,v=t(n.of),b=t.position.getWithinInfo(n.within),y=t.position.getScrollInfo(b),w=(n.collision||"flip").split(" "),k={};return _=s(v),v[0].preventDefault&&(n.at="left top"),p=_.width,f=_.height,g=_.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):h.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=h.test(i[1])?i[1]:"center",t=l.exec(i[0]),e=l.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),u=e(k.at,p,f),m.left+=u[0],m.top+=u[1],this.each(function(){var s,r,h=t(this),l=h.outerWidth(),c=h.outerHeight(),d=i(this,"marginLeft"),_=i(this,"marginTop"),x=l+d+i(this,"marginRight")+y.width,C=c+_+i(this,"marginBottom")+y.height,D=t.extend({},m),I=e(k.my,h.outerWidth(),h.outerHeight());"right"===n.my[0]?D.left-=l:"center"===n.my[0]&&(D.left-=l/2),"bottom"===n.my[1]?D.top-=c:"center"===n.my[1]&&(D.top-=c/2),D.left+=I[0],D.top+=I[1],s={marginLeft:d,marginTop:_},t.each(["left","top"],function(e,i){t.ui.position[w[e]]&&t.ui.position[w[e]][i](D,{targetWidth:p,targetHeight:f,elemWidth:l,elemHeight:c,collisionPosition:s,collisionWidth:x,collisionHeight:C,offset:[u[0]+I[0],u[1]+I[1]],my:n.my,at:n.at,within:b,elem:h})}),n.using&&(r=function(t){var e=g.left-D.left,i=e+p-l,s=g.top-D.top,r=s+f-c,u={target:{element:v,left:g.left,top:g.top,width:p,height:f},element:{element:h,left:D.left,top:D.top,width:l,height:c},horizontal:0>i?"left":e>0?"right":"center",vertical:0>r?"top":s>0?"bottom":"middle"};l>p&&p>a(e+i)&&(u.horizontal="center"),c>f&&f>a(s+r)&&(u.vertical="middle"),u.important=o(a(e),a(i))>o(a(s),a(r))?"horizontal":"vertical",n.using.call(this,t,u)}),h.offset(t.extend(D,{using:r}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,h=n-r,l=r+e.collisionWidth-a-n;e.collisionWidth>a?h>0&&0>=l?(i=t.left+h+e.collisionWidth-a-n,t.left+=h-i):t.left=l>0&&0>=h?n:h>l?n+a-e.collisionWidth:n:h>0?t.left+=h:l>0?t.left-=l:t.left=o(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,h=n-r,l=r+e.collisionHeight-a-n;e.collisionHeight>a?h>0&&0>=l?(i=t.top+h+e.collisionHeight-a-n,t.top+=h-i):t.top=l>0&&0>=h?n:h>l?n+a-e.collisionHeight:n:h>0?t.top+=h:l>0?t.top-=l:t.top=o(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,r=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=t.left-e.collisionPosition.marginLeft,c=l-h,u=l+e.collisionWidth-r-h,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+d+p+f+e.collisionWidth-r-o,(0>i||a(c)>i)&&(t.left+=d+p+f)):u>0&&(s=t.left-e.collisionPosition.marginLeft+d+p+f-h,(s>0||u>a(s))&&(t.left+=d+p+f))},top:function(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,r=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=t.top-e.collisionPosition.marginTop,c=l-h,u=l+e.collisionHeight-r-h,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+p+f+g+e.collisionHeight-r-o,(0>s||a(c)>s)&&(t.top+=p+f+g)):u>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-h,(i>0||u>a(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});var c="ui-effects-",u="ui-effects-style",d="ui-effects-animated",p=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(t,o){var a,r=o.re.exec(i),h=r&&o.parse(r),l=o.space||"rgba";return h?(a=s[l](h),s[c[l].cache]=a[c[l].cache],n=s._rgba=a._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),s):o[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var o,a="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],l=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=l.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),l.fn=t.extend(l.prototype,{parse:function(n,a,r,h){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(a),a=e);var u=this,d=t.type(n),p=this._rgba=[];return a!==e&&(n=[n,a,r,h],d="array"),"string"===d?this.parse(s(n)||o._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof l?f(c,function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}):f(c,function(e,s){var o=s.cache;f(s.props,function(t,e){if(!u[o]&&s.to){if("alpha"===t||null==n[t])return;u[o]=s.to(u._rgba)}u[o][e.idx]=i(n[t],e,!0)}),u[o]&&0>t.inArray(null,u[o].slice(0,3))&&(u[o][3]=1,s.from&&(u._rgba=s.from(u[o])))}),this):e},is:function(t){var i=l(t),s=!0,n=this;return f(c,function(t,o){var a,r=i[o.cache];return r&&(a=n[o.cache]||o.to&&o.to(n._rgba)||[],f(o.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===a[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return f(c,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=l(t),n=s._space(),o=c[n],a=0===this.alpha()?l("transparent"):this,r=a[o.cache]||o.to(a._rgba),h=r.slice();return s=s[o.cache],f(o.props,function(t,n){var o=n.idx,a=r[o],l=s[o],c=u[n.type]||{};null!==l&&(null===a?h[o]=l:(c.mod&&(l-a>c.mod/2?a+=c.mod:a-l>c.mod/2&&(a-=c.mod)),h[o]=i((l-a)*e+a,n)))}),this[n](h)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(e)._rgba;return l(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,o=t[2]/255,a=t[3],r=Math.max(s,n,o),h=Math.min(s,n,o),l=r-h,c=r+h,u=.5*c;return e=h===r?0:s===r?60*(n-o)/l+360:n===r?60*(o-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=u?l/c:l/(2-c),[Math.round(e)%360,i,u,null==a?1:a]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],o=t[3],a=.5>=s?s*(1+i):s+i-s*i,r=2*s-a;return[Math.round(255*n(r,a,e+1/3)),Math.round(255*n(r,a,e)),Math.round(255*n(r,a,e-1/3)),o]},f(c,function(s,n){var o=n.props,a=n.cache,h=n.to,c=n.from;l.fn[s]=function(s){if(h&&!this[a]&&(this[a]=h(this._rgba)),s===e)return this[a].slice();var n,r=t.type(s),u="array"===r||"object"===r?s:arguments,d=this[a].slice();return f(o,function(t,e){var s=u["object"===r?t:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?(n=l(c(d)),n[a]=d,n):l(d)},f(o,function(e,i){l.fn[e]||(l.fn[e]=function(n){var o,a=t.type(n),h="alpha"===e?this._hsla?"hsla":"rgba":s,l=this[h](),c=l[i.idx];return"undefined"===a?c:("function"===a&&(n=n.call(this,c),a=t.type(n)),null==n&&i.empty?this:("string"===a&&(o=r.exec(n),o&&(n=c+parseFloat(o[2])*("+"===o[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,a,r="";if("transparent"!==n&&("string"!==t.type(n)||(o=s(n)))){if(n=l(o||n),!d.rgba&&1!==n._rgba[3]){for(a="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&a&&a.style;)try{r=t.css(a,"backgroundColor"),a=a.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(h){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=l(e.elem,i),e.end=l(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},l.hook(a),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(p),function(){function e(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(e,i){var s,o,a={};for(s in i)o=i[s],e[s]!==o&&(n[s]||(t.fx.step[s]||!isNaN(parseFloat(o)))&&(a[s]=o));return a}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(p.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,o,a,r){var h=t.speed(o,a,r);return this.queue(function(){var o,a=t(this),r=a.attr("class")||"",l=h.children?a.find("*").addBack():a;l=l.map(function(){var i=t(this);return{el:i,start:e(this)}}),o=function(){t.each(s,function(t,e){n[e]&&a[e+"Class"](n[e])})},o(),l=l.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",r),l=l.map(function(){var e=this,i=t.Deferred(),s=t.extend({},h,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,l.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),h.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,o){return s?t.effects.animateClass.call(this,{add:i},s,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,s,n,o,a){return"boolean"==typeof s||void 0===s?n?t.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,a):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,n,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,o)}})}(),function(){function e(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}function s(t,e){var i=e.outerWidth(),s=e.outerHeight(),n=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,o=n.exec(t)||["",0,i,s,0];return{top:parseFloat(o[1])||0,right:"auto"===o[2]?i:parseFloat(o[2]),bottom:"auto"===o[3]?s:parseFloat(o[3]),left:parseFloat(o[4])||0}}t.expr&&t.expr.filters&&t.expr.filters.animated&&(t.expr.filters.animated=function(e){return function(i){return!!t(i).data(d)||e(i)}}(t.expr.filters.animated)),t.uiBackCompat!==!1&&t.extend(t.effects,{save:function(t,e){for(var i=0,s=e.length;s>i;i++)null!==e[i]&&t.data(c+e[i],t[0].style[e[i]])},restore:function(t,e){for(var i,s=0,n=e.length;n>s;s++)null!==e[s]&&(i=t.data(c+e[s]),t.css(e[s],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(a){o=document.body}return e.wrap(s),(e[0]===o||t.contains(e[0],o))&&t(o).trigger("focus"),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).trigger("focus")),e}}),t.extend(t.effects,{version:"1.12.1",define:function(e,i,s){return s||(s=i,i="effect"),t.effects.effect[e]=s,t.effects.effect[e].mode=i,s},scaledDimensions:function(t,e,i){if(0===e)return{height:0,width:0,outerHeight:0,outerWidth:0};var s="horizontal"!==i?(e||100)/100:1,n="vertical"!==i?(e||100)/100:1;return{height:t.height()*n,width:t.width()*s,outerHeight:t.outerHeight()*n,outerWidth:t.outerWidth()*s}},clipToBox:function(t){return{width:t.clip.right-t.clip.left,height:t.clip.bottom-t.clip.top,left:t.clip.left,top:t.clip.top}},unshift:function(t,e,i){var s=t.queue();e>1&&s.splice.apply(s,[1,0].concat(s.splice(e,i))),t.dequeue()},saveStyle:function(t){t.data(u,t[0].style.cssText)},restoreStyle:function(t){t[0].style.cssText=t.data(u)||"",t.removeData(u)},mode:function(t,e){var i=t.is(":hidden");return"toggle"===e&&(e=i?"show":"hide"),(i?"hide"===e:"show"===e)&&(e="none"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createPlaceholder:function(e){var i,s=e.css("position"),n=e.position();return e.css({marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()),/^(static|relative)/.test(s)&&(s="absolute",i=t("<"+e[0].nodeName+">").insertAfter(e).css({display:/^(inline|ruby)/.test(e.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight"),"float":e.css("float")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"),e.data(c+"placeholder",i)),e.css({position:s,left:n.left,top:n.top}),i},removePlaceholder:function(t){var e=c+"placeholder",i=t.data(e);i&&(i.remove(),t.removeData(e))},cleanUp:function(e){t.effects.restoreStyle(e),t.effects.removePlaceholder(e)},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),t.fn.extend({effect:function(){function i(e){function i(){r.removeData(d),t.effects.cleanUp(r),"hide"===s.mode&&r.hide(),a()}function a(){t.isFunction(h)&&h.call(r[0]),t.isFunction(e)&&e()}var r=t(this);s.mode=c.shift(),t.uiBackCompat===!1||o?"none"===s.mode?(r[l](),a()):n.call(r[0],s,i):(r.is(":hidden")?"hide"===l:"show"===l)?(r[l](),a()):n.call(r[0],s,a)}var s=e.apply(this,arguments),n=t.effects.effect[s.effect],o=n.mode,a=s.queue,r=a||"fx",h=s.complete,l=s.mode,c=[],u=function(e){var i=t(this),s=t.effects.mode(i,l)||o;i.data(d,!0),c.push(s),o&&("show"===s||s===o&&"hide"===s)&&i.show(),o&&"none"===s||t.effects.saveStyle(i),t.isFunction(e)&&e()};return t.fx.off||!n?l?this[l](s.duration,h):this.each(function(){h&&h.call(this)}):a===!1?this.each(u).each(i):this.queue(r,u).queue(r,i)},show:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)
}}(t.fn.show),hide:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(s){if(i(s)||"boolean"==typeof s)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s},cssClip:function(t){return t?this.css("clip","rect("+t.top+"px "+t.right+"px "+t.bottom+"px "+t.left+"px)"):s(this.css("clip"),this)},transfer:function(e,i){var s=t(this),n=t(e.to),o="fixed"===n.css("position"),a=t("body"),r=o?a.scrollTop():0,h=o?a.scrollLeft():0,l=n.offset(),c={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},u=s.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(e.className).css({top:u.top-r,left:u.left-h,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),t.isFunction(i)&&i()})}}),t.fx.step.clip=function(e){e.clipInit||(e.start=t(e.elem).cssClip(),"string"==typeof e.end&&(e.end=s(e.end,e.elem)),e.clipInit=!0),t(e.elem).cssClip({top:e.pos*(e.end.top-e.start.top)+e.start.top,right:e.pos*(e.end.right-e.start.right)+e.start.right,bottom:e.pos*(e.end.bottom-e.start.bottom)+e.start.bottom,left:e.pos*(e.end.left-e.start.left)+e.start.left})}}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}();var f=t.effects;t.effects.define("blind","hide",function(e,i){var s={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},n=t(this),o=e.direction||"up",a=n.cssClip(),r={clip:t.extend({},a)},h=t.effects.createPlaceholder(n);r.clip[s[o][0]]=r.clip[s[o][1]],"show"===e.mode&&(n.cssClip(r.clip),h&&h.css(t.effects.clipToBox(r)),r.clip=a),h&&h.animate(t.effects.clipToBox(r),e.duration,e.easing),n.animate(r,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("bounce",function(e,i){var s,n,o,a=t(this),r=e.mode,h="hide"===r,l="show"===r,c=e.direction||"up",u=e.distance,d=e.times||5,p=2*d+(l||h?1:0),f=e.duration/p,g=e.easing,m="up"===c||"down"===c?"top":"left",_="up"===c||"left"===c,v=0,b=a.queue().length;for(t.effects.createPlaceholder(a),o=a.css(m),u||(u=a["top"===m?"outerHeight":"outerWidth"]()/3),l&&(n={opacity:1},n[m]=o,a.css("opacity",0).css(m,_?2*-u:2*u).animate(n,f,g)),h&&(u/=Math.pow(2,d-1)),n={},n[m]=o;d>v;v++)s={},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g).animate(n,f,g),u=h?2*u:u/2;h&&(s={opacity:0},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g)),a.queue(i),t.effects.unshift(a,b,p+1)}),t.effects.define("clip","hide",function(e,i){var s,n={},o=t(this),a=e.direction||"vertical",r="both"===a,h=r||"horizontal"===a,l=r||"vertical"===a;s=o.cssClip(),n.clip={top:l?(s.bottom-s.top)/2:s.top,right:h?(s.right-s.left)/2:s.right,bottom:l?(s.bottom-s.top)/2:s.bottom,left:h?(s.right-s.left)/2:s.left},t.effects.createPlaceholder(o),"show"===e.mode&&(o.cssClip(n.clip),n.clip=s),o.animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("drop","hide",function(e,i){var s,n=t(this),o=e.mode,a="show"===o,r=e.direction||"left",h="up"===r||"down"===r?"top":"left",l="up"===r||"left"===r?"-=":"+=",c="+="===l?"-=":"+=",u={opacity:0};t.effects.createPlaceholder(n),s=e.distance||n["top"===h?"outerHeight":"outerWidth"](!0)/2,u[h]=l+s,a&&(n.css(u),u[h]=c+s,u.opacity=1),n.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("explode","hide",function(e,i){function s(){b.push(this),b.length===u*d&&n()}function n(){p.css({visibility:"visible"}),t(b).remove(),i()}var o,a,r,h,l,c,u=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=u,p=t(this),f=e.mode,g="show"===f,m=p.show().css("visibility","hidden").offset(),_=Math.ceil(p.outerWidth()/d),v=Math.ceil(p.outerHeight()/u),b=[];for(o=0;u>o;o++)for(h=m.top+o*v,c=o-(u-1)/2,a=0;d>a;a++)r=m.left+a*_,l=a-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*_,top:-o*v}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:_,height:v,left:r+(g?l*_:0),top:h+(g?c*v:0),opacity:g?0:1}).animate({left:r+(g?0:l*_),top:h+(g?0:c*v),opacity:g?1:0},e.duration||500,e.easing,s)}),t.effects.define("fade","toggle",function(e,i){var s="show"===e.mode;t(this).css("opacity",s?0:1).animate({opacity:s?1:0},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("fold","hide",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=e.size||15,h=/([0-9]+)%/.exec(r),l=!!e.horizFirst,c=l?["right","bottom"]:["bottom","right"],u=e.duration/2,d=t.effects.createPlaceholder(s),p=s.cssClip(),f={clip:t.extend({},p)},g={clip:t.extend({},p)},m=[p[c[0]],p[c[1]]],_=s.queue().length;h&&(r=parseInt(h[1],10)/100*m[a?0:1]),f.clip[c[0]]=r,g.clip[c[0]]=r,g.clip[c[1]]=0,o&&(s.cssClip(g.clip),d&&d.css(t.effects.clipToBox(g)),g.clip=p),s.queue(function(i){d&&d.animate(t.effects.clipToBox(f),u,e.easing).animate(t.effects.clipToBox(g),u,e.easing),i()}).animate(f,u,e.easing).animate(g,u,e.easing).queue(i),t.effects.unshift(s,_,4)}),t.effects.define("highlight","show",function(e,i){var s=t(this),n={backgroundColor:s.css("backgroundColor")};"hide"===e.mode&&(n.opacity=0),t.effects.saveStyle(s),s.css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("size",function(e,i){var s,n,o,a=t(this),r=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],l=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],c=e.mode,u="effect"!==c,d=e.scale||"both",p=e.origin||["middle","center"],f=a.css("position"),g=a.position(),m=t.effects.scaledDimensions(a),_=e.from||m,v=e.to||t.effects.scaledDimensions(a,0);t.effects.createPlaceholder(a),"show"===c&&(o=_,_=v,v=o),n={from:{y:_.height/m.height,x:_.width/m.width},to:{y:v.height/m.height,x:v.width/m.width}},("box"===d||"both"===d)&&(n.from.y!==n.to.y&&(_=t.effects.setTransition(a,h,n.from.y,_),v=t.effects.setTransition(a,h,n.to.y,v)),n.from.x!==n.to.x&&(_=t.effects.setTransition(a,l,n.from.x,_),v=t.effects.setTransition(a,l,n.to.x,v))),("content"===d||"both"===d)&&n.from.y!==n.to.y&&(_=t.effects.setTransition(a,r,n.from.y,_),v=t.effects.setTransition(a,r,n.to.y,v)),p&&(s=t.effects.getBaseline(p,m),_.top=(m.outerHeight-_.outerHeight)*s.y+g.top,_.left=(m.outerWidth-_.outerWidth)*s.x+g.left,v.top=(m.outerHeight-v.outerHeight)*s.y+g.top,v.left=(m.outerWidth-v.outerWidth)*s.x+g.left),a.css(_),("content"===d||"both"===d)&&(h=h.concat(["marginTop","marginBottom"]).concat(r),l=l.concat(["marginLeft","marginRight"]),a.find("*[width]").each(function(){var i=t(this),s=t.effects.scaledDimensions(i),o={height:s.height*n.from.y,width:s.width*n.from.x,outerHeight:s.outerHeight*n.from.y,outerWidth:s.outerWidth*n.from.x},a={height:s.height*n.to.y,width:s.width*n.to.x,outerHeight:s.height*n.to.y,outerWidth:s.width*n.to.x};n.from.y!==n.to.y&&(o=t.effects.setTransition(i,h,n.from.y,o),a=t.effects.setTransition(i,h,n.to.y,a)),n.from.x!==n.to.x&&(o=t.effects.setTransition(i,l,n.from.x,o),a=t.effects.setTransition(i,l,n.to.x,a)),u&&t.effects.saveStyle(i),i.css(o),i.animate(a,e.duration,e.easing,function(){u&&t.effects.restoreStyle(i)})})),a.animate(v,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){var e=a.offset();0===v.opacity&&a.css("opacity",_.opacity),u||(a.css("position","static"===f?"relative":f).offset(e),t.effects.saveStyle(a)),i()}})}),t.effects.define("scale",function(e,i){var s=t(this),n=e.mode,o=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"effect"!==n?0:100),a=t.extend(!0,{from:t.effects.scaledDimensions(s),to:t.effects.scaledDimensions(s,o,e.direction||"both"),origin:e.origin||["middle","center"]},e);e.fade&&(a.from.opacity=1,a.to.opacity=0),t.effects.effect.size.call(this,a,i)}),t.effects.define("puff","hide",function(e,i){var s=t.extend(!0,{},e,{fade:!0,percent:parseInt(e.percent,10)||150});t.effects.effect.scale.call(this,s,i)}),t.effects.define("pulsate","show",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=o||a,h=2*(e.times||5)+(r?1:0),l=e.duration/h,c=0,u=1,d=s.queue().length;for((o||!s.is(":visible"))&&(s.css("opacity",0).show(),c=1);h>u;u++)s.animate({opacity:c},l,e.easing),c=1-c;s.animate({opacity:c},l,e.easing),s.queue(i),t.effects.unshift(s,d,h+1)}),t.effects.define("shake",function(e,i){var s=1,n=t(this),o=e.direction||"left",a=e.distance||20,r=e.times||3,h=2*r+1,l=Math.round(e.duration/h),c="up"===o||"down"===o?"top":"left",u="up"===o||"left"===o,d={},p={},f={},g=n.queue().length;for(t.effects.createPlaceholder(n),d[c]=(u?"-=":"+=")+a,p[c]=(u?"+=":"-=")+2*a,f[c]=(u?"-=":"+=")+2*a,n.animate(d,l,e.easing);r>s;s++)n.animate(p,l,e.easing).animate(f,l,e.easing);n.animate(p,l,e.easing).animate(d,l/2,e.easing).queue(i),t.effects.unshift(n,g,h+1)}),t.effects.define("slide","show",function(e,i){var s,n,o=t(this),a={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},r=e.mode,h=e.direction||"left",l="up"===h||"down"===h?"top":"left",c="up"===h||"left"===h,u=e.distance||o["top"===l?"outerHeight":"outerWidth"](!0),d={};t.effects.createPlaceholder(o),s=o.cssClip(),n=o.position()[l],d[l]=(c?-1:1)*u+n,d.clip=o.cssClip(),d.clip[a[h][1]]=d.clip[a[h][0]],"show"===r&&(o.cssClip(d.clip),o.css(l,d[l]),d.clip=s,d[l]=n),o.animate(d,{queue:!1,duration:e.duration,easing:e.easing,complete:i})});var f;t.uiBackCompat!==!1&&(f=t.effects.define("transfer",function(e,i){t(this).transfer(e,i)})),t.ui.focusable=function(i,s){var n,o,a,r,h,l=i.nodeName.toLowerCase();return"area"===l?(n=i.parentNode,o=n.name,i.href&&o&&"map"===n.nodeName.toLowerCase()?(a=t("img[usemap='#"+o+"']"),a.length>0&&a.is(":visible")):!1):(/^(input|select|textarea|button|object)$/.test(l)?(r=!i.disabled,r&&(h=t(i).closest("fieldset")[0],h&&(r=!h.disabled))):r="a"===l?i.href||s:s,r&&t(i).is(":visible")&&e(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function s(e,i,s,o){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?a["inner"+i].call(this):this.each(function(){t(this).css(o,s(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(o,s(this,e,!0,n)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,s,n,o;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),s=this.attr("id"),s&&(e=this.eq(0).parents().last(),o=e.add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(s)+"']",n=n.add(o.find(i).addBack(i))),this.pushStack(n))},t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),s=null!=i;return(!s||i>=0)&&t.ui.focusable(e,s)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var e,i,s=this.options.icons;s&&(e=t("<span>"),this._addClass(e,"ui-accordion-header-icon","ui-icon "+s.header),e.prependTo(this.headers),i=this.active.children(".ui-accordion-header-icon"),this._removeClass(i,s.header)._addClass(i,null,s.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?(this._activate(e),void 0):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),void 0)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!t)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,s=this.headers.length,n=this.headers.index(e.target),o=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:o=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[s-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),t(o).trigger("focus"),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().trigger("focus")},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var t=this.headers,e=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),e&&(this._off(t.not(this.headers)),this._off(e.not(this.panels)))},_refresh:function(){var e,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var e=t(this),i=e.uniqueId().attr("id"),s=e.next(),n=s.uniqueId().attr("id");e.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(e=n.height(),this.element.siblings(":visible").each(function(){var i=t(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===s&&(e=0,this.headers.next().each(function(){var i=t(this).is(":visible");i||t(this).show(),e=Math.max(e,t(this).css("height","").height()),i||t(this).hide()}).height(e))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i,s,n=this.options,o=this.active,a=t(e.currentTarget),r=a[0]===o[0],h=r&&n.collapsible,l=h?t():a.next(),c=o.next(),u={oldHeader:o,oldPanel:c,newHeader:h?t():a,newPanel:l};e.preventDefault(),r&&!n.collapsible||this._trigger("beforeActivate",e,u)===!1||(n.active=h?!1:this.headers.index(a),this.active=r?t():a,this._toggle(u),this._removeClass(o,"ui-accordion-header-active","ui-state-active"),n.icons&&(i=o.children(".ui-accordion-header-icon"),this._removeClass(i,null,n.icons.activeHeader)._addClass(i,null,n.icons.header)),r||(this._removeClass(a,"ui-accordion-header-collapsed")._addClass(a,"ui-accordion-header-active","ui-state-active"),n.icons&&(s=a.children(".ui-accordion-header-icon"),this._removeClass(s,null,n.icons.header)._addClass(s,null,n.icons.activeHeader)),this._addClass(a.next(),"ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,s=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,e):(s.hide(),i.show(),this._toggleComplete(e)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(t(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(t,e,i){var s,n,o,a=this,r=0,h=t.css("box-sizing"),l=t.length&&(!e.length||t.index()<e.index()),c=this.options.animate||{},u=l&&c.down||c,d=function(){a._toggleComplete(i)};return"number"==typeof u&&(o=u),"string"==typeof u&&(n=u),n=n||u.easing||c.easing,o=o||u.duration||c.duration,e.length?t.length?(s=t.show().outerHeight(),e.animate(this.hideProps,{duration:o,easing:n,step:function(t,e){e.now=Math.round(t)}}),t.hide().animate(this.showProps,{duration:o,easing:n,complete:d,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?"content-box"===h&&(r+=i.now):"content"!==a.options.heightStyle&&(i.now=Math.round(s-e.outerHeight()-r),r=0)}}),void 0):e.animate(this.hideProps,o,n,d):t.animate(this.showProps,o,n,d)},_toggleComplete:function(t){var e=t.oldPanel,i=e.prev();this._removeClass(e,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target),s=t(t.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&s.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if(!this.previousFilter){var i=t(e.target).closest(".ui-menu-item"),s=t(e.currentTarget);i[0]===s[0]&&(this._removeClass(s.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,s))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){var i=!t.contains(this.element[0],t.ui.safeActiveElement(this.document[0]));i&&this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){var e=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),i=e.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),i.children().each(function(){var e=t(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var i,s,n,o,a=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:a=!1,s=this.previousFilter||"",o=!1,n=e.keyCode>=96&&105>=e.keyCode?""+(e.keyCode-96):String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===s?o=!0:n=s+n,i=this._filterMenuItems(n),i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&e.preventDefault()},_activate:function(t){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i,s,n,o,a=this,r=this.options.icons.submenu,h=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),s=h.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev(),s=t("<span>").data("ui-menu-submenu-caret",!0);a._addClass(s,"ui-menu-icon","ui-icon "+r),i.attr("aria-haspopup","true").prepend(s),e.attr("aria-labelledby",i.attr("id"))}),this._addClass(s,"ui-menu","ui-widget ui-widget-content ui-front"),e=h.add(this.element),i=e.find(this.options.items),i.not(".ui-menu-item").each(function(){var e=t(this);a._isDivider(e)&&a._addClass(e,"ui-menu-divider","ui-widget-content")}),n=i.not(".ui-menu-item, .ui-menu-divider"),o=n.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(o,"ui-menu-item-wrapper"),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){if("icons"===t){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,e.submenu)}this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t+""),this._toggleClass(null,"ui-state-disabled",!!t)},focus:function(t,e){var i,s,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.children(".ui-menu-item-wrapper"),this._addClass(s,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),n=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,o,a,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=e.outerHeight(),0>n?this.activeMenu.scrollTop(o+n):n+r>a&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",t,{item:this.active}),this.active=null)},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this._removeClass(s.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(e),void 0)},previousPage:function(e){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first())),void 0):(this.next(e),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(t.trim(t(this).children(".ui-menu-item-wrapper").text()))})}}),t.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,a="input"===n;
this.isMultiLine=o||!a&&this._isContentEditable(this.element),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,s=!0,i=!0,void 0;e=!1,s=!1,i=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(e)return e=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if(!i){var n=t.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(t){return s?(s=!1,t.preventDefault(),void 0):(this._searchTimeout(t),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(t),this._change(t),void 0)}}),this._initSource(),this.menu=t("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==t.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(e,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:n})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&t.trim(s).length&&(this.liveRegion.children().hide(),t("<div>").text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,i){var s=i.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==t.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=s})),!1!==this._trigger("select",e,{item:s})&&this._value(s.value),this.term=this._value(),this.close(e),this.selectedItem=s}}),this.liveRegion=t("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var i=this.menu.element[0];return e.target===this.element[0]||e.target===i||t.contains(i,e.target)},_closeOnClickOutside:function(t){this._isEventTargetInWidget(t)||this.close()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,s=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,s){s(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){s.xhr&&s.xhr.abort(),s.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),s=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!s)&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var s=this;t.each(i,function(t,i){s._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<div>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[t](e),void 0):(this.search(null,e),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())},_isContentEditable:function(t){if(!t.length)return!1;var e=t.prop("contentEditable");return"inherit"===e?this._isContentEditable(t.parent()):"true"===e}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var s=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return s.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var g=/ui-corner-([a-z]){2,6}/g;t.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(s,n){var o,a={};return n?"controlgroupLabel"===s?(o=e.element.find(n),o.each(function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(o,null,"ui-widget ui-widget-content ui-state-default"),i=i.concat(o.get()),void 0):(t.fn[s]&&(a=e["_"+s+"Options"]?e["_"+s+"Options"]("middle"):{classes:{}},e.element.find(n).each(function(){var n=t(this),o=n[s]("instance"),r=t.widget.extend({},a);if("button"!==s||!n.parent(".ui-spinner").length){o||(o=n[s]()[s]("instance")),o&&(r.classes=e._resolveClassesValues(r.classes,o)),n[s](r);var h=n[s]("widget");t.data(h[0],"ui-controlgroup-data",o?o:n[s]("instance")),i.push(h[0])}})),void 0):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var i=t(this),s=i.data("ui-controlgroup-data");s&&s[e]&&s[e]()})},_updateCornerClass:function(t,e){var i="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all",s=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,i),this._addClass(t,null,s)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,s={classes:{}};return s.classes[e]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[t],s},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:e?"auto":!1,classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(e,i){var s={};return t.each(e,function(n){var o=i.options.classes[n]||"";o=t.trim(o.replace(g,"")),s[n]=(o+" "+e[n]).replace(/\s+/g," ")}),s},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?(this._callChildMethod(e?"disable":"enable"),void 0):(this.refresh(),void 0)},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],function(t,s){var n=e[s]().data("ui-controlgroup-data");if(n&&i["_"+n.widgetName+"Options"]){var o=i["_"+n.widgetName+"Options"](1===e.length?"only":s);o.classes=i._resolveClassesValues(o.classes,n),n.element[n.widgetName](o)}else i._updateCornerClass(e[s](),s)}),this._callChildMethod("refresh"))}}),t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,i,s=this,n=this._super()||{};return this._readType(),i=this.element.labels(),this.label=t(i[i.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){s.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),e=this.element[0].disabled,null!=e&&(n.disabled=e),n},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var e,i=this.element[0].name,s="input[name='"+t.ui.escapeSelector(i)+"']";return i?(e=this.form.length?t(this.form[0].elements).filter(s):t(s).filter(function(){return 0===t(this).form().length}),e.not(this.element)):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),this.element[0].disabled=e,void 0):(this.refresh(),void 0)):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var t=this.label.contents().not(this.element[0]);this.icon&&(t=t.not(this.icon[0])),this.iconSpace&&(t=t.not(this.iconSpace[0])),t.remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio,t.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),t=this.element[0].disabled,null!=t&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,i){var s="iconPosition"!==e,n=s?this.options.iconPosition:i,o="top"===n||"bottom"===n;this.icon?s&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),s&&this._addClass(this.icon,null,i),this._attachIcon(n),o?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,i=void 0===t.icon?this.options.icon:t.icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),t.uiBackCompat!==!1&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?(this._super("showLabel",e),void 0):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),this._superApply(arguments),void 0)}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button,t.extend(t.ui,{datepicker:{version:"1.12.1"}});var m;t.extend(s.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return a(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var s,n,o;s=e.nodeName.toLowerCase(),n="div"===s||"span"===s,e.id||(this.uuid+=1,e.id="dp"+this.uuid),o=this._newInst(t(e),n),o.settings=t.extend({},i||{}),"input"===s?this._connectDatepicker(e,o):n&&this._inlineDatepicker(e,o)},_newInst:function(e,i){var s=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var s=t(e);i.append=t([]),i.trigger=t([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var s,n,o,a=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),a&&(i.append=t("<span class='"+this._appendClass+"'>"+a+"</span>"),e[r?"before":"after"](i.append)),e.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&e.on("focus",this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:n,title:n}):n)),e[r?"before":"after"](i.trigger),i.trigger.on("click",function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,s,n,o=new Date(2009,11,20),a=this._get(t,"dateFormat");a.match(/[DM]/)&&(e=function(t){for(i=0,s=0,n=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,s=n);return s},o.setMonth(e(this._get(t,a.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,i){var s=t(e);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,s,n,o){var r,h,l,c,u,d=this._dialogInst;return d||(this.uuid+=1,r="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+r+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),t("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},t.data(this._dialogInput[0],"datepicker",d)),a(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+c,l/2-150+u]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(e){var i,s=t(e),n=t.data(e,"datepicker");s.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),m===n&&(m=null))},_enableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,s){var n,o,r,h,l=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):l?"all"===i?t.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),o=this._getDateDatepicker(e,!0),r=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),a(l.settings,n),null!==r&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,r)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),l),this._autoSize(l),this._setDate(l,o),this._updateAlternate(l),this._updateDatepicker(l)),void 0)},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,s,n,o=t.datepicker._getInst(e.target),a=!0,r=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),a=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv),n[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,n[0]),i=t.datepicker._get(o,"onSelect"),i?(s=t.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[s,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),a=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),a=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?1:-1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),a=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?-1:1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),a=e.ctrlKey||e.metaKey;break;default:a=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):a=!1;a&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,s,n=t.datepicker._getInst(e.target);return t.datepicker._get(n,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(e){var i,s=t.datepicker._getInst(e.target);if(s.input.val()!==s.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,t.datepicker._getFormatConfig(s)),i&&(t.datepicker._setDateFromField(s),t.datepicker._updateAlternate(s),t.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var s,n,o,r,h,l,c;s=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==s&&(t.datepicker._curInst.dpDiv.stop(!0,!0),s&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),n=t.datepicker._get(s,"beforeShow"),o=n?n.apply(e,[e,s]):{},o!==!1&&(a(s.settings,o),s.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(s),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),r=!1,t(e).parents().each(function(){return r|="fixed"===t(this).css("position"),!r}),h={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,s.dpDiv.empty(),s.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(s),h=t.datepicker._checkOffset(s,h,r),s.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":r?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),s.inline||(l=t.datepicker._get(s,"showAnim"),c=t.datepicker._get(s,"duration"),s.dpDiv.css("z-index",i(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[l]?s.dpDiv.show(l,t.datepicker._get(s,"showOptions"),c):s.dpDiv[l||"show"](l?c:null),t.datepicker._shouldFocusInput(s)&&s.input.trigger("focus"),t.datepicker._curInst=s))
}},_updateDatepicker:function(e){this.maxRows=4,m=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,s=this._getNumberOfMonths(e),n=s[1],a=17,r=e.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),e.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,s){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),a=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:t(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-a:0,i.left-=s&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=s&&i.top===e.input.offset().top+r?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+o>l&&l>o?Math.abs(o+r):0),i},_findPos:function(e){for(var i,s=this._getInst(e),n=this._get(s,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,s,n,o,a=this._curInst;!a||e&&a!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(a,"showAnim"),s=this._get(a,"duration"),n=function(){t.datepicker._tidyDialog(a)},t.effects&&(t.effects.effect[i]||t.effects[i])?a.dpDiv.hide(i,t.datepicker._get(a,"showOptions"),s,n):a.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,o=this._get(a,"onClose"),o&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),s=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==s)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,s){var n=t(e),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===s?this._get(o,"showCurrentAtPos"):0),s),this._updateDatepicker(o))},_gotoToday:function(e){var i,s=t(e),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(e,i,s){var n=t(e),o=this._getInst(n[0]);o["selected"+("M"===s?"Month":"Year")]=o["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(e,i,s,n){var o,a=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(a[0])||(o=this._getInst(a[0]),o.selectedDay=o.currentDay=t("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=s,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var s,n=t(e),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),s=this._get(o,"onSelect"),s?s.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(e){var i,s,n,o=this._get(e,"altField");o&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),s=this._getDate(e),n=this.formatDate(i,s,this._getFormatConfig(e)),t(o).val(n))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,s){if(null==e||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,o,a,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),u=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,d=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,_=-1,v=-1,b=!1,y=function(t){var i=e.length>n+1&&e.charAt(n+1)===t;return i&&n++,i},w=function(t){var e=y(t),s="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n="y"===t?s:1,o=RegExp("^\\d{"+n+","+s+"}"),a=i.substring(h).match(o);if(!a)throw"Missing number at position "+h;return h+=a[0].length,parseInt(a[0],10)},k=function(e,s,n){var o=-1,a=t.map(y(e)?n:s,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(a,function(t,e){var s=e[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(o=e[0],h+=s.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+h},x=function(){if(i.charAt(h)!==e.charAt(n))throw"Unexpected literal at position "+h;h++};for(n=0;e.length>n;n++)if(b)"'"!==e.charAt(n)||y("'")?x():b=!1;else switch(e.charAt(n)){case"d":_=w("d");break;case"D":k("D",u,d);break;case"o":v=w("o");break;case"m":m=w("m");break;case"M":m=k("M",p,f);break;case"y":g=w("y");break;case"@":r=new Date(w("@")),g=r.getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"!":r=new Date((w("!")-this._ticksTo1970)/1e4),g=r.getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"'":y("'")?x():b=!0;break;default:x()}if(i.length>h&&(a=i.substr(h),!/^\s+/.test(a)))throw"Extra/unparsed characters found in date: "+a;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c>=g?0:-100)),v>-1)for(m=1,_=v;;){if(o=this._getDaysInMonth(g,m-1),o>=_)break;m++,_-=o}if(r=this._daylightSavingAdjust(new Date(g,m-1,_)),r.getFullYear()!==g||r.getMonth()+1!==m||r.getDate()!==_)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,a=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(e){var i=t.length>s+1&&t.charAt(s+1)===e;return i&&s++,i},l=function(t,e,i){var s=""+e;if(h(t))for(;i>s.length;)s="0"+s;return s},c=function(t,e,i,s){return h(t)?s[e]:i[e]},u="",d=!1;if(e)for(s=0;t.length>s;s++)if(d)"'"!==t.charAt(s)||h("'")?u+=t.charAt(s):d=!1;else switch(t.charAt(s)){case"d":u+=l("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),n,o);break;case"o":u+=l("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=l("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),a,r);break;case"y":u+=h("y")?e.getFullYear():(10>e.getFullYear()%100?"0":"")+e.getFullYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":h("'")?u+="'":d=!0;break;default:u+=t.charAt(s)}return u},_possibleChars:function(t){var e,i="",s=!1,n=function(i){var s=t.length>e+1&&t.charAt(e+1)===i;return s&&e++,s};for(e=0;t.length>e;e++)if(s)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):s=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),s=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),o=n,a=this._getFormatConfig(t);try{o=this.parseDate(i,s,a)||n}catch(r){s=e?"":s}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=s?o.getDate():0,t.currentMonth=s?o.getMonth():0,t.currentYear=s?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,s){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},o=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,o=n.getFullYear(),a=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":a+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a));break;case"y":case"Y":o+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a))}l=h.exec(i)}return new Date(o,a,r)},a=null==i||""===i?s:"string"==typeof i?o(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return a=a&&"Invalid Date"==""+a?s:a,a&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var s=!e,n=t.selectedMonth,o=t.selectedYear,a=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=a.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=a.getMonth(),t.drawYear=t.selectedYear=t.currentYear=a.getFullYear(),n===t.selectedMonth&&o===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(s?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),s="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(s,-i,"M")},next:function(){t.datepicker._adjustDate(s,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(s)},selectDay:function(){return t.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(s,this,"Y"),!1}};t(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,s,n,o,a,r,h,l,c,u,d,p,f,g,m,_,v,b,y,w,k,x,C,D,I,T,P,M,S,H,z,O,A,N,W,E,F,L,R=new Date,B=this._daylightSavingAdjust(new Date(R.getFullYear(),R.getMonth(),R.getDate())),Y=this._get(t,"isRTL"),j=this._get(t,"showButtonPanel"),q=this._get(t,"hideIfNoPrevNext"),K=this._get(t,"navigationAsDateFormat"),U=this._getNumberOfMonths(t),V=this._get(t,"showCurrentAtPos"),$=this._get(t,"stepMonths"),X=1!==U[0]||1!==U[1],G=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),Q=this._getMinMaxDate(t,"min"),J=this._getMinMaxDate(t,"max"),Z=t.drawMonth-V,te=t.drawYear;if(0>Z&&(Z+=12,te--),J)for(e=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-U[0]*U[1]+1,J.getDate())),e=Q&&Q>e?Q:e;this._daylightSavingAdjust(new Date(te,Z,1))>e;)Z--,0>Z&&(Z=11,te--);for(t.drawMonth=Z,t.drawYear=te,i=this._get(t,"prevText"),i=K?this.formatDate(i,this._daylightSavingAdjust(new Date(te,Z-$,1)),this._getFormatConfig(t)):i,s=this._canAdjustMonth(t,-1,te,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":q?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=K?this.formatDate(n,this._daylightSavingAdjust(new Date(te,Z+$,1)),this._getFormatConfig(t)):n,o=this._canAdjustMonth(t,1,te,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":q?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",a=this._get(t,"currentText"),r=this._get(t,"gotoCurrent")&&t.currentDay?G:B,a=K?this.formatDate(a,r,this._getFormatConfig(t)):a,h=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",l=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(t,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+a+"</button>":"")+(Y?"":h)+"</div>":"",c=parseInt(this._get(t,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),_=this._get(t,"showOtherMonths"),v=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),y="",k=0;U[0]>k;k++){for(x="",this.maxRows=4,C=0;U[1]>C;C++){if(D=this._daylightSavingAdjust(new Date(te,Z,t.selectedDay)),I=" ui-corner-all",T="",X){if(T+="<div class='ui-datepicker-group",U[1]>1)switch(C){case 0:T+=" ui-datepicker-group-first",I=" ui-corner-"+(Y?"right":"left");break;case U[1]-1:T+=" ui-datepicker-group-last",I=" ui-corner-"+(Y?"left":"right");break;default:T+=" ui-datepicker-group-middle",I=""}T+="'>"}for(T+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+I+"'>"+(/all|left/.test(I)&&0===k?Y?o:s:"")+(/all|right/.test(I)&&0===k?Y?s:o:"")+this._generateMonthYearHeader(t,Z,te,Q,J,k>0||C>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",P=u?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)M=(w+c)%7,P+="<th scope='col'"+((w+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+d[M]+"'>"+p[M]+"</span></th>";for(T+=P+"</tr></thead><tbody>",S=this._getDaysInMonth(te,Z),te===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,S)),H=(this._getFirstDayOfMonth(te,Z)-c+7)%7,z=Math.ceil((H+S)/7),O=X?this.maxRows>z?this.maxRows:z:z,this.maxRows=O,A=this._daylightSavingAdjust(new Date(te,Z,1-H)),N=0;O>N;N++){for(T+="<tr>",W=u?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(A)+"</td>":"",w=0;7>w;w++)E=m?m.apply(t.input?t.input[0]:null,[A]):[!0,""],F=A.getMonth()!==Z,L=F&&!v||!E[0]||Q&&Q>A||J&&A>J,W+="<td class='"+((w+c+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(A.getTime()===D.getTime()&&Z===t.selectedMonth&&t._keyEvent||b.getTime()===A.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!_?"":" "+E[1]+(A.getTime()===G.getTime()?" "+this._currentClass:"")+(A.getTime()===B.getTime()?" ui-datepicker-today":""))+"'"+(F&&!_||!E[2]?"":" title='"+E[2].replace(/'/g,"&#39;")+"'")+(L?"":" data-handler='selectDay' data-event='click' data-month='"+A.getMonth()+"' data-year='"+A.getFullYear()+"'")+">"+(F&&!_?"&#xa0;":L?"<span class='ui-state-default'>"+A.getDate()+"</span>":"<a class='ui-state-default"+(A.getTime()===B.getTime()?" ui-state-highlight":"")+(A.getTime()===G.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+A.getDate()+"</a>")+"</td>",A.setDate(A.getDate()+1),A=this._daylightSavingAdjust(A);T+=W+"</tr>"}Z++,Z>11&&(Z=0,te++),T+="</tbody></table>"+(X?"</div>"+(U[0]>0&&C===U[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=T}y+=x}return y+=l,t._keyEvent=!1,y},_generateMonthYearHeader:function(t,e,i,s,n,o,a,r){var h,l,c,u,d,p,f,g,m=this._get(t,"changeMonth"),_=this._get(t,"changeYear"),v=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",y="";if(o||!m)y+="<span class='ui-datepicker-month'>"+a[e]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;12>c;c++)(!h||c>=s.getMonth())&&(!l||n.getMonth()>=c)&&(y+="<option value='"+c+"'"+(c===e?" selected='selected'":"")+">"+r[c]+"</option>");y+="</select>"}if(v||(b+=y+(!o&&m&&_?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!_)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},f=p(u[0]),g=Math.max(f,p(u[1]||"")),f=s?Math.max(f,s.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),v&&(b+=(!o&&m&&_?"":"&#xa0;")+y),b+="</div>"},_adjustInstDate:function(t,e,i){var s=t.selectedYear+("Y"===i?e:0),n=t.selectedMonth+("M"===i?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(s,n))+("D"===i?e:0),a=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(s,n,o)));t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return s&&n>s?s:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,s){var n=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,s+(0>e?e:n[0]*n[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var i,s,n=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),a=null,r=null,h=this._get(t,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),a=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(a+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||e.getTime()>=n.getTime())&&(!o||e.getTime()<=o.getTime())&&(!a||e.getFullYear()>=a)&&(!r||r>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,s){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(s,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).on("mousedown",t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new s,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.12.1",t.datepicker,t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var _=!1;t(document).on("mouseup",function(){_=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!_){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),_=!0,!0)):!0}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,_=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blurActiveElement(e),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]),s=t(e.target);s.closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}
},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],s&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),h=t.pageX,l=t.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,h=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(h=this.originalPageX),"x"===a.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,s){var n=t("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(e,i,s){var n=s.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(e,i,s){var n=s.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),o!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){var n,o,a,r,h,l,c,u,d,p,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height;for(d=s.snapElements.length-1;d>=0;d--)h=s.snapElements[d].left-s.margins.left,l=h+s.snapElements[d].width,c=s.snapElements[d].top-s.margins.top,u=c+s.snapElements[d].height,h-g>_||m>l+g||c-g>b||v>u+g||!t.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(u-v),a=g>=Math.abs(h-_),r=g>=Math.abs(l-m),n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||o||a||r,"outer"!==f.snapMode&&(n=g>=Math.abs(c-v),o=g>=Math.abs(u-b),a=g>=Math.abs(h-m),r=g>=Math.abs(l-_),n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=n||o||a||r||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,s){var n,o=s.options,a=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(e,i,s){var n=s.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0?!0:(e[s]=1,n=e[s]>0,e[s]=0,n)},_create:function(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles();break;default:}},_setupHandles:function(){var e,i,s,n,o,a=this.options,r=this;if(this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++)e=t.trim(s[i]),n="ui-resizable-"+e,o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:a.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o);this._renderAxis=function(e){var i,s,n,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:r._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){r.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),r.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,s+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,s,n=this.originalMousePosition,o=this.axis,a=e.pageX-n.left||0,r=e.pageY-n.top||0,h=this._change[o];return this._updatePrevProperties(),h?(i=h.apply(this,[e,a,r]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,s,n,o,a,r,h,l=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=s?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-n},r=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,h=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,l.animate||this.element.css(t.extend(a,{top:h,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!l.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,h=this.originalPosition.top+this.originalSize.height,l=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&l&&(t.left=r-e.minWidth),s&&l&&(t.left=r-e.maxWidth),a&&c&&(t.top=h-e.minHeight),n&&c&&(t.top=h-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(n[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-a},l=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(h,c&&l?{top:c,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,s,n,o,a,r,h=t(this).resizable("instance"),l=h.options,c=h.element,u=l.containment,d=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;d&&(h.containerElement=t(d),/document/.test(u)||u===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=h._num(e.css("padding"+s))}),h.containerOffset=e.offset(),h.containerPosition=e.position(),h.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,o=h.containerSize.width,a=h._hasScroll(d,"left")?d.scrollWidth:o,r=h._hasScroll(d)?d.scrollHeight:n,h.parentData={element:d,left:s.left,top:s.top,width:a,height:r}))},resize:function(e){var i,s,n,o,a=t(this).resizable("instance"),r=a.options,h=a.containerOffset,l=a.position,c=a._aspectRatio||e.shiftKey,u={top:0,left:0},d=a.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=h),l.left<(a._helper?h.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-h.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=r.helper?h.left:0),l.top<(a._helper?h.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-h.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?h.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-u.left:a.offset.left-h.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-u.top:a.offset.top-h.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),h=a.outerWidth()-e.sizeDiff.width,l=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),t.uiBackCompat!==!1&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,c=h[1]||1,u=Math.round((n.width-o.width)/l)*l,d=Math.round((n.height-o.height)/c)*c,p=o.width+u,f=o.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>f;s.grid=h,_&&(p+=l),v&&(f+=c),g&&(p-=l),m&&(f-=c),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=a.top-d):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=a.left-u):((0>=f-c||0>=p-l)&&(e=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=a.top-d):(f=c-e.height,i.size.height=f,i.position.top=a.top+o.height-f),p-l>0?(i.size.width=p,i.position.left=a.left-u):(p=l-e.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),t.ui.resizable,t.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog
},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&this._trigger("beforeClose",e)!==!1&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t.ui.safeBlur(t.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),s=!0),s&&!i&&this._trigger("focus",e),s},open:function(){var e=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=t(t.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"),void 0)},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).trigger("focus")},_keepFocus:function(e){function i(){var e=t.ui.safeActiveElement(this.document[0]),i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),this.close(e),void 0;if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==s[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){n.trigger("focus")}),e.preventDefault()):(this._delay(function(){s.trigger("focus")}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?(this._removeClass(this.uiDialog,"ui-dialog-buttons"),void 0):(t.each(i,function(i,s){var n,o;s=t.isFunction(s)?{click:s,text:i}:s,s=t.extend({type:"button"},s),n=s.click,o={icon:s.icon,iconPosition:s.iconPosition,showLabel:s.showLabel,icons:s.icons,text:s.text},delete s.click,delete s.icon,delete s.iconPosition,delete s.showLabel,delete s.icons,"boolean"==typeof s.text&&delete s.text,t("<button></button>",s).button(o).appendTo(e.uiButtonSet).on("click",function(){n.apply(e.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){i._addClass(t(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,e(n))},drag:function(t,s){i._trigger("drag",t,e(s))},stop:function(n,o){var a=o.offset.left-i.document.scrollLeft(),r=o.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" "+"top"+(r>=0?"+":"")+r,of:i.window},i._removeClass(t(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,s=this.options,n=s.resizable,o=this.uiDialog.css("position"),a="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:a,start:function(s,n){i._addClass(t(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,e(n))},resize:function(t,s){i._trigger("resize",t,e(s))},stop:function(n,o){var a=i.uiDialog.offset(),r=a.left-i.document.scrollLeft(),h=a.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" "+"top"+(h>=0?"+":"")+h,of:i.window},i._removeClass(t(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,s=!1,n={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(s=!0),t in i.resizableRelatedOptions&&(n[t]=e)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,i){var s,n,o=this.uiDialog;"disabled"!==e&&(this._super(e,i),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&(s=o.is(":data(ui-draggable)"),s&&!i&&o.draggable("destroy"),!s&&i&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(n=o.is(":data(ui-resizable)"),n&&!i&&o.resizable("destroy"),n&&"string"==typeof i&&o.resizable("option","handles",i),n||i===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),t=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),e=Math.max(0,s.minHeight-t),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-t):"none","auto"===s.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return t(e.target).closest(".ui-dialog").length?!0:!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?(e=arguments[0],void 0):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var s=t.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&v(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var v=t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,s,n){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,a=(e.positionAbs||e.position.absolute).top+e.margins.top,r=o+e.helperProportions.width,h=a+e.helperProportions.height,l=i.offset.left,c=i.offset.top,u=l+i.proportions().width,d=c+i.proportions().height;switch(s){case"fit":return o>=l&&u>=r&&a>=c&&d>=h;case"intersect":return o+e.helperProportions.width/2>l&&u>r-e.helperProportions.width/2&&a+e.helperProportions.height/2>c&&d>h-e.helperProportions.height/2;case"pointer":return t(n.pageY,c,i.proportions().height)&&t(n.pageX,l,i.proportions().width);case"touch":return(a>=c&&d>=a||h>=c&&d>=h||c>a&&h>d)&&(o>=l&&u>=o||r>=l&&u>=r||l>o&&r>u);default:return!1}}}();t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++)if(!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if(r[n]===o[s].element[0]){o[s].proportions().height=0;continue t}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&v(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,o,a=v(e,this,this.options.tolerance,i),r=!a&&this.isover?"isout":a&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===n}),o.length&&(s=t(o[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.uiBackCompat!==!1&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=t("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),this._refreshValue(),void 0)},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,e===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),s=i.offset(),n={left:s.left-e.elementPos.left,top:s.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,s?"ui-unselecting":"ui-selected")._addClass(n.$element,s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,h=e.pageY;return o>r&&(i=r,r=o,o=i),a>h&&(i=h,h=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:h-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),l=!1,c={};i&&i.element!==s.element[0]&&(c.left=i.left+s.elementPos.left,c.right=i.right+s.elementPos.left,c.top=i.top+s.elementPos.top,c.bottom=i.bottom+s.elementPos.top,"touch"===n.tolerance?l=!(c.left>r||o>c.right||c.top>h||a>c.bottom):"fit"===n.tolerance&&(l=c.left>o&&r>c.right&&c.top>a&&h>c.bottom),l?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.selectmenu",[t.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=t()},_drawButton:function(){var e,i=this,s=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),e=t("<span>").appendTo(this.button),this._addClass(e,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(s).appendTo(this.button),this.options.width!==!1&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(t,i){t.preventDefault(),e._setSelection(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,i){var s=i.item.data("ui-selectmenu-item");null!=e.focusIndex&&s.index!==e.focusIndex&&(e._trigger("focus",t,{item:s}),e.isOpen||e._select(s,t)),e.focusIndex=s.index,e.button.attr("aria-activedescendant",e.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var t,e=this.element.find("option");this.menu.empty(),this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,e.length&&(t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t)))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(e){var i=t("<span>");return this._setText(i,e.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(e,i){var s=this,n="";t.each(i,function(i,o){var a;o.optgroup!==n&&(a=t("<li>",{text:o.optgroup}),s._addClass(a,"ui-selectmenu-optgroup","ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),a.appendTo(e),n=o.optgroup),s._renderItemData(e,o)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var s=t("<li>"),n=t("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(s,null,"ui-state-disabled"),this._setText(n,i.label),s.append(n).appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),n+=":not(.ui-state-disabled)"),s="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](n).eq(-1):i[t+"All"](n).eq(0),s.length&&this.menuInstance.focus(e,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_setSelection:function(){var t;this.range&&(window.getSelection?(t=window.getSelection(),t.removeAllRanges(),t.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+t.ui.escapeSelector(this.ids.button)).length||this.close(e))}},_buttonEvents:{mousedown:function(){var t;window.getSelection?(t=window.getSelection(),t.rangeCount&&(this.range=t.getRangeAt(0))):this.range=document.selection.createRange()},click:function(t){this._setSelection(),this._toggle(t)},keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex).parent("li");e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(t)),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(t){var e=this.menuItems.eq(t.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){if("icons"===t){var i=this.button.find("span.ui-icon");this._removeClass(i,null,this.options.icons.button)._addClass(i,null,e.button)}this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"width"===t&&this._resizeButton()},_setOptionDisabled:function(t){this._super(t),this.menuInstance.option("disabled",t),this.button.attr("aria-disabled",t),this._toggleClass(this.button,null,"ui-state-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;return t===!1?(this.button.css("width",""),void 0):(null===t&&(t=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(t),void 0)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var t=this._super();return t.disabled=this.element.prop("disabled"),t},_parseOptions:function(e){var i=this,s=[];e.each(function(e,n){s.push(i._parseOption(t(n),e))}),this.items=s},_parseOption:function(t,e){var i=t.parent("optgroup");return{element:t,index:e,value:t.val(),label:t.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||t.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),t.widget("ui.slider",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1
},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle"),o="<span tabindex='0'></span>",a=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)a.push(o);this.handles=n.add(t(a.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e).attr("tabIndex",0)})},_createRange:function(){var e=this.options;e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=t("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===e.range||"max"===e.range)&&this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,o,a,r,h,l,c=this,u=this.options;return u.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-c.values(e));(n>i||n===i&&(e===c._lastChangedValue||c.values(e)===u.min))&&(n=i,o=t(this),a=e)}),r=this._start(e,a),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,this._addClass(o,null,"ui-state-active"),o.trigger("focus"),h=o.offset(),l=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:e.pageX-h.left-o.width()/2,top:e.pageY-h.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,o;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/e,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),o=this._valueMin()+s*n,this._trimAlignValue(o)},_uiHash:function(t,e,i){var s={handle:this.handles[t],handleIndex:t,value:void 0!==e?e:this.value()};return this._hasMultipleValues()&&(s.value=void 0!==e?e:this.values(t),s.values=i||this.values()),s},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(t,e){return this._trigger("start",t,this._uiHash(e))},_slide:function(t,e,i){var s,n,o=this.value(),a=this.values();this._hasMultipleValues()&&(n=this.values(e?0:1),o=this.values(e),2===this.options.values.length&&this.options.range===!0&&(i=0===e?Math.min(n,i):Math.max(n,i)),a[e]=i),i!==o&&(s=this._trigger("slide",t,this._uiHash(e,i,a)),s!==!1&&(this._hasMultipleValues()?this.values(e,i):this.value(i)))},_stop:function(t,e){this._trigger("stop",t,this._uiHash(e))},_change:function(t,e){this._keySliding||this._mouseSliding||(this._lastChangedValue=e,this._trigger("change",t,this._uiHash(e)))},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(e,i){var s,n,o;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),this._change(null,e),void 0;if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this._hasMultipleValues()?this._values(e):this.value();for(s=this.options.values,n=arguments[0],o=0;s.length>o;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),this._super(e,i),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=n-1;s>=0;s--)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(t){this._super(t),this._toggleClass(null,"ui-state-disabled",!!t)},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this._hasMultipleValues()){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step,s=Math.round((t-e)/i)*i;t=s+e,t>this.options.max&&(t-=i),this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(t){"vertical"===t&&this.range.css({width:"",left:""}),"horizontal"===t&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var e,i,s,n,o,a=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,c={};this._hasMultipleValues()?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),c["horizontal"===h.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[l?"animate":"css"](c,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?100*((s-n)/(o-n)):0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](c,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:100-i+"%"},r.animate),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:100-i+"%"},r.animate))},_handleEvents:{keydown:function(e){var i,s,n,o,a=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(t(e.target),null,"ui-state-active"),i=this._start(e,a),i===!1))return}switch(o=this.options.step,s=n=this._hasMultipleValues()?this.values(a):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-o)}this._slide(e,a,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),this._removeClass(t(e.target),null,"ui-state-active"))}}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,h=r+t.height,l=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+l>r&&h>s+l,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=s&&n;return o?(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1)):!1},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],h=[],l=this._connectWith();if(l&&e)for(s=l.length-1;s>=0;s--)for(o=t(l[s],this.document[0]),n=o.length-1;n>=0;n--)a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&h.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(h.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,h,l,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i],this.document[0]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],r=u[i][0],s=0,l=r.length;l>s;s++)h=t(r[s]),h.data(this.widgetName+"-item",a),c.push({item:h,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,n,o,a,r,h,l,c,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,c=d.floating||this._isFloating(this.currentItem),a=c?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[a],l=!1,e[u]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(e[u]-h)&&(n=Math.abs(e[u]-h),o=this.items[s],this.direction=l?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;
this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e=this._super(),i=this.element;return t.each(["min","max","step"],function(t,s){var n=i.attr(s);null!=n&&n.length&&(e[s]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",t),void 0)},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var e=this.element[0]===t.ui.safeActiveElement(this.document[0]);e||(this.element.trigger("focus"),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===t.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)===!1?!1:(this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e),void 0):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(e){var i=this.options,s=t.ui.keyCode;switch(e.keyCode){case s.UP:return this._repeat(null,1,e),!0;case s.DOWN:return this._repeat(null,-1,e),!0;case s.PAGE_UP:return this._repeat(null,i.page,e),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_start:function(t){return this.spinning||this._trigger("start",t)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,s=this.options;return e=null!==s.min?s.min:0,i=t-e,i=Math.round(i/s.step)*s.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==s.max&&t>s.max?s.max:null!==s.min&&s.min>t?s.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){var i,s,n;return"culture"===t||"numberFormat"===t?(i=this._parse(this.element.val()),this.options[t]=e,this.element.val(this._format(i)),void 0):(("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(s=this.buttons.first().find(".ui-icon"),this._removeClass(s,null,this.options.icons.up),this._addClass(s,null,e.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,e.down)),this._super(t,e),void 0)},_setOptionDisabled:function(t){this._super(t),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable")},_setOptions:r(function(t){this._super(t)}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null===t?!1:t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:r(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:r(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:r(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:r(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?(r(this._value).call(this,t),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),t.uiBackCompat!==!1&&t.widget("ui.spinner",t.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),t.ui.spinner,t.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i,s;i=e.href.replace(t,""),s=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return e.hash.length>1&&i===s}}(),_create:function(){var e=this,i=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===e&&(s&&this.tabs.each(function(i,n){return t(n).attr("aria-controls")===s?(e=i,!1):void 0}),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===e||-1===e)&&(e=this.tabs.length?0:!1)),e!==!1&&(e=this.tabs.index(this.tabs.eq(e)),-1===e&&(e=i?!1:0)),!i&&e===!1&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(t.ui.safeActiveElement(this.document[0])).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:s++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:n=!1,s--;break;case t.ui.keyCode.END:s=this.anchors.length-1;break;case t.ui.keyCode.HOME:s=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),this._activate(s),void 0;case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),void 0;default:return}e.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),e.ctrlKey||e.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){function s(){return e>n&&(e=0),0>e&&(e=n),e}for(var n=this.tabs.length-1;-1!==t.inArray(s(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).trigger("focus"),t},_setOption:function(t,e){return"active"===t?(this._activate(e),void 0):(this._super(t,e),"collapsible"===t&&(this._toggleClass("ui-tabs-collapsible",null,e),e||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(e),"heightStyle"===t&&this._setupHeightStyle(e),void 0)},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=t(),this.anchors.each(function(i,s){var n,o,a,r=t(s).uniqueId().attr("id"),h=t(s).closest("li"),l=h.attr("aria-controls");e._isLocal(s)?(n=s.hash,a=n.substring(1),o=e.element.find(e._sanitizeSelector(n))):(a=h.attr("aria-controls")||t({}).uniqueId()[0].id,n="#"+a,o=e.element.find(n),o.length||(o=e._createPanel(a),o.insertAfter(e.panels[i-1]||e.tablist)),o.attr("aria-live","polite")),o.length&&(e.panels=e.panels.add(o)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":a,"aria-labelledby":r}),o.attr("aria-labelledby",r)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(e){var i,s,n;for(t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1),n=0;s=this.tabs[n];n++)i=t(s),e===!0||-1!==t.inArray(n,e)?(i.attr("aria-disabled","true"),this._addClass(i,null,"ui-state-disabled")):(i.removeAttr("aria-disabled"),this._removeClass(i,null,"ui-state-disabled"));this.options.disabled=e,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,e===!0)},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,s=this.element.parent();"fill"===e?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),s=e.css("position");"absolute"!==s&&"fixed"!==s&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,s=this.active,n=t(e.currentTarget),o=n.closest("li"),a=o[0]===s[0],r=a&&i.collapsible,h=r?t():this._getPanelForTab(o),l=s.length?this._getPanelForTab(s):t(),c={oldTab:s,oldPanel:l,newTab:r?t():o,newPanel:h};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||a&&!i.collapsible||this._trigger("beforeActivate",e,c)===!1||(i.active=r?!1:this.tabs.index(o),this.active=a?t():o,this.xhr&&this.xhr.abort(),l.length||h.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(o),e),this._toggle(e,c))},_toggle:function(e,i){function s(){o.running=!1,o._trigger("activate",e,i)}function n(){o._addClass(i.newTab.closest("li"),"ui-tabs-active","ui-state-active"),a.length&&o.options.show?o._show(a,o.options.show,s):(a.show(),s())}var o=this,a=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){o._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),n()}):(this._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),a.length&&r.length?i.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),a.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){var i,s=this._findActive(e);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+t.ui.escapeSelector(e)+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;i!==!1&&(void 0===e?i=!1:(e=this._getIndex(e),i=t.isArray(i)?t.map(i,function(t){return t!==e?t:null}):t.map(this.tabs,function(t,i){return i!==e?i:null})),this._setOptionDisabled(i))},disable:function(e){var i=this.options.disabled;if(i!==!0){if(void 0===e)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setOptionDisabled(i)}},load:function(e,i){e=this._getIndex(e);var s=this,n=this.tabs.eq(e),o=n.find(".ui-tabs-anchor"),a=this._getPanelForTab(n),r={tab:n,panel:a},h=function(t,e){"abort"===e&&s.panels.stop(!1,!0),s._removeClass(n,"ui-tabs-loading"),a.removeAttr("aria-busy"),t===s.xhr&&delete s.xhr};this._isLocal(o[0])||(this.xhr=t.ajax(this._ajaxSettings(o,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(n,"ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.done(function(t,e,n){setTimeout(function(){a.html(t),s._trigger("load",i,r),h(n,e)},1)}).fail(function(t,e){setTimeout(function(){h(t,e)},1)})))},_ajaxSettings:function(e,i,s){var n=this;return{url:e.attr("href").replace(/#.*$/,""),beforeSend:function(e,o){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:o},s))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),t.uiBackCompat!==!1&&t.widget("ui.tabs",t.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),t.ui.tabs,t.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var s=(e.attr("aria-describedby")||"").split(/\s+/);s.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(s.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),s=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,s);-1!==n&&s.splice(n,1),e.removeData("ui-tooltip-id"),s=t.trim(s.join(" ")),s?e.attr("aria-describedby",s):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=t([])},_setOption:function(e,i){var s=this;this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){s._updateContent(e.element)})},_setOptionDisabled:function(t){this[t?"_disable":"_enable"]()},_disable:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s.element[0],e.close(n,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var e=t(this);return e.is("[title]")?e.data("ui-tooltip-title",e.attr("title")).removeAttr("title"):void 0}))},_enable:function(){this.disabledTitles.each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))}),this.disabledTitles=t([])},open:function(e){var i=this,s=t(e?e.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&s.parents().each(function(){var e,s=t(this);s.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(e,s),this._updateContent(s,e))},_updateContent:function(t,e){var i,s=this.options.content,n=this,o=e?e.type:null;return"string"==typeof s||s.nodeType||s.jquery?this._open(e,t,s):(i=s.call(t[0],function(i){n._delay(function(){t.data("ui-tooltip-open")&&(e&&(e.type=o),this._open(e,t,i))})}),i&&this._open(e,t,i),void 0)},_open:function(e,i,s){function n(t){l.of=t,a.is(":hidden")||a.position(l)}var o,a,r,h,l=t.extend({},this.options.position);if(s){if(o=this._find(i))return o.tooltip.find(".ui-tooltip-content").html(s),void 0;i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),a=o.tooltip,this._addDescribedBy(i,a.attr("id")),a.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),h=t("<div>").html(a.find(".ui-tooltip-content").html()),h.removeAttr("name").find("[name]").removeAttr("name"),h.removeAttr("id").find("[id]").removeAttr("id"),h.appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:n}),n(e)):a.position(t.extend({of:i},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){a.is(":visible")&&(n(l.of),clearInterval(r))},t.fx.interval)),this._trigger("open",e,{tooltip:a})}},_registerCloseHandlers:function(e,i){var s={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var s=t.Event(e);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),e&&"mouseover"!==e.type||(s.mouseleave="close"),e&&"focusin"!==e.type||(s.focusout="close"),this._on(!0,i,s)},close:function(e){var i,s=this,n=t(e?e.currentTarget:this.element),o=this._find(n);return o?(i=o.tooltip,o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete s.parents[e]}),o.closing=!0,this._trigger("close",e,{tooltip:i}),o.hiding||(o.closing=!1)),void 0):(n.removeData("ui-tooltip-open"),void 0)},_tooltip:function(e){var i=t("<div>").attr("role","tooltip"),s=t("<div>").appendTo(i),n=i.uniqueId().attr("id");return this._addClass(s,"ui-tooltip-content"),this._addClass(i,"ui-tooltip","ui-widget ui-widget-content"),i.appendTo(this._appendTo(e)),this.tooltips[n]={element:e,tooltip:i}},_find:function(t){var e=t.data("ui-tooltip-id");return e?this.tooltips[e]:null},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_appendTo:function(t){var e=t.closest(".ui-front, dialog");return e.length||(e=this.document[0].body),e},_destroy:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur"),o=s.element;n.target=n.currentTarget=o[0],e.close(n,!0),t("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),t.uiBackCompat!==!1&&t.widget("ui.tooltip",t.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var t=this._superApply(arguments);return this.options.tooltipClass&&t.tooltip.addClass(this.options.tooltipClass),t}}),t.ui.tooltip});
// ==================================================
// fancyBox v3.5.7
//
// Licensed GPLv3 for open source use
// or fancyBox Commercial License for commercial use
//
// http://fancyapps.com/fancybox/
// Copyright 2019 fancyApps
//
// ==================================================
!function(t,e,n,o){"use strict";function i(t,e){var o,i,a,s=[],r=0;t&&t.isDefaultPrevented()||(t.preventDefault(),e=e||{},t&&t.data&&(e=h(t.data.options,e)),o=e.$target||n(t.currentTarget).trigger("blur"),(a=n.fancybox.getInstance())&&a.$trigger&&a.$trigger.is(o)||(e.selector?s=n(e.selector):(i=o.attr("data-fancybox")||"",i?(s=t.data?t.data.items:[],s=s.length?s.filter('[data-fancybox="'+i+'"]'):n('[data-fancybox="'+i+'"]')):s=[o]),r=n(s).index(o),r<0&&(r=0),a=n.fancybox.open(s,e,r),a.$trigger=o))}if(t.console=t.console||{info:function(t){}},n){if(n.fn.fancybox)return void console.info("fancyBox already initialized");var a={closeExisting:!1,loop:!1,gutter:50,keyboard:!0,preventCaptionOverlap:!0,arrows:!0,infobar:!0,smallBtn:"auto",toolbar:"auto",buttons:["zoom","slideShow","thumbs","close"],idleTime:3,protect:!1,modal:!1,image:{preload:!1},ajax:{settings:{data:{fancybox:!0}}},iframe:{tpl:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" allowfullscreen="allowfullscreen" allow="autoplay; fullscreen" src=""></iframe>',preload:!0,css:{},attr:{scrolling:"auto"}},video:{tpl:'<video class="fancybox-video" controls controlsList="nodownload" poster="{{poster}}"><source src="{{src}}" type="{{format}}" />Sorry, your browser doesn\'t support embedded videos, <a href="{{src}}">download</a> and watch with your favorite video player!</video>',format:"",autoStart:!0},defaultType:"image",animationEffect:"zoom",animationDuration:366,zoomOpacity:"auto",transitionEffect:"fade",transitionDuration:366,slideClass:"",baseClass:"",baseTpl:'<div class="fancybox-container" role="dialog" tabindex="-1"><div class="fancybox-bg"></div><div class="fancybox-inner"><div class="fancybox-infobar"><span data-fancybox-index></span>&nbsp;/&nbsp;<span data-fancybox-count></span></div><div class="fancybox-toolbar">{{buttons}}</div><div class="fancybox-navigation">{{arrows}}</div><div class="fancybox-stage"></div><div class="fancybox-caption"><div class="fancybox-caption__body"></div></div></div></div>',spinnerTpl:'<div class="fancybox-loading"></div>',errorTpl:'<div class="fancybox-error"><p>{{ERROR}}</p></div>',btnTpl:{download:'<a download data-fancybox-download class="fancybox-button fancybox-button--download" title="{{DOWNLOAD}}" href="javascript:;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.62 17.09V19H5.38v-1.91zm-2.97-6.96L17 11.45l-5 4.87-5-4.87 1.36-1.32 2.68 2.64V5h1.92v7.77z"/></svg></a>',zoom:'<button data-fancybox-zoom class="fancybox-button fancybox-button--zoom" title="{{ZOOM}}"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.7 17.3l-3-3a5.9 5.9 0 0 0-.6-7.6 5.9 5.9 0 0 0-8.4 0 5.9 5.9 0 0 0 0 8.4 5.9 5.9 0 0 0 7.7.7l3 3a1 1 0 0 0 1.3 0c.4-.5.4-1 0-1.5zM8.1 13.8a4 4 0 0 1 0-5.7 4 4 0 0 1 5.7 0 4 4 0 0 1 0 5.7 4 4 0 0 1-5.7 0z"/></svg></button>',close:'<button data-fancybox-close class="fancybox-button fancybox-button--close" title="{{CLOSE}}"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 10.6L6.6 5.2 5.2 6.6l5.4 5.4-5.4 5.4 1.4 1.4 5.4-5.4 5.4 5.4 1.4-1.4-5.4-5.4 5.4-5.4-1.4-1.4-5.4 5.4z"/></svg></button>',arrowLeft:'<button data-fancybox-prev class="fancybox-button fancybox-button--arrow_left" title="{{PREV}}"><div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.28 15.7l-1.34 1.37L5 12l4.94-5.07 1.34 1.38-2.68 2.72H19v1.94H8.6z"/></svg></div></button>',arrowRight:'<button data-fancybox-next class="fancybox-button fancybox-button--arrow_right" title="{{NEXT}}"><div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.4 12.97l-2.68 2.72 1.34 1.38L19 12l-4.94-5.07-1.34 1.38 2.68 2.72H5v1.94z"/></svg></div></button>',smallBtn:'<button type="button" data-fancybox-close class="fancybox-button fancybox-close-small" title="{{CLOSE}}"><svg xmlns="http://www.w3.org/2000/svg" version="1" viewBox="0 0 24 24"><path d="M13 12l5-5-1-1-5 5-5-5-1 1 5 5-5 5 1 1 5-5 5 5 1-1z"/></svg></button>'},parentEl:"body",hideScrollbar:!0,autoFocus:!0,backFocus:!0,trapFocus:!0,fullScreen:{autoStart:!1},touch:{vertical:!0,momentum:!0},hash:null,media:{},slideShow:{autoStart:!1,speed:3e3},thumbs:{autoStart:!1,hideOnClose:!0,parentEl:".fancybox-container",axis:"y"},wheel:"auto",onInit:n.noop,beforeLoad:n.noop,afterLoad:n.noop,beforeShow:n.noop,afterShow:n.noop,beforeClose:n.noop,afterClose:n.noop,onActivate:n.noop,onDeactivate:n.noop,clickContent:function(t,e){return"image"===t.type&&"zoom"},clickSlide:"close",clickOutside:"close",dblclickContent:!1,dblclickSlide:!1,dblclickOutside:!1,mobile:{preventCaptionOverlap:!1,idleTime:!1,clickContent:function(t,e){return"image"===t.type&&"toggleControls"},clickSlide:function(t,e){return"image"===t.type?"toggleControls":"close"},dblclickContent:function(t,e){return"image"===t.type&&"zoom"},dblclickSlide:function(t,e){return"image"===t.type&&"zoom"}},lang:"en",i18n:{en:{CLOSE:"Close",NEXT:"Next",PREV:"Previous",ERROR:"The requested content cannot be loaded. <br/> Please try again later.",PLAY_START:"Start slideshow",PLAY_STOP:"Pause slideshow",FULL_SCREEN:"Full screen",THUMBS:"Thumbnails",DOWNLOAD:"Download",SHARE:"Share",ZOOM:"Zoom"},de:{CLOSE:"Schlie&szlig;en",NEXT:"Weiter",PREV:"Zur&uuml;ck",ERROR:"Die angeforderten Daten konnten nicht geladen werden. <br/> Bitte versuchen Sie es sp&auml;ter nochmal.",PLAY_START:"Diaschau starten",PLAY_STOP:"Diaschau beenden",FULL_SCREEN:"Vollbild",THUMBS:"Vorschaubilder",DOWNLOAD:"Herunterladen",SHARE:"Teilen",ZOOM:"Vergr&ouml;&szlig;ern"}}},s=n(t),r=n(e),c=0,l=function(t){return t&&t.hasOwnProperty&&t instanceof n},d=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||function(e){return t.setTimeout(e,1e3/60)}}(),u=function(){return t.cancelAnimationFrame||t.webkitCancelAnimationFrame||t.mozCancelAnimationFrame||t.oCancelAnimationFrame||function(e){t.clearTimeout(e)}}(),f=function(){var t,n=e.createElement("fakeelement"),o={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in o)if(void 0!==n.style[t])return o[t];return"transitionend"}(),p=function(t){return t&&t.length&&t[0].offsetHeight},h=function(t,e){var o=n.extend(!0,{},t,e);return n.each(e,function(t,e){n.isArray(e)&&(o[t]=e)}),o},g=function(t){var o,i;return!(!t||t.ownerDocument!==e)&&(n(".fancybox-container").css("pointer-events","none"),o={x:t.getBoundingClientRect().left+t.offsetWidth/2,y:t.getBoundingClientRect().top+t.offsetHeight/2},i=e.elementFromPoint(o.x,o.y)===t,n(".fancybox-container").css("pointer-events",""),i)},b=function(t,e,o){var i=this;i.opts=h({index:o},n.fancybox.defaults),n.isPlainObject(e)&&(i.opts=h(i.opts,e)),n.fancybox.isMobile&&(i.opts=h(i.opts,i.opts.mobile)),i.id=i.opts.id||++c,i.currIndex=parseInt(i.opts.index,10)||0,i.prevIndex=null,i.prevPos=null,i.currPos=0,i.firstRun=!0,i.group=[],i.slides={},i.addContent(t),i.group.length&&i.init()};n.extend(b.prototype,{init:function(){var o,i,a=this,s=a.group[a.currIndex],r=s.opts;r.closeExisting&&n.fancybox.close(!0),n("body").addClass("fancybox-active"),!n.fancybox.getInstance()&&!1!==r.hideScrollbar&&!n.fancybox.isMobile&&e.body.scrollHeight>t.innerHeight&&(n("head").append('<style id="fancybox-style-noscroll" type="text/css">.compensate-for-scrollbar{margin-right:'+(t.innerWidth-e.documentElement.clientWidth)+"px;}</style>"),n("body").addClass("compensate-for-scrollbar")),i="",n.each(r.buttons,function(t,e){i+=r.btnTpl[e]||""}),o=n(a.translate(a,r.baseTpl.replace("{{buttons}}",i).replace("{{arrows}}",r.btnTpl.arrowLeft+r.btnTpl.arrowRight))).attr("id","fancybox-container-"+a.id).addClass(r.baseClass).data("FancyBox",a).appendTo(r.parentEl),a.$refs={container:o},["bg","inner","infobar","toolbar","stage","caption","navigation"].forEach(function(t){a.$refs[t]=o.find(".fancybox-"+t)}),a.trigger("onInit"),a.activate(),a.jumpTo(a.currIndex)},translate:function(t,e){var n=t.opts.i18n[t.opts.lang]||t.opts.i18n.en;return e.replace(/\{\{(\w+)\}\}/g,function(t,e){return void 0===n[e]?t:n[e]})},addContent:function(t){var e,o=this,i=n.makeArray(t);n.each(i,function(t,e){var i,a,s,r,c,l={},d={};n.isPlainObject(e)?(l=e,d=e.opts||e):"object"===n.type(e)&&n(e).length?(i=n(e),d=i.data()||{},d=n.extend(!0,{},d,d.options),d.$orig=i,l.src=o.opts.src||d.src||i.attr("href"),l.type||l.src||(l.type="inline",l.src=e)):l={type:"html",src:e+""},l.opts=n.extend(!0,{},o.opts,d),n.isArray(d.buttons)&&(l.opts.buttons=d.buttons),n.fancybox.isMobile&&l.opts.mobile&&(l.opts=h(l.opts,l.opts.mobile)),a=l.type||l.opts.type,r=l.src||"",!a&&r&&((s=r.match(/\.(mp4|mov|ogv|webm)((\?|#).*)?$/i))?(a="video",l.opts.video.format||(l.opts.video.format="video/"+("ogv"===s[1]?"ogg":s[1]))):r.match(/(^data:image\/[a-z0-9+\/=]*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg|ico)((\?|#).*)?$)/i)?a="image":r.match(/\.(pdf)((\?|#).*)?$/i)?(a="iframe",l=n.extend(!0,l,{contentType:"pdf",opts:{iframe:{preload:!1}}})):"#"===r.charAt(0)&&(a="inline")),a?l.type=a:o.trigger("objectNeedsType",l),l.contentType||(l.contentType=n.inArray(l.type,["html","inline","ajax"])>-1?"html":l.type),l.index=o.group.length,"auto"==l.opts.smallBtn&&(l.opts.smallBtn=n.inArray(l.type,["html","inline","ajax"])>-1),"auto"===l.opts.toolbar&&(l.opts.toolbar=!l.opts.smallBtn),l.$thumb=l.opts.$thumb||null,l.opts.$trigger&&l.index===o.opts.index&&(l.$thumb=l.opts.$trigger.find("img:first"),l.$thumb.length&&(l.opts.$orig=l.opts.$trigger)),l.$thumb&&l.$thumb.length||!l.opts.$orig||(l.$thumb=l.opts.$orig.find("img:first")),l.$thumb&&!l.$thumb.length&&(l.$thumb=null),l.thumb=l.opts.thumb||(l.$thumb?l.$thumb[0].src:null),"function"===n.type(l.opts.caption)&&(l.opts.caption=l.opts.caption.apply(e,[o,l])),"function"===n.type(o.opts.caption)&&(l.opts.caption=o.opts.caption.apply(e,[o,l])),l.opts.caption instanceof n||(l.opts.caption=void 0===l.opts.caption?"":l.opts.caption+""),"ajax"===l.type&&(c=r.split(/\s+/,2),c.length>1&&(l.src=c.shift(),l.opts.filter=c.shift())),l.opts.modal&&(l.opts=n.extend(!0,l.opts,{trapFocus:!0,infobar:0,toolbar:0,smallBtn:0,keyboard:0,slideShow:0,fullScreen:0,thumbs:0,touch:0,clickContent:!1,clickSlide:!1,clickOutside:!1,dblclickContent:!1,dblclickSlide:!1,dblclickOutside:!1})),o.group.push(l)}),Object.keys(o.slides).length&&(o.updateControls(),(e=o.Thumbs)&&e.isActive&&(e.create(),e.focus()))},addEvents:function(){var e=this;e.removeEvents(),e.$refs.container.on("click.fb-close","[data-fancybox-close]",function(t){t.stopPropagation(),t.preventDefault(),e.close(t)}).on("touchstart.fb-prev click.fb-prev","[data-fancybox-prev]",function(t){t.stopPropagation(),t.preventDefault(),e.previous()}).on("touchstart.fb-next click.fb-next","[data-fancybox-next]",function(t){t.stopPropagation(),t.preventDefault(),e.next()}).on("click.fb","[data-fancybox-zoom]",function(t){e[e.isScaledDown()?"scaleToActual":"scaleToFit"]()}),s.on("orientationchange.fb resize.fb",function(t){t&&t.originalEvent&&"resize"===t.originalEvent.type?(e.requestId&&u(e.requestId),e.requestId=d(function(){e.update(t)})):(e.current&&"iframe"===e.current.type&&e.$refs.stage.hide(),setTimeout(function(){e.$refs.stage.show(),e.update(t)},n.fancybox.isMobile?600:250))}),r.on("keydown.fb",function(t){var o=n.fancybox?n.fancybox.getInstance():null,i=o.current,a=t.keyCode||t.which;if(9==a)return void(i.opts.trapFocus&&e.focus(t));if(!(!i.opts.keyboard||t.ctrlKey||t.altKey||t.shiftKey||n(t.target).is("input,textarea,video,audio,select")))return 8===a||27===a?(t.preventDefault(),void e.close(t)):37===a||38===a?(t.preventDefault(),void e.previous()):39===a||40===a?(t.preventDefault(),void e.next()):void e.trigger("afterKeydown",t,a)}),e.group[e.currIndex].opts.idleTime&&(e.idleSecondsCounter=0,r.on("mousemove.fb-idle mouseleave.fb-idle mousedown.fb-idle touchstart.fb-idle touchmove.fb-idle scroll.fb-idle keydown.fb-idle",function(t){e.idleSecondsCounter=0,e.isIdle&&e.showControls(),e.isIdle=!1}),e.idleInterval=t.setInterval(function(){++e.idleSecondsCounter>=e.group[e.currIndex].opts.idleTime&&!e.isDragging&&(e.isIdle=!0,e.idleSecondsCounter=0,e.hideControls())},1e3))},removeEvents:function(){var e=this;s.off("orientationchange.fb resize.fb"),r.off("keydown.fb .fb-idle"),this.$refs.container.off(".fb-close .fb-prev .fb-next"),e.idleInterval&&(t.clearInterval(e.idleInterval),e.idleInterval=null)},previous:function(t){return this.jumpTo(this.currPos-1,t)},next:function(t){return this.jumpTo(this.currPos+1,t)},jumpTo:function(t,e){var o,i,a,s,r,c,l,d,u,f=this,h=f.group.length;if(!(f.isDragging||f.isClosing||f.isAnimating&&f.firstRun)){if(t=parseInt(t,10),!(a=f.current?f.current.opts.loop:f.opts.loop)&&(t<0||t>=h))return!1;if(o=f.firstRun=!Object.keys(f.slides).length,r=f.current,f.prevIndex=f.currIndex,f.prevPos=f.currPos,s=f.createSlide(t),h>1&&((a||s.index<h-1)&&f.createSlide(t+1),(a||s.index>0)&&f.createSlide(t-1)),f.current=s,f.currIndex=s.index,f.currPos=s.pos,f.trigger("beforeShow",o),f.updateControls(),s.forcedDuration=void 0,n.isNumeric(e)?s.forcedDuration=e:e=s.opts[o?"animationDuration":"transitionDuration"],e=parseInt(e,10),i=f.isMoved(s),s.$slide.addClass("fancybox-slide--current"),o)return s.opts.animationEffect&&e&&f.$refs.container.css("transition-duration",e+"ms"),f.$refs.container.addClass("fancybox-is-open").trigger("focus"),f.loadSlide(s),void f.preload("image");c=n.fancybox.getTranslate(r.$slide),l=n.fancybox.getTranslate(f.$refs.stage),n.each(f.slides,function(t,e){n.fancybox.stop(e.$slide,!0)}),r.pos!==s.pos&&(r.isComplete=!1),r.$slide.removeClass("fancybox-slide--complete fancybox-slide--current"),i?(u=c.left-(r.pos*c.width+r.pos*r.opts.gutter),n.each(f.slides,function(t,o){o.$slide.removeClass("fancybox-animated").removeClass(function(t,e){return(e.match(/(^|\s)fancybox-fx-\S+/g)||[]).join(" ")});var i=o.pos*c.width+o.pos*o.opts.gutter;n.fancybox.setTranslate(o.$slide,{top:0,left:i-l.left+u}),o.pos!==s.pos&&o.$slide.addClass("fancybox-slide--"+(o.pos>s.pos?"next":"previous")),p(o.$slide),n.fancybox.animate(o.$slide,{top:0,left:(o.pos-s.pos)*c.width+(o.pos-s.pos)*o.opts.gutter},e,function(){o.$slide.css({transform:"",opacity:""}).removeClass("fancybox-slide--next fancybox-slide--previous"),o.pos===f.currPos&&f.complete()})})):e&&s.opts.transitionEffect&&(d="fancybox-animated fancybox-fx-"+s.opts.transitionEffect,r.$slide.addClass("fancybox-slide--"+(r.pos>s.pos?"next":"previous")),n.fancybox.animate(r.$slide,d,e,function(){r.$slide.removeClass(d).removeClass("fancybox-slide--next fancybox-slide--previous")},!1)),s.isLoaded?f.revealContent(s):f.loadSlide(s),f.preload("image")}},createSlide:function(t){var e,o,i=this;return o=t%i.group.length,o=o<0?i.group.length+o:o,!i.slides[t]&&i.group[o]&&(e=n('<div class="fancybox-slide"></div>').appendTo(i.$refs.stage),i.slides[t]=n.extend(!0,{},i.group[o],{pos:t,$slide:e,isLoaded:!1}),i.updateSlide(i.slides[t])),i.slides[t]},scaleToActual:function(t,e,o){var i,a,s,r,c,l=this,d=l.current,u=d.$content,f=n.fancybox.getTranslate(d.$slide).width,p=n.fancybox.getTranslate(d.$slide).height,h=d.width,g=d.height;l.isAnimating||l.isMoved()||!u||"image"!=d.type||!d.isLoaded||d.hasError||(l.isAnimating=!0,n.fancybox.stop(u),t=void 0===t?.5*f:t,e=void 0===e?.5*p:e,i=n.fancybox.getTranslate(u),i.top-=n.fancybox.getTranslate(d.$slide).top,i.left-=n.fancybox.getTranslate(d.$slide).left,r=h/i.width,c=g/i.height,a=.5*f-.5*h,s=.5*p-.5*g,h>f&&(a=i.left*r-(t*r-t),a>0&&(a=0),a<f-h&&(a=f-h)),g>p&&(s=i.top*c-(e*c-e),s>0&&(s=0),s<p-g&&(s=p-g)),l.updateCursor(h,g),n.fancybox.animate(u,{top:s,left:a,scaleX:r,scaleY:c},o||366,function(){l.isAnimating=!1}),l.SlideShow&&l.SlideShow.isActive&&l.SlideShow.stop())},scaleToFit:function(t){var e,o=this,i=o.current,a=i.$content;o.isAnimating||o.isMoved()||!a||"image"!=i.type||!i.isLoaded||i.hasError||(o.isAnimating=!0,n.fancybox.stop(a),e=o.getFitPos(i),o.updateCursor(e.width,e.height),n.fancybox.animate(a,{top:e.top,left:e.left,scaleX:e.width/a.width(),scaleY:e.height/a.height()},t||366,function(){o.isAnimating=!1}))},getFitPos:function(t){var e,o,i,a,s=this,r=t.$content,c=t.$slide,l=t.width||t.opts.width,d=t.height||t.opts.height,u={};return!!(t.isLoaded&&r&&r.length)&&(e=n.fancybox.getTranslate(s.$refs.stage).width,o=n.fancybox.getTranslate(s.$refs.stage).height,e-=parseFloat(c.css("paddingLeft"))+parseFloat(c.css("paddingRight"))+parseFloat(r.css("marginLeft"))+parseFloat(r.css("marginRight")),o-=parseFloat(c.css("paddingTop"))+parseFloat(c.css("paddingBottom"))+parseFloat(r.css("marginTop"))+parseFloat(r.css("marginBottom")),l&&d||(l=e,d=o),i=Math.min(1,e/l,o/d),l*=i,d*=i,l>e-.5&&(l=e),d>o-.5&&(d=o),"image"===t.type?(u.top=Math.floor(.5*(o-d))+parseFloat(c.css("paddingTop")),u.left=Math.floor(.5*(e-l))+parseFloat(c.css("paddingLeft"))):"video"===t.contentType&&(a=t.opts.width&&t.opts.height?l/d:t.opts.ratio||16/9,d>l/a?d=l/a:l>d*a&&(l=d*a)),u.width=l,u.height=d,u)},update:function(t){var e=this;n.each(e.slides,function(n,o){e.updateSlide(o,t)})},updateSlide:function(t,e){var o=this,i=t&&t.$content,a=t.width||t.opts.width,s=t.height||t.opts.height,r=t.$slide;o.adjustCaption(t),i&&(a||s||"video"===t.contentType)&&!t.hasError&&(n.fancybox.stop(i),n.fancybox.setTranslate(i,o.getFitPos(t)),t.pos===o.currPos&&(o.isAnimating=!1,o.updateCursor())),o.adjustLayout(t),r.length&&(r.trigger("refresh"),t.pos===o.currPos&&o.$refs.toolbar.add(o.$refs.navigation.find(".fancybox-button--arrow_right")).toggleClass("compensate-for-scrollbar",r.get(0).scrollHeight>r.get(0).clientHeight)),o.trigger("onUpdate",t,e)},centerSlide:function(t){var e=this,o=e.current,i=o.$slide;!e.isClosing&&o&&(i.siblings().css({transform:"",opacity:""}),i.parent().children().removeClass("fancybox-slide--previous fancybox-slide--next"),n.fancybox.animate(i,{top:0,left:0,opacity:1},void 0===t?0:t,function(){i.css({transform:"",opacity:""}),o.isComplete||e.complete()},!1))},isMoved:function(t){var e,o,i=t||this.current;return!!i&&(o=n.fancybox.getTranslate(this.$refs.stage),e=n.fancybox.getTranslate(i.$slide),!i.$slide.hasClass("fancybox-animated")&&(Math.abs(e.top-o.top)>.5||Math.abs(e.left-o.left)>.5))},updateCursor:function(t,e){var o,i,a=this,s=a.current,r=a.$refs.container;s&&!a.isClosing&&a.Guestures&&(r.removeClass("fancybox-is-zoomable fancybox-can-zoomIn fancybox-can-zoomOut fancybox-can-swipe fancybox-can-pan"),o=a.canPan(t,e),i=!!o||a.isZoomable(),r.toggleClass("fancybox-is-zoomable",i),n("[data-fancybox-zoom]").prop("disabled",!i),o?r.addClass("fancybox-can-pan"):i&&("zoom"===s.opts.clickContent||n.isFunction(s.opts.clickContent)&&"zoom"==s.opts.clickContent(s))?r.addClass("fancybox-can-zoomIn"):s.opts.touch&&(s.opts.touch.vertical||a.group.length>1)&&"video"!==s.contentType&&r.addClass("fancybox-can-swipe"))},isZoomable:function(){var t,e=this,n=e.current;if(n&&!e.isClosing&&"image"===n.type&&!n.hasError){if(!n.isLoaded)return!0;if((t=e.getFitPos(n))&&(n.width>t.width||n.height>t.height))return!0}return!1},isScaledDown:function(t,e){var o=this,i=!1,a=o.current,s=a.$content;return void 0!==t&&void 0!==e?i=t<a.width&&e<a.height:s&&(i=n.fancybox.getTranslate(s),i=i.width<a.width&&i.height<a.height),i},canPan:function(t,e){var o=this,i=o.current,a=null,s=!1;return"image"===i.type&&(i.isComplete||t&&e)&&!i.hasError&&(s=o.getFitPos(i),void 0!==t&&void 0!==e?a={width:t,height:e}:i.isComplete&&(a=n.fancybox.getTranslate(i.$content)),a&&s&&(s=Math.abs(a.width-s.width)>1.5||Math.abs(a.height-s.height)>1.5)),s},loadSlide:function(t){var e,o,i,a=this;if(!t.isLoading&&!t.isLoaded){if(t.isLoading=!0,!1===a.trigger("beforeLoad",t))return t.isLoading=!1,!1;switch(e=t.type,o=t.$slide,o.off("refresh").trigger("onReset").addClass(t.opts.slideClass),e){case"image":a.setImage(t);break;case"iframe":a.setIframe(t);break;case"html":a.setContent(t,t.src||t.content);break;case"video":a.setContent(t,t.opts.video.tpl.replace(/\{\{src\}\}/gi,t.src).replace("{{format}}",t.opts.videoFormat||t.opts.video.format||"").replace("{{poster}}",t.thumb||""));break;case"inline":n(t.src).length?a.setContent(t,n(t.src)):a.setError(t);break;case"ajax":a.showLoading(t),i=n.ajax(n.extend({},t.opts.ajax.settings,{url:t.src,success:function(e,n){"success"===n&&a.setContent(t,e)},error:function(e,n){e&&"abort"!==n&&a.setError(t)}})),o.one("onReset",function(){i.abort()});break;default:a.setError(t)}return!0}},setImage:function(t){var o,i=this;setTimeout(function(){var e=t.$image;i.isClosing||!t.isLoading||e&&e.length&&e[0].complete||t.hasError||i.showLoading(t)},50),i.checkSrcset(t),t.$content=n('<div class="fancybox-content"></div>').addClass("fancybox-is-hidden").appendTo(t.$slide.addClass("fancybox-slide--image")),!1!==t.opts.preload&&t.opts.width&&t.opts.height&&t.thumb&&(t.width=t.opts.width,t.height=t.opts.height,o=e.createElement("img"),o.onerror=function(){n(this).remove(),t.$ghost=null},o.onload=function(){i.afterLoad(t)},t.$ghost=n(o).addClass("fancybox-image").appendTo(t.$content).attr("src",t.thumb)),i.setBigImage(t)},checkSrcset:function(e){var n,o,i,a,s=e.opts.srcset||e.opts.image.srcset;if(s){i=t.devicePixelRatio||1,a=t.innerWidth*i,o=s.split(",").map(function(t){var e={};return t.trim().split(/\s+/).forEach(function(t,n){var o=parseInt(t.substring(0,t.length-1),10);if(0===n)return e.url=t;o&&(e.value=o,e.postfix=t[t.length-1])}),e}),o.sort(function(t,e){return t.value-e.value});for(var r=0;r<o.length;r++){var c=o[r];if("w"===c.postfix&&c.value>=a||"x"===c.postfix&&c.value>=i){n=c;break}}!n&&o.length&&(n=o[o.length-1]),n&&(e.src=n.url,e.width&&e.height&&"w"==n.postfix&&(e.height=e.width/e.height*n.value,e.width=n.value),e.opts.srcset=s)}},setBigImage:function(t){var o=this,i=e.createElement("img"),a=n(i);t.$image=a.one("error",function(){o.setError(t)}).one("load",function(){var e;t.$ghost||(o.resolveImageSlideSize(t,this.naturalWidth,this.naturalHeight),o.afterLoad(t)),o.isClosing||(t.opts.srcset&&(e=t.opts.sizes,e&&"auto"!==e||(e=(t.width/t.height>1&&s.width()/s.height()>1?"100":Math.round(t.width/t.height*100))+"vw"),a.attr("sizes",e).attr("srcset",t.opts.srcset)),t.$ghost&&setTimeout(function(){t.$ghost&&!o.isClosing&&t.$ghost.hide()},Math.min(300,Math.max(1e3,t.height/1600))),o.hideLoading(t))}).addClass("fancybox-image").attr("src",t.src).appendTo(t.$content),(i.complete||"complete"==i.readyState)&&a.naturalWidth&&a.naturalHeight?a.trigger("load"):i.error&&a.trigger("error")},resolveImageSlideSize:function(t,e,n){var o=parseInt(t.opts.width,10),i=parseInt(t.opts.height,10);t.width=e,t.height=n,o>0&&(t.width=o,t.height=Math.floor(o*n/e)),i>0&&(t.width=Math.floor(i*e/n),t.height=i)},setIframe:function(t){var e,o=this,i=t.opts.iframe,a=t.$slide;t.$content=n('<div class="fancybox-content'+(i.preload?" fancybox-is-hidden":"")+'"></div>').css(i.css).appendTo(a),a.addClass("fancybox-slide--"+t.contentType),t.$iframe=e=n(i.tpl.replace(/\{rnd\}/g,(new Date).getTime())).attr(i.attr).appendTo(t.$content),i.preload?(o.showLoading(t),e.on("load.fb error.fb",function(e){this.isReady=1,t.$slide.trigger("refresh"),o.afterLoad(t)}),a.on("refresh.fb",function(){var n,o,s=t.$content,r=i.css.width,c=i.css.height;if(1===e[0].isReady){try{n=e.contents(),o=n.find("body")}catch(t){}o&&o.length&&o.children().length&&(a.css("overflow","visible"),s.css({width:"100%","max-width":"100%",height:"9999px"}),void 0===r&&(r=Math.ceil(Math.max(o[0].clientWidth,o.outerWidth(!0)))),s.css("width",r||"").css("max-width",""),void 0===c&&(c=Math.ceil(Math.max(o[0].clientHeight,o.outerHeight(!0)))),s.css("height",c||""),a.css("overflow","auto")),s.removeClass("fancybox-is-hidden")}})):o.afterLoad(t),e.attr("src",t.src),a.one("onReset",function(){try{n(this).find("iframe").hide().unbind().attr("src","//about:blank")}catch(t){}n(this).off("refresh.fb").empty(),t.isLoaded=!1,t.isRevealed=!1})},setContent:function(t,e){var o=this;o.isClosing||(o.hideLoading(t),t.$content&&n.fancybox.stop(t.$content),t.$slide.empty(),l(e)&&e.parent().length?((e.hasClass("fancybox-content")||e.parent().hasClass("fancybox-content"))&&e.parents(".fancybox-slide").trigger("onReset"),t.$placeholder=n("<div>").hide().insertAfter(e),e.css("display","inline-block")):t.hasError||("string"===n.type(e)&&(e=n("<div>").append(n.trim(e)).contents()),t.opts.filter&&(e=n("<div>").html(e).find(t.opts.filter))),t.$slide.one("onReset",function(){n(this).find("video,audio").trigger("pause"),t.$placeholder&&(t.$placeholder.after(e.removeClass("fancybox-content").hide()).remove(),t.$placeholder=null),t.$smallBtn&&(t.$smallBtn.remove(),t.$smallBtn=null),t.hasError||(n(this).empty(),t.isLoaded=!1,t.isRevealed=!1)}),n(e).appendTo(t.$slide),n(e).is("video,audio")&&(n(e).addClass("fancybox-video"),n(e).wrap("<div></div>"),t.contentType="video",t.opts.width=t.opts.width||n(e).attr("width"),t.opts.height=t.opts.height||n(e).attr("height")),t.$content=t.$slide.children().filter("div,form,main,video,audio,article,.fancybox-content").first(),t.$content.siblings().hide(),t.$content.length||(t.$content=t.$slide.wrapInner("<div></div>").children().first()),t.$content.addClass("fancybox-content"),t.$slide.addClass("fancybox-slide--"+t.contentType),o.afterLoad(t))},setError:function(t){t.hasError=!0,t.$slide.trigger("onReset").removeClass("fancybox-slide--"+t.contentType).addClass("fancybox-slide--error"),t.contentType="html",this.setContent(t,this.translate(t,t.opts.errorTpl)),t.pos===this.currPos&&(this.isAnimating=!1)},showLoading:function(t){var e=this;(t=t||e.current)&&!t.$spinner&&(t.$spinner=n(e.translate(e,e.opts.spinnerTpl)).appendTo(t.$slide).hide().fadeIn("fast"))},hideLoading:function(t){var e=this;(t=t||e.current)&&t.$spinner&&(t.$spinner.stop().remove(),delete t.$spinner)},afterLoad:function(t){var e=this;e.isClosing||(t.isLoading=!1,t.isLoaded=!0,e.trigger("afterLoad",t),e.hideLoading(t),!t.opts.smallBtn||t.$smallBtn&&t.$smallBtn.length||(t.$smallBtn=n(e.translate(t,t.opts.btnTpl.smallBtn)).appendTo(t.$content)),t.opts.protect&&t.$content&&!t.hasError&&(t.$content.on("contextmenu.fb",function(t){return 2==t.button&&t.preventDefault(),!0}),"image"===t.type&&n('<div class="fancybox-spaceball"></div>').appendTo(t.$content)),e.adjustCaption(t),e.adjustLayout(t),t.pos===e.currPos&&e.updateCursor(),e.revealContent(t))},adjustCaption:function(t){var e,n=this,o=t||n.current,i=o.opts.caption,a=o.opts.preventCaptionOverlap,s=n.$refs.caption,r=!1;s.toggleClass("fancybox-caption--separate",a),a&&i&&i.length&&(o.pos!==n.currPos?(e=s.clone().appendTo(s.parent()),e.children().eq(0).empty().html(i),r=e.outerHeight(!0),e.empty().remove()):n.$caption&&(r=n.$caption.outerHeight(!0)),o.$slide.css("padding-bottom",r||""))},adjustLayout:function(t){var e,n,o,i,a=this,s=t||a.current;s.isLoaded&&!0!==s.opts.disableLayoutFix&&(s.$content.css("margin-bottom",""),s.$content.outerHeight()>s.$slide.height()+.5&&(o=s.$slide[0].style["padding-bottom"],i=s.$slide.css("padding-bottom"),parseFloat(i)>0&&(e=s.$slide[0].scrollHeight,s.$slide.css("padding-bottom",0),Math.abs(e-s.$slide[0].scrollHeight)<1&&(n=i),s.$slide.css("padding-bottom",o))),s.$content.css("margin-bottom",n))},revealContent:function(t){var e,o,i,a,s=this,r=t.$slide,c=!1,l=!1,d=s.isMoved(t),u=t.isRevealed;return t.isRevealed=!0,e=t.opts[s.firstRun?"animationEffect":"transitionEffect"],i=t.opts[s.firstRun?"animationDuration":"transitionDuration"],i=parseInt(void 0===t.forcedDuration?i:t.forcedDuration,10),!d&&t.pos===s.currPos&&i||(e=!1),"zoom"===e&&(t.pos===s.currPos&&i&&"image"===t.type&&!t.hasError&&(l=s.getThumbPos(t))?c=s.getFitPos(t):e="fade"),"zoom"===e?(s.isAnimating=!0,c.scaleX=c.width/l.width,c.scaleY=c.height/l.height,a=t.opts.zoomOpacity,"auto"==a&&(a=Math.abs(t.width/t.height-l.width/l.height)>.1),a&&(l.opacity=.1,c.opacity=1),n.fancybox.setTranslate(t.$content.removeClass("fancybox-is-hidden"),l),p(t.$content),void n.fancybox.animate(t.$content,c,i,function(){s.isAnimating=!1,s.complete()})):(s.updateSlide(t),e?(n.fancybox.stop(r),o="fancybox-slide--"+(t.pos>=s.prevPos?"next":"previous")+" fancybox-animated fancybox-fx-"+e,r.addClass(o).removeClass("fancybox-slide--current"),t.$content.removeClass("fancybox-is-hidden"),p(r),"image"!==t.type&&t.$content.hide().show(0),void n.fancybox.animate(r,"fancybox-slide--current",i,function(){r.removeClass(o).css({transform:"",opacity:""}),t.pos===s.currPos&&s.complete()},!0)):(t.$content.removeClass("fancybox-is-hidden"),u||!d||"image"!==t.type||t.hasError||t.$content.hide().fadeIn("fast"),void(t.pos===s.currPos&&s.complete())))},getThumbPos:function(t){var e,o,i,a,s,r=!1,c=t.$thumb;return!(!c||!g(c[0]))&&(e=n.fancybox.getTranslate(c),o=parseFloat(c.css("border-top-width")||0),i=parseFloat(c.css("border-right-width")||0),a=parseFloat(c.css("border-bottom-width")||0),s=parseFloat(c.css("border-left-width")||0),r={top:e.top+o,left:e.left+s,width:e.width-i-s,height:e.height-o-a,scaleX:1,scaleY:1},e.width>0&&e.height>0&&r)},complete:function(){var t,e=this,o=e.current,i={};!e.isMoved()&&o.isLoaded&&(o.isComplete||(o.isComplete=!0,o.$slide.siblings().trigger("onReset"),e.preload("inline"),p(o.$slide),o.$slide.addClass("fancybox-slide--complete"),n.each(e.slides,function(t,o){o.pos>=e.currPos-1&&o.pos<=e.currPos+1?i[o.pos]=o:o&&(n.fancybox.stop(o.$slide),o.$slide.off().remove())}),e.slides=i),e.isAnimating=!1,e.updateCursor(),e.trigger("afterShow"),o.opts.video.autoStart&&o.$slide.find("video,audio").filter(":visible:first").trigger("play").one("ended",function(){Document.exitFullscreen?Document.exitFullscreen():this.webkitExitFullscreen&&this.webkitExitFullscreen(),e.next()}),o.opts.autoFocus&&"html"===o.contentType&&(t=o.$content.find("input[autofocus]:enabled:visible:first"),t.length?t.trigger("focus"):e.focus(null,!0)),o.$slide.scrollTop(0).scrollLeft(0))},preload:function(t){var e,n,o=this;o.group.length<2||(n=o.slides[o.currPos+1],e=o.slides[o.currPos-1],e&&e.type===t&&o.loadSlide(e),n&&n.type===t&&o.loadSlide(n))},focus:function(t,o){var i,a,s=this,r=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","video","audio","[contenteditable]",'[tabindex]:not([tabindex^="-"])'].join(",");s.isClosing||(i=!t&&s.current&&s.current.isComplete?s.current.$slide.find("*:visible"+(o?":not(.fancybox-close-small)":"")):s.$refs.container.find("*:visible"),i=i.filter(r).filter(function(){return"hidden"!==n(this).css("visibility")&&!n(this).hasClass("disabled")}),i.length?(a=i.index(e.activeElement),t&&t.shiftKey?(a<0||0==a)&&(t.preventDefault(),i.eq(i.length-1).trigger("focus")):(a<0||a==i.length-1)&&(t&&t.preventDefault(),i.eq(0).trigger("focus"))):s.$refs.container.trigger("focus"))},activate:function(){var t=this;n(".fancybox-container").each(function(){var e=n(this).data("FancyBox");e&&e.id!==t.id&&!e.isClosing&&(e.trigger("onDeactivate"),e.removeEvents(),e.isVisible=!1)}),t.isVisible=!0,(t.current||t.isIdle)&&(t.update(),t.updateControls()),t.trigger("onActivate"),t.addEvents()},close:function(t,e){var o,i,a,s,r,c,l,u=this,f=u.current,h=function(){u.cleanUp(t)};return!u.isClosing&&(u.isClosing=!0,!1===u.trigger("beforeClose",t)?(u.isClosing=!1,d(function(){u.update()}),!1):(u.removeEvents(),a=f.$content,o=f.opts.animationEffect,i=n.isNumeric(e)?e:o?f.opts.animationDuration:0,f.$slide.removeClass("fancybox-slide--complete fancybox-slide--next fancybox-slide--previous fancybox-animated"),!0!==t?n.fancybox.stop(f.$slide):o=!1,f.$slide.siblings().trigger("onReset").remove(),i&&u.$refs.container.removeClass("fancybox-is-open").addClass("fancybox-is-closing").css("transition-duration",i+"ms"),u.hideLoading(f),u.hideControls(!0),u.updateCursor(),"zoom"!==o||a&&i&&"image"===f.type&&!u.isMoved()&&!f.hasError&&(l=u.getThumbPos(f))||(o="fade"),"zoom"===o?(n.fancybox.stop(a),s=n.fancybox.getTranslate(a),c={top:s.top,left:s.left,scaleX:s.width/l.width,scaleY:s.height/l.height,width:l.width,height:l.height},r=f.opts.zoomOpacity,
"auto"==r&&(r=Math.abs(f.width/f.height-l.width/l.height)>.1),r&&(l.opacity=0),n.fancybox.setTranslate(a,c),p(a),n.fancybox.animate(a,l,i,h),!0):(o&&i?n.fancybox.animate(f.$slide.addClass("fancybox-slide--previous").removeClass("fancybox-slide--current"),"fancybox-animated fancybox-fx-"+o,i,h):!0===t?setTimeout(h,i):h(),!0)))},cleanUp:function(e){var o,i,a,s=this,r=s.current.opts.$orig;s.current.$slide.trigger("onReset"),s.$refs.container.empty().remove(),s.trigger("afterClose",e),s.current.opts.backFocus&&(r&&r.length&&r.is(":visible")||(r=s.$trigger),r&&r.length&&(i=t.scrollX,a=t.scrollY,r.trigger("focus"),n("html, body").scrollTop(a).scrollLeft(i))),s.current=null,o=n.fancybox.getInstance(),o?o.activate():(n("body").removeClass("fancybox-active compensate-for-scrollbar"),n("#fancybox-style-noscroll").remove())},trigger:function(t,e){var o,i=Array.prototype.slice.call(arguments,1),a=this,s=e&&e.opts?e:a.current;if(s?i.unshift(s):s=a,i.unshift(a),n.isFunction(s.opts[t])&&(o=s.opts[t].apply(s,i)),!1===o)return o;"afterClose"!==t&&a.$refs?a.$refs.container.trigger(t+".fb",i):r.trigger(t+".fb",i)},updateControls:function(){var t=this,o=t.current,i=o.index,a=t.$refs.container,s=t.$refs.caption,r=o.opts.caption;o.$slide.trigger("refresh"),r&&r.length?(t.$caption=s,s.children().eq(0).html(r)):t.$caption=null,t.hasHiddenControls||t.isIdle||t.showControls(),a.find("[data-fancybox-count]").html(t.group.length),a.find("[data-fancybox-index]").html(i+1),a.find("[data-fancybox-prev]").prop("disabled",!o.opts.loop&&i<=0),a.find("[data-fancybox-next]").prop("disabled",!o.opts.loop&&i>=t.group.length-1),"image"===o.type?a.find("[data-fancybox-zoom]").show().end().find("[data-fancybox-download]").attr("href",o.opts.image.src||o.src).show():o.opts.toolbar&&a.find("[data-fancybox-download],[data-fancybox-zoom]").hide(),n(e.activeElement).is(":hidden,[disabled]")&&t.$refs.container.trigger("focus")},hideControls:function(t){var e=this,n=["infobar","toolbar","nav"];!t&&e.current.opts.preventCaptionOverlap||n.push("caption"),this.$refs.container.removeClass(n.map(function(t){return"fancybox-show-"+t}).join(" ")),this.hasHiddenControls=!0},showControls:function(){var t=this,e=t.current?t.current.opts:t.opts,n=t.$refs.container;t.hasHiddenControls=!1,t.idleSecondsCounter=0,n.toggleClass("fancybox-show-toolbar",!(!e.toolbar||!e.buttons)).toggleClass("fancybox-show-infobar",!!(e.infobar&&t.group.length>1)).toggleClass("fancybox-show-caption",!!t.$caption).toggleClass("fancybox-show-nav",!!(e.arrows&&t.group.length>1)).toggleClass("fancybox-is-modal",!!e.modal)},toggleControls:function(){this.hasHiddenControls?this.showControls():this.hideControls()}}),n.fancybox={version:"3.5.7",defaults:a,getInstance:function(t){var e=n('.fancybox-container:not(".fancybox-is-closing"):last').data("FancyBox"),o=Array.prototype.slice.call(arguments,1);return e instanceof b&&("string"===n.type(t)?e[t].apply(e,o):"function"===n.type(t)&&t.apply(e,o),e)},open:function(t,e,n){return new b(t,e,n)},close:function(t){var e=this.getInstance();e&&(e.close(),!0===t&&this.close(t))},destroy:function(){this.close(!0),r.add("body").off("click.fb-start","**")},isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),use3d:function(){var n=e.createElement("div");return t.getComputedStyle&&t.getComputedStyle(n)&&t.getComputedStyle(n).getPropertyValue("transform")&&!(e.documentMode&&e.documentMode<11)}(),getTranslate:function(t){var e;return!(!t||!t.length)&&(e=t[0].getBoundingClientRect(),{top:e.top||0,left:e.left||0,width:e.width,height:e.height,opacity:parseFloat(t.css("opacity"))})},setTranslate:function(t,e){var n="",o={};if(t&&e)return void 0===e.left&&void 0===e.top||(n=(void 0===e.left?t.position().left:e.left)+"px, "+(void 0===e.top?t.position().top:e.top)+"px",n=this.use3d?"translate3d("+n+", 0px)":"translate("+n+")"),void 0!==e.scaleX&&void 0!==e.scaleY?n+=" scale("+e.scaleX+", "+e.scaleY+")":void 0!==e.scaleX&&(n+=" scaleX("+e.scaleX+")"),n.length&&(o.transform=n),void 0!==e.opacity&&(o.opacity=e.opacity),void 0!==e.width&&(o.width=e.width),void 0!==e.height&&(o.height=e.height),t.css(o)},animate:function(t,e,o,i,a){var s,r=this;n.isFunction(o)&&(i=o,o=null),r.stop(t),s=r.getTranslate(t),t.on(f,function(c){(!c||!c.originalEvent||t.is(c.originalEvent.target)&&"z-index"!=c.originalEvent.propertyName)&&(r.stop(t),n.isNumeric(o)&&t.css("transition-duration",""),n.isPlainObject(e)?void 0!==e.scaleX&&void 0!==e.scaleY&&r.setTranslate(t,{top:e.top,left:e.left,width:s.width*e.scaleX,height:s.height*e.scaleY,scaleX:1,scaleY:1}):!0!==a&&t.removeClass(e),n.isFunction(i)&&i(c))}),n.isNumeric(o)&&t.css("transition-duration",o+"ms"),n.isPlainObject(e)?(void 0!==e.scaleX&&void 0!==e.scaleY&&(delete e.width,delete e.height,t.parent().hasClass("fancybox-slide--image")&&t.parent().addClass("fancybox-is-scaling")),n.fancybox.setTranslate(t,e)):t.addClass(e),t.data("timer",setTimeout(function(){t.trigger(f)},o+33))},stop:function(t,e){t&&t.length&&(clearTimeout(t.data("timer")),e&&t.trigger(f),t.off(f).css("transition-duration",""),t.parent().removeClass("fancybox-is-scaling"))}},n.fn.fancybox=function(t){var e;return t=t||{},e=t.selector||!1,e?n("body").off("click.fb-start",e).on("click.fb-start",e,{options:t},i):this.off("click.fb-start").on("click.fb-start",{items:this,options:t},i),this},r.on("click.fb-start","[data-fancybox]",i),r.on("click.fb-start","[data-fancybox-trigger]",function(t){n('[data-fancybox="'+n(this).attr("data-fancybox-trigger")+'"]').eq(n(this).attr("data-fancybox-index")||0).trigger("click.fb-start",{$trigger:n(this)})}),function(){var t=null;r.on("mousedown mouseup focus blur",".fancybox-button",function(e){switch(e.type){case"mousedown":t=n(this);break;case"mouseup":t=null;break;case"focusin":n(".fancybox-button").removeClass("fancybox-focus"),n(this).is(t)||n(this).is("[disabled]")||n(this).addClass("fancybox-focus");break;case"focusout":n(".fancybox-button").removeClass("fancybox-focus")}})}()}}(window,document,jQuery),function(t){"use strict";var e={youtube:{matcher:/(youtube\.com|youtu\.be|youtube\-nocookie\.com)\/(watch\?(.*&)?v=|v\/|u\/|embed\/?)?(videoseries\?list=(.*)|[\w-]{11}|\?listType=(.*)&list=(.*))(.*)/i,params:{autoplay:1,autohide:1,fs:1,rel:0,hd:1,wmode:"transparent",enablejsapi:1,html5:1},paramPlace:8,type:"iframe",url:"https://www.youtube-nocookie.com/embed/$4",thumb:"https://img.youtube.com/vi/$4/hqdefault.jpg"},vimeo:{matcher:/^.+vimeo.com\/(.*\/)?([\d]+)(.*)?/,params:{autoplay:1,hd:1,show_title:1,show_byline:1,show_portrait:0,fullscreen:1},paramPlace:3,type:"iframe",url:"//player.vimeo.com/video/$2"},instagram:{matcher:/(instagr\.am|instagram\.com)\/p\/([a-zA-Z0-9_\-]+)\/?/i,type:"image",url:"//$1/p/$2/media/?size=l"},gmap_place:{matcher:/(maps\.)?google\.([a-z]{2,3}(\.[a-z]{2})?)\/(((maps\/(place\/(.*)\/)?\@(.*),(\d+.?\d+?)z))|(\?ll=))(.*)?/i,type:"iframe",url:function(t){return"//maps.google."+t[2]+"/?ll="+(t[9]?t[9]+"&z="+Math.floor(t[10])+(t[12]?t[12].replace(/^\//,"&"):""):t[12]+"").replace(/\?/,"&")+"&output="+(t[12]&&t[12].indexOf("layer=c")>0?"svembed":"embed")}},gmap_search:{matcher:/(maps\.)?google\.([a-z]{2,3}(\.[a-z]{2})?)\/(maps\/search\/)(.*)/i,type:"iframe",url:function(t){return"//maps.google."+t[2]+"/maps?q="+t[5].replace("query=","q=").replace("api=1","")+"&output=embed"}}},n=function(e,n,o){if(e)return o=o||"","object"===t.type(o)&&(o=t.param(o,!0)),t.each(n,function(t,n){e=e.replace("$"+t,n||"")}),o.length&&(e+=(e.indexOf("?")>0?"&":"?")+o),e};t(document).on("objectNeedsType.fb",function(o,i,a){var s,r,c,l,d,u,f,p=a.src||"",h=!1;s=t.extend(!0,{},e,a.opts.media),t.each(s,function(e,o){if(c=p.match(o.matcher)){if(h=o.type,f=e,u={},o.paramPlace&&c[o.paramPlace]){d=c[o.paramPlace],"?"==d[0]&&(d=d.substring(1)),d=d.split("&");for(var i=0;i<d.length;++i){var s=d[i].split("=",2);2==s.length&&(u[s[0]]=decodeURIComponent(s[1].replace(/\+/g," ")))}}return l=t.extend(!0,{},o.params,a.opts[e],u),p="function"===t.type(o.url)?o.url.call(this,c,l,a):n(o.url,c,l),r="function"===t.type(o.thumb)?o.thumb.call(this,c,l,a):n(o.thumb,c),"youtube"===e?p=p.replace(/&t=((\d+)m)?(\d+)s/,function(t,e,n,o){return"&start="+((n?60*parseInt(n,10):0)+parseInt(o,10))}):"vimeo"===e&&(p=p.replace("&%23","#")),!1}}),h?(a.opts.thumb||a.opts.$thumb&&a.opts.$thumb.length||(a.opts.thumb=r),"iframe"===h&&(a.opts=t.extend(!0,a.opts,{iframe:{preload:!1,attr:{scrolling:"no"}}})),t.extend(a,{type:h,src:p,origSrc:a.src,contentSource:f,contentType:"image"===h?"image":"gmap_place"==f||"gmap_search"==f?"map":"video"})):p&&(a.type=a.opts.defaultType)});var o={youtube:{src:"https://www.youtube.com/iframe_api",class:"YT",loading:!1,loaded:!1},vimeo:{src:"https://player.vimeo.com/api/player.js",class:"Vimeo",loading:!1,loaded:!1},load:function(t){var e,n=this;if(this[t].loaded)return void setTimeout(function(){n.done(t)});this[t].loading||(this[t].loading=!0,e=document.createElement("script"),e.type="text/javascript",e.src=this[t].src,"youtube"===t?window.onYouTubeIframeAPIReady=function(){n[t].loaded=!0,n.done(t)}:e.onload=function(){n[t].loaded=!0,n.done(t)},document.body.appendChild(e))},done:function(e){var n,o,i;"youtube"===e&&delete window.onYouTubeIframeAPIReady,(n=t.fancybox.getInstance())&&(o=n.current.$content.find("iframe"),"youtube"===e&&void 0!==YT&&YT?i=new YT.Player(o.attr("id"),{events:{onStateChange:function(t){0==t.data&&n.next()}}}):"vimeo"===e&&void 0!==Vimeo&&Vimeo&&(i=new Vimeo.Player(o),i.on("ended",function(){n.next()})))}};t(document).on({"afterShow.fb":function(t,e,n){e.group.length>1&&("youtube"===n.contentSource||"vimeo"===n.contentSource)&&o.load(n.contentSource)}})}(jQuery),function(t,e,n){"use strict";var o=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||function(e){return t.setTimeout(e,1e3/60)}}(),i=function(){return t.cancelAnimationFrame||t.webkitCancelAnimationFrame||t.mozCancelAnimationFrame||t.oCancelAnimationFrame||function(e){t.clearTimeout(e)}}(),a=function(e){var n=[];e=e.originalEvent||e||t.e,e=e.touches&&e.touches.length?e.touches:e.changedTouches&&e.changedTouches.length?e.changedTouches:[e];for(var o in e)e[o].pageX?n.push({x:e[o].pageX,y:e[o].pageY}):e[o].clientX&&n.push({x:e[o].clientX,y:e[o].clientY});return n},s=function(t,e,n){return e&&t?"x"===n?t.x-e.x:"y"===n?t.y-e.y:Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)):0},r=function(t){if(t.is('a,area,button,[role="button"],input,label,select,summary,textarea,video,audio,iframe')||n.isFunction(t.get(0).onclick)||t.data("selectable"))return!0;for(var e=0,o=t[0].attributes,i=o.length;e<i;e++)if("data-fancybox-"===o[e].nodeName.substr(0,14))return!0;return!1},c=function(e){var n=t.getComputedStyle(e)["overflow-y"],o=t.getComputedStyle(e)["overflow-x"],i=("scroll"===n||"auto"===n)&&e.scrollHeight>e.clientHeight,a=("scroll"===o||"auto"===o)&&e.scrollWidth>e.clientWidth;return i||a},l=function(t){for(var e=!1;;){if(e=c(t.get(0)))break;if(t=t.parent(),!t.length||t.hasClass("fancybox-stage")||t.is("body"))break}return e},d=function(t){var e=this;e.instance=t,e.$bg=t.$refs.bg,e.$stage=t.$refs.stage,e.$container=t.$refs.container,e.destroy(),e.$container.on("touchstart.fb.touch mousedown.fb.touch",n.proxy(e,"ontouchstart"))};d.prototype.destroy=function(){var t=this;t.$container.off(".fb.touch"),n(e).off(".fb.touch"),t.requestId&&(i(t.requestId),t.requestId=null),t.tapped&&(clearTimeout(t.tapped),t.tapped=null)},d.prototype.ontouchstart=function(o){var i=this,c=n(o.target),d=i.instance,u=d.current,f=u.$slide,p=u.$content,h="touchstart"==o.type;if(h&&i.$container.off("mousedown.fb.touch"),(!o.originalEvent||2!=o.originalEvent.button)&&f.length&&c.length&&!r(c)&&!r(c.parent())&&(c.is("img")||!(o.originalEvent.clientX>c[0].clientWidth+c.offset().left))){if(!u||d.isAnimating||u.$slide.hasClass("fancybox-animated"))return o.stopPropagation(),void o.preventDefault();i.realPoints=i.startPoints=a(o),i.startPoints.length&&(u.touch&&o.stopPropagation(),i.startEvent=o,i.canTap=!0,i.$target=c,i.$content=p,i.opts=u.opts.touch,i.isPanning=!1,i.isSwiping=!1,i.isZooming=!1,i.isScrolling=!1,i.canPan=d.canPan(),i.startTime=(new Date).getTime(),i.distanceX=i.distanceY=i.distance=0,i.canvasWidth=Math.round(f[0].clientWidth),i.canvasHeight=Math.round(f[0].clientHeight),i.contentLastPos=null,i.contentStartPos=n.fancybox.getTranslate(i.$content)||{top:0,left:0},i.sliderStartPos=n.fancybox.getTranslate(f),i.stagePos=n.fancybox.getTranslate(d.$refs.stage),i.sliderStartPos.top-=i.stagePos.top,i.sliderStartPos.left-=i.stagePos.left,i.contentStartPos.top-=i.stagePos.top,i.contentStartPos.left-=i.stagePos.left,n(e).off(".fb.touch").on(h?"touchend.fb.touch touchcancel.fb.touch":"mouseup.fb.touch mouseleave.fb.touch",n.proxy(i,"ontouchend")).on(h?"touchmove.fb.touch":"mousemove.fb.touch",n.proxy(i,"ontouchmove")),n.fancybox.isMobile&&e.addEventListener("scroll",i.onscroll,!0),((i.opts||i.canPan)&&(c.is(i.$stage)||i.$stage.find(c).length)||(c.is(".fancybox-image")&&o.preventDefault(),n.fancybox.isMobile&&c.parents(".fancybox-caption").length))&&(i.isScrollable=l(c)||l(c.parent()),n.fancybox.isMobile&&i.isScrollable||o.preventDefault(),(1===i.startPoints.length||u.hasError)&&(i.canPan?(n.fancybox.stop(i.$content),i.isPanning=!0):i.isSwiping=!0,i.$container.addClass("fancybox-is-grabbing")),2===i.startPoints.length&&"image"===u.type&&(u.isLoaded||u.$ghost)&&(i.canTap=!1,i.isSwiping=!1,i.isPanning=!1,i.isZooming=!0,n.fancybox.stop(i.$content),i.centerPointStartX=.5*(i.startPoints[0].x+i.startPoints[1].x)-n(t).scrollLeft(),i.centerPointStartY=.5*(i.startPoints[0].y+i.startPoints[1].y)-n(t).scrollTop(),i.percentageOfImageAtPinchPointX=(i.centerPointStartX-i.contentStartPos.left)/i.contentStartPos.width,i.percentageOfImageAtPinchPointY=(i.centerPointStartY-i.contentStartPos.top)/i.contentStartPos.height,i.startDistanceBetweenFingers=s(i.startPoints[0],i.startPoints[1]))))}},d.prototype.onscroll=function(t){var n=this;n.isScrolling=!0,e.removeEventListener("scroll",n.onscroll,!0)},d.prototype.ontouchmove=function(t){var e=this;return void 0!==t.originalEvent.buttons&&0===t.originalEvent.buttons?void e.ontouchend(t):e.isScrolling?void(e.canTap=!1):(e.newPoints=a(t),void((e.opts||e.canPan)&&e.newPoints.length&&e.newPoints.length&&(e.isSwiping&&!0===e.isSwiping||t.preventDefault(),e.distanceX=s(e.newPoints[0],e.startPoints[0],"x"),e.distanceY=s(e.newPoints[0],e.startPoints[0],"y"),e.distance=s(e.newPoints[0],e.startPoints[0]),e.distance>0&&(e.isSwiping?e.onSwipe(t):e.isPanning?e.onPan():e.isZooming&&e.onZoom()))))},d.prototype.onSwipe=function(e){var a,s=this,r=s.instance,c=s.isSwiping,l=s.sliderStartPos.left||0;if(!0!==c)"x"==c&&(s.distanceX>0&&(s.instance.group.length<2||0===s.instance.current.index&&!s.instance.current.opts.loop)?l+=Math.pow(s.distanceX,.8):s.distanceX<0&&(s.instance.group.length<2||s.instance.current.index===s.instance.group.length-1&&!s.instance.current.opts.loop)?l-=Math.pow(-s.distanceX,.8):l+=s.distanceX),s.sliderLastPos={top:"x"==c?0:s.sliderStartPos.top+s.distanceY,left:l},s.requestId&&(i(s.requestId),s.requestId=null),s.requestId=o(function(){s.sliderLastPos&&(n.each(s.instance.slides,function(t,e){var o=e.pos-s.instance.currPos;n.fancybox.setTranslate(e.$slide,{top:s.sliderLastPos.top,left:s.sliderLastPos.left+o*s.canvasWidth+o*e.opts.gutter})}),s.$container.addClass("fancybox-is-sliding"))});else if(Math.abs(s.distance)>10){if(s.canTap=!1,r.group.length<2&&s.opts.vertical?s.isSwiping="y":r.isDragging||!1===s.opts.vertical||"auto"===s.opts.vertical&&n(t).width()>800?s.isSwiping="x":(a=Math.abs(180*Math.atan2(s.distanceY,s.distanceX)/Math.PI),s.isSwiping=a>45&&a<135?"y":"x"),"y"===s.isSwiping&&n.fancybox.isMobile&&s.isScrollable)return void(s.isScrolling=!0);r.isDragging=s.isSwiping,s.startPoints=s.newPoints,n.each(r.slides,function(t,e){var o,i;n.fancybox.stop(e.$slide),o=n.fancybox.getTranslate(e.$slide),i=n.fancybox.getTranslate(r.$refs.stage),e.$slide.css({transform:"",opacity:"","transition-duration":""}).removeClass("fancybox-animated").removeClass(function(t,e){return(e.match(/(^|\s)fancybox-fx-\S+/g)||[]).join(" ")}),e.pos===r.current.pos&&(s.sliderStartPos.top=o.top-i.top,s.sliderStartPos.left=o.left-i.left),n.fancybox.setTranslate(e.$slide,{top:o.top-i.top,left:o.left-i.left})}),r.SlideShow&&r.SlideShow.isActive&&r.SlideShow.stop()}},d.prototype.onPan=function(){var t=this;if(s(t.newPoints[0],t.realPoints[0])<(n.fancybox.isMobile?10:5))return void(t.startPoints=t.newPoints);t.canTap=!1,t.contentLastPos=t.limitMovement(),t.requestId&&i(t.requestId),t.requestId=o(function(){n.fancybox.setTranslate(t.$content,t.contentLastPos)})},d.prototype.limitMovement=function(){var t,e,n,o,i,a,s=this,r=s.canvasWidth,c=s.canvasHeight,l=s.distanceX,d=s.distanceY,u=s.contentStartPos,f=u.left,p=u.top,h=u.width,g=u.height;return i=h>r?f+l:f,a=p+d,t=Math.max(0,.5*r-.5*h),e=Math.max(0,.5*c-.5*g),n=Math.min(r-h,.5*r-.5*h),o=Math.min(c-g,.5*c-.5*g),l>0&&i>t&&(i=t-1+Math.pow(-t+f+l,.8)||0),l<0&&i<n&&(i=n+1-Math.pow(n-f-l,.8)||0),d>0&&a>e&&(a=e-1+Math.pow(-e+p+d,.8)||0),d<0&&a<o&&(a=o+1-Math.pow(o-p-d,.8)||0),{top:a,left:i}},d.prototype.limitPosition=function(t,e,n,o){var i=this,a=i.canvasWidth,s=i.canvasHeight;return n>a?(t=t>0?0:t,t=t<a-n?a-n:t):t=Math.max(0,a/2-n/2),o>s?(e=e>0?0:e,e=e<s-o?s-o:e):e=Math.max(0,s/2-o/2),{top:e,left:t}},d.prototype.onZoom=function(){var e=this,a=e.contentStartPos,r=a.width,c=a.height,l=a.left,d=a.top,u=s(e.newPoints[0],e.newPoints[1]),f=u/e.startDistanceBetweenFingers,p=Math.floor(r*f),h=Math.floor(c*f),g=(r-p)*e.percentageOfImageAtPinchPointX,b=(c-h)*e.percentageOfImageAtPinchPointY,m=(e.newPoints[0].x+e.newPoints[1].x)/2-n(t).scrollLeft(),v=(e.newPoints[0].y+e.newPoints[1].y)/2-n(t).scrollTop(),y=m-e.centerPointStartX,x=v-e.centerPointStartY,w=l+(g+y),$=d+(b+x),S={top:$,left:w,scaleX:f,scaleY:f};e.canTap=!1,e.newWidth=p,e.newHeight=h,e.contentLastPos=S,e.requestId&&i(e.requestId),e.requestId=o(function(){n.fancybox.setTranslate(e.$content,e.contentLastPos)})},d.prototype.ontouchend=function(t){var o=this,s=o.isSwiping,r=o.isPanning,c=o.isZooming,l=o.isScrolling;if(o.endPoints=a(t),o.dMs=Math.max((new Date).getTime()-o.startTime,1),o.$container.removeClass("fancybox-is-grabbing"),n(e).off(".fb.touch"),e.removeEventListener("scroll",o.onscroll,!0),o.requestId&&(i(o.requestId),o.requestId=null),o.isSwiping=!1,o.isPanning=!1,o.isZooming=!1,o.isScrolling=!1,o.instance.isDragging=!1,o.canTap)return o.onTap(t);o.speed=100,o.velocityX=o.distanceX/o.dMs*.5,o.velocityY=o.distanceY/o.dMs*.5,r?o.endPanning():c?o.endZooming():o.endSwiping(s,l)},d.prototype.endSwiping=function(t,e){var o=this,i=!1,a=o.instance.group.length,s=Math.abs(o.distanceX),r="x"==t&&a>1&&(o.dMs>130&&s>10||s>50);o.sliderLastPos=null,"y"==t&&!e&&Math.abs(o.distanceY)>50?(n.fancybox.animate(o.instance.current.$slide,{top:o.sliderStartPos.top+o.distanceY+150*o.velocityY,opacity:0},200),i=o.instance.close(!0,250)):r&&o.distanceX>0?i=o.instance.previous(300):r&&o.distanceX<0&&(i=o.instance.next(300)),!1!==i||"x"!=t&&"y"!=t||o.instance.centerSlide(200),o.$container.removeClass("fancybox-is-sliding")},d.prototype.endPanning=function(){var t,e,o,i=this;i.contentLastPos&&(!1===i.opts.momentum||i.dMs>350?(t=i.contentLastPos.left,e=i.contentLastPos.top):(t=i.contentLastPos.left+500*i.velocityX,e=i.contentLastPos.top+500*i.velocityY),o=i.limitPosition(t,e,i.contentStartPos.width,i.contentStartPos.height),o.width=i.contentStartPos.width,o.height=i.contentStartPos.height,n.fancybox.animate(i.$content,o,366))},d.prototype.endZooming=function(){var t,e,o,i,a=this,s=a.instance.current,r=a.newWidth,c=a.newHeight;a.contentLastPos&&(t=a.contentLastPos.left,e=a.contentLastPos.top,i={top:e,left:t,width:r,height:c,scaleX:1,scaleY:1},n.fancybox.setTranslate(a.$content,i),r<a.canvasWidth&&c<a.canvasHeight?a.instance.scaleToFit(150):r>s.width||c>s.height?a.instance.scaleToActual(a.centerPointStartX,a.centerPointStartY,150):(o=a.limitPosition(t,e,r,c),n.fancybox.animate(a.$content,o,150)))},d.prototype.onTap=function(e){var o,i=this,s=n(e.target),r=i.instance,c=r.current,l=e&&a(e)||i.startPoints,d=l[0]?l[0].x-n(t).scrollLeft()-i.stagePos.left:0,u=l[0]?l[0].y-n(t).scrollTop()-i.stagePos.top:0,f=function(t){var o=c.opts[t];if(n.isFunction(o)&&(o=o.apply(r,[c,e])),o)switch(o){case"close":r.close(i.startEvent);break;case"toggleControls":r.toggleControls();break;case"next":r.next();break;case"nextOrClose":r.group.length>1?r.next():r.close(i.startEvent);break;case"zoom":"image"==c.type&&(c.isLoaded||c.$ghost)&&(r.canPan()?r.scaleToFit():r.isScaledDown()?r.scaleToActual(d,u):r.group.length<2&&r.close(i.startEvent))}};if((!e.originalEvent||2!=e.originalEvent.button)&&(s.is("img")||!(d>s[0].clientWidth+s.offset().left))){if(s.is(".fancybox-bg,.fancybox-inner,.fancybox-outer,.fancybox-container"))o="Outside";else if(s.is(".fancybox-slide"))o="Slide";else{if(!r.current.$content||!r.current.$content.find(s).addBack().filter(s).length)return;o="Content"}if(i.tapped){if(clearTimeout(i.tapped),i.tapped=null,Math.abs(d-i.tapX)>50||Math.abs(u-i.tapY)>50)return this;f("dblclick"+o)}else i.tapX=d,i.tapY=u,c.opts["dblclick"+o]&&c.opts["dblclick"+o]!==c.opts["click"+o]?i.tapped=setTimeout(function(){i.tapped=null,r.isAnimating||f("click"+o)},500):f("click"+o);return this}},n(e).on("onActivate.fb",function(t,e){e&&!e.Guestures&&(e.Guestures=new d(e))}).on("beforeClose.fb",function(t,e){e&&e.Guestures&&e.Guestures.destroy()})}(window,document,jQuery),function(t,e){"use strict";e.extend(!0,e.fancybox.defaults,{btnTpl:{slideShow:'<button data-fancybox-play class="fancybox-button fancybox-button--play" title="{{PLAY_START}}"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 5.4v13.2l11-6.6z"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.33 5.75h2.2v12.5h-2.2V5.75zm5.15 0h2.2v12.5h-2.2V5.75z"/></svg></button>'},slideShow:{autoStart:!1,speed:3e3,progress:!0}});var n=function(t){this.instance=t,this.init()};e.extend(n.prototype,{timer:null,isActive:!1,$button:null,init:function(){var t=this,n=t.instance,o=n.group[n.currIndex].opts.slideShow;t.$button=n.$refs.toolbar.find("[data-fancybox-play]").on("click",function(){t.toggle()}),n.group.length<2||!o?t.$button.hide():o.progress&&(t.$progress=e('<div class="fancybox-progress"></div>').appendTo(n.$refs.inner))},set:function(t){var n=this,o=n.instance,i=o.current;i&&(!0===t||i.opts.loop||o.currIndex<o.group.length-1)?n.isActive&&"video"!==i.contentType&&(n.$progress&&e.fancybox.animate(n.$progress.show(),{scaleX:1},i.opts.slideShow.speed),n.timer=setTimeout(function(){o.current.opts.loop||o.current.index!=o.group.length-1?o.next():o.jumpTo(0)},i.opts.slideShow.speed)):(n.stop(),o.idleSecondsCounter=0,o.showControls())},clear:function(){var t=this;clearTimeout(t.timer),t.timer=null,t.$progress&&t.$progress.removeAttr("style").hide()},start:function(){var t=this,e=t.instance.current;e&&(t.$button.attr("title",(e.opts.i18n[e.opts.lang]||e.opts.i18n.en).PLAY_STOP).removeClass("fancybox-button--play").addClass("fancybox-button--pause"),t.isActive=!0,e.isComplete&&t.set(!0),t.instance.trigger("onSlideShowChange",!0))},stop:function(){var t=this,e=t.instance.current;t.clear(),t.$button.attr("title",(e.opts.i18n[e.opts.lang]||e.opts.i18n.en).PLAY_START).removeClass("fancybox-button--pause").addClass("fancybox-button--play"),t.isActive=!1,t.instance.trigger("onSlideShowChange",!1),t.$progress&&t.$progress.removeAttr("style").hide()},toggle:function(){var t=this;t.isActive?t.stop():t.start()}}),e(t).on({"onInit.fb":function(t,e){e&&!e.SlideShow&&(e.SlideShow=new n(e))},"beforeShow.fb":function(t,e,n,o){var i=e&&e.SlideShow;o?i&&n.opts.slideShow.autoStart&&i.start():i&&i.isActive&&i.clear()},"afterShow.fb":function(t,e,n){var o=e&&e.SlideShow;o&&o.isActive&&o.set()},"afterKeydown.fb":function(n,o,i,a,s){var r=o&&o.SlideShow;!r||!i.opts.slideShow||80!==s&&32!==s||e(t.activeElement).is("button,a,input")||(a.preventDefault(),r.toggle())},"beforeClose.fb onDeactivate.fb":function(t,e){var n=e&&e.SlideShow;n&&n.stop()}}),e(t).on("visibilitychange",function(){var n=e.fancybox.getInstance(),o=n&&n.SlideShow;o&&o.isActive&&(t.hidden?o.clear():o.set())})}(document,jQuery),function(t,e){"use strict";var n=function(){for(var e=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n={},o=0;o<e.length;o++){var i=e[o];if(i&&i[1]in t){for(var a=0;a<i.length;a++)n[e[0][a]]=i[a];return n}}return!1}();if(n){var o={request:function(e){e=e||t.documentElement,e[n.requestFullscreen](e.ALLOW_KEYBOARD_INPUT)},exit:function(){t[n.exitFullscreen]()},toggle:function(e){e=e||t.documentElement,this.isFullscreen()?this.exit():this.request(e)},isFullscreen:function(){return Boolean(t[n.fullscreenElement])},enabled:function(){return Boolean(t[n.fullscreenEnabled])}};e.extend(!0,e.fancybox.defaults,{btnTpl:{fullScreen:'<button data-fancybox-fullscreen class="fancybox-button fancybox-button--fsenter" title="{{FULL_SCREEN}}"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 16h3v3h2v-5H5zm3-8H5v2h5V5H8zm6 11h2v-3h3v-2h-5zm2-11V5h-2v5h5V8z"/></svg></button>'},fullScreen:{autoStart:!1}}),e(t).on(n.fullscreenchange,function(){var t=o.isFullscreen(),n=e.fancybox.getInstance();n&&(n.current&&"image"===n.current.type&&n.isAnimating&&(n.isAnimating=!1,n.update(!0,!0,0),n.isComplete||n.complete()),n.trigger("onFullscreenChange",t),n.$refs.container.toggleClass("fancybox-is-fullscreen",t),n.$refs.toolbar.find("[data-fancybox-fullscreen]").toggleClass("fancybox-button--fsenter",!t).toggleClass("fancybox-button--fsexit",t))})}e(t).on({"onInit.fb":function(t,e){var i;if(!n)return void e.$refs.toolbar.find("[data-fancybox-fullscreen]").remove();e&&e.group[e.currIndex].opts.fullScreen?(i=e.$refs.container,i.on("click.fb-fullscreen","[data-fancybox-fullscreen]",function(t){t.stopPropagation(),t.preventDefault(),o.toggle()}),e.opts.fullScreen&&!0===e.opts.fullScreen.autoStart&&o.request(),e.FullScreen=o):e&&e.$refs.toolbar.find("[data-fancybox-fullscreen]").hide()},"afterKeydown.fb":function(t,e,n,o,i){e&&e.FullScreen&&70===i&&(o.preventDefault(),e.FullScreen.toggle())},"beforeClose.fb":function(t,e){e&&e.FullScreen&&e.$refs.container.hasClass("fancybox-is-fullscreen")&&o.exit()}})}(document,jQuery),function(t,e){"use strict";var n="fancybox-thumbs";e.fancybox.defaults=e.extend(!0,{btnTpl:{thumbs:'<button data-fancybox-thumbs class="fancybox-button fancybox-button--thumbs" title="{{THUMBS}}"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.59 14.59h3.76v3.76h-3.76v-3.76zm-4.47 0h3.76v3.76h-3.76v-3.76zm-4.47 0h3.76v3.76H5.65v-3.76zm8.94-4.47h3.76v3.76h-3.76v-3.76zm-4.47 0h3.76v3.76h-3.76v-3.76zm-4.47 0h3.76v3.76H5.65v-3.76zm8.94-4.47h3.76v3.76h-3.76V5.65zm-4.47 0h3.76v3.76h-3.76V5.65zm-4.47 0h3.76v3.76H5.65V5.65z"/></svg></button>'},thumbs:{autoStart:!1,hideOnClose:!0,parentEl:".fancybox-container",axis:"y"}},e.fancybox.defaults);var o=function(t){this.init(t)};e.extend(o.prototype,{$button:null,$grid:null,$list:null,isVisible:!1,isActive:!1,init:function(t){var e=this,n=t.group,o=0;e.instance=t,e.opts=n[t.currIndex].opts.thumbs,t.Thumbs=e,e.$button=t.$refs.toolbar.find("[data-fancybox-thumbs]");for(var i=0,a=n.length;i<a&&(n[i].thumb&&o++,!(o>1));i++);o>1&&e.opts?(e.$button.removeAttr("style").on("click",function(){e.toggle()}),e.isActive=!0):e.$button.hide()},create:function(){var t,o=this,i=o.instance,a=o.opts.parentEl,s=[];o.$grid||(o.$grid=e('<div class="'+n+" "+n+"-"+o.opts.axis+'"></div>').appendTo(i.$refs.container.find(a).addBack().filter(a)),o.$grid.on("click","a",function(){i.jumpTo(e(this).attr("data-index"))})),o.$list||(o.$list=e('<div class="'+n+'__list">').appendTo(o.$grid)),e.each(i.group,function(e,n){t=n.thumb,t||"image"!==n.type||(t=n.src),s.push('<a href="javascript:;" tabindex="0" data-index="'+e+'"'+(t&&t.length?' style="background-image:url('+t+')"':'class="fancybox-thumbs-missing"')+"></a>")}),o.$list[0].innerHTML=s.join(""),"x"===o.opts.axis&&o.$list.width(parseInt(o.$grid.css("padding-right"),10)+i.group.length*o.$list.children().eq(0).outerWidth(!0))},focus:function(t){var e,n,o=this,i=o.$list,a=o.$grid;o.instance.current&&(e=i.children().removeClass("fancybox-thumbs-active").filter('[data-index="'+o.instance.current.index+'"]').addClass("fancybox-thumbs-active"),n=e.position(),"y"===o.opts.axis&&(n.top<0||n.top>i.height()-e.outerHeight())?i.stop().animate({scrollTop:i.scrollTop()+n.top},t):"x"===o.opts.axis&&(n.left<a.scrollLeft()||n.left>a.scrollLeft()+(a.width()-e.outerWidth()))&&i.parent().stop().animate({scrollLeft:n.left},t))},update:function(){var t=this;t.instance.$refs.container.toggleClass("fancybox-show-thumbs",this.isVisible),t.isVisible?(t.$grid||t.create(),t.instance.trigger("onThumbsShow"),t.focus(0)):t.$grid&&t.instance.trigger("onThumbsHide"),t.instance.update()},hide:function(){this.isVisible=!1,this.update()},show:function(){this.isVisible=!0,this.update()},toggle:function(){this.isVisible=!this.isVisible,this.update()}}),e(t).on({"onInit.fb":function(t,e){var n;e&&!e.Thumbs&&(n=new o(e),n.isActive&&!0===n.opts.autoStart&&n.show())},"beforeShow.fb":function(t,e,n,o){var i=e&&e.Thumbs;i&&i.isVisible&&i.focus(o?0:250)},"afterKeydown.fb":function(t,e,n,o,i){var a=e&&e.Thumbs;a&&a.isActive&&71===i&&(o.preventDefault(),a.toggle())},"beforeClose.fb":function(t,e){var n=e&&e.Thumbs;n&&n.isVisible&&!1!==n.opts.hideOnClose&&n.$grid.hide()}})}(document,jQuery),function(t,e){"use strict";function n(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(t).replace(/[&<>"'`=\/]/g,function(t){return e[t]})}e.extend(!0,e.fancybox.defaults,{btnTpl:{share:'<button data-fancybox-share class="fancybox-button fancybox-button--share" title="{{SHARE}}"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M2.55 19c1.4-8.4 9.1-9.8 11.9-9.8V5l7 7-7 6.3v-3.5c-2.8 0-10.5 2.1-11.9 4.2z"/></svg></button>'},share:{url:function(t,e){return!t.currentHash&&"inline"!==e.type&&"html"!==e.type&&(e.origSrc||e.src)||window.location},
tpl:'<div class="fancybox-share"><h1>{{SHARE}}</h1><p><a class="fancybox-share__button fancybox-share__button--fb" href="https://www.facebook.com/sharer/sharer.php?u={{url}}"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m287 456v-299c0-21 6-35 35-35h38v-63c-7-1-29-3-55-3-54 0-91 33-91 94v306m143-254h-205v72h196" /></svg><span>Facebook</span></a><a class="fancybox-share__button fancybox-share__button--tw" href="https://twitter.com/intent/tweet?url={{url}}&text={{descr}}"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m456 133c-14 7-31 11-47 13 17-10 30-27 37-46-15 10-34 16-52 20-61-62-157-7-141 75-68-3-129-35-169-85-22 37-11 86 26 109-13 0-26-4-37-9 0 39 28 72 65 80-12 3-25 4-37 2 10 33 41 57 77 57-42 30-77 38-122 34 170 111 378-32 359-208 16-11 30-25 41-42z" /></svg><span>Twitter</span></a><a class="fancybox-share__button fancybox-share__button--pt" href="https://www.pinterest.com/pin/create/button/?url={{url}}&description={{descr}}&media={{media}}"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m265 56c-109 0-164 78-164 144 0 39 15 74 47 87 5 2 10 0 12-5l4-19c2-6 1-8-3-13-9-11-15-25-15-45 0-58 43-110 113-110 62 0 96 38 96 88 0 67-30 122-73 122-24 0-42-19-36-44 6-29 20-60 20-81 0-19-10-35-31-35-25 0-44 26-44 60 0 21 7 36 7 36l-30 125c-8 37-1 83 0 87 0 3 4 4 5 2 2-3 32-39 42-75l16-64c8 16 31 29 56 29 74 0 124-67 124-157 0-69-58-132-146-132z" fill="#fff"/></svg><span>Pinterest</span></a></p><p><input class="fancybox-share__input" type="text" value="{{url_raw}}" onclick="select()" /></p></div>'}}),e(t).on("click","[data-fancybox-share]",function(){var t,o,i=e.fancybox.getInstance(),a=i.current||null;a&&("function"===e.type(a.opts.share.url)&&(t=a.opts.share.url.apply(a,[i,a])),o=a.opts.share.tpl.replace(/\{\{media\}\}/g,"image"===a.type?encodeURIComponent(a.src):"").replace(/\{\{url\}\}/g,encodeURIComponent(t)).replace(/\{\{url_raw\}\}/g,n(t)).replace(/\{\{descr\}\}/g,i.$caption?encodeURIComponent(i.$caption.text()):""),e.fancybox.open({src:i.translate(i,o),type:"html",opts:{touch:!1,animationEffect:!1,afterLoad:function(t,e){i.$refs.container.one("beforeClose.fb",function(){t.close(null,0)}),e.$content.find(".fancybox-share__button").click(function(){return window.open(this.href,"Share","width=550, height=450"),!1})},mobile:{autoFocus:!1}}}))})}(document,jQuery),function(t,e,n){"use strict";function o(){var e=t.location.hash.substr(1),n=e.split("-"),o=n.length>1&&/^\+?\d+$/.test(n[n.length-1])?parseInt(n.pop(-1),10)||1:1,i=n.join("-");return{hash:e,index:o<1?1:o,gallery:i}}function i(t){""!==t.gallery&&n("[data-fancybox='"+n.escapeSelector(t.gallery)+"']").eq(t.index-1).focus().trigger("click.fb-start")}function a(t){var e,n;return!!t&&(e=t.current?t.current.opts:t.opts,""!==(n=e.hash||(e.$orig?e.$orig.data("fancybox")||e.$orig.data("fancybox-trigger"):""))&&n)}n.escapeSelector||(n.escapeSelector=function(t){return(t+"").replace(/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g,function(t,e){return e?"\0"===t?"�":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t})}),n(function(){!1!==n.fancybox.defaults.hash&&(n(e).on({"onInit.fb":function(t,e){var n,i;!1!==e.group[e.currIndex].opts.hash&&(n=o(),(i=a(e))&&n.gallery&&i==n.gallery&&(e.currIndex=n.index-1))},"beforeShow.fb":function(n,o,i,s){var r;i&&!1!==i.opts.hash&&(r=a(o))&&(o.currentHash=r+(o.group.length>1?"-"+(i.index+1):""),t.location.hash!=="#"+o.currentHash&&(s&&!o.origHash&&(o.origHash=t.location.hash),o.hashTimer&&clearTimeout(o.hashTimer),o.hashTimer=setTimeout(function(){"replaceState"in t.history?(t.history[s?"pushState":"replaceState"]({},e.title,t.location.pathname+t.location.search+"#"+o.currentHash),s&&(o.hasCreatedHistory=!0)):t.location.hash=o.currentHash,o.hashTimer=null},300)))},"beforeClose.fb":function(n,o,i){i&&!1!==i.opts.hash&&(clearTimeout(o.hashTimer),o.currentHash&&o.hasCreatedHistory?t.history.back():o.currentHash&&("replaceState"in t.history?t.history.replaceState({},e.title,t.location.pathname+t.location.search+(o.origHash||"")):t.location.hash=o.origHash),o.currentHash=null)}}),n(t).on("hashchange.fb",function(){var t=o(),e=null;n.each(n(".fancybox-container").get().reverse(),function(t,o){var i=n(o).data("FancyBox");if(i&&i.currentHash)return e=i,!1}),e?e.currentHash===t.gallery+"-"+t.index||1===t.index&&e.currentHash==t.gallery||(e.currentHash=null,e.close()):""!==t.gallery&&i(t)}),setTimeout(function(){n.fancybox.getInstance()||i(o())},50))})}(window,document,jQuery),function(t,e){"use strict";var n=(new Date).getTime();e(t).on({"onInit.fb":function(t,e,o){e.$refs.stage.on("mousewheel DOMMouseScroll wheel MozMousePixelScroll",function(t){var o=e.current,i=(new Date).getTime();e.group.length<2||!1===o.opts.wheel||"auto"===o.opts.wheel&&"image"!==o.type||(t.preventDefault(),t.stopPropagation(),o.$slide.hasClass("fancybox-animated")||(t=t.originalEvent||t,i-n<250||(n=i,e[(-t.deltaY||-t.deltaX||t.wheelDelta||-t.detail)<0?"next":"previous"]())))})}})}(document,jQuery);
/*
    jQuery Masked Input Plugin
    Copyright (c) 2007 - 2015 Josh Bush (digitalbush.com)
    Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license)
    Version: 1.4.1
*/
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){var b,c=navigator.userAgent,d=/iphone/i.test(c),e=/chrome/i.test(c),f=/android/i.test(c);a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"},a.fn.extend({caret:function(a,b){var c;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof a?(b="number"==typeof b?b:a,this.each(function(){this.setSelectionRange?this.setSelectionRange(a,b):this.createTextRange&&(c=this.createTextRange(),c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select())})):(this[0].setSelectionRange?(a=this[0].selectionStart,b=this[0].selectionEnd):document.selection&&document.selection.createRange&&(c=document.selection.createRange(),a=0-c.duplicate().moveStart("character",-1e5),b=a+c.text.length),{begin:a,end:b})},unmask:function(){return this.trigger("unmask")},mask:function(c,g){var h,i,j,k,l,m,n,o;if(!c&&this.length>0){h=a(this[0]);var p=h.data(a.mask.dataName);return p?p():void 0}return g=a.extend({autoclear:a.mask.autoclear,placeholder:a.mask.placeholder,completed:null},g),i=a.mask.definitions,j=[],k=n=c.length,l=null,a.each(c.split(""),function(a,b){"?"==b?(n--,k=a):i[b]?(j.push(new RegExp(i[b])),null===l&&(l=j.length-1),k>a&&(m=j.length-1)):j.push(null)}),this.trigger("unmask").each(function(){function h(){if(g.completed){for(var a=l;m>=a;a++)if(j[a]&&C[a]===p(a))return;g.completed.call(B)}}function p(a){return g.placeholder.charAt(a<g.placeholder.length?a:0)}function q(a){for(;++a<n&&!j[a];);return a}function r(a){for(;--a>=0&&!j[a];);return a}function s(a,b){var c,d;if(!(0>a)){for(c=a,d=q(b);n>c;c++)if(j[c]){if(!(n>d&&j[c].test(C[d])))break;C[c]=C[d],C[d]=p(d),d=q(d)}z(),B.caret(Math.max(l,a))}}function t(a){var b,c,d,e;for(b=a,c=p(a);n>b;b++)if(j[b]){if(d=q(b),e=C[b],C[b]=c,!(n>d&&j[d].test(e)))break;c=e}}function u(){var a=B.val(),b=B.caret();if(o&&o.length&&o.length>a.length){for(A(!0);b.begin>0&&!j[b.begin-1];)b.begin--;if(0===b.begin)for(;b.begin<l&&!j[b.begin];)b.begin++;B.caret(b.begin,b.begin)}else{for(A(!0);b.begin<n&&!j[b.begin];)b.begin++;B.caret(b.begin,b.begin)}h()}function v(){A(),B.val()!=E&&B.change()}function w(a){if(!B.prop("readonly")){var b,c,e,f=a.which||a.keyCode;o=B.val(),8===f||46===f||d&&127===f?(b=B.caret(),c=b.begin,e=b.end,e-c===0&&(c=46!==f?r(c):e=q(c-1),e=46===f?q(e):e),y(c,e),s(c,e-1),a.preventDefault()):13===f?v.call(this,a):27===f&&(B.val(E),B.caret(0,A()),a.preventDefault())}}function x(b){if(!B.prop("readonly")){var c,d,e,g=b.which||b.keyCode,i=B.caret();if(!(b.ctrlKey||b.altKey||b.metaKey||32>g)&&g&&13!==g){if(i.end-i.begin!==0&&(y(i.begin,i.end),s(i.begin,i.end-1)),c=q(i.begin-1),n>c&&(d=String.fromCharCode(g),j[c].test(d))){if(t(c),C[c]=d,z(),e=q(c),f){var k=function(){a.proxy(a.fn.caret,B,e)()};setTimeout(k,0)}else B.caret(e);i.begin<=m&&h()}b.preventDefault()}}}function y(a,b){var c;for(c=a;b>c&&n>c;c++)j[c]&&(C[c]=p(c))}function z(){B.val(C.join(""))}function A(a){var b,c,d,e=B.val(),f=-1;for(b=0,d=0;n>b;b++)if(j[b]){for(C[b]=p(b);d++<e.length;)if(c=e.charAt(d-1),j[b].test(c)){C[b]=c,f=b;break}if(d>e.length){y(b+1,n);break}}else C[b]===e.charAt(d)&&d++,k>b&&(f=b);return a?z():k>f+1?g.autoclear||C.join("")===D?(B.val()&&B.val(""),y(0,n)):z():(z(),B.val(B.val().substring(0,f+1))),k?b:l}var B=a(this),C=a.map(c.split(""),function(a,b){return"?"!=a?i[a]?p(b):a:void 0}),D=C.join(""),E=B.val();B.data(a.mask.dataName,function(){return a.map(C,function(a,b){return j[b]&&a!=p(b)?a:null}).join("")}),B.one("unmask",function(){B.off(".mask").removeData(a.mask.dataName)}).on("focus.mask",function(){if(!B.prop("readonly")){clearTimeout(b);var a;E=B.val(),a=A(),b=setTimeout(function(){B.get(0)===document.activeElement&&(z(),a==c.replace("?","").length?B.caret(0,a):B.caret(a))},10)}}).on("blur.mask",v).on("keydown.mask",w).on("keypress.mask",x).on("input.mask paste.mask",function(){B.prop("readonly")||setTimeout(function(){var a=A(!0);B.caret(a),h()},0)}),e&&f&&B.off("input.mask").on("input.mask",u),A()})}})});

(function($){$.extend({tablesorter:new function(){var parsers=[],widgets=[];this.defaults={cssHeader:"header",cssAsc:"headerSortUp",cssDesc:"headerSortDown",sortInitialOrder:"asc",sortMultiSortKey:"shiftKey",sortForce:null,sortAppend:null,textExtraction:"simple",parsers:{},widgets:[],widgetZebra:{css:["even","odd"]},headers:{},widthFixed:false,cancelSelection:true,sortList:[],headerList:[],dateFormat:"us",decimal:'.',debug:false};function benchmark(s,d){log(s+","+(new Date().getTime()-d.getTime())+"ms");}this.benchmark=benchmark;function log(s){if(typeof console!="undefined"&&typeof console.debug!="undefined"){console.log(s);}else{alert(s);}}function buildParserCache(table,$headers){if(table.config.debug){var parsersDebug="";}var rows=table.tBodies[0].rows;if(table.tBodies[0].rows[0]){var list=[],cells=rows[0].cells,l=cells.length;for(var i=0;i<l;i++){var p=false;if($.metadata&&($($headers[i]).metadata()&&$($headers[i]).metadata().sorter)){p=getParserById($($headers[i]).metadata().sorter);}else if((table.config.headers[i]&&table.config.headers[i].sorter)){p=getParserById(table.config.headers[i].sorter);}if(!p){p=detectParserForColumn(table,cells[i]);}if(table.config.debug){parsersDebug+="column:"+i+" parser:"+p.id+"\n";}list.push(p);}}if(table.config.debug){log(parsersDebug);}return list;};function detectParserForColumn(table,node){var l=parsers.length;for(var i=1;i<l;i++){if(parsers[i].is($.trim(getElementText(table.config,node)),table,node)){return parsers[i];}}return parsers[0];}function getParserById(name){var l=parsers.length;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==name.toLowerCase()){return parsers[i];}}return false;}function buildCache(table){if(table.config.debug){var cacheTime=new Date();}var totalRows=(table.tBodies[0]&&table.tBodies[0].rows.length)||0,totalCells=(table.tBodies[0].rows[0]&&table.tBodies[0].rows[0].cells.length)||0,parsers=table.config.parsers,cache={row:[],normalized:[]};for(var i=0;i<totalRows;++i){var c=table.tBodies[0].rows[i],cols=[];cache.row.push($(c));for(var j=0;j<totalCells;++j){cols.push(parsers[j].format(getElementText(table.config,c.cells[j]),table,c.cells[j]));}cols.push(i);cache.normalized.push(cols);cols=null;};if(table.config.debug){benchmark("Building cache for "+totalRows+" rows:",cacheTime);}return cache;};function getElementText(config,node){if(!node)return"";var t="";if(config.textExtraction=="simple"){if(node.childNodes[0]&&node.childNodes[0].hasChildNodes()){t=node.childNodes[0].innerHTML;}else{t=node.innerHTML;}}else{if(typeof(config.textExtraction)=="function"){t=config.textExtraction(node);}else{t=$(node).text();}}return t;}function appendToTable(table,cache){if(table.config.debug){var appendTime=new Date()}var c=cache,r=c.row,n=c.normalized,totalRows=n.length,checkCell=(n[0].length-1),tableBody=$(table.tBodies[0]),rows=[];for(var i=0;i<totalRows;i++){rows.push(r[n[i][checkCell]]);if(!table.config.appender){var o=r[n[i][checkCell]];var l=o.length;for(var j=0;j<l;j++){tableBody[0].appendChild(o[j]);}}}if(table.config.appender){table.config.appender(table,rows);}rows=null;if(table.config.debug){benchmark("Rebuilt table:",appendTime);}applyWidget(table);setTimeout(function(){$(table).trigger("sortEnd");},0);};function buildHeaders(table){if(table.config.debug){var time=new Date();}var meta=($.metadata)?true:false,tableHeadersRows=[];for(var i=0;i<table.tHead.rows.length;i++){tableHeadersRows[i]=0;};$tableHeaders=$("thead th",table);$tableHeaders.each(function(index){this.count=0;this.column=index;this.order=formatSortingOrder(table.config.sortInitialOrder);if(checkHeaderMetadata(this)||checkHeaderOptions(table,index))this.sortDisabled=true;if(!this.sortDisabled){$(this).addClass(table.config.cssHeader);}table.config.headerList[index]=this;});if(table.config.debug){benchmark("Built headers:",time);log($tableHeaders);}return $tableHeaders;};function checkCellColSpan(table,rows,row){var arr=[],r=table.tHead.rows,c=r[row].cells;for(var i=0;i<c.length;i++){var cell=c[i];if(cell.colSpan>1){arr=arr.concat(checkCellColSpan(table,headerArr,row++));}else{if(table.tHead.length==1||(cell.rowSpan>1||!r[row+1])){arr.push(cell);}}}return arr;};function checkHeaderMetadata(cell){if(($.metadata)&&($(cell).metadata().sorter===false)){return true;};return false;}function checkHeaderOptions(table,i){if((table.config.headers[i])&&(table.config.headers[i].sorter===false)){return true;};return false;}function applyWidget(table){var c=table.config.widgets;var l=c.length;for(var i=0;i<l;i++){getWidgetById(c[i]).format(table);}}function getWidgetById(name){var l=widgets.length;for(var i=0;i<l;i++){if(widgets[i].id.toLowerCase()==name.toLowerCase()){return widgets[i];}}};function formatSortingOrder(v){if(typeof(v)!="Number"){i=(v.toLowerCase()=="desc")?1:0;}else{i=(v==(0||1))?v:0;}return i;}function isValueInArray(v,a){var l=a.length;for(var i=0;i<l;i++){if(a[i][0]==v){return true;}}return false;}function setHeadersCss(table,$headers,list,css){$headers.removeClass(css[0]).removeClass(css[1]);var h=[];$headers.each(function(offset){if(!this.sortDisabled){h[this.column]=$(this);}});var l=list.length;for(var i=0;i<l;i++){h[list[i][0]].addClass(css[list[i][1]]);}}function fixColumnWidth(table,$headers){var c=table.config;if(c.widthFixed){var colgroup=$('<colgroup>');$("tr:first td",table.tBodies[0]).each(function(){colgroup.append($('<col>').css('width',$(this).width()));});$(table).prepend(colgroup);};}function updateHeaderSortCount(table,sortList){var c=table.config,l=sortList.length;for(var i=0;i<l;i++){var s=sortList[i],o=c.headerList[s[0]];o.count=s[1];o.count++;}}function multisort(table,sortList,cache){if(table.config.debug){var sortTime=new Date();}var dynamicExp="var sortWrapper = function(a,b) {",l=sortList.length;for(var i=0;i<l;i++){var c=sortList[i][0];var order=sortList[i][1];var s=(getCachedSortType(table.config.parsers,c)=="text")?((order==0)?"sortText":"sortTextDesc"):((order==0)?"sortNumeric":"sortNumericDesc");var e="e"+i;dynamicExp+="var "+e+" = "+s+"(a["+c+"],b["+c+"]); ";dynamicExp+="if("+e+") { return "+e+"; } ";dynamicExp+="else { ";}var orgOrderCol=cache.normalized[0].length-1;dynamicExp+="return a["+orgOrderCol+"]-b["+orgOrderCol+"];";for(var i=0;i<l;i++){dynamicExp+="}; ";}dynamicExp+="return 0; ";dynamicExp+="}; ";eval(dynamicExp);cache.normalized.sort(sortWrapper);if(table.config.debug){benchmark("Sorting on "+sortList.toString()+" and dir "+order+" time:",sortTime);}return cache;};function sortText(a,b){return((a<b)?-1:((a>b)?1:0));};function sortTextDesc(a,b){return((b<a)?-1:((b>a)?1:0));};function sortNumeric(a,b){return a-b;};function sortNumericDesc(a,b){return b-a;};function getCachedSortType(parsers,i){return parsers[i].type;};this.construct=function(settings){return this.each(function(){if(!this.tHead||!this.tBodies)return;var $this,$document,$headers,cache,config,shiftDown=0,sortOrder;this.config={};config=$.extend(this.config,$.tablesorter.defaults,settings);$this=$(this);$headers=buildHeaders(this);this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);var sortCSS=[config.cssDesc,config.cssAsc];fixColumnWidth(this);$headers.click(function(e){$this.trigger("sortStart");var totalRows=($this[0].tBodies[0]&&$this[0].tBodies[0].rows.length)||0;if(!this.sortDisabled&&totalRows>0){var $cell=$(this);var i=this.column;this.order=this.count++%2;if(!e[config.sortMultiSortKey]){config.sortList=[];if(config.sortForce!=null){var a=config.sortForce;for(var j=0;j<a.length;j++){if(a[j][0]!=i){config.sortList.push(a[j]);}}}config.sortList.push([i,this.order]);}else{if(isValueInArray(i,config.sortList)){for(var j=0;j<config.sortList.length;j++){var s=config.sortList[j],o=config.headerList[s[0]];if(s[0]==i){o.count=s[1];o.count++;s[1]=o.count%2;}}}else{config.sortList.push([i,this.order]);}};setTimeout(function(){setHeadersCss($this[0],$headers,config.sortList,sortCSS);appendToTable($this[0],multisort($this[0],config.sortList,cache));},1);return false;}}).mousedown(function(){if(config.cancelSelection){this.onselectstart=function(){return false};return false;}});$this.bind("update",function(){this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);}).bind("sorton",function(e,list){$(this).trigger("sortStart");config.sortList=list;var sortList=config.sortList;updateHeaderSortCount(this,sortList);setHeadersCss(this,$headers,sortList,sortCSS);appendToTable(this,multisort(this,sortList,cache));}).bind("appendCache",function(){appendToTable(this,cache);}).bind("applyWidgetId",function(e,id){getWidgetById(id).format(this);}).bind("applyWidgets",function(){applyWidget(this);});if($.metadata&&($(this).metadata()&&$(this).metadata().sortlist)){config.sortList=$(this).metadata().sortlist;}if(config.sortList.length>0){$this.trigger("sorton",[config.sortList]);}applyWidget(this);});};this.addParser=function(parser){var l=parsers.length,a=true;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==parser.id.toLowerCase()){a=false;}}if(a){parsers.push(parser);};};this.addWidget=function(widget){widgets.push(widget);};this.formatFloat=function(s){var i=parseFloat(s);return(isNaN(i))?0:i;};this.formatInt=function(s){var i=parseInt(s);return(isNaN(i))?0:i;};this.isDigit=function(s,config){var DECIMAL='\\'+config.decimal;var exp='/(^[+]?0('+DECIMAL+'0+)?$)|(^([-+]?[1-9][0-9]*)$)|(^([-+]?((0?|[1-9][0-9]*)'+DECIMAL+'(0*[1-9][0-9]*)))$)|(^[-+]?[1-9]+[0-9]*'+DECIMAL+'0+$)/';return RegExp(exp).test($.trim(s));};this.clearTableBody=function(table){if($.browser.msie){function empty(){while(this.firstChild)this.removeChild(this.firstChild);}empty.apply(table.tBodies[0]);}else{table.tBodies[0].innerHTML="";}};}});$.fn.extend({tablesorter:$.tablesorter.construct});var ts=$.tablesorter;ts.addParser({id:"text",is:function(s){return true;},format:function(s){return $.trim(s.toLowerCase());},type:"text"});ts.addParser({id:"digit",is:function(s,table){var c=table.config;return $.tablesorter.isDigit(s,c);},format:function(s){return $.tablesorter.formatFloat(s);},type:"numeric"});ts.addParser({id:"currency",is:function(s){return/^[A?$a?.]/.test(s);},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/[^0-9.]/g),""));},type:"numeric"});ts.addParser({id:"ipAddress",is:function(s){return/^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(s);},format:function(s){var a=s.split("."),r="",l=a.length;for(var i=0;i<l;i++){var item=a[i];if(item.length==2){r+="0"+item;}else{r+=item;}}return $.tablesorter.formatFloat(r);},type:"numeric"});ts.addParser({id:"url",is:function(s){return/^(https?|ftp|file):\/\/$/.test(s);},format:function(s){return jQuery.trim(s.replace(new RegExp(/(https?|ftp|file):\/\//),''));},type:"text"});ts.addParser({id:"isoDate",is:function(s){return/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(s);},format:function(s){return $.tablesorter.formatFloat((s!="")?new Date(s.replace(new RegExp(/-/g),"/")).getTime():"0");},type:"numeric"});ts.addParser({id:"percent",is:function(s){return/\%$/.test($.trim(s));},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/%/g),""));},type:"numeric"});ts.addParser({id:"usLongDate",is:function(s){return s.match(new RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2}) (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM)))$/));},format:function(s){return $.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"shortDate",is:function(s){return/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/.test(s);},format:function(s,table){var c=table.config;s=s.replace(/\-/g,"/");if(c.dateFormat=="us"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$1/$2");}else if(c.dateFormat=="uk"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1");}else if(c.dateFormat=="dd/mm/yy"||c.dateFormat=="dd-mm-yy"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3");}return $.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"time",is:function(s){return/^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(s);},format:function(s){return $.tablesorter.formatFloat(new Date("2000/01/01 "+s).getTime());},type:"numeric"});ts.addParser({id:"metadata",is:function(s){return false;},format:function(s,table,cell){var c=table.config,p=(!c.parserMetadataName)?'sortValue':c.parserMetadataName;return $(cell).metadata()[p];},type:"numeric"});ts.addWidget({id:"zebra",format:function(table){if(table.config.debug){var time=new Date();}$("tr:visible",table.tBodies[0]).filter(':even').removeClass(table.config.widgetZebra.css[1]).addClass(table.config.widgetZebra.css[0]).end().filter(':odd').removeClass(table.config.widgetZebra.css[0]).addClass(table.config.widgetZebra.css[1]);if(table.config.debug){$.tablesorter.benchmark("Applying Zebra widget",time);}}});})(jQuery);
/*! jQuery Validation Plugin - v1.19.1 - 6/15/2019
 * https://jqueryvalidation.org/
 * Copyright (c) 2019 Jörn Zaefferer; Licensed MIT */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){a.extend(a.fn,{validate:function(b){if(!this.length)return void(b&&b.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing."));var c=a.data(this[0],"validator");return c?c:(this.attr("novalidate","novalidate"),c=new a.validator(b,this[0]),a.data(this[0],"validator",c),c.settings.onsubmit&&(this.on("click.validate",":submit",function(b){c.submitButton=b.currentTarget,a(this).hasClass("cancel")&&(c.cancelSubmit=!0),void 0!==a(this).attr("formnovalidate")&&(c.cancelSubmit=!0)}),this.on("submit.validate",function(b){function d(){var d,e;return c.submitButton&&(c.settings.submitHandler||c.formSubmitted)&&(d=a("<input type='hidden'/>").attr("name",c.submitButton.name).val(a(c.submitButton).val()).appendTo(c.currentForm)),!(c.settings.submitHandler&&!c.settings.debug)||(e=c.settings.submitHandler.call(c,c.currentForm,b),d&&d.remove(),void 0!==e&&e)}return c.settings.debug&&b.preventDefault(),c.cancelSubmit?(c.cancelSubmit=!1,d()):c.form()?c.pendingRequest?(c.formSubmitted=!0,!1):d():(c.focusInvalid(),!1)})),c)},valid:function(){var b,c,d;return a(this[0]).is("form")?b=this.validate().form():(d=[],b=!0,c=a(this[0].form).validate(),this.each(function(){b=c.element(this)&&b,b||(d=d.concat(c.errorList))}),c.errorList=d),b},rules:function(b,c){var d,e,f,g,h,i,j=this[0],k="undefined"!=typeof this.attr("contenteditable")&&"false"!==this.attr("contenteditable");if(null!=j&&(!j.form&&k&&(j.form=this.closest("form")[0],j.name=this.attr("name")),null!=j.form)){if(b)switch(d=a.data(j.form,"validator").settings,e=d.rules,f=a.validator.staticRules(j),b){case"add":a.extend(f,a.validator.normalizeRule(c)),delete f.messages,e[j.name]=f,c.messages&&(d.messages[j.name]=a.extend(d.messages[j.name],c.messages));break;case"remove":return c?(i={},a.each(c.split(/\s/),function(a,b){i[b]=f[b],delete f[b]}),i):(delete e[j.name],f)}return g=a.validator.normalizeRules(a.extend({},a.validator.classRules(j),a.validator.attributeRules(j),a.validator.dataRules(j),a.validator.staticRules(j)),j),g.required&&(h=g.required,delete g.required,g=a.extend({required:h},g)),g.remote&&(h=g.remote,delete g.remote,g=a.extend(g,{remote:h})),g}}}),a.extend(a.expr.pseudos||a.expr[":"],{blank:function(b){return!a.trim(""+a(b).val())},filled:function(b){var c=a(b).val();return null!==c&&!!a.trim(""+c)},unchecked:function(b){return!a(b).prop("checked")}}),a.validator=function(b,c){this.settings=a.extend(!0,{},a.validator.defaults,b),this.currentForm=c,this.init()},a.validator.format=function(b,c){return 1===arguments.length?function(){var c=a.makeArray(arguments);return c.unshift(b),a.validator.format.apply(this,c)}:void 0===c?b:(arguments.length>2&&c.constructor!==Array&&(c=a.makeArray(arguments).slice(1)),c.constructor!==Array&&(c=[c]),a.each(c,function(a,c){b=b.replace(new RegExp("\\{"+a+"\\}","g"),function(){return c})}),b)},a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",pendingClass:"pending",validClass:"valid",errorElement:"label",focusCleanup:!1,focusInvalid:!0,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(a){this.lastActive=a,this.settings.focusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,a,this.settings.errorClass,this.settings.validClass),this.hideThese(this.errorsFor(a)))},onfocusout:function(a){this.checkable(a)||!(a.name in this.submitted)&&this.optional(a)||this.element(a)},onkeyup:function(b,c){var d=[16,17,18,20,35,36,37,38,39,40,45,144,225];9===c.which&&""===this.elementValue(b)||a.inArray(c.keyCode,d)!==-1||(b.name in this.submitted||b.name in this.invalid)&&this.element(b)},onclick:function(a){a.name in this.submitted?this.element(a):a.parentNode.name in this.submitted&&this.element(a.parentNode)},highlight:function(b,c,d){"radio"===b.type?this.findByName(b.name).addClass(c).removeClass(d):a(b).addClass(c).removeClass(d)},unhighlight:function(b,c,d){"radio"===b.type?this.findByName(b.name).removeClass(c).addClass(d):a(b).removeClass(c).addClass(d)}},setDefaults:function(b){a.extend(a.validator.defaults,b)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",equalTo:"Please enter the same value again.",maxlength:a.validator.format("Please enter no more than {0} characters."),minlength:a.validator.format("Please enter at least {0} characters."),rangelength:a.validator.format("Please enter a value between {0} and {1} characters long."),range:a.validator.format("Please enter a value between {0} and {1}."),max:a.validator.format("Please enter a value less than or equal to {0}."),min:a.validator.format("Please enter a value greater than or equal to {0}."),step:a.validator.format("Please enter a multiple of {0}.")},autoCreateRanges:!1,prototype:{init:function(){function b(b){var c="undefined"!=typeof a(this).attr("contenteditable")&&"false"!==a(this).attr("contenteditable");if(!this.form&&c&&(this.form=a(this).closest("form")[0],this.name=a(this).attr("name")),d===this.form){var e=a.data(this.form,"validator"),f="on"+b.type.replace(/^validate/,""),g=e.settings;g[f]&&!a(this).is(g.ignore)&&g[f].call(e,this,b)}}this.labelContainer=a(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm),this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var c,d=this.currentForm,e=this.groups={};a.each(this.settings.groups,function(b,c){"string"==typeof c&&(c=c.split(/\s/)),a.each(c,function(a,c){e[c]=b})}),c=this.settings.rules,a.each(c,function(b,d){c[b]=a.validator.normalizeRule(d)}),a(this.currentForm).on("focusin.validate focusout.validate keyup.validate",":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'], [type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'], [type='radio'], [type='checkbox'], [contenteditable], [type='button']",b).on("click.validate","select, option, [type='radio'], [type='checkbox']",b),this.settings.invalidHandler&&a(this.currentForm).on("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),a.extend(this.submitted,this.errorMap),this.invalid=a.extend({},this.errorMap),this.valid()||a(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var a=0,b=this.currentElements=this.elements();b[a];a++)this.check(b[a]);return this.valid()},element:function(b){var c,d,e=this.clean(b),f=this.validationTargetFor(e),g=this,h=!0;return void 0===f?delete this.invalid[e.name]:(this.prepareElement(f),this.currentElements=a(f),d=this.groups[f.name],d&&a.each(this.groups,function(a,b){b===d&&a!==f.name&&(e=g.validationTargetFor(g.clean(g.findByName(a))),e&&e.name in g.invalid&&(g.currentElements.push(e),h=g.check(e)&&h))}),c=this.check(f)!==!1,h=h&&c,c?this.invalid[f.name]=!1:this.invalid[f.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),a(b).attr("aria-invalid",!c)),h},showErrors:function(b){if(b){var c=this;a.extend(this.errorMap,b),this.errorList=a.map(this.errorMap,function(a,b){return{message:a,element:c.findByName(b)[0]}}),this.successList=a.grep(this.successList,function(a){return!(a.name in b)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){a.fn.resetForm&&a(this.currentForm).resetForm(),this.invalid={},this.submitted={},this.prepareForm(),this.hideErrors();var b=this.elements().removeData("previousValue").removeAttr("aria-invalid");this.resetElements(b)},resetElements:function(a){var b;if(this.settings.unhighlight)for(b=0;a[b];b++)this.settings.unhighlight.call(this,a[b],this.settings.errorClass,""),this.findByName(a[b].name).removeClass(this.settings.validClass);else a.removeClass(this.settings.errorClass).removeClass(this.settings.validClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(a){var b,c=0;for(b in a)void 0!==a[b]&&null!==a[b]&&a[b]!==!1&&c++;return c},hideErrors:function(){this.hideThese(this.toHide)},hideThese:function(a){a.not(this.containers).text(""),this.addWrapper(a).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").trigger("focus").trigger("focusin")}catch(b){}},findLastActive:function(){var b=this.lastActive;return b&&1===a.grep(this.errorList,function(a){return a.element.name===b.name}).length&&b},elements:function(){var b=this,c={};return a(this.currentForm).find("input, select, textarea, [contenteditable]").not(":submit, :reset, :image, :disabled").not(this.settings.ignore).filter(function(){var d=this.name||a(this).attr("name"),e="undefined"!=typeof a(this).attr("contenteditable")&&"false"!==a(this).attr("contenteditable");return!d&&b.settings.debug&&window.console&&console.error("%o has no name assigned",this),e&&(this.form=a(this).closest("form")[0],this.name=d),this.form===b.currentForm&&(!(d in c||!b.objectLength(a(this).rules()))&&(c[d]=!0,!0))})},clean:function(b){return a(b)[0]},errors:function(){var b=this.settings.errorClass.split(" ").join(".");return a(this.settings.errorElement+"."+b,this.errorContext)},resetInternals:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=a([]),this.toHide=a([])},reset:function(){this.resetInternals(),this.currentElements=a([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(a){this.reset(),this.toHide=this.errorsFor(a)},elementValue:function(b){var c,d,e=a(b),f=b.type,g="undefined"!=typeof e.attr("contenteditable")&&"false"!==e.attr("contenteditable");return"radio"===f||"checkbox"===f?this.findByName(b.name).filter(":checked").val():"number"===f&&"undefined"!=typeof b.validity?b.validity.badInput?"NaN":e.val():(c=g?e.text():e.val(),"file"===f?"C:\\fakepath\\"===c.substr(0,12)?c.substr(12):(d=c.lastIndexOf("/"),d>=0?c.substr(d+1):(d=c.lastIndexOf("\\"),d>=0?c.substr(d+1):c)):"string"==typeof c?c.replace(/\r/g,""):c)},check:function(b){b=this.validationTargetFor(this.clean(b));var c,d,e,f,g=a(b).rules(),h=a.map(g,function(a,b){return b}).length,i=!1,j=this.elementValue(b);"function"==typeof g.normalizer?f=g.normalizer:"function"==typeof this.settings.normalizer&&(f=this.settings.normalizer),f&&(j=f.call(b,j),delete g.normalizer);for(d in g){e={method:d,parameters:g[d]};try{if(c=a.validator.methods[d].call(this,j,b,e.parameters),"dependency-mismatch"===c&&1===h){i=!0;continue}if(i=!1,"pending"===c)return void(this.toHide=this.toHide.not(this.errorsFor(b)));if(!c)return this.formatAndAdd(b,e),!1}catch(k){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+b.id+", check the '"+e.method+"' method.",k),k instanceof TypeError&&(k.message+=".  Exception occurred when checking element "+b.id+", check the '"+e.method+"' method."),k}}if(!i)return this.objectLength(g)&&this.successList.push(b),!0},customDataMessage:function(b,c){return a(b).data("msg"+c.charAt(0).toUpperCase()+c.substring(1).toLowerCase())||a(b).data("msg")},customMessage:function(a,b){var c=this.settings.messages[a];return c&&(c.constructor===String?c:c[b])},findDefined:function(){for(var a=0;a<arguments.length;a++)if(void 0!==arguments[a])return arguments[a]},defaultMessage:function(b,c){"string"==typeof c&&(c={method:c});var d=this.findDefined(this.customMessage(b.name,c.method),this.customDataMessage(b,c.method),!this.settings.ignoreTitle&&b.title||void 0,a.validator.messages[c.method],"<strong>Warning: No message defined for "+b.name+"</strong>"),e=/\$?\{(\d+)\}/g;return"function"==typeof d?d=d.call(this,c.parameters,b):e.test(d)&&(d=a.validator.format(d.replace(e,"{$1}"),c.parameters)),d},formatAndAdd:function(a,b){var c=this.defaultMessage(a,b);this.errorList.push({message:c,element:a,method:b.method}),this.errorMap[a.name]=c,this.submitted[a.name]=c},addWrapper:function(a){return this.settings.wrapper&&(a=a.add(a.parent(this.settings.wrapper))),a},defaultShowErrors:function(){var a,b,c;for(a=0;this.errorList[a];a++)c=this.errorList[a],this.settings.highlight&&this.settings.highlight.call(this,c.element,this.settings.errorClass,this.settings.validClass),this.showLabel(c.element,c.message);if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(a=0;this.successList[a];a++)this.showLabel(this.successList[a]);if(this.settings.unhighlight)for(a=0,b=this.validElements();b[a];a++)this.settings.unhighlight.call(this,b[a],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return a(this.errorList).map(function(){return this.element})},showLabel:function(b,c){var d,e,f,g,h=this.errorsFor(b),i=this.idOrName(b),j=a(b).attr("aria-describedby");h.length?(h.removeClass(this.settings.validClass).addClass(this.settings.errorClass),h.html(c)):(h=a("<"+this.settings.errorElement+">").attr("id",i+"-error").addClass(this.settings.errorClass).html(c||""),d=h,this.settings.wrapper&&(d=h.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.length?this.labelContainer.append(d):this.settings.errorPlacement?this.settings.errorPlacement.call(this,d,a(b)):d.insertAfter(b),h.is("label")?h.attr("for",i):0===h.parents("label[for='"+this.escapeCssMeta(i)+"']").length&&(f=h.attr("id"),j?j.match(new RegExp("\\b"+this.escapeCssMeta(f)+"\\b"))||(j+=" "+f):j=f,a(b).attr("aria-describedby",j),e=this.groups[b.name],e&&(g=this,a.each(g.groups,function(b,c){c===e&&a("[name='"+g.escapeCssMeta(b)+"']",g.currentForm).attr("aria-describedby",h.attr("id"))})))),!c&&this.settings.success&&(h.text(""),"string"==typeof this.settings.success?h.addClass(this.settings.success):this.settings.success(h,b)),this.toShow=this.toShow.add(h)},errorsFor:function(b){var c=this.escapeCssMeta(this.idOrName(b)),d=a(b).attr("aria-describedby"),e="label[for='"+c+"'], label[for='"+c+"'] *";return d&&(e=e+", #"+this.escapeCssMeta(d).replace(/\s+/g,", #")),this.errors().filter(e)},escapeCssMeta:function(a){return a.replace(/([\\!"#$%&'()*+,.\/:;<=>?@\[\]^`{|}~])/g,"\\$1")},idOrName:function(a){return this.groups[a.name]||(this.checkable(a)?a.name:a.id||a.name)},validationTargetFor:function(b){return this.checkable(b)&&(b=this.findByName(b.name)),a(b).not(this.settings.ignore)[0]},checkable:function(a){return/radio|checkbox/i.test(a.type)},findByName:function(b){return a(this.currentForm).find("[name='"+this.escapeCssMeta(b)+"']")},getLength:function(b,c){switch(c.nodeName.toLowerCase()){case"select":return a("option:selected",c).length;case"input":if(this.checkable(c))return this.findByName(c.name).filter(":checked").length}return b.length},depend:function(a,b){return!this.dependTypes[typeof a]||this.dependTypes[typeof a](a,b)},dependTypes:{"boolean":function(a){return a},string:function(b,c){return!!a(b,c.form).length},"function":function(a,b){return a(b)}},optional:function(b){var c=this.elementValue(b);return!a.validator.methods.required.call(this,c,b)&&"dependency-mismatch"},startRequest:function(b){this.pending[b.name]||(this.pendingRequest++,a(b).addClass(this.settings.pendingClass),this.pending[b.name]=!0)},stopRequest:function(b,c){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[b.name],a(b).removeClass(this.settings.pendingClass),c&&0===this.pendingRequest&&this.formSubmitted&&this.form()?(a(this.currentForm).submit(),this.submitButton&&a("input:hidden[name='"+this.submitButton.name+"']",this.currentForm).remove(),this.formSubmitted=!1):!c&&0===this.pendingRequest&&this.formSubmitted&&(a(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(b,c){return c="string"==typeof c&&c||"remote",a.data(b,"previousValue")||a.data(b,"previousValue",{old:null,valid:!0,message:this.defaultMessage(b,{method:c})})},destroy:function(){this.resetForm(),a(this.currentForm).off(".validate").removeData("validator").find(".validate-equalTo-blur").off(".validate-equalTo").removeClass("validate-equalTo-blur").find(".validate-lessThan-blur").off(".validate-lessThan").removeClass("validate-lessThan-blur").find(".validate-lessThanEqual-blur").off(".validate-lessThanEqual").removeClass("validate-lessThanEqual-blur").find(".validate-greaterThanEqual-blur").off(".validate-greaterThanEqual").removeClass("validate-greaterThanEqual-blur").find(".validate-greaterThan-blur").off(".validate-greaterThan").removeClass("validate-greaterThan-blur")}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(b,c){b.constructor===String?this.classRuleSettings[b]=c:a.extend(this.classRuleSettings,b)},classRules:function(b){var c={},d=a(b).attr("class");return d&&a.each(d.split(" "),function(){this in a.validator.classRuleSettings&&a.extend(c,a.validator.classRuleSettings[this])}),c},normalizeAttributeRule:function(a,b,c,d){/min|max|step/.test(c)&&(null===b||/number|range|text/.test(b))&&(d=Number(d),isNaN(d)&&(d=void 0)),d||0===d?a[c]=d:b===c&&"range"!==b&&(a[c]=!0)},attributeRules:function(b){var c,d,e={},f=a(b),g=b.getAttribute("type");for(c in a.validator.methods)"required"===c?(d=b.getAttribute(c),""===d&&(d=!0),d=!!d):d=f.attr(c),this.normalizeAttributeRule(e,g,c,d);return e.maxlength&&/-1|2147483647|524288/.test(e.maxlength)&&delete e.maxlength,e},dataRules:function(b){var c,d,e={},f=a(b),g=b.getAttribute("type");for(c in a.validator.methods)d=f.data("rule"+c.charAt(0).toUpperCase()+c.substring(1).toLowerCase()),""===d&&(d=!0),this.normalizeAttributeRule(e,g,c,d);return e},staticRules:function(b){var c={},d=a.data(b.form,"validator");return d.settings.rules&&(c=a.validator.normalizeRule(d.settings.rules[b.name])||{}),c},normalizeRules:function(b,c){return a.each(b,function(d,e){if(e===!1)return void delete b[d];if(e.param||e.depends){var f=!0;switch(typeof e.depends){case"string":f=!!a(e.depends,c.form).length;break;case"function":f=e.depends.call(c,c)}f?b[d]=void 0===e.param||e.param:(a.data(c.form,"validator").resetElements(a(c)),delete b[d])}}),a.each(b,function(d,e){b[d]=a.isFunction(e)&&"normalizer"!==d?e(c):e}),a.each(["minlength","maxlength"],function(){b[this]&&(b[this]=Number(b[this]))}),a.each(["rangelength","range"],function(){var c;b[this]&&(a.isArray(b[this])?b[this]=[Number(b[this][0]),Number(b[this][1])]:"string"==typeof b[this]&&(c=b[this].replace(/[\[\]]/g,"").split(/[\s,]+/),b[this]=[Number(c[0]),Number(c[1])]))}),a.validator.autoCreateRanges&&(null!=b.min&&null!=b.max&&(b.range=[b.min,b.max],delete b.min,delete b.max),null!=b.minlength&&null!=b.maxlength&&(b.rangelength=[b.minlength,b.maxlength],delete b.minlength,delete b.maxlength)),b},normalizeRule:function(b){if("string"==typeof b){var c={};a.each(b.split(/\s/),function(){c[this]=!0}),b=c}return b},addMethod:function(b,c,d){a.validator.methods[b]=c,a.validator.messages[b]=void 0!==d?d:a.validator.messages[b],c.length<3&&a.validator.addClassRules(b,a.validator.normalizeRule(b))},methods:{required:function(b,c,d){if(!this.depend(d,c))return"dependency-mismatch";if("select"===c.nodeName.toLowerCase()){var e=a(c).val();return e&&e.length>0}return this.checkable(c)?this.getLength(b,c)>0:void 0!==b&&null!==b&&b.length>0},email:function(a,b){return this.optional(b)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a)},url:function(a,b){return this.optional(b)||/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(a)},date:function(){var a=!1;return function(b,c){return a||(a=!0,this.settings.debug&&window.console&&console.warn("The `date` method is deprecated and will be removed in version '2.0.0'.\nPlease don't use it, since it relies on the Date constructor, which\nbehaves very differently across browsers and locales. Use `dateISO`\ninstead or one of the locale specific methods in `localizations/`\nand `additional-methods.js`.")),this.optional(c)||!/Invalid|NaN/.test(new Date(b).toString())}}(),dateISO:function(a,b){return this.optional(b)||/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(a)},number:function(a,b){return this.optional(b)||/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)},digits:function(a,b){return this.optional(b)||/^\d+$/.test(a)},minlength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(b,c);return this.optional(c)||e>=d},maxlength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(b,c);return this.optional(c)||e<=d},rangelength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(b,c);return this.optional(c)||e>=d[0]&&e<=d[1]},min:function(a,b,c){return this.optional(b)||a>=c},max:function(a,b,c){return this.optional(b)||a<=c},range:function(a,b,c){return this.optional(b)||a>=c[0]&&a<=c[1]},step:function(b,c,d){var e,f=a(c).attr("type"),g="Step attribute on input type "+f+" is not supported.",h=["text","number","range"],i=new RegExp("\\b"+f+"\\b"),j=f&&!i.test(h.join()),k=function(a){var b=(""+a).match(/(?:\.(\d+))?$/);return b&&b[1]?b[1].length:0},l=function(a){return Math.round(a*Math.pow(10,e))},m=!0;if(j)throw new Error(g);return e=k(d),(k(b)>e||l(b)%l(d)!==0)&&(m=!1),this.optional(c)||m},equalTo:function(b,c,d){var e=a(d);return this.settings.onfocusout&&e.not(".validate-equalTo-blur").length&&e.addClass("validate-equalTo-blur").on("blur.validate-equalTo",function(){a(c).valid()}),b===e.val()},remote:function(b,c,d,e){if(this.optional(c))return"dependency-mismatch";e="string"==typeof e&&e||"remote";var f,g,h,i=this.previousValue(c,e);return this.settings.messages[c.name]||(this.settings.messages[c.name]={}),i.originalMessage=i.originalMessage||this.settings.messages[c.name][e],this.settings.messages[c.name][e]=i.message,d="string"==typeof d&&{url:d}||d,h=a.param(a.extend({data:b},d.data)),i.old===h?i.valid:(i.old=h,f=this,this.startRequest(c),g={},g[c.name]=b,a.ajax(a.extend(!0,{mode:"abort",port:"validate"+c.name,dataType:"json",data:g,context:f.currentForm,success:function(a){var d,g,h,j=a===!0||"true"===a;f.settings.messages[c.name][e]=i.originalMessage,j?(h=f.formSubmitted,f.resetInternals(),f.toHide=f.errorsFor(c),f.formSubmitted=h,f.successList.push(c),f.invalid[c.name]=!1,f.showErrors()):(d={},g=a||f.defaultMessage(c,{method:e,parameters:b}),d[c.name]=i.message=g,f.invalid[c.name]=!0,f.showErrors(d)),i.valid=j,f.stopRequest(c,j)}},d)),"pending")}}});var b,c={};return a.ajaxPrefilter?a.ajaxPrefilter(function(a,b,d){var e=a.port;"abort"===a.mode&&(c[e]&&c[e].abort(),c[e]=d)}):(b=a.ajax,a.ajax=function(d){var e=("mode"in d?d:a.ajaxSettings).mode,f=("port"in d?d:a.ajaxSettings).port;return"abort"===e?(c[f]&&c[f].abort(),c[f]=b.apply(this,arguments),c[f]):b.apply(this,arguments)}),a});
$(document).ready(function(){
    const $commonChart = $('[common-chart-form]');
    const $commonChartLine = $('[common-chart-line]');

    $commonChartLine.on('change', function () {
        $commonChart.trigger('submit')
    })
});

$(document).ready(function(){
    const $menuBtn = $('[js-menu-button]');
    const $menuChannel = $('[js-menu-channel]');
    const $menuPurchase = $('[js-menu-purchase]');
    const $menuCloseBtn = $('[js-menu-close-btn]');
    const $menu = $('[js-menu]');
    const $filterForm = $('[filter-form]');
    const $advertiser = $('[js-advertiser]');
    const $menuPlatform = $('[js-menu-platform]');
    const $menuManager = $('[js-menu-manager]');
    const $menuDirection = $('[js-menu-direction]');
    const $menuCourse = $('[js-menu-course]');
    const $searchInput = $('[js-menu-search]');
    const $purchases = $('[js-menu-purchase]');

    $menuManager.on('change', function () {
        $menuChannel.val('all');
        $menuPlatform.val('all');
        $menuBtn.val('Все аудитории');
        $filterForm.trigger('submit')
    })
    $menuDirection.on('change', function () {
        $menuChannel.val('all');
        $menuPlatform.val('all');
        $menuBtn.val('Все аудитории');
        $filterForm.trigger('submit')
    })
    $menuCourse.on('change', function () {
        $menuChannel.val('all');
        $menuPlatform.val('all');
        $menuBtn.val('Все аудитории');
        $filterForm.trigger('submit')
    })

    $advertiser.on('change', function () {
        $menuChannel.val('all');
        $menuPlatform.val('all');
        $menuBtn.val('Все аудитории');
        $filterForm.trigger('submit')
    })

    $menuPlatform.on('change', function () {
        if ($(this).val() === 'unknown') {
            $menuBtn.val('Неизвестно');
        } else {
            $menuBtn.val('Все аудитории');
        }

        $filterForm.trigger('submit')
    })

    $menuChannel.on('change', function () {
        $menuBtn.val('Все аудитории');
        $filterForm.trigger('submit')
    })

    $menuBtn.on('click', function () {
       if ($menuChannel.val() != 'all' && $menuChannel.val() != 'unknown') {
           displayCommunities();
           $menu.addClass('is-open');
       }
    })

    $menuCloseBtn.on('click', function() {
        $menu.removeClass('is-open');
        closeCommunities();
        showAll()
    })

    $menuPurchase.on('click', function () {
        $menuBtn.val($(this).find('[js-menu-community]').text())
        $filterForm.trigger('submit')
    })

    $searchInput.on('keyup', function () {
        var $v = $(this).val().toLowerCase();

        $purchases.each(function () {
            if (!(~$(this).find('[js-menu-community]').text().toLowerCase().indexOf($v))) {
                $(this).addClass('none');
            } else {
                $(this).removeClass('none');
            }
        })
    })
});

function showAll() {
    $purchases.each(function () {
        $(this).removeClass('none');
    })
}
function displayCommunities() {
    $('body').css('overflow','hidden');
}
function closeCommunities() {
    $('body').css('overflow','auto');
}
$(document).ready(function(){

    checkChannel();

    const $menuBtn = $('[js-menu-button]');
    const $menuChannel = $('[js-menu-channel]');
    const $menuCloseBtn = $('[js-menu-close-btn]');
    const $menu = $('[js-menu]');
    const $filterForm = $('[filter-form]');
    const $filterForm2 = $('[filter-form-communities]');
    const $advertiser = $('[js-advertiser]');
    const $menuPlatform = $('[js-menu-platform]');
    const $menuManager = $('[js-menu-manager]');
    const $menuDirection = $('[js-menu-direction]');
    const $menuCourse = $('[js-menu-course]');
    const $searchInput = $('[js-menu-search]');
    const $purchases = $('[js-menu-purchase]');
    const $allPurchases = $('[js-menu-purchase-all]');

    $menuManager.on('change', function () {
        $menuChannel.val('all');
        $menuPlatform.val('all');
        $menuBtn.val('Все аудитории');
        $filterForm.trigger('submit')
    })
    $menuDirection.on('change', function () {
        $menuChannel.val('all');
        $menuPlatform.val('all');
        $menuBtn.val('Все аудитории');
        $filterForm.trigger('submit')
    })
    $menuCourse.on('change', function () {
        $menuChannel.val('all');
        $menuPlatform.val('all');
        $menuBtn.val('Все аудитории');
        $filterForm.trigger('submit')
    })

    $advertiser.on('change', function () {
        $menuChannel.val('all');
        $menuPlatform.val('all');
        $menuBtn.val('Все аудитории');
        $filterForm.trigger('submit')
    })

    $menuPlatform.on('change', function () {
        if ($(this).val() === 'unknown') {
            $menuBtn.val('Неизвестно');
        } else {
            $menuBtn.val('Все аудитории');
        }
        $menuChannel.val('all');

        $filterForm.trigger('submit')
    })

    $menuChannel.on('change', function () {
        $menuBtn.val('Все аудитории');
        $filterForm.trigger('submit')
    })

    $allPurchases.on('click', function () {
        let $attr = $(this).find('[js-menu-checker]').prop('checked');

        $purchases.each(function () {
            $(this).find('[js-menu-checker]').prop('checked', !$attr);
        })

    })

    $menuBtn.on('click', function () {
        if ($menuChannel.val() != 'all' && $menuChannel.val() != 'unknown') {
            displayCommunities();
            $menu.addClass('is-open');
        }
    })

    $menuCloseBtn.on('click', function() {
        $menu.removeClass('is-open');
        closeCommunities();
        showAll()
        $filterForm2.trigger('submit')
    });

    $filterForm2.on('submit', function (event) {
        event.preventDefault();
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "communities",
            data: JSON.stringify($(this).serializeObject()),
            dataType: 'json',
            cache: false,
            success: function (data) {
                location.reload();
            },
            error: function (data) {
                location.reload();
            }
        });

    });

    $purchases.on('click', function (event) {
        var $isAll = $(this).attr('js-menu-purchase-all');
        if (!(typeof $isAll !== typeof undefined && $isAll !== false)) {
            var $attr = $(this).find('[js-menu-checker]');
            $attr.prop('checked', !$attr.prop('checked'))
            $allPurchases.find('[js-menu-checker]').prop('checked', false)
            checkSelect();
            event.preventDefault();
        }
    })

    $searchInput.on('keyup', function () {
        var $v = $(this).val().toLowerCase();

        $purchases.each(function () {
            if (!(~$(this).find('[js-menu-community]').text().toLowerCase().indexOf($v))) {
                $(this).addClass('none');
            } else {
                $(this).removeClass('none');
            }
        })
    })


    selectAll()
});

function showAll() {
    $('[js-menu-purchase]').each(function () {
        $(this).removeClass('none');
    })
}
function displayCommunities() {
    $('body').css('overflow','hidden');
}
function closeCommunities() {
    $('body').css('overflow','auto');
}
function selectAll() {
    var $isAll = $('[js-menu-purchase-all]').find('[js-menu-checker]').prop('checked')
    if ($isAll) {
        $('[js-menu-purchase]').each(function () {
            $(this).find('[js-menu-checker]').prop('checked', $isAll);
        })
    }
}

function checkSelect() {
    let $counter = $('[js-menu-purchase]').length - 1;
    var $s = 0;
    $('[js-menu-purchase]').each(function () {
        var $isAll = $(this).attr('js-menu-purchase-all');
        if (!(typeof $isAll !== typeof undefined && $isAll !== false)) {
            if ($(this).find('[js-menu-checker]').prop('checked')) {
                $s++;
            }
        }
    })

    if ($s == $counter) {
        $('[js-menu-purchase-all]').find('[js-menu-checker]').prop('checked', true);
    }
}
function checkChannel() {
    if ($('[js-menu-channel]').val() !== 'all' && $('[js-menu-channel]').val() !== 'unknown') {
        $('[js-menu-button]').val('Выберите аудиторию');
    }
}
$(document).ready(function(){
    const $menuBtn = $('[js-menu-button]');
    const $menuPurchase = $('[js-menu-purchase]');
    const $menuChannel = $('[js-menu-channel]');
    const $menuCloseBtn = $('[js-menu-close-btn]');
    const $menuSubmitBtn = $('[distribute-submit-btn]');
    const $menu = $('[js-menu]');

    const $searchInput = $('[js-menu-search]');
    const $purchases = $('[js-menu-purchase]');

    var $target = null;


    $menuCloseBtn.on('click', function() {
        $menu.removeClass('is-open');
        closeChannelsPurchases()
    })

    const $jsonObj = [];
    const $jsonObjTemp = [];

    $menuChannel.on('change', function() {
        var jsonItem = {};
        var $billNumber = $(this).closest('tr.body__row').find('[distribute-id]').val();

        $jsonObj.forEach(function(e, index) {
            if ($jsonObj[index].distributeId === $billNumber) {
                $jsonObj.splice(index, 1);
            }
        })

        $jsonObjTemp.forEach(function(e, index) {
            if ($jsonObjTemp[index].distributeId === $billNumber) {
                $jsonObjTemp.splice(index, 1);
            }
        })
        if('unknown' === $(this).val()) {
            $(this).closest('tr.body__row').find('[js-menu-button]').val('Неизвестный');
            $(this).closest('tr.body__row').find('[js-menu-button]').prop('disabled', true);

            jsonItem ['distributeIdChannel'] = 'unknown';
            jsonItem ['distributeChannel'] = 'unknown';
            jsonItem ['distributeId'] = $billNumber;

            $jsonObj.push(jsonItem);
        } else {
            $(this).closest('tr.body__row').find('[js-menu-button]').val('');
            $(this).closest('tr.body__row').find('[js-menu-button]').prop('disabled', false);

            var $channel = $(this).closest('tr.body__row').find('[js-menu-channel] option:selected').text();
            jsonItem ['distributeIdChannel'] = '';
            jsonItem ['distributeChannel'] = $channel;
            jsonItem ['distributeId'] = $billNumber;

            $jsonObjTemp.push(jsonItem);
        }

        check($jsonObj);
    });

    $menuBtn.on('click', function () {
        if (!($(this).val() === 'Неизвестный')) {
            var $channel = $(this).closest('tr.body__row').find('[js-menu-channel] option:selected').val();
            displayChannelsPurchases($channel);

            $target = $(this);
            $menu.addClass('is-open');
        }
    });

    $menuPurchase.on('click', function () {
        $target.val($(this).find('[js-menu-purchase-name]').val());
        var $billNumber = $target.closest('tr.body__row').find('[distribute-id]').val();
        var $channelId = $(this).find('[js-menu-purchase-id]').val();

        $jsonObj.forEach(function(e, index) {
            if ($jsonObj[index].distributeId === $billNumber) {
                $jsonObj[index].distributeIdChannel = $channelId;
            }
        })

        $jsonObjTemp.forEach(function(e, index) {
            if ($jsonObjTemp[index].distributeId === $billNumber) {
                $jsonObjTemp[index].distributeIdChannel = $channelId;

                $jsonObj.push($jsonObjTemp[index]);
                $jsonObjTemp.splice(index, 1);
            }
        })

        $menu.removeClass('is-open');
        closeChannelsPurchases();
        check($jsonObj);
    })


    $menuSubmitBtn.on('click', function (e) {
        e.preventDefault();
        $.ajax({
            url: "/payment/distributeFew/",
            type:"POST",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify($jsonObj),
            async: false,
            cache: false,
            processData:false,
            success: function(resposeJsonObject){
                location.reload();
            }
        });
    })

    $searchInput.on('keyup', function () {
        var $v = $(this).val().toLowerCase();

        $purchases.each(function () {
            if (!(~$(this).find('[js-menu-purchase-date]').text().toLowerCase().indexOf($v) ||
                    ~$(this).find('[js-menu-purchase-community]').text().toLowerCase().indexOf($v) ||
                    ~$(this).find('[js-menu-purchase-course]').text().toLowerCase().indexOf($v) ||
                    ~$(this).find('[js-menu-purchase-link]').text().toLowerCase().indexOf($v) ||
                    ~$(this).find('[js-menu-purchase-tiser]').text().toLowerCase().indexOf($v))) {
                $(this).addClass('none');
            } else {
                $(this).removeClass('none');
            }
        })
    })
});

function displayChannelsPurchases(id) {
    var $content = $('[js-menu-content]')
    $content.find('#' + id).addClass('is-selected');
    $('body').css('overflow','hidden');
}
function closeChannelsPurchases() {
    var $content = $('[js-menu-content]')
    $content.find('.menu-content__wrapper').removeClass('is-selected');
    $('body').css('overflow','auto');
}

function check(jsonObj) {
    var $sz = jsonObj.length;
    if (jsonObj.length > 0) {
        $('[js-distributed-count]').text($sz);
        $('[js-distributed-message]').addClass('active');
    } else {
        $('[js-distributed-count]').text(0);
        $('[js-distributed-message]').removeClass('active');
    }
}
$(document).ready(function(){
    const $menuBtn = $('[js-menu-button]');
    const $menuChannel = $('[js-menu-channel]');

    $menuBtn.on('click', function () {
        if (!($(this).val() === 'Неизвестный')) {
            var $channel = $(this).closest('tr.body__row').find('[js-menu-channel] option:selected').val();
            var $channelText = $(this).closest('tr.body__row').find('[js-menu-channel] option:selected').text();
            $(this).closest('tr.body__row').find('[distribute-from]').find('[distribute-channel]').val($channelText)
            displayChannelsPurchases($channel);

            $target = $(this);
            $menu.addClass('is-open');
        }
    })

    $menuChannel.on('change', function() {
        if('unknown' === $(this).val()) {
            $(this).closest('tr.body__row').find('[js-menu-button]').val('Неизвестный');
        } else {
            $(this).closest('tr.body__row').find('[js-menu-button]').val('');
        }
    })

    $menuCloseBtn.on('click', function() {
        $menu.removeClass('is-open');
        closeChannelsPurchases()
        showAll()
    })

    $menuPurchase.on('click', function () {
        $menuPurchase.removeClass('active')
        $(this).addClass('active')
        $target.val($(this).find('[js-menu-purchase-name]').val())
        $target.closest('tr.body__row').find('[distribute-from]').find('[distribute-id-channel]').val($(this).find('[js-menu-purchase-id]').val())
    })

    $menuSubmitBtn.on('click', function (e) {
        var v = $(this).closest('tr.body__row').find('[js-menu-button]').val()
        var v2 = $(this).closest('tr.body__row').find('[js-menu-channel]').val()
        if (v === null || v === '' || v2 === null || v2 === '') {
            e.preventDefault();
        }
    })

    $searchInput.on('keyup', function () {
        var $v = $(this).val();

        $purchases.each(function () {
            if (!(~$(this).find('[js-menu-purchase-date]').text().indexOf($v) ||
                    ~$(this).find('[js-menu-purchase-community]').text().indexOf($v) ||
                    ~$(this).find('[js-menu-purchase-course]').text().indexOf($v) ||
                    ~$(this).find('[js-menu-purchase-link]').text().indexOf($v) ||
                    ~$(this).find('[js-menu-purchase-tiser]').text().indexOf($v))) {
                $(this).addClass('none');
            } else {
                $(this).removeClass('none');
            }
        })
    })
});
var LESSON_BLOCK_COUNTER = 0;

$(document).ready(function () {
    $(".sortableList").sortable({
        revert: true,
        placeholder: 'sortable-placeholder',
        stop: function(event, ui) {
            var type = ui.item.attr('data-type')
            if (typeof type !== typeof undefined && type !== false) {
                var replaced = '';
                if (type === 'video') {
                    replaced = '<div class="lesson-block draggable ui-draggable ui-draggable-handle ui-draggable-dragging ui-sortable-helper">' +
                        '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].index" type="hidden" required>' +
                        '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].type" value="video" type="hidden" required>' +
                        '                                        <div class="lesson-block__wrapper">' +
                        '                                            <div class="lesson-block__title">Видео</div>' +
                        '                                            <div class="lesson-elements">' +
                        '                                                <div class="lesson-elements__wrapper">' +
                        '                                                    <div class="lesson-element">' +
                        '                                                        <div class="lesson-element__title">Cсылку на видео *</div>' +
                        '                                                        <div class="lesson-element__wrapper">' +
                        '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].value" type="text" required placeholder="Введите ссылку" class="lesson-element__input">' +
                        '                                                        </div>' +
                        '                                                    </div>' +
                        '                                                </div>' +
                        '                                            </div>' +
                        '                                        </div>' +
                        '                                        <div class="lesson-block__delete"></div>' +
                        '                                    </div>';
                } else if (type === 'text') {
                    replaced = '<div class="lesson-block draggable ui-draggable ui-draggable-handle ui-draggable-dragging ui-sortable-helper">' +
                        '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].index" type="hidden" required>' +
                        '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].type" value="text" type="hidden" required>' +
                        '                                        <div class="lesson-block__wrapper">' +
                        '                                            <div class="lesson-block__title">Текстовый блок</div>' +
                        '                                            <div class="lesson-elements">' +
                        '                                                <div class="lesson-elements__wrapper lesson-elements__wrapper_column">' +
                        '                                                    <div class="lesson-element">' +
                        '                                                        <div class="lesson-element__title">Заголовок *</div>' +
                        '                                                        <div class="lesson-element__wrapper">' +
                        '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].title" type="text" required placeholder="Введите заголовок" class="lesson-element__input">' +
                        '                                                        </div>' +
                        '                                                    </div>' +
                        '                                                    <div class="lesson-element">' +
                        '                                                        <div class="lesson-element__title">Текст *</div>' +
                        '                                                        <div class="lesson-element__wrapper">' +
                        '                                                            <textarea name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].value" required placeholder="Введите текст" class="lesson-element__input lesson-element__input_textarea"></textarea>' +
                        '                                                        </div>' +
                        '                                                    </div>' +
                        '                                                </div>' +
                        '                                            </div>' +
                        '                                        </div>' +
                        '                                        <div class="lesson-block__delete"></div>' +
                        '                                    </div>';
                } else if (type === 'document') {
                    replaced = '<div class="lesson-block draggable ui-draggable ui-draggable-handle ui-draggable-dragging ui-sortable-helper">' +
                        '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].index" type="hidden" required>' +
                        '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].type" value="document" type="hidden" required>' +
                        '                                        <div class="lesson-block__wrapper">' +
                        '                                            <div class="lesson-block__title">Документ</div>' +
                        '                                            <div class="lesson-elements">' +
                        '                                                <div class="lesson-elements__wrapper lesson-elements__wrapper_column">' +
                        '                                                    <div class="lesson-element">' +
                        '                                                        <div class="lesson-element__title">Название *</div>' +
                        '                                                        <div class="lesson-element__wrapper">' +
                        '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].title" type="text" required placeholder="Введите название" class="lesson-element__input">' +
                        '                                                        </div>' +
                        '                                                    </div>' +
                        '                                                    <div class="lesson-element">' +
                        '                                                        <div class="lesson-element__wrapper lesson-element__wrapper_list">' +
                        '                                                               <div class="file-loader">' +
                        '                                                                   <input type="file" name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].files" id="files' + LESSON_BLOCK_COUNTER + '" accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx" class="file-loader__file file-loader__file_file" required>' +
                        '                                                                   <label for="files' + LESSON_BLOCK_COUNTER + '" class="file-loader__label"><span class="file-loader__title"></span></label>' +
                        '                                                               </div>' +
                        '                                                        </div>' +
                        '                                                    </div>' +
                        '                                                </div>' +
                        '                                            </div>' +
                        '                                        </div>' +
                        '                                        <div class="lesson-block__delete"></div>' +
                        '                                    </div>';
                }  else if (type === 'image') {
                    replaced = '<div class="lesson-block draggable ui-draggable ui-draggable-handle ui-draggable-dragging ui-sortable-helper">' +
                        '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].index" type="hidden" required>' +
                        '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].type" value="image" type="hidden" required>' +
                        '                                        <div class="lesson-block__wrapper">' +
                        '                                            <div class="lesson-block__title">Изображение</div>' +
                        '                                            <div class="lesson-elements">' +
                        '                                                <div class="lesson-elements__wrapper lesson-elements__wrapper_column">' +
                        '                                                    <div class="lesson-element">' +
                        '                                                        <div class="lesson-element__title">Название *</div>' +
                        '                                                        <div class="lesson-element__wrapper">' +
                        '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].title" type="text" required placeholder="Введите название" class="lesson-element__input">' +
                        '                                                        </div>' +
                        '                                                    </div>' +
                        '                                                    <div class="lesson-element">' +
                        '                                                        <div class="lesson-element__wrapper lesson-element__wrapper_list">' +
                        '                                                               <div class="file-loader">' +
                        '                                                                   <input type="file" name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].files" id="files' + LESSON_BLOCK_COUNTER + '" accept=".png,.jpg,.jpeg" class="file-loader__file file-loader__file_image" required>' +
                        '                                                                   <label for="files' + LESSON_BLOCK_COUNTER + '" class="file-loader__label"><span class="file-loader__title"></span></label>' +
                        '                                                               </div>' +
                        '                                                        </div>' +
                        '                                                    </div>' +
                        '                                                </div>' +
                        '                                            </div>' +
                        '                                        </div>' +
                        '                                        <div class="lesson-block__delete"></div>' +
                        '                                    </div>';
                } else if (type === 'gallery') {
                    replaced = '<div class="lesson-block draggable ui-draggable ui-draggable-handle ui-draggable-dragging ui-sortable-helper">' +
                        '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].index" type="hidden" required>' +
                        '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].type" value="gallery" type="hidden" required>' +
                        '                                        <div class="lesson-block__wrapper lesson-block__wrapper_pb0">' +
                        '                                            <div class="lesson-block__title">Галлерея</div>' +
                        '                                            <div class="lesson-elements">' +
                        '                                                <div class="lesson-elements__wrapper lesson-elements__wrapper_column">' +
                        '                                                    <div class="lesson-element">' +
                        '                                                        <div class="lesson-element__title">Название *</div>' +
                        '                                                        <div class="lesson-element__wrapper">' +
                        '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].title" type="text" required placeholder="Введите название" class="lesson-element__input">' +
                        '                                                        </div>' +
                        '                                                    </div>' +
                        '                                                    <div class="lesson-element">' +
                        '                                                        <div class="lesson-element__wrapper lesson-element__wrapper_list">' +
                        '                                                               <div class="file-loader file-loader_mb20">' +
                        '                                                                   <input type="file" data-name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].files" id="files' + LESSON_BLOCK_COUNTER + '" accept=".png,.jpg,.jpeg" class="file-loader__file file-loader__file_gallery" multiple>' +
                        '                                                                   <label for="files' + LESSON_BLOCK_COUNTER + '" class="file-loader__label"><span class="file-loader__title"></span></label>' +
                        '                                                               </div>' +
                        '                                                        </div>' +
                        '                                                    </div>' +
                        '                                                </div>' +
                        '                                            </div>' +
                        '                                        </div>' +
                        '                                        <div class="lesson-block__delete"></div>' +
                        '                                    </div>';
                } else if (type === 'question') {
                    replaced = '<div class="lesson-block draggable ui-draggable ui-draggable-handle ui-draggable-dragging ui-sortable-helper">' +
                        '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].index" type="hidden" required>' +
                        '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].type" value="question" type="hidden" required>' +
                        '                                        <div class="lesson-block__wrapper">' +
                        '                                            <div class="lesson-block__title">Открытый вопрос</div>' +
                        '                                            <div class="lesson-elements">' +
                        '                                                <div class="lesson-elements__wrapper lesson-elements__wrapper_column">' +
                        '                                                    <div class="lesson-element">' +
                        '                                                        <div class="lesson-element__wrapper">' +
                        '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].blockValues[0].value" type="checkbox" id="images' + LESSON_BLOCK_COUNTER + '" class="checkbox" value="images">' +
                        '                                                            <label class="checkbox-label checkbox-label_gray" for="images' + LESSON_BLOCK_COUNTER + '" >Разрешить загружать изображения</label>' +
                        '                                                        </div>' +
                        '                                                    </div>' +
                        '                                                    <div class="lesson-element">' +
                        '                                                        <div class="lesson-element__wrapper">' +
                        '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].blockValues[1].value" type="checkbox" id="files' + LESSON_BLOCK_COUNTER + '" class="checkbox" value="files">' +
                        '                                                            <label class="checkbox-label checkbox-label_gray" for="files' + LESSON_BLOCK_COUNTER + '" >Разрешить загружать файлы</label>' +
                        '                                                        </div>' +
                        '                                                    </div>' +
                        '                                                </div>' +
                        '                                            </div>' +
                        '                                        </div>' +
                        '                                        <div class="lesson-block__delete"></div>' +
                        '                                    </div>';
                }

                LESSON_BLOCK_COUNTER++;
                ui.item.replaceWith(replaced);
            }

            recheckLessonBlockIndex($(this).find('.lesson-block'));
        }
    });
    $(".draggable").draggable({
        connectToSortable: '.sortableList',
        helper: 'clone',
        revert: 'invalid'
    });
    $(".draggable").disableSelection();
});

function recheckLessonBlockIndex(blocks) {
    $.each(blocks, function(index, block) {
        $(block).find('[name$=".index"]').val(index);
    });
}

$(document).on('click', '.lesson-block__delete', function(event) {
    var block = $(this).closest('.lesson-block');
    var blockWrapper = block.closest('.lesson-content__blocks');

    block.remove();
    recheckLessonBlockIndex(blockWrapper.find('.lesson-block'));
});
var DELETE_LESSON_BLOCKS = [];
$(document).on('click', '.lesson-block__delete.update', function(event) {
    var block = $(this).closest('.lesson-block');
    DELETE_LESSON_BLOCKS.push(Number(block.find('[name$=".id"]').val()));
    var blockWrapper = block.closest('.lesson-content__blocks');

    block.remove();
    recheckLessonBlockIndex(blockWrapper.find('.lesson-block'));
});

$(document).on('click', '[lesson-tab]', function(event) {
    var currentBtn  = $(this);
    var formData = new FormData();
    formData.set('id', Number(currentBtn.attr('current-course')));

    $('[lesson-tab]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getModules",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setCourseModules(data);

            var currentActiveId = currentBtn.data('tab');
            currentBtn.closest('.tabs__wrapper').find('[js-tab]').removeClass('active');
            currentBtn.addClass('active');
            currentBtn.closest('.tabs__wrapper').find('[js-tab-panel]').removeClass('is-open');
            currentBtn.closest('.tabs__wrapper').find('[js-tab-panel]').filter('[data-tab=' + currentActiveId + ']').addClass('is-open');

            $('[lesson-tab]').prop("disabled", false);
        },
        error: function (data) {
            $('[lesson-tab]').prop("disabled", false);
        }
    });
});

function setCourseModules(data) {
    $('[modules-list]').html('');
    $.each(data, function(index, module){
        $('[modules-list]').append(createModule(module, (index+1)));

        var lessonWrapper = $('[data-module="' + module.id + '"]').find('.module__lessons');
        var lessonCount = lessonWrapper.find('.module__lesson').length + 1;

        $.each(module.lessonList, function(index, lesson){
            lessonWrapper.append(createLesson(lesson, lessonCount));
            lessonCount++;
        });
    });

}

$(document).on('click','[js-delete-module]',function (event) {
    event.stopPropagation();
    if (!confirm('Вы действительно хотите удалить модуль?')){
        return;
    }
    console.log('deleteModule', $(this).data('module-id'));
    var idModule = $(this).data('module-id');
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "deleteModule",
        data: JSON.stringify(idModule),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('.module[data-module="' + idModule + '"]').remove();
        },
        error: function (data) {
        }
    });
});

$(document).on('click','[js-delete-lesson]',function (event) {
    event.stopPropagation();
    if (!confirm('Вы действительно хотите удалить урок?')){
        return;
    }
    console.log('deleteLesson', $(this).data('lesson-id'));
    var idLesson = $(this).data('lesson-id');
    var isHomework = ($(this).data('lesson-homework') == 'true')
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "deleteLesson",
        data: JSON.stringify(idLesson),
        dataType: 'json',
        cache: false,
        success: function (data) {
            var $wrapper = $('.module__lesson[data-lesson="' + idLesson + '"]').parents('.module__wrapper');
            $('.module__lesson[data-lesson="' + idLesson + '"]').remove();
            if (isHomework){
                var $it = $wrapper.find('.homework-count');
                var count = parseInt($it.data('item-count')) - 1;
                $it.data('item-count', count);
                $it.html(count + ' домашнее задание')
            }else{
                var $it = $wrapper.find('.lesson-count');
                var count = parseInt($it.data('item-count')) - 1;
                $it.data('item-count', count);
                $it.html(count + ' уроков')
            }
        },
        error: function (data) {
        }
    });
});


$(document).on('click', '[add-module]', function(event) {
    $('[js-add-module-form]').trigger('reset');
    $('[js-add-module-form]').find('[img-title]').html('Загрузите изображение (410 х 280px)');

    $('[m-course-id]').val($(this).attr('current-course'));

    $('[js-menu-add-module]').addClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[js-menu-add-module-close-btn]', function(event){
    $('[js-menu-add-module]').removeClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[js-add-module]', function(event){
    event.preventDefault();
    $('[js-add-module-form]').trigger('submit');
});
$(document).on('submit', '[js-add-module-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-add-module-form]')[0]);
        saveModule(formData);
    }
});
function saveModule(formData) {
    $('[js-add-module]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveModule",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {

            setNewModule(data);

            $('[js-menu-add-module]').removeClass('is-open');
            checkBodyHidden();
            $('[js-add-module]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-module]').prop("disabled", false);
        }
    });
}

function setNewModule(module) {
    var moduleCount = $('[modules-list]').find('.module').length + 1;
    $('[modules-list]').append(createModule(module, moduleCount));
}

function createModule(module, index) {
    return '<div data-module="' + module.id + '" class="module">' +
        '                                                <div class="module__wrapper">' +
        '                                                    <div class="module__header collapsed"' +
        '                                                         data-toggle="collapse"' +
        '                                                         data-target="#module' + module.id + '"' +
        '                                                         aria-expanded="false"' +
        '                                                         aria-controls="module' + module.id + '">' +
        '                                                  <div js-delete-module class="module__header-delete" data-module-id="'+module.id+'">' +
        '                                                        <img src="/img/close.svg">' +
        '                                                  </div>' +
        '                                                        <div class="module-desc">' +
        '                                                            <div class="module-desc__number">' + index + '</div>' +
        '                                                            <div class="module-desc__wrapper">' +
        '                                                                <div class="module-name module-desc__title">' + module.name + '</div>' +
        '                                                                <div class="module-desc__desc">' +
        '                                                                    <div class="lesson-count module-desc__text module-desc__text_video" data-item-count="'+module.lessonCount+'">' + module.lessonCount + ' уроков</div>' +
        '                                                                    <div class="module-desc__delim"><span></span></div>' +
        '                                                                    <div class="homework-count module-desc__text module-desc__text_work" data-item-count="'+module.homeworkCount+'">' + module.homeworkCount + ' домашнее задание</div>' +
        '                                                                </div>' +
        '                                                            </div>' +
        '                                                        </div>' +
        '                                                        <div class="module__switch"></div>' +
        '                                                    </div>' +
        '                                                    <div class="module__body collapse" id="module' + module.id + '">' +
        '                                                        <div class="module__lessons">' +

    '                                                        </div>' +
    '                                                        <div class="modules__btn-wrapper">' +
    '                                                            <div add-lesson data-type="lesson" class="module-btn module-btn_low">+ Добавить урок</div>' +
        ((module.homeworkCount == 0) ? '                                                            <div add-lesson data-type="homework" class="module-btn module-btn_low">+ Добавить домашнее задание</div>':'') +
    '                                                        </div>' +
    '                                                    </div>' +
    '                                                </div>' +
    '                                                <div update-module class="module-setting"></div>' +
    '                                            </div>'
}

function createLesson(lesson, index) {
    var durationHour = Math.trunc(lesson.duration / 60);
    var durationMin = lesson.duration % 60;
    return '<div data-lesson="' + lesson.id + '" class="module__lesson">' +
        '<div js-delete-lesson class="module__lesson-delete" data-lesson-id="'+lesson.id+'" data-lesson-homework="'+(lesson.type=='homework')+'">' +
        '<img src="/img/close.svg">' +
        '</div>' +
        '<div class="module-desc">' +
        '<div class="module-desc__number">' + index + '</div>' +
        '<div class="module-desc__wrapper">' +
        '<div class="module-desc__title">' + lesson.title + '</div>' +
        '<div class="module-desc__desc">' +
        '<div class="module-desc__text module-desc__text_clock">' + durationHour + ' ч ' + durationMin + ' мин</div>' +
        '<div class="module-desc__delim"><span></span></div>' +
        '<div class="module-desc__text module-desc__text_document">' + lesson.documentsCounter + ' файла</div>' +
        '</div>' +
        '</div>' +
        '</div>' +
        '<div update-lesson class="module__btn module__btn_right">'+(lesson.type=='homework' ? 'Настроить ДЗ':'Настроить урок')+'</div>' +
        '</div>';
}

$(document).on('click', '[update-module]', function(event) {
    var formData = new FormData();
    formData.append('id', Number($(this).closest('[data-module]').data('module')));

    $('[update-module]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getModule",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setUpdateModuleInfo(data);

            $('[update-module]').prop("disabled", false);
        },
        error: function (data) {
            $('[update-module]').prop("disabled", false);
        }
    });
});

function setUpdateModuleInfo(module) {
    $('[js-update-module-form]').trigger('reset');
    $('[js-update-module-form]').find('[img-title]').html('Загрузите изображение (410 х 280px)');

    $('[u-module-name]').val(module.name);
    $('[u-module-description]').html(module.description);
    $('[u-module-access]').prop('checked', module.accessLimitation);
    $('[u-module-id]').val(module.id);

    $('[js-menu-update-module]').addClass('is-open');
    checkBodyHidden();
}

$(document).on('click', '[js-menu-update-module-close-btn]', function(event){
    $('[js-menu-update-module]').removeClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[js-update-module]', function(event){
    event.preventDefault();
    $('[js-update-module-form]').trigger('submit');
});
$(document).on('submit', '[js-update-module-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-update-module-form]')[0]);
        updateModule(formData);
    }
});
function updateModule(formData) {
    $('[js-update-module]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "updateModule",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[data-module="' + data.id + '"]').find('.module-name').html(data.name);

            $('[js-menu-update-module]').removeClass('is-open');
            checkBodyHidden();
            $('[js-update-module]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-module]').prop("disabled", false);
        }
    });
}

$(document).on('click', '[add-lesson]', function(event){
    $('.constructor-blocks.add-lesson').find('.not-common').addClass('constructor-blocks__wrapper_hide');
    $('[js-add-lesson-form]').trigger('reset');
    $('[js-add-lesson-form]').find('.lesson-content__blocks').html('');
    TEMP_DATA = {};
    LESSON_BLOCK_COUNTER = 0;

    $('[a-lesson-module]').val($(this).closest('[data-module]').data('module'));
    $('[a-lesson-type]').val($(this).data('type'));

    if ($(this).data('type') === 'homework') {
        $('.constructor-blocks.add-lesson').find('.not-common').removeClass('constructor-blocks__wrapper_hide');
    }

    $('[js-menu-add-lesson]').addClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[js-menu-add-lesson-close-btn]', function(event){
    $('[js-menu-add-lesson]').removeClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[js-add-lesson]', function(event){
    event.preventDefault();
    $('[js-add-lesson-form]').trigger('submit');
});
$(document).on('submit', '[js-add-lesson-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-add-lesson-form]')[0]);
        $.each(TEMP_DATA, function(index, file) {
            formData.append(file['name'], file['file']);
        });

        saveLesson(formData);
    }
});
function saveLesson(formData) {
    $('[js-add-lesson]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveLesson",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var lessonWrapper = $('[data-module="' + data.idModule + '"]').find('.module__lessons');
            var lessonCount = lessonWrapper.find('.module__lesson').length + 1;

            lessonWrapper.append(createLesson(data, lessonCount));

            updateModuleInfo(data.idModule);

            $('[js-menu-add-lesson]').removeClass('is-open');
            checkBodyHidden();
            $('[js-add-lesson]').prop("disabled", false);
            hideLoader();
        },
        error: function (data) {
            $('[js-add-lesson]').prop("disabled", false);
            hideLoader();
        },
        beforeSend: function() {
            showLoader();
        },
        afterSend: function() {
            hideLoader();
        }
    });
}
function updateModuleInfo(idModule) {
    var formData = new FormData();
    formData.append('id', Number(idModule));
    $.ajax({
        type: "POST",
        url: "getModule",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[data-module="' + data.id + '"]').find('.lesson-count').data('item-count', data.lessonCount).html(data.lessonCount + ' уроков');
            $('[data-module="' + data.id + '"]').find('.homework-count').data('item-count', data.homeworkCount).html(data.homeworkCount + ' домашнее задание');
            if (data.homeworkCount > 0){
                $('[data-module="' + data.id + '"]').find('[add-lesson][data-type="homework"]').hide();
            }else{
                $('[data-module="' + data.id + '"]').find('[add-lesson][data-type="homework"]').show();
            }
        },
        error: function (data) {
        }
    });
}

$(document).on('change', '.file-loader__file_file', function(element) {
    var $input = $(this),
        $label = $input.siblings('.file-loader__label');

    if (element.target.value) {
        var fileType = element.target.value.split('\\').pop().split('.').pop();
        $label.addClass('file-loader__label_attached');
        $label.after(
            '<div class="file-loader__file-preview file-loader__file-preview_' + fileType + '">' +
            '   <span class="file-loader__title">' + fileType + '</span>' +
            '</div>'+
            '<span class="file-loader__delete file-preview"></span>');
    }
});
$(document).on('click', '.file-loader__delete.file-preview', function(element) {
    deleteFilePreview($(this));
    $(this).remove();
});
function deleteFilePreview(block) {
    var $preview = block.siblings('.file-loader__file-preview'),
        $input = $preview.closest('.file-loader').find('.file-loader__file_file'),
        $label = $input.siblings('.file-loader__label');

    $preview.remove();
    $input.val('');
    $label.removeClassWild('file-loader__label_*');
}

$(document).on('click', '.file-loader__delete.file-preview_update', function(element) {
    deleteFilePreview($(this));
    $(this).siblings('input').attr('required', 'required');
    $(this).remove();
});

$(document).on('change', '.file-loader__file_image', function(element) {
    var $input = $(this),
        $label = $input.siblings('.file-loader__label');

    if (element.target.value) {
        var tmpPath = URL.createObjectURL(element.target.files[0]);
        $label.addClass('file-loader__label_attached');
        $label.after(
            '<a class="file-loader__preview" href="' + tmpPath + '" data-fancybox="' + element.target.value.split('\\').pop() + '">' +
            '    <img src="' + tmpPath + '">' +
            '</a>' +
            '<span class="file-loader__delete preview"></span>');
    }
});

$(document).on('click', '.file-loader__delete.preview', function(element) {
    deleteImagePreview($(this));
    $(this).remove();
});
function deleteImagePreview(block) {
    var $preview = block.siblings('.file-loader__preview'),
        $input = $preview.closest('.file-loader').find('.file-loader__file_image'),
        $label = $input.siblings('.file-loader__label');

    $preview.remove();
    $input.val('');
    $label.removeClassWild('file-loader__label_*');
}
$(document).on('click', '.file-loader__delete.preview_update', function(element) {
    deleteImagePreview($(this));
    $(this).siblings('input').attr('required', 'required');
    $(this).remove();
});

var TEMP_DATA = {};
$(document).on('change', '.file-loader__file_gallery', function(element) {
    if (element.target.value) {
        var $loader = $(this).closest('.file-loader'),
            $name = $(this).data('name');

        $.each(element.target.files, function(index, file) {
            var tmpPath = URL.createObjectURL(file);

            $loader.before(
                '<div class="file-loader file-loader_mb20">' +
                '   <a class="file-loader__preview" href="' + tmpPath + '" data-fancybox="' + file.name + '">' +
                '       <img src="' + tmpPath + '">' +
                '   </a>'+
                '<span class="file-loader__delete gallery"></span>' +
                '</div>');

            var tmpFile = {};
            tmpFile['name'] = $name;
            tmpFile['file'] = file;

            TEMP_DATA[tmpPath] = tmpFile;
        });
        $(this).val('');
    }
});

$(document).on('click', '.file-loader__delete.gallery', function(element) {
    var $loader = $(this).closest('.file-loader');

    delete TEMP_DATA[$loader.find('img').attr('src')];

    $loader.remove();
});

var DELETE_GALLERY = [];
$(document).on('click', '.file-loader__delete.gallery_update', function(element) {
    var $loader = $(this).closest('.file-loader');

    DELETE_GALLERY.push(Number($loader.data('gallery')));

    $loader.remove();
});

$(document).on('click', '[update-lesson]', function(event) {
    TEMP_DATA = {};
    LESSON_BLOCK_COUNTER = 0;
    DELETE_GALLERY = [];
    DELETE_LESSON_BLOCKS = [];

    var formData = new FormData();
    formData.set('id', Number($(this).closest('[data-lesson]').data('lesson')));

    $('[update-lesson]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getModuleLessonWithBlocks",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[u-lesson-id]').val(data.id);
            $('[u-lesson-title]').val(data.title);
            $('[u-lesson-duration]').val(data.duration);

            setUpdateLessonBlock(data.lessonBlocks);

            $('[js-menu-update-lesson]').addClass('is-open');
            checkBodyHidden();

            $('[update-lesson]').prop("disabled", false);
        },
        error: function (data) {
            $('[update-lesson]').prop("disabled", false);
        }
    });
});

function setUpdateLessonBlock(blocks) {
    var blocksHtml = '';
    $.each(blocks, function(index, block) {
        if (block.type === 'video') {
            blocksHtml += '<div class="lesson-block draggable ui-draggable ui-draggable-handle ui-draggable-dragging ui-sortable-helper">' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].id" value="' + block.id + '" type="hidden" required>' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].index" value="' + block.index + '" type="hidden" required>' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].type" value="video" type="hidden" required>' +
                '                                        <div class="lesson-block__wrapper">' +
                '                                            <div class="lesson-block__title">Видео</div>' +
                '                                            <div class="lesson-elements">' +
                '                                                <div class="lesson-elements__wrapper">' +
                '                                                    <div class="lesson-element">' +
                '                                                        <div class="lesson-element__title">Cсылка на видео *</div>' +
                '                                                        <div class="lesson-element__wrapper">' +
                '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].value" value="' + block.value + '" type="text" required placeholder="Введите ссылку" class="lesson-element__input">' +
                '                                                        </div>' +
                '                                                    </div>' +
                '                                                </div>' +
                '                                            </div>' +
                '                                        </div>' +
                '                                        <div class="lesson-block__delete update"></div>' +
                '                                    </div>';
        } else if (block.type === 'text') {
            blocksHtml += '<div class="lesson-block draggable ui-draggable ui-draggable-handle ui-draggable-dragging ui-sortable-helper">' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].id" value="' + block.id + '" type="hidden" required>' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].index" value="' + block.index + '" type="hidden" required>' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].type" value="text" type="hidden" required>' +
                '                                        <div class="lesson-block__wrapper">' +
                '                                            <div class="lesson-block__title">Текстовый блок</div>' +
                '                                            <div class="lesson-elements">' +
                '                                                <div class="lesson-elements__wrapper lesson-elements__wrapper_column">' +
                '                                                    <div class="lesson-element">' +
                '                                                        <div class="lesson-element__title">Заголовок *</div>' +
                '                                                        <div class="lesson-element__wrapper">' +
                '                                                            <input value="' + block.title + '" name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].title" type="text" required placeholder="Введите заголовок" class="lesson-element__input">' +
                '                                                        </div>' +
                '                                                    </div>' +
                '                                                    <div class="lesson-element">' +
                '                                                        <div class="lesson-element__title">Текст *</div>' +
                '                                                        <div class="lesson-element__wrapper">' +
                '                                                            <textarea name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].value" required placeholder="Введите текст" class="lesson-element__input lesson-element__input_textarea">' + block.value + '</textarea>' +
                '                                                        </div>' +
                '                                                    </div>' +
                '                                                </div>' +
                '                                            </div>' +
                '                                        </div>' +
                '                                        <div class="lesson-block__delete update"></div>' +
                '                                    </div>';
        } else if (block.type === 'document') {
            var fileType = block.value.split('\\').pop().split('.').pop();
            blocksHtml += '<div class="lesson-block draggable ui-draggable ui-draggable-handle ui-draggable-dragging ui-sortable-helper">' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].id" value="' + block.id + '" type="hidden" required>' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].index" value="' + block.index + '" type="hidden" required>' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].type" value="document" type="hidden" required>' +
                '                                        <div class="lesson-block__wrapper">' +
                '                                            <div class="lesson-block__title">Документ</div>' +
                '                                            <div class="lesson-elements">' +
                '                                                <div class="lesson-elements__wrapper lesson-elements__wrapper_column">' +
                '                                                    <div class="lesson-element">' +
                '                                                        <div class="lesson-element__title">Название *</div>' +
                '                                                        <div class="lesson-element__wrapper">' +
                '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].title" value="' + block.title + '" type="text" required placeholder="Введите название" class="lesson-element__input">' +
                '                                                        </div>' +
                '                                                    </div>' +
                '                                                    <div class="lesson-element">' +
                '                                                        <div class="lesson-element__wrapper lesson-element__wrapper_list">' +
                '                                                               <div class="file-loader">' +
                '                                                                   <input type="file" name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].files" id="files' + LESSON_BLOCK_COUNTER + '" accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx" class="file-loader__file file-loader__file_file">' +
                '                                                                   <label for="files' + LESSON_BLOCK_COUNTER + '" class="file-loader__label file-loader__label_attached"></label>' +
                '                                                                       <div class="file-loader__file-preview file-loader__file-preview_' + fileType + '">' +
                '                                                                           <span class="file-loader__title">' + fileType + '</span>' +
                '                                                                       </div>'+
                '                                                                   <span class="file-loader__delete file-preview_update"></span>' +
                '                                                               </div>' +
                '                                                        </div>' +
                '                                                    </div>' +
                '                                                </div>' +
                '                                            </div>' +
                '                                        </div>' +
                '                                        <div class="lesson-block__delete update"></div>' +
                '                                    </div>';
        }  else if (block.type === 'image') {
            blocksHtml += '<div class="lesson-block draggable ui-draggable ui-draggable-handle ui-draggable-dragging ui-sortable-helper">' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].id" value="' + block.id + '" type="hidden" required>' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].index" value="' + block.index + '" type="hidden" required>' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].type" value="image" type="hidden" required>' +
                '                                        <div class="lesson-block__wrapper">' +
                '                                            <div class="lesson-block__title">Изображение</div>' +
                '                                            <div class="lesson-elements">' +
                '                                                <div class="lesson-elements__wrapper lesson-elements__wrapper_column">' +
                '                                                    <div class="lesson-element">' +
                '                                                        <div class="lesson-element__title">Название *</div>' +
                '                                                        <div class="lesson-element__wrapper">' +
                '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].title" value="' + block.title + '" type="text" required placeholder="Введите название" class="lesson-element__input">' +
                '                                                        </div>' +
                '                                                    </div>' +
                '                                                    <div class="lesson-element">' +
                '                                                        <div class="lesson-element__wrapper lesson-element__wrapper_list">' +
                '                                                               <div class="file-loader">' +
                '                                                                   <input type="file" name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].files" id="files' + LESSON_BLOCK_COUNTER + '" accept=".png,.jpg,.jpeg" class="file-loader__file file-loader__file_image">' +
                '                                                                   <label for="files' + LESSON_BLOCK_COUNTER + '" class="file-loader__label file-loader__label_attached"><span class="file-loader__title"></span></label>' +
                '                                                                   <a class="file-loader__preview" href="/' + block.value + '" data-fancybox="' + block.value + '">' +
                '                                                                       <img src="/' + block.value + '">' +
                '                                                                   </a>' +
                '                                                                   <span class="file-loader__delete preview_update"></span>' +
                '                                                               </div>' +
                '                                                        </div>' +
                '                                                    </div>' +
                '                                                </div>' +
                '                                            </div>' +
                '                                        </div>' +
                '                                        <div class="lesson-block__delete update"></div>' +
                '                                    </div>';
        } else if (block.type === 'gallery') {
            var blockValues = '';
            $.each(block.blockValues, function(index, blockValue) {
                blockValues += '<div data-gallery="' + blockValue.id + '" class="file-loader file-loader_mb20">' +
                    '   <a class="file-loader__preview" href="/' + blockValue.value + '" data-fancybox="' + blockValue.value + '">' +
                    '       <img src="/' + blockValue.value + '">' +
                    '   </a>'+
                    '<span class="file-loader__delete gallery_update"></span>' +
                    '</div>';
            });

            blocksHtml += '<div class="lesson-block draggable ui-draggable ui-draggable-handle ui-draggable-dragging ui-sortable-helper">' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].id" value="' + block.id + '" type="hidden" required>' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].index" value="' + block.index + '" type="hidden" required>' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].type" value="gallery" type="hidden" required>' +
                '                                        <div class="lesson-block__wrapper lesson-block__wrapper_pb0">' +
                '                                            <div class="lesson-block__title">Галлерея</div>' +
                '                                            <div class="lesson-elements">' +
                '                                                <div class="lesson-elements__wrapper lesson-elements__wrapper_column">' +
                '                                                    <div class="lesson-element">' +
                '                                                        <div class="lesson-element__title">Название *</div>' +
                '                                                        <div class="lesson-element__wrapper">' +
                '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].title" value="' + block.title + '" type="text" required placeholder="Введите название" class="lesson-element__input">' +
                '                                                        </div>' +
                '                                                    </div>' +
                '                                                    <div class="lesson-element">' +
                '                                                        <div class="lesson-element__wrapper lesson-element__wrapper_list">' +
                                                                                blockValues +
                '                                                               <div class="file-loader file-loader_mb20">' +
                '                                                                   <input type="file" data-name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].files" id="files' + LESSON_BLOCK_COUNTER + '" accept=".png,.jpg,.jpeg" class="file-loader__file file-loader__file_gallery" multiple>' +
                '                                                                   <label for="files' + LESSON_BLOCK_COUNTER + '" class="file-loader__label"><span class="file-loader__title"></span></label>' +
                '                                                               </div>' +
                '                                                        </div>' +
                '                                                    </div>' +
                '                                                </div>' +
                '                                            </div>' +
                '                                        </div>' +
                '                                        <div class="lesson-block__delete update"></div>' +
                '                                    </div>';
        } else if (block.type === 'question') {
            var arr = block.blockValues;

            blocksHtml += '<div class="lesson-block draggable ui-draggable ui-draggable-handle ui-draggable-dragging ui-sortable-helper">' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].id" value="' + block.id + '" type="hidden" required>' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].index" value="' + block.index + '" type="hidden" required>' +
                '                                        <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].type" value="question" type="hidden" required>' +
                '                                        <div class="lesson-block__wrapper">' +
                '                                            <div class="lesson-block__title">Открытый вопрос</div>' +
                '                                            <div class="lesson-elements">' +
                '                                                <div class="lesson-elements__wrapper lesson-elements__wrapper_column">' +
                '                                                    <div class="lesson-element">' +
                '                                                        <div class="lesson-element__wrapper">' +
                '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].blockValues[0].value" type="checkbox" id="images' + LESSON_BLOCK_COUNTER + '" class="checkbox" ' + ((arr.filter(x => x.value === 'images')[0]) ? 'checked' : '') + ' value="images">' +
                '                                                            <label class="checkbox-label checkbox-label_gray" for="images' + LESSON_BLOCK_COUNTER + '" >Разрешить загружать изображения</label>' +
                '                                                        </div>' +
                '                                                    </div>' +
                '                                                    <div class="lesson-element">' +
                '                                                        <div class="lesson-element__wrapper">' +
                '                                                            <input name="lessonBlocks[' + LESSON_BLOCK_COUNTER + '].blockValues[1].value" type="checkbox" id="files' + LESSON_BLOCK_COUNTER + '" class="checkbox" ' + ((arr.filter(x => x.value === 'files')[0]) ? 'checked' : '') + ' value="files">' +
                '                                                            <label class="checkbox-label checkbox-label_gray" for="files' + LESSON_BLOCK_COUNTER + '" >Разрешить загружать файлы</label>' +
                '                                                        </div>' +
                '                                                    </div>' +
                '                                                </div>' +
                '                                            </div>' +
                '                                        </div>' +
                '                                        <div class="lesson-block__delete update"></div>' +
                '                                    </div>';
        }

        LESSON_BLOCK_COUNTER++;
    });

    $('[u-lesson-blocks]').html(blocksHtml);
}

$(document).on('click', '[js-menu-update-lesson-close-btn]', function(event) {
    $('[js-menu-update-lesson]').removeClass('is-open');
    checkBodyHidden();
});
$(document).on('click', '[js-update-lesson]', function(event){
    event.preventDefault();
    $('[js-update-lesson-form]').trigger('submit');
});
$(document).on('submit', '[js-update-lesson-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-update-lesson-form]')[0]);
        $.each(TEMP_DATA, function(index, file) {
            formData.append(file['name'], file['file']);
        });
        formData.append('deleteGalleryElements', DELETE_GALLERY);
        formData.append('deleteLessonBlocks', DELETE_LESSON_BLOCKS);

        updateLesson(formData);
    }
});
function updateLesson(formData) {
    $('[js-update-lesson]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "updateLesson",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var index = $('[data-lesson="' + data.id + '"]').find('.module-desc__number').html();
            $('[data-lesson="' + data.id + '"]').replaceWith(createLesson(data, index));

            $('[js-menu-update-lesson]').removeClass('is-open');
            checkBodyHidden();
            $('[js-update-lesson]').prop("disabled", false);
            hideLoader();
        },
        error: function (data) {
            $('[js-update-lesson]').prop("disabled", false);
            hideLoader();
        },
        beforeSend: function() {
            showLoader();
        },
        afterSend: function() {
            hideLoader();
        }
    });
}

$(document).on('click', '[vote]', function(event){
    event.preventDefault();
    var json = new Object();
    json.rate = Number($(this).data('rate'));

    vote(json);
});
function vote(json) {
    $('[js-save-project]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "vote",
        data: JSON.stringify(json),
        dataType: 'json',
        cache: false,
        success: function (data) {
            setMessage('Ваш голос принят, спасибо!');
        },
        error: function (data) {
            setMessage('Произошла ошибка, попробуйте проголосовать позднее.');
        }
    });
}
function setMessage(msg) {
    $('[vote-block-wrapper]').html(createBlock(msg));
}
function createBlock(message) {
    return '<div class="content-element__header-item">' +
        '       <div class="content-element__header-main">' +
        '           <div class="content-element__header-element">' +
        '               <span class="content-element__title title title-h6">' + message + '</span>' +
        '           </div>' +
        '       </div>' +
        '   </div>'
}


$(document).on('click', '[js-update-lesson]', function(event) {
    var idLesson = $(this).closest('.lesson').attr('data-lesson');
    setUpdateLessonFormData(idLesson);
    $('[js-menu-update-lesson]').addClass('is-open');
    checkBodyHidden();
});
$(document).on('click', '[js-update-delete-doc]', function() {
    var request = new FormData();
    request.append('idLesson', $('[js-update-lesson-form-id]').val());
    request.append('file',  $(this).attr('data-file'));

    var element = $(this);

    $('[js-update-delete-doc]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "deleteDocument",
        data: request,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 300000,
        success: function (data) {
            element.closest('.input-element__document-wrapper').remove();
            $('[js-update-delete-doc]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-delete-doc]').prop("disabled", false);
        }
    });
});
$(document).on('click', '[js-menu-update-lesson-close-btn]', function(event) {
    $('[js-menu-update-lesson]').removeClass('is-open');
    resetUpdateLessonForm();
    checkBodyHidden();
});
$(document).on('click', '[js-update-save-lesson]', function(event){
    event.preventDefault();
    $('[js-update-lesson-form]').trigger('submit');
});
$(document).on('submit', '[js-update-lesson-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var form = $('[js-update-lesson-form]')[0];
        var lessonData = new FormData(form);
        addFilesToFormData(lessonData);
        updateLesson(lessonData);
    }
});
$(document).on('click', '[js-create-lesson]', function(event) {
    var idTutorial = $(this).closest('.theme').attr('data-tutorial');
    $('[js-lesson-form-id-tutorial]').val(idTutorial);
    $('[js-menu-create-lesson]').addClass('is-open');
    checkBodyHidden();
});
$(document).on('click', '[js-menu-create-lesson-close-btn]', function(event) {
    $('[js-menu-create-lesson]').removeClass('is-open');
    resetCreateLessonForm();
    checkBodyHidden();
});
$(document).on('click', '[js-save-lesson]', function(event){
    event.preventDefault();
    $('[js-lesson-form]').trigger('submit');
});
$(document).on('submit', '[js-lesson-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var form = $('[js-lesson-form]')[0];
        var lessonData = new FormData(form);
        addFilesToFormData(lessonData);
        createLesson(lessonData);
    }
});

$(document).ready(function() {
    initDeleteLesson();
});

function createLesson(lessonData) {
    $('[js-save-lesson]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: "multipart/form-data",
        url: "saveLesson",
        data: lessonData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateLessonInTutorialContainer(data);
            $('[js-menu-create-lesson]').removeClass('is-open');
            resetCreateLessonForm();
            checkBodyHidden();
            $('[js-save-lesson]').prop("disabled", false);
            hideLoader();
        },
        error: function (data) {
            $('[js-save-lesson]').prop("disabled", false);
            hideLoader();
        },
        beforeSend: function() {
            showLoader();
        },
        afterSend: function() {
            hideLoader();
        }
    });
}


function updateLesson(lessonData) {
    $('[js-update-save-lesson]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: "multipart/form-data",
        url: "updateLesson",
        data: lessonData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateLessonAfterUpdate(data);
            $('[js-menu-update-lesson]').removeClass('is-open');
            resetUpdateLessonForm();
            checkBodyHidden();
            $('[js-update-save-lesson]').prop("disabled", false);
            hideLoader();
        },
        error: function (data) {
            $('[js-update-save-lesson]').prop("disabled", false);
            hideLoader();
        },
        beforeSend: function() {
            showLoader();
        },
        afterSend: function() {
            hideLoader();
        }
    });
}


function updateLessonAfterUpdate(data) {
    var $lesson = $('.lesson[data-lesson="' + data.id + '"]');
    $lesson.find('.lesson-header__title').html(data.name);
    $lesson.find('.lesson-video').attr('href', data.videoLink);

    var videoPreview = data.videoLink.substr(data.videoLink.lastIndexOf('/') + 1, data.videoLink.length);
    $lesson.find('.lesson-video__preview').attr('src', '//img.youtube.com/vi/' + videoPreview + '/hqdefault.jpg');
    $lesson.find('.lesson-description').html(data.description);

    var documents = '';
    $.each(data.documents, function (index, value) {
        var document = '<a href="' + value.path +'" class="lesson-document">' +
            '<div class="lesson-document__type lesson-document__type_' + value.type + '">' + value.type + '</div>' +
            '<div class="lesson-document__name">' + value.name + '</div>' +
            '</a>';

        documents += document;
    });
    $lesson.find('.lesson__documents').html(documents);
}
function updateLessonInTutorialContainer(data) {
    var $themeLessons = $('.theme[data-tutorial="' + data.idTutorial + '"]').find('.theme__lessons');
    var lastIndex = $('.theme[data-tutorial="' + data.idTutorial + '"]').find('.theme__lessons .lesson:last').find('.lesson-header__number').find('[lesson-counter]').html();

    var videoPreview = data.videoLink.substr(data.videoLink.lastIndexOf('/') + 1, data.videoLink.length);

    var documents = '';
    $.each(data.documents, function (index, value) {
        var document = '<a href="' + value.path +'" class="lesson-document">' +
            '<div class="lesson-document__type lesson-document__type_' + value.type + '">' + value.type + '</div>' +
            '<div class="lesson-document__name">' + value.name + '</div>' +
            '</a>';

        documents += document;
    });

    $themeLessons.html($themeLessons.html() +
        '<div class="lesson" data-lesson="' + data.id + '"">' +
        '   <div js-update-lesson class="theme-setting theme-setting_top theme-setting_absolute theme-setting_big"></div>' +
        '   <div class="lesson__header">' +
        '       <div class="lesson-header__number">' +
        '           <span lesson-counter>' + ((typeof lastIndex == "undefined") ? 1 : parseInt(lastIndex) + 1) + '</span>' +
        '           <span>урок</span>' +
        '       </div>' +
        '       <div class="lesson-header__title">' + data.name + '</div>' +
        '   </div>' +
        '   <div class="lesson__content">' +
        '       <div class="lesson__content-wrapper">' +
        '       <div class="lesson-content__side">' +
        '           <a href="' + data.videoLink + '" class="lesson-video js-fancybox">' +
        '               <img src="//img.youtube.com/vi/' + videoPreview + '/hqdefault.jpg" class="lesson-video__preview" alt="">' +
        '           </a>' +
        '       </div>' +
        '       <div class="lesson-content__main">' +
        '           <div class="lesson-description">' + data.description + '</div>' +
        '           <div class="lesson__documents">' +
                        documents +
                    '</div>' +
        '       </div>' +
        '       </div>' +
        '   </div>' +
        '</div>'
    );

    initFancy();
}


function resetCreateLessonForm() {
    var form = $('[js-lesson-form]');
    form.trigger('reset');
    clearFiles(form);
}
function resetUpdateLessonForm() {
    var form = $('[js-update-lesson-form]');
    form.trigger('reset');
    $('[js-update-lesson-form-documents]').html('');
    clearFiles(form);
}

function setUpdateLessonFormData(idLesson) {
    $('[js-update-lesson]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getLesson",
        data: JSON.stringify(idLesson),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-update-lesson-form-id]').val(data.id);
            $('[js-update-lesson-form-name]').val(data.name);
            $('[js-update-lesson-form-desc]').val(data.description);
            $('[js-update-lesson-form-video-link]').val(data.videoLink);

            var documents = '';
            $.each(data.documents, function (index, value) {
                var doc = '<div class="input-element__document-wrapper">' +
                    '<div class="lesson-document lesson-document_full lesson-document_without-hover">' +
                    '<div class="lesson-document__type lesson-document__type_' + value.type + '">' + value.type + '</div>' +
                    '<div class="lesson-document__name">' + value.name + '</div>' +
                    '</div>' +
                    '<div js-update-delete-doc data-file="' + value.name + '.' + value.type + '" class="lesson-document__delete-btn"></div>' +
                    '</div>';

                documents += doc;
            });
            $('[js-update-lesson-form-documents]').html(documents);

            $('[js-update-lesson]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-lesson]').prop("disabled", false);
        }
    });
}

function initDeleteLesson() {
    $('[js-delete-lesson]').on('click', function(event) {
        var idLesson = $('[js-update-lesson-form-id]').val();

        $('[js-delete-lesson]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "deleteLesson",
            data: JSON.stringify(idLesson),
            dataType: 'json',
            cache: false,
            success: function (data) {
                $('.lesson[data-lesson="' + idLesson + '"]').remove();
                $('[js-menu-update-lesson]').removeClass('is-open');
                checkBodyHidden();
                resetUpdateLessonForm();
                $('[js-delete-lesson]').prop("disabled", false);
            },
            error: function (data) {
                $('[js-delete-lesson]').prop("disabled", false);
            }
        });
    });
}

$(document).on('click', '[js-update-line-color]', function(event){
    setLineColors();
});
$(document).on('click', '[js-menu-line-color-close-btn]', function(event){
    closeLineColorMenu();
});

function setLineColors() {
    $.ajax({
        type: "POST",
        url: "getLineColors",
        data: null,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var lineColors = $('[line-colors]');

            var list = "";
            $.each(data, function(index, value){
                list += '<div class="menu-input menu-input_xsmall menu-input_t30 menu-input_b0">' +
                    '                            <div class="menu-input__title">' + value.name + '</div>' +
                    '                           <input type="hidden" name="lineColors[' + index + '].id" value="' + value.id + '" required>' +
                    '                        </div>' +
                    '                        <div class="menu-input__wrapper menu-input__wrapper_row menu-input__wrapper_margin">' +
                    '                            <div class="menu-input menu-input_m menu-input_full">' +
                    '                                <div class="menu-input__title">Зеленый</div>' +
                    '                                <div class="menu-input__wrapper ">' +
                    '                                    <input name="lineColors[' + index + '].green" value="' + value.green + '" class="menu-input__input menu-input__input_small" placeholder="Введите значение" required>' +
                    '                                </div>' +
                    '                            </div>' +
                    '                            <div class="menu-input menu-input_m menu-input_full">' +
                    '                                <div class="menu-input__title">Желтый</div>' +
                    '                                <div class="menu-input__wrapper ">' +
                    '                                    <input name="lineColors[' + index + '].yellow" value="' + value.yellow + '"class="menu-input__input menu-input__input_small" placeholder="Введите значение" required>' +
                    '                                </div>' +
                    '                            </div>' +
                    '                            <div class="menu-input menu-input_m  menu-input_full">' +
                    '                                <div class="menu-input__title">Красный</div>' +
                    '                                <div class="menu-input__wrapper ">' +
                    '                                    <input name="lineColors[' + index + '].red" value="' + value.red + '" class="menu-input__input menu-input__input_small" placeholder="Введите значение" required>' +
                    '                                </div>' +
                    '                            </div>' +
                    '                        </div>';
            });

            lineColors.html(list);
            $('[js-menu-line-color]').addClass('is-open');
            checkBodyHidden();
        },
        error: function (data) {

        }
    });
}
$(document).on('click', '[js-save-line-color]', function(event){
    event.preventDefault();
    $('[js-line-color-form]').trigger('submit');
});
$(document).on('submit', '[js-line-color-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-line-color-form]')[0]);
        saveLineColors(formData);
    }
});
function saveLineColors(formData) {
    $.ajax({
        type: "POST",
        url: "updateLineColors",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            closeLineColorMenu();
        },
        error: function (data) {

        }
    });
}

function closeLineColorMenu() {
    $('[line-colors]').html();
    $('[js-line-color-form]').trigger('reset');

    $('[js-menu-line-color]').removeClass('is-open');
    checkBodyHidden();
}
// $(document).on('click', '.datepicker-here', function(event){
//     $('.datepicker.active').find('[data-action="today"]').trigger('click');
// });
// $(document).on('click', '.datepicker-here-b', function(event){
//     $('.datepicker.active').find('[data-action="today"]').trigger('click');
// });
// $(document).on('click', '.datepicker-here-deal', function(event){
//     $('.datepicker.active').find('[data-action="today"]').trigger('click');
// });
// $(document).on('click', '.datepicker-here-cs', function(event){
//     $('.datepicker.active').find('[data-action="today"]').trigger('click');
// });

$(document).ready(function(){
    var $mobileMenu = $('[js-mobile-menu]');
    var $openMobileMenu = $('[js-open-mobile-menu]');
    var $closeMobileMenu = $('[js-close-mobile-menu]');

    $openMobileMenu.click(function () {
        $mobileMenu.show();
        document.body.style.overflow = 'hidden';
    });

    $closeMobileMenu.click(function () {
       $mobileMenu.hide();
       document.body.style.overflow = 'auto';
    });

    const $filterForm = $('[filter-form]')
    const $filterParams = $filterForm.find('[filter-param]')
    const $filterBtnParams = $filterForm.find('[filter-param-btn]')
    const $filterParamsInput = $filterForm.find('[filter-param-input]')

    const $paramDateType = $('[filter-param-date-type]');
    const $paramYear = $('[filter-param-year]');
    $paramDateType.on('change', function() {
        clearFilterDate();
    })

    $paramYear.on('change', function() {
        clearFilterDate();
    })

    $filterParams.on('change', function () {
        $filterForm.trigger('submit')
    })

    $filterParamsInput.keydown(function (e) {
        if (e.keyCode == 13) {
            $filterForm.trigger('submit')
        }
    });


    const $filterBtn = $('[filter-btn]')
    const $filterBlock = $('.filter.custom-lg-2')
    const $contentBlock = $('.custom-lg-10')
    $filterBtn.on('click', function () {
        $(this).toggleClass('filter__btn_active')
        $filterForm.toggleClass('filter__wrapper_none')
        $filterBlock.toggleClass('custom-lg-2_active')
        $contentBlock.toggleClass('custom-lg-10_active')
    })

    const $accardionBtn = $('.table-body__accordion')
    $accardionBtn.on('click', function () {
        const $block = $(this).attr('data-target');
        const $b = $($block);

        if (!$b.hasClass('collapsing') && !$b.hasClass('show')) {
            $(this).text('-')
        }
        if (!$b.hasClass('collapsing') && $b.hasClass('show')) {
            $(this).text('+')
        }
    })

    // const $settingSideBtn = $('.setting-said__btn');
    // const $settingSideList = $('.setting-said__list');
    // $settingSideBtn.on('click', function () {
    //     $settingSideList.toggleClass('setting-said__list_hide');
    // });
    // $(function() {
    //     $('.datepicker').mousedown(function() {
    //         $('.datepicker--cell').click(function() {
    //             $(this).parents('.datepicker').removeClass('active');
    //             $(this).parents('.datepicker').removeAttr('style');
    //         });
    //     });
    // });

    $('[js-copy-link]').on('click', function() {
        var $tmp = $("<textarea>");
        $("body").append($tmp);
        $tmp.val($(this).attr('data-link')).select();
        document.execCommand("copy");
        $tmp.remove();
    });


    $("form").submit(function () {
        setTimeout(function () {
            $("label.error").hide();
        }, 3000);
    });

    $("select").on('click', function () {
        setTimeout(function () {
            $("label.error").hide();
        }, 3000);
    });
    $("select").on('blur', function () {
        setTimeout(function () {
            $("label.error").hide();
        }, 3000);
    });
    $("select").on('focusout', function () {
        setTimeout(function () {
            $("label.error").hide();
        }, 3000);
    });
});

$.fn.serializeObject = function()
{
    var o = {};
    var a = this.serializeArray();
    $.each(a, function() {
        if (o[this.name]) {
            if (!o[this.name].push) {
                o[this.name] = [o[this.name]];
            }
            o[this.name].push(this.value || '');
        } else {
            o[this.name] = this.value || '';
        }
    });
    return o;
};

$.fn.removeClassWild = function(mask) {
    return this.removeClass(function(index, cls) {
        var re = mask.replace(/\*/g, '\\S+');
        return (cls.match(new RegExp('\\b' + re + '', 'g')) || []).join(' ');
    });
};

function clearFilterDate() {
    $('[filter-param-date]').find('option[selected]').val('change');
    $('[filter-param-date]').append($('<option>', {
        value: '',
        text: ''
    }));
    $('[filter-param-date]').val('');
    $('[filter-form]').trigger('submit');
}

function checkBodyHidden() {
    if ($(".menu.is-open").length) {
        $('body').addClass('hiddenOverflow');
    } else {
        $('body').removeClass('hiddenOverflow');
    }
}


function validateForm(form) {

    $(form).validate({
        onkeyup: false,
        onfocusout: false,
        errorPlacement: function(label, element) {
            label.addClass('error-wrapper');
            label.insertAfter(element);
        },
        wrapper: 'span'
    });
    $(form).rules('add', {
        messages: {
            required: 'Заполните это поле.',
        }
    });

    return $(form).valid();
}


function removeAcceptBtnAttribute(btn) {
    btn.each(function() {
        var attributes = $.map(this.attributes, function(item) {
            return item.name;
        });

        var img = $(this);
        $.each(attributes, function(i, item) {
            if (item !== 'accept-dialog' && item !== 'class')  {
                img.removeAttr(item);
            }
        });
    });
}

function numberWithSpaces(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
}

function validateCheckboxForm(form) {

    $(form).validate({
        onkeyup: false,
        onfocusout: false,
        errorPlacement: function(label, element) {
            label.addClass('error-wrapper');
            label.insertAfter(element.siblings('label').last());
        },
        wrapper: 'span'
    });
    $(form).rules('add', {
        messages: {
            required: 'Заполните это поле.',
        }
    });

    return $(form).valid();
}


$(document).ready(function(){
    const $managers = $('[manager-name]');
    const $left = $managers.offset().left;
    var $offset = $left - $('.main-nav').width();

    processScroll($offset, $managers);

    $(window).resize(function(){
        $offset = $left - $('.main-nav').width();
    });

    $(window).scroll(function() {
        processScroll($offset, $managers);
    });
});

function processScroll(offset, managers) {
    var $width = $('body').scrollLeft();
    var $translate = $width - offset;
    if($width > offset) {
        managers.css('transform','translateX(' + $translate +  'px' + ')');
        managers.css('-moz-transform','translateX(' + $translate +  'px' + ')');
        managers.css('-webkit-transform','translateX(' + $translate +  'px' + ')');
        managers.addClass('lb');
    } else {
        managers.removeClass('lb');
        managers.css('transform','translateX(' + 0 +  'px' + ')');
    }
}
$(document).ready(function(){
    const $filterForm = $('[tr-filter-form]');
    const $filterFormBtn = $('[tr-filter-form-btn]');
    const $filter = $('[tr-filter]');
    const $filterOpenBtn = $('[tr-filter-btn]');
    const $filterCloseBtn = $('[tr-filter-close-btn]');

    $filterOpenBtn.on('click', function() {
        $('body').addClass('hiddenOverflow');
        $filter.addClass('is-open');
    });

    $filterCloseBtn.on('click', function() {
        $('body').removeClass('hiddenOverflow');
        $filter.removeClass('is-open');
        resetFilter(FILTER_FROM_BACK);
    });

    $filterFormBtn.on('click', function(event) {
        event.preventDefault();
        $filterForm.trigger('submit');
    });
});

//список фильтр
var FILTER_FROM_BACK;
function setDashboardFilter(filter) {
    FILTER_FROM_BACK = filter;
}

function resetFilter(filter) {
    $('#proceedType option:selected').removeAttr('selected');
    $('#proceedType').val(filter.proceedType);

    $('#projectId option:selected').removeAttr('selected');
    $('#projectId').val(filter.projectId);
}

$(document).on('change', '[filter-parameter]', function() {
    $(this).closest('form').trigger('submit');
});

$(document).on('click', '[js-menu-update-background-close-btn]', function() {
    $('[js-menu-update-background]').removeClass('is-open');
    $('[default-background-color]').prop("checked", false).attr("checked", false).removeAttr("checked");
    checkBodyHidden();
});
$(document).on('click', '[js-save-background]', function() {
    event.preventDefault();
    $('[js-update-background-form]').trigger('submit');
});

$(document).on('submit', '[js-update-background-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var jsonData = $(this).serializeObject();
        //
        // var jsonItem = {};
        // jsonItem['color'] = $(this).find('[background-color]').val();
        // jsonItem['idCompany'] = Number($(this).find('[name="idCompany"]').val());

        updateBackground(jsonData);
    }
});
function updateBackground(jsonData) {
    $('[js-save-background]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateCompanyBgColor",
        data: JSON.stringify(jsonData),
        dataType: 'json',
        cache: false,
        success: function (data) {

            if ($('[default-background-color]').prop("checked")) {
                $('body').css("background-color", $('[default-background-color]').val());
            } else {
                $('body').css("background-color", jsonData['color']);
            }


            $('[js-menu-update-background]').removeClass('is-open');
            $('[default-background-color]').prop("checked", false).attr("checked", false).removeAttr("checked");
            checkBodyHidden();
            $('[js-save-background]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-background]').prop("disabled", false);
        }
    });
};

$(document).on('click', '[js-update-background]', function() {

    var jsonItem = {};
    jsonItem['id'] = $(this).find('[name="idCompany"]').val();

    $('[js-update-background]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getCompanyBgColor",
        data: JSON.stringify(jsonItem),
        dataType: 'json',
        cache: false,
        success: function (data) {
            openUpdateBackgroundMenu(data);
            $('[js-update-background]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-background]').prop("disabled", false);
        }
    });
});

function openUpdateBackgroundMenu(data) {
    $('[background-color]').val(data.color);
    $('[js-menu-update-background]').addClass('is-open');
    checkBodyHidden();
}

$(document).on('mouseenter', '.c-tooltip.tile__tooltip', function(event) {
    var topOffset = -10;
    var content = $(this).find('.tooltip-content').html();
    var tooltip = $('.c-tooltip__wrapper_right.tooltip-wrapper');

    if (typeof content !== "undefined" && content !== '') {
        var rect = $(this)[0].getBoundingClientRect();
        tooltip.css({top: $(window).scrollTop() + rect.top + topOffset, left: (rect.left - tooltip.width())});
        tooltip.html(content);
        tooltip.addClass('show');
    }
});
$(document).on('mouseleave', '.c-tooltip.tile__tooltip', function(event) {
    var tooltip = $('.c-tooltip__wrapper_right.tooltip-wrapper');
    tooltip.html('');
    tooltip.removeClass('show');
});

$(document).on('mouseenter', '.c-tooltip.action-info_prize', function(event) {
    var topOffset = -10;
    var content = $(this).find('.tooltip-content').html();
    var tooltip = $('.c-tooltip__wrapper_maxwidth.tooltip-wrapper');

    if (typeof content !== "undefined" && content !== '') {
        var rect = $(this)[0].getBoundingClientRect();
        tooltip.css({top: $(window).scrollTop() + rect.top + topOffset, left: rect.left + (rect.width/2)});
        tooltip.html(content);
        tooltip.addClass('show');
    }
});
$(document).on('mouseleave', '.c-tooltip.action-info_prize', function(event) {
    var tooltip = $('.c-tooltip__wrapper_maxwidth.tooltip-wrapper');
    tooltip.html('');
    tooltip.removeClass('show');
});
$(document).ready(function(){
    $("#collapseBlock").on("hide.bs.collapse", function(){
        $(".action-collapse__btn").text('Показать акцию');
        $(".action-collapse__btn").removeClass('action-collapse__btn_up');
    });
    $("#collapseBlock").on("show.bs.collapse", function(){
        $(".action-collapse__btn").text('Скрыть акцию');
        $(".action-collapse__btn").addClass('action-collapse__btn_up');
    });
});
//открытие модалки
$(document).on('click', '[js-open-article]', function(event) {
    setArticleDataToModal($(this).closest('.theme').attr('data-article'));
    $('[js-menu-open-article]').addClass('is-open');
    checkBodyHidden()
});
$(document).on('click', '[js-menu-open-article-close-btn]', function(event) {
    $('[js-menu-open-article]').removeClass('is-open');
    checkBodyHidden()
});


function setArticleDataToModal(idArticle) {
    $('[js-open-article]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getArticle",
        data: JSON.stringify(idArticle),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-open-title]').html(data.name);
            $('[js-open-text]').html(data.text);
            $('[js-open-article]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-open-article]').prop("disabled", false);
        }
    });
}
$(document).on('click', '.lesson .lesson__header', function(event) {
    $('.lesson .lesson__content').not($(this).next()).slideUp(400);
    $(this).next().slideToggle(400);

    $('.lesson .lesson__header').not($(this)).removeClass('lesson__header_active');
    $(this).toggleClass('lesson__header_active');
});

$(document).ready(function() {
    initFancy();
});


function initFancy() {
    $('.js-fancybox').fancybox({
        youtube: {
            showinfo: 0
        }
    });
}
$(document).ready(function(){
    const $filterForm = $('[tr-filter-form]');
    const $filterFormBtn = $('[tr-filter-form-btn]');
    const $filter = $('[tr-filter]');
    const $filterOpenBtn = $('[tr-filter-btn]');
    const $filterCloseBtn = $('[tr-filter-close-btn]');

    $filterOpenBtn.on('click', function() {
        $('body').addClass('hiddenOverflow');
        $filter.addClass('is-open');
    });

    $filterCloseBtn.on('click', function() {
        $('body').removeClass('hiddenOverflow');
        $filter.removeClass('is-open');
        resetFilter(FILTER_FROM_BACK);
    });

    $filterFormBtn.on('click', function(event) {
        event.preventDefault();
        $filterForm.trigger('submit');
    });

    $('.datepicker-here-f').datepicker({
        autoClose: true
    });
});

//список фильтр
var FILTER_FROM_BACK;
function setFilter(filter) {
    FILTER_FROM_BACK = filter;
}

function resetFilter(filter) {
    $('#idManager option:selected').removeAttr('selected');
    $('#idManager').val(filter.idManager);

    $('#scoreType option:selected').removeAttr('selected');
    $('#scoreType').val(filter.scoreType);

    $('#idRateStatus option:selected').removeAttr('selected');
    $('#idRateStatus').val(filter.idRateStatus);

    $('#rateDateFrom').val(filter.rateDateFrom);
    $('#rateDateTo').val(filter.rateDateTo);
    $('#rateDateFrom').val(filter.rateDateFrom);
    $('#rateDateTo').val(filter.rateDateTo);
}

$(document).on('change', '[filter-parameter]', function() {
    $(this).closest('form').trigger('submit');
});

$(document).on('change', '[tr-templates]', function() {
    $('[tr-template-items]').html('<option value="0" selected>Все пункты</option>');

    var currValue = $('option:selected', this).attr('value');
    if (currValue != 0) {
        var formData = new FormData();
        formData.append("id", currValue);
        setTemplateItemsByTemplate(formData);
    }

});
function setTemplateItemsByTemplate(formData) {
    $('[tr-templates]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getTemplateItems",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var currentOptions = $('[tr-template-items]').html();
            var seloption = "";
            $.each(data, function(index, value){
                seloption += '<option value="' + value.id + '">' + value.name + '</option>';
            });

            $('[tr-template-items]').html(currentOptions + seloption);

            $('[tr-templates]').prop("disabled", false);
        },
        error: function (data) {
            $('[tr-templates]').prop("disabled", false);
        }
    });
}
//открытие меню категории
$(document).on('click', '[add-category]', function(event){
    $('[js-menu-add-category]').addClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[js-menu-add-category-close-btn]', function(event){
    closeAddCategoryMenu();
});

function closeAddCategoryMenu() {
    $('[js-menu-add-category]').removeClass('is-open');
    $('[js-add-category-form]').trigger('reset');
    checkBodyHidden();
}

//сохранение категории
$(document).on('click', '[save-password-category]', function(event){
    event.preventDefault();
    $('[js-add-category-form]').trigger('submit');
});
$(document).on('submit', '[js-add-category-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-add-category-form]')[0]);
        formData.append('password', $('[data-part="1"]'). val() + $('[data-part="2"]'). val() + $('[data-part="3"]'). val() + $('[data-part="4"]'). val());
        savePasswordCategory(formData);
    }
});
function savePasswordCategory(formData) {
    $('[save-password-category]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "savePasswordCategory",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            addCategoryToList(data);

            closeAddCategoryMenu();
        },
        error: function (data) {
            $('[save-password-category]').prop("disabled", false);
        }
    });
}

function addCategoryToList(data) {
    var listItems = $('[category-list]').html();

    $('[category-list]').html(listItems +
        '<div category data-category="' + data.id + '" class="side-category__item">' +
        '   <div category-name open-category class="side-category__link">' + data.name + '</div>' +
        '   <div class="side-category__setting"></div>' +
        '</div>'
    );
}
$(document).on('keydown', '[data-part]', function(event) {
    if (event.keyCode == 46 || event.keyCode == 8) {
        return;
    } else {
        if ((event.keyCode < 48 || event.keyCode > 57) && (event.keyCode < 96 || event.keyCode > 105 )) {
            event.preventDefault();
        }
    }
});

$(document).on('keyup', '[data-part]', function(event){
    var currentPart = Number($(this).attr('data-part'));
    if (event.keyCode == 46 || event.keyCode == 8) {
        var prev = $('[data-part="' + (currentPart - 1) + '"]');
        if (prev.length) { prev.focus(); prev.select(); }
    } else {
        if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105 )) {
            var next = $('[data-part="' + (currentPart + 1) + '"]');
            if (next.length) { next.focus(); }
        }
    }

    checkFullPassword($('[data-part]'), $(this));
});
function checkFullPassword(parts, currentBtn) {
    var isFull = true;

    parts.each(function() {
        if ($(this).val().length !== 1) {
            isFull = false;
        }
    });

    if (isFull) {
        parts.addClass('active');
        currentBtn.closest('form').find('[disabled-btn]').removeAttr("disabled");
    } else {
        parts.removeClass('active');
        currentBtn.closest('form').find('[disabled-btn]').attr("disabled", "disabled");
    }
}
$(document).on('keydown', '[data-password-part]', function(event) {
    if (event.keyCode == 46 || event.keyCode == 8 || event.keyCode == 13) {
        return;
    } else {
        if ((event.keyCode < 48 || event.keyCode > 57) && (event.keyCode < 96 || event.keyCode > 105 )) {
            event.preventDefault();
        }
    }
});
$(document).on('keyup', '[data-password-part]', function(event){
    var currentPart = Number($(this).attr('data-password-part'));
    if (event.keyCode == 46 || event.keyCode == 8) {
        var prev = $('[data-password-part="' + (currentPart - 1) + '"]');
        if (prev.length) { prev.focus(); prev.select(); }
    } else {
        if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105 )) {
            var next = $('[data-password-part="' + (currentPart + 1) + '"]');
            if (next.length) { next.focus(); }
        }
    }

    checkFullPassword($('[data-password-part]'), $(this));
});

//модалка входа в категорию
$(document).on('click', '[open-category]', function(event) {
    event.preventDefault();
    $('[category-form-id]').val($(this).closest('[category]').data('category'));
    $('[taboo-dialog]').find('[accept-dialog]').attr('category-accept', '');
    $('[taboo-dialog]').find('form').attr('category-open-form', '');
    $('[taboo-dialog]').addClass('is-open');
});

$(document).on('click', '[close-dialog]', function(event) {
    removeAcceptBtnAttribute($(this).siblings('[accept-dialog]'));
    $(this).closest('.dialog').removeClass('is-open');
});

function removeAcceptBtnAttribute(btn) {
    btn.each(function() {
        var attributes = $.map(this.attributes, function(item) {
            return item.name;
        });

        var img = $(this);
        $.each(attributes, function(i, item) {
            if (item !== 'accept-dialog' && item !== 'class' && item !== 'disabled-btn' && item !== 'disabled')  {
                img.removeAttr(item);
            }
        });
    });
}

$(document).on('click', '[close-taboo-dialog]', function(event) {
    resetTabooModal();
});

$(document).on('click', '[category-accept]', function(event) {
    event.preventDefault();
    $('[category-open-form]').trigger('submit');
});

$(document).on('submit', '[category-open-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[category-open-form]')[0]);
        formData.append('password', $('[data-password-part="1"]'). val() + $('[data-password-part="2"]'). val() + $('[data-password-part="3"]'). val() + $('[data-password-part="4"]'). val());
        openPasswordCategory(formData);
    }
});
function openPasswordCategory(formData) {
    $('[category-accept]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "openPasswordCategory",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            resetTabooModal();

            $('[category]').removeClass('active');
            $('[category]').find('[category-name]').attr('open-category', '');
            setPasswordCategory(formData.get('id'), data);
        },
        error: function (data) {
            resetTabooModal();

            resetCategory();
            $('[category]').removeClass('active');
            $('[category]').find('[category-name]').attr('open-category', '');

            $('[dialog-info]').find('.dialog__title').html('Ошибка входа в категорию');
            $('[dialog-info]').find('.dialog__text').html('Пароль неверный, повторите ввод');
            $('[dialog-info]').addClass('is-open');
        }
    });
}
function resetTabooModal() {
    $('[taboo-dialog]').removeClass('is-open');
    removeAcceptBtnAttribute($('[taboo-dialog]').find('[accept-dialog]'));
    $('[category-form]').removeAttr('category-update-form');
    $('[category-form]').removeAttr('category-open-form');
    $('[category-form]').trigger('reset');
    $('[category-form]').find('[disabled-btn]').attr("disabled", "disabled");
    $('[data-password-part]').removeClass('active');
}
function resetCategory() {
    $('[passwords]').html(
        '<div class="message">' +
        '   <div class="message__title">Пожалуйста, выберите<br>категорию</div>' +
        '</div>');
}

function setPasswordCategory(idCategory, data) {
    $('[category][data-category="' + idCategory + '"]').addClass('active');
    $('[category][data-category="' + idCategory + '"]').find('[category-name]').removeAttr('open-category');
    var categoryName = $('[category][data-category="' + idCategory + '"]').find('[category-name]').html();

    var header =
        '<div data-category="' + idCategory + '" class="side-header side-header_bordered">' +
        '    <div category-name class="side-header__title">' + categoryName + '</div>' +
        '    <div add-password class="add-button add-button_right">+ Добавить пароль</div>' +
        '</div>';

    var rows =  '';
    $.each(data, function(index, value){
        rows += createRow(value);
    });

    var table =
        ' <div class="side-content__table">' +
        '                <table class="custom-table">' +
        '                    <thead class="custom-table__header">' +
        '                        <td class="custom-table__header-col custom-table__header-col_big custom-table__header-col_gray">Назввание</td>' +
        '                        <td class="custom-table__header-col custom-table__header-col_big custom-table__header-col_gray">Логин</td>' +
        '                        <td class="custom-table__header-col custom-table__header-col_big custom-table__header-col_gray">Пароль</td>' +
        '                        <td class="custom-table__header-col custom-table__header-col_big custom-table__header-col_gray">Телефон</td>' +
        '                        <td class="custom-table__header-col custom-table__header-col_big custom-table__header-col_gray">Доступен</td>' +
        '                        <td class="custom-table__header-col custom-table__header-col_big custom-table__header-col_gray"></td>' +
        '                    </thead>' +
        '                    <tbody password-rows class="custom-table__body custom-table__body_white">' + rows +
        '                    </tbody>' +
        '                </table>' +
        '            </div>';

    $('[passwords]').html( header + table);
}
function createRow(value) {
    var employees = '';
    var employeeCount = 0;
    $.each(value.passwordDepartments, function(index, passwordDepartment){
        $.each(passwordDepartment.employees, function(index2, employee) {
            employeeCount++;
            employees +=
                '<div class="c-tooltip__row">' +
                '       <div class="avatar">' +
                '           <div class="avatar__wrapper avatar__wrapper_small">' +
                '                <span class="avatar-image ' + (employee.avatar === null || employee.avatar === '' ? 'avatar-image_default' : '') + '">' +
                (employee.avatar !== null ? ('<img src="/' + employee.avatar + '" alt="">') : '') +
                '                </span>' +
                '           </div>' +
                '        </div>' +
                '   <div class="c-tooltip__text c-tooltip__text_p16">' + employee.name + '</div>' +
                '</div>';
        });
    });

    return '<tr data-password="' + value.id + '" class="custom-table__body-row custom-table__body-row_large">' +
        '                            <td class="custom-table__body-col custom-table__body-col_30per">' +
        '                               <div class="side-wrapper">' +
        '                                   <div class="side-wrapper side-wrapper_col side-wrapper_w100">' +
        '                                       <div class="side-text side-text_bold">' + value.name + '</div>' +
        '                                       <div class="side-desc">' + value.desc + '</div>' +
        '                                   </div>' +
        '                                    <div class="column-links">' +
        '                                        <div js-copy-link class="column_mwidth column_mwidth-copy" data-link="' + value.url + '"></div>' +
        '                                        <a target="_blank" class="column_mwidth column_mwidth-open" href="' + value.url + '"></a>' +
        '                                    </div>' +
        '                               </div>' +
        '                            </td>' +
        '                            <td class="custom-table__body-col custom-table__body-col_20per">' +
        '                                <div js-copy-link data-link="' + value.login + '" class="side-copy">' +
        '                                    <div class="side-text">' + value.login + '</div>' +
        '                                </div>' +
        '                            </td>' +
        '                            <td class="custom-table__body-col custom-table__body-col_10per">' +
        '                                <div js-copy-link data-link="' + value.password + '" class="side-copy">' +
        '                                    <div class="side-text">**********</div>' +
        '                                </div>' +
        '                            </td>' +
        '                            <td class="custom-table__body-col custom-table__body-col_15per">' +
        '                                <div class="side-text">' + value.phone + '</div>' +
        '                            </td>' +
        '                            <td class="custom-table__body-col custom-table__body-col_15per">' +
        '                                <div class="side-tooltip ' + (employeeCount !== 0 ? 'c-tooltip' : '') + '">' +
        '                                    <div class="c-tooltip__wrapper c-tooltip__wrapper_large">' + employees + '</div>' +
        '                                    <span>' + employeeCount + ' сотрудников</span>' +
        '                                </div>' +
        '                            </td>' +
        '                            <td class="custom-table__body-col custom-table__body-col_10per">' +
        '                                <div class="column-links display-flex-none is-open">' +
        '                                    <div update-password class="column_mwidth div-table__body-col_center column_mwidth-edit"></div>' +
        '                                    <form class="column-form" action="#">' +
        '                                        <button delete-password type="button" class="column_mwidth column_mwidth-delete"></button>' +
        '                                    </form>' +
        '                                </div>' +
        '                            </td>' +
        '                        </tr>';
}

//модалка обновления категории
$(document).on('click', '[update-category]', function(event) {
    event.preventDefault();
    $('[category-form-id]').val($(this).closest('[category]').data('category'));
    $('[taboo-dialog]').find('[accept-dialog]').attr('category-accept-update', '');
    $('[taboo-dialog]').find('form').attr('category-update-form', '');
    $('[taboo-dialog]').addClass('is-open');
});
$(document).on('click', '[category-accept-update]', function(event) {
    event.preventDefault();
    $('[category-update-form]').trigger('submit');
});

$(document).on('submit', '[category-update-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[category-update-form]')[0]);
        formData.append('password', $('[data-password-part="1"]'). val() + $('[data-password-part="2"]'). val() + $('[data-password-part="3"]'). val() + $('[data-password-part="4"]'). val());
        openUpdatePasswordCategory(formData);
    }
});
function openUpdatePasswordCategory(formData) {
    $('[category-accept-update]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getPasswordCategory",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            resetTabooModal();

            $('[update-category-id]').val(data.id);
            $('[update-category-password]').val(formData.get('password'));
            $('[update-category-name]').val(data.name);

            $('[js-menu-update-category]').addClass('is-open');
            checkBodyHidden();
        },
        error: function (data) {
            resetTabooModal();

            $('[dialog-info]').find('.dialog__title').html('Ошибка входа в категорию');
            $('[dialog-info]').find('.dialog__text').html('Пароль неверный, повторите ввод');
            $('[dialog-info]').addClass('is-open');
        }
    });
}
$(document).on('keydown', '[data-p]', function(event) {
    if (event.keyCode == 46 || event.keyCode == 8) {
        return;
    } else {
        if ((event.keyCode < 48 || event.keyCode > 57) && (event.keyCode < 96 || event.keyCode > 105 )) {
            event.preventDefault();
        }
    }
});

$(document).on('keyup', '[data-p]', function(event){
    var currentPart = Number($(this).attr('data-p'));
    if (event.keyCode == 46 || event.keyCode == 8) {
        var prev = $('[data-p="' + (currentPart - 1) + '"]');
        if (prev.length) { prev.focus(); prev.select(); }
    } else {
        if ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105 )) {
            var next = $('[data-p="' + (currentPart + 1) + '"]');
            if (next.length) { next.focus(); }
        }
    }

    checkRequiredPassword($('[data-p]'));
});
function checkRequiredPassword(parts) {
    var isRequired = false;

    parts.each(function() {
        if ($(this).val().length === 1) {
            isRequired = true;
        }
    });

    if (isRequired) {
        parts.attr('required', '');
    } else {
        parts.removeAttr("required");
    }
}
$(document).on('click', '[js-menu-update-category-close-btn]', function(event){
    closeUpdateCategoryMenu();
});

function closeUpdateCategoryMenu() {
    $('[js-menu-update-category]').removeClass('is-open');
    $('[js-update-category-form]').trigger('reset');
    checkBodyHidden();
}

$(document).on('click', '[update-password-category]', function(event) {
    event.preventDefault();
    $('[js-update-category-form]').trigger('submit');
});

$(document).on('submit', '[js-update-category-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-update-category-form]')[0]);
        formData.append('newPassword', $('[data-p="1"]'). val() + $('[data-p="2"]'). val() + $('[data-p="3"]'). val() + $('[data-p="4"]'). val());
        updatePasswordCategory(formData);
    }
});

function updatePasswordCategory(formData) {
    $('[update-password-category]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "updatePasswordCategory",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[data-category="' + data.id + '"]').find('[category-name]').html(data.name);

            closeUpdateCategoryMenu();
            $('[update-password-category]').prop("disabled", false);
        },
        error: function (data) {
            $('[update-password-category]').prop("disabled", false);
        }
    });
}

var $employeeTypes;
function setEmployeeTypes(employeeTypes) {
    $employeeTypes = employeeTypes;
}
var $employeeByTypes;
function setEmployeeByTypes(employeeByTypes) {
    $employeeByTypes = employeeByTypes;
}

$(document).on('change', '[password-department]', function(event){
    var idAccessBlock = $(this).closest('[data-access]').data('access');
    $('[data-access="' + idAccessBlock + '"]').find('[password-role]').html('<option value="0" selected>Все роли</option>');

    var selectedDepartment = Number($('option:selected', this).val());
    if (selectedDepartment !== 0) {
        var seloption = "";
        $.each($employeeTypes[selectedDepartment], function(index, value){
            seloption += '<option value="' + value.id + '">' + value.title + '</option>';
        });

        $('[data-access="' + idAccessBlock + '"]').find('[password-role]').html($('[data-access="' + idAccessBlock + '"]').find('[password-role]').html() + seloption);
    }
    var idDepartment = Number($('[data-access="' + idAccessBlock + '"]').find('[password-department] option:selected').val());
    var idRole = Number($('[data-access="' + idAccessBlock + '"]').find('[password-role] option:selected').val());
    setEmployee($('[data-access="' + idAccessBlock + '"]').find('[manager-rows]'), idDepartment, idRole);
});

$(document).on('change', '[u-password-department]', function(event){
    var idAccessBlock = $(this).closest('[data-access]').data('access');
    $('[data-access="' + idAccessBlock + '"]').find('[u-password-role]').html('<option value="0" selected>Все роли</option>');

    var selectedDeaprtment = Number($('option:selected', this).val());
    if (selectedDeaprtment !== 0) {
        var seloption = "";
        $.each($employeeTypes[selectedDeaprtment], function(index, value){
            seloption += '<option value="' + value.id + '">' + value.title + '</option>';
        });

        $('[data-access="' + idAccessBlock + '"]').find('[u-password-role]').html($('[data-access="' + idAccessBlock + '"]').find('[u-password-role]').html() + seloption);
    }
    var idDepartment = Number($('[data-access="' + idAccessBlock + '"]').find('[u-password-department] option:selected').val());
    var idRole = Number($('[data-access="' + idAccessBlock + '"]').find('[u-password-role] option:selected').val());
    setEmployee($('[data-access="' + idAccessBlock + '"]').find('[u-manager-rows]'), idDepartment, idRole);
});

$(document).on('change', '[u-password-role]', function(event){
    var idAccessBlock = $(this).closest('[data-access]').data('access');
    var idDepartment = Number($('[data-access="' + idAccessBlock + '"]').find('[u-password-department] option:selected').val());
    var idRole = Number($('[data-access="' + idAccessBlock + '"]').find('[u-password-role] option:selected').val());
    setEmployee($('[data-access="' + idAccessBlock + '"]').find('[u-manager-rows]'), idDepartment, idRole);
});


function setEmployee(managerRows, idDepartment, idRole) {

    managerRows.html('');
    var idAccessBlock = managerRows.closest('[data-access]').data('access');

    if (idDepartment !== 0) {
        if (idRole !== 0) {

            var rows = "";
            $.each($employeeByTypes[idDepartment][idRole], function(index, value){
                rows +=
                    '<div class="cb">' +
                    '    <input checked type="checkbox" id="block' + idAccessBlock + 'id' + value.id + '" class="cb__checkbox"  name="passwordDepartments[' + idAccessBlock + '].employees[' + index + '].id" value="' + value.id + '">' +
                    '    <label class="cb__label" for="block' + idAccessBlock + 'id' + value.id + '">' +
                    '       <div class="avatar">' +
                    '           <div class="avatar__wrapper">' +
                    '                <span class="avatar-image ' + (value.avatar === null || value.avatar === '' ? 'avatar-image_default' : '') + '">' +
                                        (value.avatar !== null ? ('<img src="/' + value.avatar + '" alt="">') : '')  +
                    '                </span>' +
                    '           </div>' +
                    '        </div>' +
                    '        <span class="cb__text cb__text_bordered">' + value.name + '</span> ' +
                    '        <span class="cb__text">' + value.position + '</span> ' +
                    '    </label>' +
                    '</div>';
            });

            managerRows.html(rows);
        } else {
            var rows = "";
            var counter = 0;
            $.each($employeeByTypes[idDepartment], function(index, value){
                $.each(value, function(index2, value2){
                    rows +=
                        '<div class="cb">' +
                        '    <input checked type="checkbox" id="block' + idAccessBlock + 'id' + value2.id + '" class="cb__checkbox" name="passwordDepartments[' + idAccessBlock + '].employees[' + counter + '].id" value="' + value2.id + '">' +
                        '    <label class="cb__label" for="block' + idAccessBlock + 'id' + value2.id + '">' +
                        '       <div class="avatar">' +
                        '           <div class="avatar__wrapper">' +
                        '                <span class="avatar-image ' + (value2.avatar === null || value2.avatar === '' ? 'avatar-image_default' : '') + '">' +
                                            (value2.avatar !== null ? ('<img src="/' + value2.avatar + '" alt="">') : '')  +
                        '                </span>' +
                        '           </div>' +
                        '        </div>' +
                        '        <span class="cb__text cb__text_bordered">' + value2.name + '</span> ' +
                        '        <span class="cb__text">' + value2.position + '</span> ' +
                        '    </label>' +
                        '</div>';

                    counter++;
                });
            });
            managerRows.html(rows);
        }

    }
}

$(document).on('change', '[password-role]', function(event){
    var idAccessBlock = $(this).closest('[data-access]').data('access');
    var idDepartment = Number($('[data-access="' + idAccessBlock + '"]').find('[password-department] option:selected').val());
    var idRole = Number($('[data-access="' + idAccessBlock + '"]').find('[password-role] option:selected').val());
    setEmployee($('[data-access="' + idAccessBlock + '"]').find('[manager-rows]'), idDepartment, idRole);
});

$(document).on('click', '[add-password]', function(event){
    $('[password-category-id]').val($(this).closest('[data-category]').data('category'));
    $('[js-menu-add-password]').addClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[js-menu-add-password-close-btn]', function(event){
    closeAddPasswordMenu();
});

$(document).on('click', '[save-password]', function(event) {
    event.preventDefault();
    $('[js-add-password-form]').trigger('submit');
});

$(document).on('submit', '[js-add-password-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-add-password-form]')[0]);
        savePassword(formData);
    }
});

function savePassword(formData) {
    $('[save-password]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "savePassword",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            addPasswordToList(data);

            closeAddPasswordMenu();
            $('[save-password]').prop("disabled", false);
        },
        error: function (data) {
            $('[save-password]').prop("disabled", false);
        }
    });
}

function addPasswordToList(data) {
    var rows = $('[password-rows]').html();
    var newRow = createRow(data);

    $('[password-rows]').html(newRow + rows);
}

function closeAddPasswordMenu() {
    $('[js-menu-add-password]').removeClass('is-open');
    $('[js-add-password-form]').trigger('reset');
    $('[data-access]').remove();
    ACCESS_BLOCK_COUNTER = -1;
    checkBodyHidden();
}
var DELETE_PASSWORD;
$(document).on('click', '[delete-password]', function(event) {
    event.preventDefault();
    $('[dialog-accept]').find('.dialog__title').html('Вы действительно хотите удалить пароль?');
    $('[dialog-accept]').find('.dialog__text').html('Пароль будет удален');
    $('[dialog-accept]').find('[accept-dialog]').attr('accept-delete-password', '');
    $('[dialog-accept]').addClass('is-open');
    DELETE_PASSWORD =  Number($(this).closest('[data-password]').data('password'));
});

$(document).on('click', '[accept-delete-password]', function(event) {
    var formData = new FormData();
    formData.append('id', DELETE_PASSWORD);

    $.ajax({
        type: "POST",
        url: "deletePassword",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[data-password="' + DELETE_PASSWORD + '"]').remove();

            $('[dialog-accept]').removeClass('is-open');
            removeAcceptBtnAttribute($(this));
        },
        error: function (data) {
            $('[dialog-accept]').removeClass('is-open');
            removeAcceptBtnAttribute($(this));
        }
    });

});

$(document).on('click', '[update-password]', function(event){
    openUpdatePasswordMenu($(this).closest('[data-password]').data('password'));
});
function openUpdatePasswordMenu(idPassword) {
    var formData = new FormData();
    formData.append('id', idPassword);

    $('[update-password]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getPassword",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setUpdatePasswordInfo(data);

            $('[update-password]').prop("disabled", false);
        },
        error: function (data) {
            $('[update-password]').prop("disabled", false);
        }
    });
};

function setUpdatePasswordInfo(data) {
    $('[u-password-id]').val(data.id);
    $('[u-password-category-id]').val(data.idCategory);
    $('[u-password-name]').val(data.name);
    $('[u-password-desc]').val(data.desc);
    $('[u-password-url]').val(data.url);
    $('[u-password-login]').val(data.login);
    $('[u-password-password]').val(data.password);
    $('[u-password-phone]').val(data.phone);

    $.each(data.passwordDepartments, function(index, value){
        var accessBlock = ' <div data-access="' + index + '" class="menu-input menu-input_xsmall">' +
            '            <div class="menu-input__title">Отдел</div>' +
            '            <div class="menu-input__wrapper menu-input__wrapper_select">' +
            '                <select u-password-department id="u-password-department" name="passwordDepartments[' + index + '].idDepartment" class="menu-input__input menu-input__input_small menu-input__input_select" required>' +
            '                      <option value="" disabled>Выберите отдел</option>' +
            '                      <option value="1000">Продажи</option>' +
            '                      <option value="1001">Маркетинг</option>' +
            '                 </select>' +
            '            </div>' +
            '        </div>' +
            '        <div data-access="' + index + '" class="menu-input menu-input_xsmall">' +
            '             <div class="menu-input__title">Роли</div>' +
            '             <div class="menu-input__wrapper menu-input__wrapper_select">' +
            '                 <select u-password-role id="u-password-role" name="passwordDepartments[' + index + '].idEmployeeType" class="menu-input__input menu-input__input_small menu-input__input_select" required>' +
            '                      <option value="" selected disabled>Выберите роль</option>' +
            '                 </select>' +
            '              </div>' +
            '         </div>' +
            '         <div data-access="' + index + '" class="menu-input__delim">' +
            '              <span></span>' +
            '         </div>' +
            '         <div data-access="' + index + '" class="menu-input menu-input_xsmall">' +
            '              <div class="input-element__input input-element__input_light-violet input-element__input_row">' +
            '                  <div class="input-element__radio">' +
            '                       <input u-password-type type="radio" id="utypeAll' + index + '" class="radio radio-check" name="passwordDepartments[' + index + '].passwordType" value="1" checked="checked">' +
            '                       <label for="utypeAll' + index + '">Все сотрудники</label>' +
            '                  </div>' +
            '                  <div class="input-element__radio">' +
            '                       <input u-password-type type="radio" id="utypeFew' + index + '" class="radio radio-check" name="passwordDepartments[' + index + '].passwordType" value="2">' +
            '                       <label for="utypeFew' + index + '">Некоторые сотрудники</label>' +
            '                  </div>' +
            '              </div>' +
            '         </div>' +
            '         <div data-access="' + index + '" class="menu-input menu-input_xsmall">' +
            '              <div u-manager-rows class="menu-input__checkbox-wrapper">' +
            '              </div>' +
            '         </div>' +
            '         <div u-access-delimiter data-access="' + index + '" class="menu-input__delim">' +
            '              <span></span>' +
            '         </div>';

        if (index === 0) {
            $('[u-access-delimiter]').after(accessBlock);
        } else {
            $('[u-access-delimiter][data-access="' + (index - 1) + '"]').after(accessBlock);
        }

        $('[data-access="' + index + '"]').find('[u-password-type][value="' + value.passwordType + '"]').prop('checked', true);
        $('[data-access="' + index + '"]').find('[u-password-department]').val(value.idDepartment);
        $('[data-access="' + index + '"]').find('[u-password-department]').trigger('change');

        $('[data-access="' + index + '"]').find('[u-password-role]').val(value.idEmployeeType);
        $('[data-access="' + index + '"]').find('[u-password-role]').trigger('change');

        $('[data-access="' + index + '"]').find('[u-manager-rows]').find('input[type="checkbox"]').prop('checked', false);
        $.each(value.employees, function(index3, employee){
            $('[data-access="' + index + '"]').find('[u-manager-rows]').find('input[type="checkbox"][value="' + employee.id + '"]').prop('checked', true);
        });

    });

    ACCESS_BLOCK_COUNTER = data.passwordDepartments.length - 1;

    $('[js-menu-update-password]').addClass('is-open');
    checkBodyHidden();
}

$(document).on('click', '[js-menu-update-password-close-btn]', function(event){
    closeUpdatePasswordMenu();
});
function closeUpdatePasswordMenu() {
    $('[js-menu-update-password]').removeClass('is-open');
    $('[js-update-password-form]').trigger('reset');
    $('[data-access]').remove();
    ACCESS_BLOCK_COUNTER = -1;
    checkBodyHidden();
}

$(document).on('click', '[save-update-password]', function(event){
    event.preventDefault();
    $('[js-update-password-form]').trigger('submit');
});
$(document).on('submit', '[js-update-password-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-update-password-form]')[0]);
        updatePassword(formData);
    }
});
function updatePassword(formData) {
    $('[save-update-password]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "updatePassword",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[password-rows]').find('[data-password="' + formData.get('id') + '"]').replaceWith(createRow(data));
            closeUpdatePasswordMenu();

            $('[save-update-password]').prop("disabled", false);
        },
        error: function (data) {
            $('[save-update-password]').prop("disabled", false);
        }
    });
}

//добавление удаление блока доступа
var ACCESS_BLOCK_COUNTER = -1;
$(document).on('click', '[add-access]', function(event){
    ACCESS_BLOCK_COUNTER++;

    var depId = '';
    var roleId = '';
    var managersBlock = '';
    var attr = $(this).attr('is-update');
    var isUpdate = (typeof attr !== typeof undefined && attr !== false);
    if (isUpdate) {
        depId = ' u-password-department id="u-password-department" ';
        roleId = ' u-password-role id="u-password-role" ';
        managersBlock = ' u-manager-rows ';
    } else {
        depId = ' password-department id="password-department" ';
        roleId = ' password-role id="password-role" ';
        managersBlock = ' manager-rows ';
    }

    var accessBlock = ' <div data-access="' + ACCESS_BLOCK_COUNTER + '" class="menu-input menu-input_xsmall">' +
        '            <div class="menu-input__title">Отдел</div>' +
        '            <div class="menu-input__wrapper menu-input__wrapper_select">' +
        '                <select ' + depId + ' name="passwordDepartments[' + ACCESS_BLOCK_COUNTER + '].idDepartment" class="menu-input__input menu-input__input_small menu-input__input_select" required>' +
        '                      <option value="" disabled>Выберите отдел</option>' +
        '                      <option value="1000">Продажи</option>' +
        '                      <option value="1001">Маркетинг</option>' +
        '                 </select>' +
        '            </div>' +
        '        </div>' +
        '        <div data-access="' + ACCESS_BLOCK_COUNTER + '" class="menu-input menu-input_xsmall">' +
        '             <div class="menu-input__title">Роли</div>' +
        '             <div class="menu-input__wrapper menu-input__wrapper_select">' +
        '                 <select ' + roleId + ' name="passwordDepartments[' + ACCESS_BLOCK_COUNTER + '].idEmployeeType" class="menu-input__input menu-input__input_small menu-input__input_select" required>' +
        '                      <option value="" selected disabled>Выберите роль</option>' +
        '                 </select>' +
        '              </div>' +
        '         </div>' +
        '         <div data-access="' + ACCESS_BLOCK_COUNTER + '" class="menu-input__delim">' +
        '              <span></span>' +
        '         </div>' +
        '         <div data-access="' + ACCESS_BLOCK_COUNTER + '" class="menu-input menu-input_xsmall">' +
        '              <div class="input-element__input input-element__input_light-violet input-element__input_row">' +
        '                  <div class="input-element__radio">' +
        '                       <input type="radio" id="typeAll' + ACCESS_BLOCK_COUNTER + '" class="radio radio-check" name="passwordDepartments[' + ACCESS_BLOCK_COUNTER + '].passwordType" value="1" checked="checked">' +
        '                       <label for="typeAll' + ACCESS_BLOCK_COUNTER + '">Все сотрудники</label>' +
        '                  </div>' +
        '                  <div class="input-element__radio">' +
        '                       <input type="radio" id="typeFew' + ACCESS_BLOCK_COUNTER + '" class="radio radio-check" name="passwordDepartments[' + ACCESS_BLOCK_COUNTER + '].passwordType" value="2">' +
        '                       <label for="typeFew' + ACCESS_BLOCK_COUNTER + '">Некоторые сотрудники</label>' +
        '                  </div>' +
        '              </div>' +
        '         </div>' +
        '         <div data-access="' + ACCESS_BLOCK_COUNTER + '" class="menu-input menu-input_xsmall">' +
        '              <div ' + managersBlock + ' class="menu-input__checkbox-wrapper">' +
        '              </div>' +
        '         </div>' +
        '         <div ' + (isUpdate ? 'u-access-delimiter' : '') + ' access-delimiter data-access="' + ACCESS_BLOCK_COUNTER + '" class="menu-input__delim">' +
        '              <span></span>' +
        '         </div>';

    if (ACCESS_BLOCK_COUNTER === 0) {
        if (isUpdate) {
            $('[u-access-delimiter]').after(accessBlock);
        } else {
            $('[access-delimiter]').after(accessBlock);
        }
    } else {
        if (isUpdate) {
            $('[u-access-delimiter][data-access="' + (ACCESS_BLOCK_COUNTER - 1) + '"]').after(accessBlock);
        } else {
            $('[access-delimiter][data-access="' + (ACCESS_BLOCK_COUNTER - 1) + '"]').after(accessBlock);
        }
    }
});
$(document).on('click', '[del-access]', function(event) {

    if (ACCESS_BLOCK_COUNTER >= 0 ) {
        $('[data-access="' + ACCESS_BLOCK_COUNTER + '"]').remove();
        ACCESS_BLOCK_COUNTER--;
    }
});
$(document).ready(function() {

    const $menuCreatePMBtn = $('[js-create-row]');
    const $menuCreatePMCloseBtn = $('[js-menu-create-row-close-btn]');
    const $menuCreatePM = $('[js-menu-create-row]');

    const $saveRowBtn = $('[js-save-row]');
    const $createRowForm = $('[js-row-form]');

    $menuCreatePMBtn.on('click', function () {
        $menuCreatePM.addClass('is-open');
        checkBodyHidden()
    });

    $menuCreatePMCloseBtn.on('click', function() {
        $menuCreatePM.removeClass('is-open');
        $createRowForm.trigger('reset');
        checkBodyHidden()
    });

    $saveRowBtn.on('click', function(event) {
        event.preventDefault();
        $createRowForm.trigger('submit');
    });

    $createRowForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var formData = $createRowForm.serializeObject();
            createPaymentMethod(formData);
        }
    });

    initEditRowFromList();
    initCancelEditRowFromList();
    initAcceptEditUserFromList();

    changeSelectorIndicator();
});

function changeSelectorIndicator() {
    $('.indicated-select select').on('change', function(event) {
        var vl = $('option:selected', this).attr('value');
        $(this).closest('.indicated-select').removeClassWild("indicated-select_*").addClass('indicated-select_' + vl);
    });
}

function createPaymentMethod(userData) {
    $('[js-save-row]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "savePaymentMethod",
        data: JSON.stringify(userData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            addRowToFrontList(data);
            $('[js-menu-create-row]').removeClass('is-open');
            checkBodyHidden();
            $('[js-row-form]').trigger('reset');
            $('[js-save-row]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-row]').prop("disabled", false);
        }
    });
}
//активация редактирования формы
var ROW_INFO_TEMP = {};
function initEditRowFromList() {

    $('[edit-row]').on('click', function (event) {
        event.preventDefault();
        $(this).closest('[edit-menu]').removeClass('is-open').siblings('[edit-btns]').addClass('is-open');
        var list = {};

        $(this).closest('.custom-table__body-row').find('[pm-enable-wrapper]').removeClass('disabled');
        $(this).closest('.custom-table__body-row').find('[pm-enable-selector]').removeAttr('disabled');
        var enable = $(this).closest('.custom-table__body-row').find('[pm-enable-selector]');
        list['enable'] = enable.val();

        $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
        ROW_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[pm-id]').val()] = list;
    });
}
function initCancelEditRowFromList() {
    $('[edit-row-cancel]').on('click', function (event) {
        event.preventDefault();
        var values = ROW_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[pm-id]').val()];

        $(this).closest('.custom-table__body-row').find('[pm-enable-wrapper]').removeClassWild("indicated-select_*").addClass('indicated-select_' + values.enable).addClass('disabled');
        $(this).closest('.custom-table__body-row').find('[pm-enable-selector]').val(values.enable).attr("disabled", true);

        $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
        delete ROW_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[pm-id]').val()];
    });
}
var ROW_ACCEPT_BTN;
function initAcceptEditUserFromList() {
    $('[edit-row-accept]').on('click', function (event) {
        event.preventDefault();
        ROW_ACCEPT_BTN = $(this);

        var rowData = new Object();
        rowData.id = $(this).closest('.custom-table__body-row').find('[pm-id]').val();
        rowData.isActive = $(this).closest('.custom-table__body-row').find('[pm-enable-selector]').val();

        $('[edit-row-accept]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "updatePaymentMethod",
            data: JSON.stringify(rowData),
            dataType: 'json',
            cache: false,
            success: function (data) {
                ROW_ACCEPT_BTN.closest('.custom-table__body-row').find('[pm-enable-wrapper]').addClass('disabled');
                ROW_ACCEPT_BTN.closest('.custom-table__body-row').find('[pm-enable-selector]').val(data.isActive.toString()).attr("disabled", true);

                ROW_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
                delete ROW_INFO_TEMP[data.id];

                $('[edit-row-accept]').prop("disabled", false);
            },
            error: function (data) {
                var values = ROW_INFO_TEMP[rowData.id];

                ROW_ACCEPT_BTN.closest('.custom-table__body-row').find('[pm-enable-wrapper]').addClass('disabled');
                ROW_ACCEPT_BTN.closest('.custom-table__body-row').find('[pm-enable-selector]').val(values.isActive).attr("disabled", true);

                ROW_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');

                delete ROW_INFO_TEMP[data.id];
                $('[edit-row-accept]').prop("disabled", false);
            }
        });
    });
}
function addRowToFrontList(data) {
    $('[table-body]').html(
        '<tr class="custom-table__body-row">' +
        '<input type="hidden" pm-id value="' + data.id + '" name="id" required>' +
        '<td class="custom-table__body-col"></td>' +
        '<td class="custom-table__body-col">' +
        '<div class="column_pmethod column_pmethod_' + data.code + '"></div>' +
        '</td>'+
        '<td class="custom-table__body-col">' + data.title + '</td>' +
        '<td class="custom-table__body-col custom-table__body-col_medium">' +
        '<div pm-enable-wrapper class="indicated-select menu-input__wrapper menu-input__wrapper_select indicated-select_true disabled">' +
        '<select pm-enable-selector class="editable menu-input__input menu-input__input_medium menu-input__input_select menu-input__input_white" disabled>' +
        '<option value="true" selected>Активен</option>' +
        '<option value="false">Не активен</option>' +
        '</select>' +
        '</div>' +
        '</td>' +
        '<td class="custom-table__body-col custom-table__body-col_last">' +
        '<div edit-btns class="column-links display-flex-none">' +
        '<div edit-row-accept class="column_mwidth column_mwidth-accept"></div>' +
        '<div edit-row-cancel class="column_mwidth column_mwidth-cancel"></div>' +
        '</div>' +
        '<div edit-menu class="column-links display-flex-none is-open">' +
        '<div edit-row class="column_mwidth div-table__body-col_center column_mwidth-edit column_mwidth-edit-b"></div>' +
        '</div>' +
        '</td>' +
        '</tr>'
        + $('[table-body]').html()
    );
    initEditRowFromList();
    initCancelEditRowFromList();
    initAcceptEditUserFromList();

    changeSelectorIndicator();
}

function validateForm(form) {

    $(form).validate({
        onkeyup: false,
        onfocusout: false,
        errorPlacement: function(label, element) {
            label.addClass('error-wrapper');
            label.insertAfter(element.parent().last());
        },
        wrapper: 'span'
    });
    $(form).rules('add', {
        messages: {
            required: 'Заполните это поле.',
        }
    });

    return $(form).valid();
}
$(document).on('click', '[open-comment]', function(event){
    resetOpenCommentMenu();
    openCommentMenu($(this).closest('[data-item]').data('item'));
});

function openCommentMenu(idComment) {
    var formData = new FormData();
    formData.append('id', idComment);

    $('[open-comment]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getRateItemInfo",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setRateItemInfo(data);

            $('[js-menu-open-comment]').addClass('is-open');
            checkBodyHidden();
            $('[open-comment]').prop("disabled", false);
        },
        error: function (data) {
            $('[open-comment]').prop("disabled", false);
        }
    });
}

function resetOpenCommentMenu() {
    // $('[c-rate-mscore]').removeClassWild("score_*");
    // $('[examiner-comment]').removeClass('is-open');
    $('[process-btn]').removeClass('is-open');
    $('[not-process-btn]').removeClass('is-open');
    $('[debate-comment]').removeClass('is-open');

    $('[js-open-comment-form]').trigger('reset');
    $('.input-element__documents-new').html('');
    FILES = new FormData();

    $('[comments]').nextAll('.comment').remove();
}

function setRateItemInfo(data) {

    $('[c-rate-id]').val(data.id);

    var comments = '';
    $.each(data.comments, function(index, comment) {
        var documents = getDocuments(comment.commentFiles);
        if ((documents.length != 0 || comment.text != null) || comment.type == 'manager') {
            comments +=
                '<div class="comment">' +
                '   <div class="comment__wrapper ' + (comment.type == 'examiner' ? 'comment__wrapper_400 comment__wrapper_violet' : 'comment__wrapper_400 comment__wrapper_right') + '">' +
                (comment.type == 'manager' ?
                    '<div class="comment__score"><span>Желаемая оценка </span><div class="score ' + (comment.wishScore > 0 ? 'score_green' : (comment.wishScore === 0 ? 'score_gray' : 'score_red')) + '">' + comment.wishScore + '</div></div>' : '') +
                ((comment.text != null) ? '<div class="comment__text">' + comment.text + '</div>' : '') +
                '       <div class="comment__document-wrapper">' +
                documents +
                '       </div>' +
                '   </div>' +
                '</div>';
        }

        $('[c-rate-mscore]').val(comment.wishScore);
    });
    $('[comments]').after(comments);

    if (data.status !== 2) {
        $('[not-process-btn]').addClass('is-open');
    } else {
        $('[process-btn]').addClass('is-open');
        $('[debate-comment]').addClass('is-open');
    }
}

function getDocuments(documents) {
    var documentsBlock = '';
    $.each(documents, function(index, document){
        if (document.type === 'png' || document.type === 'jpeg' || document.type === 'jpg') {
            documentsBlock += '<div class="comment__document">' +
                '   <a class="comment__img" data-fancybox="' + document.name + '" href="/' + document.shortPath + '">  ' +
                '       <img src="/' + document.shortPath + '">' +
                '   </a>' +
                '</div>';
        } else {
            documentsBlock += '<div class="comment__document">' +
                '<a href="' + document.path + '" class="comment__file comment__file_' + document.type + '">' +
                '<div class="comment__file-type">' + document.type + '</div>' +
                // '<div class="comment__file-name">' + document.name + '</div>' +
                '</a>' +
                '</div>';
        }

    });

    return documentsBlock;
}

$(document).on('click', '[js-menu-open-comment-close-btn]', function(event){
    $('[js-menu-open-comment]').removeClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[approve]', function(event){
    var formData = new FormData($('[js-open-comment-form]')[0]);
    addFilesToFormData(formData);

    $('[approve]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "approveDebate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateRateOnList(formData.get('id'), 'Подтвержден', $('[c-rate-mscore]').val());

            $('[js-menu-open-comment]').removeClass('is-open');
            checkBodyHidden();

            $('[approve]').prop("disabled", false);
        },
        error: function (data) {
            $('[approve]').prop("disabled", false);
        }
    });
});

$(document).on('click', '[reject]', function(event){
    var formData = new FormData($('[js-open-comment-form]')[0]);
    addFilesToFormData(formData);

    $('[reject]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "rejectDebate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateRateOnList(formData.get('id'), 'Отклонен');

            $('[js-menu-open-comment]').removeClass('is-open');
            checkBodyHidden();
            $('[reject]').prop("disabled", false);
        },
        error: function (data) {
            $('[reject]').prop("disabled", false);
        }
    });
});

function updateRateOnList(id, status, score) {
    $('[data-item="' + id + '"]').find('.status').html(status);
    if (score) {
        $('[data-item="' + id + '"]').find('.score').removeClassWild("score_*");
        $('[data-item="' + id + '"]').find('.score').addClass((score > 0 ? 'score_green' : (score === 0 ? 'score_gray' : 'score_red')));
        var afterDot = (score.toString().includes('.')) ? (score.toString().split('.').pop().length) : 0;
        var wishScore = afterDot == 0 ? Number(score).toFixed(1) : score;
        $('[data-item="' + id + '"]').find('.score').html(score > 0 ? ('+' + wishScore)  : wishScore);
    }
}
$(document).ready(function(){
    const $filterForm = $('[tr-filter-form]');
    const $filterFormBtn = $('[tr-filter-form-btn]');
    const $filter = $('[tr-filter]');
    const $filterOpenBtn = $('[tr-filter-btn]');
    const $filterCloseBtn = $('[tr-filter-close-btn]');

    $filterOpenBtn.on('click', function() {
        $('body').addClass('hiddenOverflow');
        $filter.addClass('is-open');
    });

    $filterCloseBtn.on('click', function() {
        $('body').removeClass('hiddenOverflow');
        $filter.removeClass('is-open');
        resetFilter(FILTER_FROM_BACK);
    });

    $filterFormBtn.on('click', function(event) {
        event.preventDefault();
        $filterForm.trigger('submit');
    });

    $('.datepicker-here-f').datepicker({
        autoClose: true
    });


    $searchDeal = $('[search-deal]');
    $searchDealForm = $('[search-deal-form]');
    $searchDealBtn = $('[search-deal-btn]');
    $searchDealClear = $('[search-deal-clear]');

    $searchDeal.on('keyup', function () {
        $searchDealClear.removeClass('is-open');
        $searchDealBtn.addClass('is-open');
        $(this).addClass('active');
    });

    $searchDealBtn.on('click', function (event) {
        event.preventDefault();
        $searchDealForm.trigger('submit');
    });

    $searchDealClear.on('click', function (event) {
        event.preventDefault();
        $searchDeal.val('');
        $searchDealForm.trigger('submit');
    });
});

//список фильтр
var FILTER_FROM_BACK;
function setDashboardFilter(filter) {
    FILTER_FROM_BACK = filter;
}

function resetFilter(filter) {
    $('#createDateFrom').val(filter.createDateFrom);
    $('#createDateTo').val(filter.createDateTo);
}
$(document).on('click', '[open-rates]', function(event){
    openRatesMenu($(this).closest('[data-deal]').data('deal'));
});
$(document).on('click', '[js-menu-rates-close-btn]', function(event){
    $('[js-menu-rates]').removeClass('is-open');
    checkBodyHidden();
});
function openRatesMenu(idDeal) {
    var formData = new FormData();
    formData.append('id', idDeal);

    $('[open-rates]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getRateTemplatesInfo",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            resetRateTemplatesInfo();
            setRateTemplatesInfo(data);

            $('[js-menu-rates]').addClass('is-open');
            checkBodyHidden();
            $('[open-rates]').prop("disabled", false);
        },
        error: function (data) {
            $('[open-rates]').prop("disabled", false);
        }
    });
}
function setRateTemplatesInfo(data) {
    var avatar = data.employee.avatar;
    if (avatar === null) {
        $('[rate-avatar]').addClass('avatar-image_default');
        $('[rate-avatar]').html('');
    } else {
        $('[rate-avatar]').html('<img src="/' + avatar + '" alt="">');
    }

    $('[rate-employee-name]').html(data.employee.name);
    $('[rate-employee-position]').html(data.employee.position);
    $('[rate-date]').html((data.editDate !== null ? data.editDate : ''));
    $('[rate-deal]').html('Сделка № ' + data.idDeal);

    $('[rate-id-deal]').val(data.idDeal);

    var templates = '';
    $.each(data.templates, function(index, template){
        templates += '<tr template-info="' + template.id + '" class="custom-table__body-row">' +
            '<td class="custom-table__body-col custom-table__body-col_xxxsmall">' +
            '   <div class="column_bstatus ' + ((template.isRated) ? "column_bstatus_checked" : "column_bstatus_unchecked") + '"></div>' +
            '</td>' +
            '<td class="custom-table__body-col custom-table__body-col_60per">' +
            '   <div class="column-text column-text_full">' + template.name + '</div>' +
            '</td>' +
            '<td class="custom-table__body-col custom-table__body-col_10per">' +
            '   <div class="column-text">' + template.items.length + '</div>' +
            '</td>' +
            '<td class="custom-table__body-col custom-table__body-col_5per">' +
            (template.totalScore !== null
                ? '<div class="score ' + (template.totalScore > 0 ? 'score_green' : (template.totalScore == 0 ? 'score_gray' : 'score_red')) + '">' + (template.totalScore > 0 ? ('+' + template.totalScore) : (template.totalScore)) + '</div>'
                : '<div class="score score_gray">—</div>') +
            '</td>' +
            '<td class="custom-table__body-col custom-table__body-col_20per custom-table__body-col_r16">' +
            ((template.isRated) ? '<div data-rate="' + template.idRate + '" open-rate class="button button_white">Подробнее</div>' : '<div data-template="' + template.id + '" add-rate class="button button_violet">Оценить по списку</div>') +
            '</td>' +
            '</tr>';
    });
    $('[templates]').html(templates);

}
$(document).on('click', '[add-rate]', function(event){
    openAddRateMenu($(this).attr('data-template'));
});

function openAddRateMenu(idDeal) {
    var formData = new FormData();
    formData.append('id', idDeal);

    $('[add-rate]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getPerformanceAssessmentTemplatesItems",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[rate-id-template]').val(formData.get('id'));
            resetTotalScore();
            setTemplateItems(data);

            $('[js-menu-rate]').addClass('is-open');
            checkBodyHidden();
            $('[add-rate]').prop("disabled", false);
        },
        error: function (data) {
            $('[add-rate]').prop("disabled", false);
        }
    });
}
// function setRateTemplateInfo(data) {
//     var avatar = data.employee.avatar;
//     if (avatar === null) {
//         $('[rate-avatar]').addClass('avatar-image_default');
//         $('[rate-avatar]').html('');
//     } else {
//         $('[rate-avatar]').html('<img src="/' + avatar + '" alt="">');
//     }
//
//     $('[rate-employee-name]').html(data.employee.name);
//     $('[rate-employee-position]').html(data.employee.position);
//     $('[rate-date]').html((data.editDate !== null ? data.editDate : ''));
//     $('[rate-deal]').html('Сделка № ' + data.idDeal);
//
//     $('[rate-id-deal]').val(data.idDeal);
//
//     var templates = '';
//     $.each(data.availableTemplates, function(index, template){
//         templates += '<option value="' + template.id + '">' + template.name + '</option>';
//     });
//     $('[rate-templates]').html(templates);
//
//     $('[rate-templates]').trigger('change');
//
// }
$(document).on('click', '[js-menu-rate-close-btn]', function(event){
    resetRateTemplateInfo();
    $('[js-menu-rate]').removeClass('is-open');
    checkBodyHidden();
});
function resetRateTemplateInfo() {
    $('[js-save-rate]').attr('disabled', '');
    resetTotalScore();
    TEMP_DATA = {};
}
function resetRateTemplatesInfo() {
    $('[rate-avatar]').removeClass('avatar-image_default');
    $('[rate-avatar]').html('');
    $('[rate-employee-name]').html('');
    $('[rate-employee-position]').html('');
    $('[rate-date]').html('');
    $('[rate-deal]').html('');
    $('[templates]').html('');
}

$(document).on('change', '[rate-templates]', function(event){
    var formData = new FormData();
    formData.append('id', Number($('option:selected', this).val()));

    $('[rate-templates]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getPerformanceAssessmentTemplatesItems",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[rate-id-template]').val(formData.get('id'));
            resetTotalScore();
            setTemplateItems(data);

            $('[rate-templates]').prop("disabled", false);
        },
        error: function (data) {
            $('[rate-templates]').prop("disabled", false);
        }
    });
});

function resetTotalScore() {
    $('.total-score').removeClassWild("score_*");
    $('.total-score').html('—');
}

function setTemplateItems(data) {
    var row = '';
    $.each(data, function(index, item){
        row += '<tr class="custom-table__body-row item-row">' +
            '<input type="hidden" name="items[' + index + '].idItem" value="' + item.id + '" required>' +
            '<td class="custom-table__body-col custom-table__body-col_25per">' + item.name + '</td>' +
            '<td class="custom-table__body-col custom-table__body-col_25per">' +
            '   <div add-comment data-index="' + index + '" class="button button_white">Оставить комментарий</div>' +
            '</td>' +
            '<td class="custom-table__body-col custom-table__body-col_10per custom-table__body-col_center">' +
            '   <div class="score item-score">—</div>' +
            '</td>' +
            '<td class="custom-table__body-col custom-table__body-col_40per">' +
            '   <div class="rate-block">           ' +
            '       <div class="rate-block__wrapper">               ' +
            '           <div class="rate-block__btn rate-block__btn_small">                   ' +
            '               <input type="radio" id="good' + index + '" class="radio radio_icon radio_like rate-value" name="items[' + index + '].score" value="' + item.goodScore + '" required>                   ' +
            '               <label for="good' + index + '" class="label">Отлично</label>               ' +
            '           </div>               ' +
            '           <div class="rate-block__btn rate-block__btn_small">                   ' +
            '               <input type="radio" id="bad' + index + '" class="radio radio_icon radio_dislike rate-value" name="items[' + index + '].score" value="0" required>                   ' +
            '               <label for="bad' + index + '" class="label">Плохо</label>               ' +
            '           </div>           ' +
            '       </div>       ' +
            '   </div>' +
            '</td>' +
            '</tr>';
    });
    $('[template-fields]').html(row);
}

$(document).on('change', '.rate-value', function() {
    var score = Number($(this).val());
    var scoreBlock = $(this).closest('.item-row').find('.item-score');

    scoreBlock.removeClassWild("score_*");
    if (score > 0) {
        scoreBlock.addClass('score_green');
    } else if (score < 0) {
        scoreBlock.addClass('score_red');
    } else {
        scoreBlock.addClass('score_gray');
    }
    scoreBlock.html(score);

    checkAllRateValueSelected();
    countTotalScore();
});

function checkAllRateValueSelected() {
    var i = 0;
    var isAllSelected = true;
    while (true) {
        if ($('input[type="radio"][name="items[' + i + '].score"]').length) {
            if (!$('input[type="radio"][name="items[' + i + '].score"]').is(':checked')) {
                isAllSelected = false;
            }
        } else {
            break;
        }
        i++;
    }

    if (isAllSelected) {
        $('[js-save-rate]').removeAttr('disabled');
    }
}
function countTotalScore() {
    var total = 0;
    $.each($('.rate-value:checked'), function(index){
        total += Number($(this).val())
    });

    var totalScoreBlock = $('.total-score');

    totalScoreBlock.removeClassWild("score_*");
    if (total > 0) {
        totalScoreBlock.addClass('score_green');
    } else if (total < 0) {
        totalScoreBlock.addClass('score_red');
    } else {
        totalScoreBlock.addClass('score_gray');
    }

    totalScoreBlock.html(total);
}

$(document).on('click', '[js-save-rate]', function(event){
    event.preventDefault();
    $('[js-rate-form]').trigger('submit');
});
$(document).on('submit', '[js-rate-form]', function(event) {
    event.preventDefault();
    if (validateCheckboxForm(this)) {
        var formData = new FormData($('[js-rate-form]')[0]);


        $.each(TEMP_DATA, function(index, item){
            formData.append('items[' + index + '].exComment', item.get('exComment'));
            $.each(item.getAll('files'), function(index2, file){
                formData.append('items[' + index + '].files', file);
            });
        });

        saveRate(formData);
    }
});

function saveRate(formData) {
    $('[js-save-rate]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveRate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            replaceTemplateInfoRow(data);

            resetRateTemplateInfo();
            $('[js-menu-rate]').removeClass('is-open');
            checkBodyHidden();

            $('[js-save-rate]').prop("disabled", false);
            hideLoader();
        },
        error: function (data) {
            $('[js-save-rate]').prop("disabled", false);
            hideLoader();
        },
        beforeSend: function() {
            showLoader();
        },
        afterSend: function() {
            hideLoader();
        }
    });
}
function replaceTemplateInfoRow(data) {
    $('[template-info="' + data.idPerformanceAssessmentTemplate + '"]').replaceWith(
        '<tr template-info="' + data.idPerformanceAssessmentTemplate + '" class="custom-table__body-row">' +
        '<td class="custom-table__body-col custom-table__body-col_xxxsmall">' +
        '   <div class="column_bstatus column_bstatus_checked"></div>' +
        '</td>' +
        '<td class="custom-table__body-col custom-table__body-col_60per">' +
        '   <div class="column-text">' + data.performanceAssessmentTemplateName + '</div>' +
        '</td>' +
        '<td class="custom-table__body-col custom-table__body-col_10per">' +
        '   <div class="column-text">' + data.items.length + '</div>' +
        '</td>' +
        '<td class="custom-table__body-col custom-table__body-col_5per">' +
        '   <div class="score ' + (data.totalScore > 0 ? 'score_green' : (data.totalScore == 0 ? 'score_gray' : 'score_red')) + '">' + (data.totalScore > 0 ? ('+' + data.totalScore) : (data.totalScore)) + '</div>' +
        '</td>' +
        '<td class="custom-table__body-col custom-table__body-col_20per custom-table__body-col_r16">' +
        '   <div data-rate="' + data.id + '" open-rate class="button button_white">Подробнее</div>' +
        '</td>' +
        '</tr>');
}

var TEMP_DATA = {};
$(document).on('click', '[add-comment]', function(event){
    var index = $(this).data('index');
    $('[comment-index]').val(index);

    $('[js-menu-add-comment]').addClass('is-open');
    checkBodyHidden();
});
$(document).on('click', '[js-menu-add-comment-close-btn]', function(event){
    resetAddCommentForm();

    $('[js-menu-add-comment]').removeClass('is-open');
    checkBodyHidden();
});
function resetAddCommentForm() {
    $('[js-add-comment-form]').trigger('reset');
    $('.input-element__documents-new').html('');
    FILES = new FormData();
}

$(document).on('click', '[js-add-comment]', function(event){
    event.preventDefault();
    var formData = new FormData($('[js-add-comment-form]')[0]);
    addFilesToFormData(formData);


    var index = $('[comment-index]').val();
    if (formData.get('exComment') !== "" || formData.getAll('files').length !== 0) {
        $('[add-comment][data-index="' + index + '"]').removeClass('button_white');
        $('[add-comment][data-index="' + index + '"]').html('Посмотреть комментарий');
        $('[add-comment][data-index="' + index + '"]').removeAttr('add-comment').attr('open-comment', '');
        TEMP_DATA[index] = formData;
    } else {
        $('[add-comment][data-index="' + index + '"]').addClass('button_white');
        $('[add-comment][data-index="' + index + '"]').html('Оставить комментарий');
        $('[add-comment][data-index="' + index + '"]').removeAttr('open-comment').attr('add-comment', '');
        delete TEMP_DATA[index];
    }

    resetAddCommentForm();
    $('[js-menu-add-comment]').removeClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[open-comment]', function(event){
    var index = $(this).data('index');
    $('[comment-index]').val(index);

    var formData = TEMP_DATA[index];
    $('[comment-index]').val(formData.get('index'));
    $('[comment-desc]').val(formData.get('exComment'));
    FILES = new FormData();

    setFiles(formData.getAll('files'));
    updateFiles($('[comment-files]'));

    $('[js-menu-add-comment]').addClass('is-open');
    checkBodyHidden();
});



$(document).on('click', '[view-comment]', function(event){
    openCommentMenu($(this).attr('data-item'));
});

function openCommentMenu(idComment) {
    var formData = new FormData();
    formData.append('id', idComment);

    $('[view-comment]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getRateItemInfo",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setRateItemInfo(data);

            $('[js-menu-open-comment]').addClass('is-open');
            checkBodyHidden();
            $('[view-comment]').prop("disabled", false);
        },
        error: function (data) {
            $('[view-comment]').prop("disabled", false);
        }
    });
}
$(document).on('click', '[js-menu-open-comment-close-btn]', function(event){
    $('[js-menu-open-comment]').removeClass('is-open');
    checkBodyHidden();
});
function setRateItemInfo(data) {
    resetOpenCommentMenu();

    $('[c-rate-item-name]').html(data.itemName);

    $('[c-rate-score]').html(data.score);
    $('[c-rate-score]').addClass((data.score > 0 ? 'score_green' : (data.score === 0 ? 'score_gray' : 'score_red')));

    var comments = '';
    $.each(data.comments, function(index, comment) {
        var documents = getDocuments(comment.commentFiles);

        if ((documents.length != 0 || comment.text != null) || comment.type == 'manager') {
            comments +=
                '<div class="comment">' +
                '   <div class="comment__wrapper ' + (comment.type == 'examiner' ? 'comment__wrapper_400 comment__wrapper_violet' : 'comment__wrapper_400 comment__wrapper_right') + '">' +
                (comment.type == 'manager' ?
                    '<div class="comment__score"><span>Желаемая оценка </span><div class="score ' + (comment.wishScore > 0 ? 'score_green' : (comment.wishScore === 0 ? 'score_gray' : 'score_red')) + '">' + comment.wishScore + '</div></div>' : '') +
                ((comment.text != null) ? '<div class="comment__text">' + comment.text + '</div>' : '') +
                '       <div class="comment__document-wrapper">' +
                documents +
                '       </div>' +
                '   </div>' +
                '</div>'
        }
    });
    $('[comments]').after(comments);
}

function getDocuments(documents) {
    var documentsBlock = '';
    $.each(documents, function(index, document){
        if (document.type === 'png' || document.type === 'jpeg' || document.type === 'jpg') {
            documentsBlock += '<div class="comment__document">' +
                '   <a class="comment__img" data-fancybox="' + document.name + '" href="/' + document.shortPath + '">  ' +
                '       <img src="/' + document.shortPath + '">' +
                '   </a>' +
                '</div>';
        } else {
            documentsBlock += '<div class="comment__document">' +
                '<a href="' + document.path + '" class="comment__file comment__file_' + document.type + '">' +
                '<div class="comment__file-type">' + document.type + '</div>' +
                // '<div class="comment__file-name">' + document.name + '</div>' +
                '</a>' +
                '</div>';
        }

    });

    return documentsBlock;
}

function resetOpenCommentMenu() {
    $('[comments]').nextAll('.comment').remove();
}

$(document).on('click', '[js-menu-rate-close-btn]', function(event){
    $('[js-menu-rate]').removeClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[open-rate]', function(event){
    openRateMenu($(this).attr('data-rate'));
});

function openRateMenu(idRate) {
    var formData = new FormData();
    formData.append('id', idRate);

    $('[open-rate]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getRateInfo",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setRateInfo(data);

            $('[js-menu-rate-items]').addClass('is-open');
            checkBodyHidden();
            $('[open-rate]').prop("disabled", false);
        },
        error: function (data) {
            $('[open-rate]').prop("disabled", false);
        }
    });
}

function setRateInfo(data) {
    var rows = '';
    $.each(data.items, function(index, item){
        rows +=
            '<tr class="custom-table__body-row">' +
            '   <td class="custom-table__body-col custom-table__body-col_xxxlarge">' + item.itemName + '</td>' +
            '   <td class="custom-table__body-col custom-table__body-col_center custom-table__body-col_xsmall">' +
            '       <div class="score ' + (item.score > 0 ? 'score_green' : (item.score == 0 ? 'score_gray' : 'score_red')) + '">' + (item.score > 0 ? ('+' + item.score) : (item.score)) + '</div>' +
            '   </td>' +
            '   <td class="custom-table__body-col custom-table__body-col_r16">   ' +
            '       <div view-comment data-item="' + item.id + '" class="button button_white">Посмотреть</div>' +
            '   </td>' +
            '</tr>';
    });
    $('[rate-items]').html(rows);
}

$(document).on('click', '[js-menu-rate-items-close-btn]', function(event){
    $('[js-menu-rate-items]').removeClass('is-open');
    checkBodyHidden();
});


$(document).on('click', '[add-template]', function(event){
    $('[js-menu-add-template]').addClass('is-open');
    checkBodyHidden();
    recalculateTotal();
});
$(document).on('click', '[js-menu-add-template-close-btn]', function(event){
    resetAddTemplateForm();
    $('[js-menu-add-template]').removeClass('is-open');
    checkBodyHidden();
});
$(document).on('keyup', '.rate-fields .menu-input__input_rate-value input', function (event){
   recalculateTotal();
});

function recalculateTotal(){
    var total = 0;
    $('.rate-fields .menu-input__input_rate-value input').each(function(index, item){
        var v = parseFloat($(item).val());
        if (!isNaN(v)) {
            total += v;
        }
    });
    $('[u-template-items-total]').html('Итого: ' + total).attr('template-items-total', total);
    $('[u-rate-alert]').toggle(total !== 5);
}

function resetAddTemplateForm() {
    $('[js-template-form]').trigger('reset');
    $('input[id^="addType"]').prop('checked', true);
    $('[data-item]').filter('[data-item!="0"]').remove();
    ITEMS_COUNT = 0;
}
var ITEMS_COUNT = 0;
$(document).on('click', '[add-rate-item]', function(event){
    ITEMS_COUNT++;
    $('[data-item]').last().after(
        '<div data-item="' + ITEMS_COUNT + '" class="rate-filed">' +
        '   <div class="rate-filed__wrapper menu-input__input_rate-filed">' +
        '      <input name="items[' + ITEMS_COUNT + '].name" autocomplete="off" class="menu-input__input menu-input__input_small " placeholder="Введите название пункта" required>' +
        '   </div>' +
        '   <div class="rate-filed__wrapper menu-input__input_rate-value">' +
        '      <input name="items[' + ITEMS_COUNT + '].goodScore" autocomplete="off" class="menu-input__input menu-input__input_small " placeholder="0" required>' +
        '   </div>' +
        '   <div delete-item class="rate-field__delete"></div>' +
        '</div>'
    );
    recalculateTotal();
});
$(document).on('click', '[delete-item]', function(event){
    $(this).closest('div[data-item]').remove();
    recalculateTotal();
});


$(document).on('click', '[save-template]', function(event){
    event.preventDefault();
    $('[js-template-form]').trigger('submit');
});
$(document).on('submit', '[js-template-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-template-form]')[0]);
        saveTemplate(formData);
    }
});
function saveTemplate(formData) {
    if (parseFloat($('[u-template-items-total]').attr('template-items-total')) !== 5) {
        return;
    }
    $('[save-template]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "savePerformanceAssessmentTemplate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setTemplate(data);

            resetAddTemplateForm();
            $('[js-menu-add-template]').removeClass('is-open');
            checkBodyHidden();
            $('[save-template]').prop("disabled", false);
        },
        error: function (data) {
            $('[save-template]').prop("disabled", false);
        }
    });
}
function setTemplate(data) {
    var rows = $('[template-list]').html();
    var newRow = createRow(data);

    $('[template-list]').html(newRow + rows);
}
function createRow(data) {
    var items = '';
    var userTypes = '';
    var itemCount = 0;
    $.each(data.items, function(index, item){
        itemCount++;
        items +=
            '<div class="c-tooltip__row">' +
            '   <div class="c-tooltip__text">' + item.name + '</div> ' +
            '</div>';
    });

    $.each(data.userTypes, function(index, userType){
        userTypes += '<span class="side-list__item">' + userType.title + '</span>';
    });

    return '<tr data-template="' + data.id + '" class="custom-table__body-row">' +
    '                                <td class="custom-table__body-col custom-table__body-col_25per">' +
    '                                    <div class="column-text">' + data.name + '</div>' +
    '                                </td>' +
    '                                <td class="custom-table__body-col custom-table__body-col_25per">' +
    '                                    <div class="side-tooltip ' + (itemCount !== 0 ? 'c-tooltip' : '') + '">' +
    '                                        <div class="c-tooltip__wrapper">' +
                                                items +
    '                                        </div>' +
    '                                        <span>' + itemCount + ' пунктов</span>' +
    '                                    </div>' +
    '                                </td>' +
    '                                <td class="custom-table__body-col custom-table__body-col_40per">' +
    '                                    <div class="side-list">' +
                                            userTypes +
    '                                    </div>' +
    '                                </td>' +
    '                                <td class="custom-table__body-col custom-table__body-col_10per">' +
    '                                    <div class="column-links display-flex-none is-open">' +
    '                                        <div update-template class="column_mwidth div-table__body-col_center column_mwidth-edit"></div>' +
    '                                        <form class="column-form" action="#">' +
    '                                            <button delete-template type="button" class="column_mwidth column_mwidth-delete"></button>' +
    '                                        </form>' +
    '                                    </div>' +
    '                                </td>' +
    '                            </tr>';
}

var DELETE_TEMPLATE;
$(document).on('click', '[delete-template]', function(event) {
    event.preventDefault();
    $('[dialog-accept]').find('.dialog__title').html('Вы действительно хотите удалить шаблон?');
    $('[dialog-accept]').find('.dialog__text').html('Шаблон будет удален');
    $('[dialog-accept]').find('[accept-dialog]').attr('accept-delete-template', '');
    $('[dialog-accept]').addClass('is-open');
    DELETE_TEMPLATE =  Number($(this).closest('[data-template]').data('template'));
});

$(document).on('click', '[close-dialog]', function(event) {
    removeAcceptBtnAttribute($(this).siblings('[accept-dialog]'));
    $(this).closest('.dialog').removeClass('is-open');
});

$(document).on('click', '[accept-delete-template]', function(event) {
    var formData = new FormData();
    formData.append('id', DELETE_TEMPLATE);

    $.ajax({
        type: "POST",
        url: "deletePerformanceAssessmentTemplate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[data-template="' + DELETE_TEMPLATE + '"]').remove();

            $('[dialog-accept]').removeClass('is-open');
            removeAcceptBtnAttribute($(this));
        },
        error: function (data) {
            $('[dialog-accept]').removeClass('is-open');
            removeAcceptBtnAttribute($(this));
        }
    });

});

$(document).on('click', '[update-template]', function(event){
    var formData = new FormData();
    formData.append('id', Number($(this).closest('[data-template]').data('template')));

    $('[update-template]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getPerformanceAssessmentTemplate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setUpdateTemplate(data);

            $('[update-template]').prop("disabled", false);
        },
        error: function (data) {
            $('[update-template]').prop("disabled", false);
        }
    });
});

function setUpdateTemplate(data) {
    $('[u-template-id]').val(data.id);
    $('[u-template-name]').val(data.name);
    $.each(data.userTypes, function(index, userType){
        $('input[type="checkbox"][value="' + userType.id + '"]').prop('checked', true);
    });

    var items = '';
    $.each(data.items, function(index, item){
        items +=
            '<div data-item="' + index + '" class="rate-filed">' +
            '        <input type="hidden" value="' + item.id + '" name="items[' + index + '].id" required>' +
            '    <div class="rate-filed__wrapper menu-input__input_rate-filed">' +
            '        <input value="' + item.name + '" name="items[' + index + '].name" autocomplete="off" class="menu-input__input menu-input__input_small " placeholder="Введите название пункта" required>' +
            '    </div>' +
            '    <div class="rate-filed__wrapper menu-input__input_rate-value">' +
            '        <input value="' + item.goodScore + '" name="items[' + index + '].goodScore" autocomplete="off" class="menu-input__input menu-input__input_small " placeholder="0" required>' +
            '    </div>' +
            '    <div ' + (index !== 0 ? 'delete-item' : '') + ' class="rate-field__delete ' + (index === 0 ? 'rate-field__delete_disabled' : '') + '"></div>' +
            '</div>';
    });

    $('[u-template-items]').after(items);

    ITEMS_COUNT = data.items.length;

    $('[js-menu-update-template]').addClass('is-open');
    checkBodyHidden();
    recalculateTotal();
}

$(document).on('click', '[js-menu-update-template-close-btn]', function(event){
    resetUpdateTemplateForm();
    $('[js-menu-update-template]').removeClass('is-open');
    checkBodyHidden();
});

function resetUpdateTemplateForm() {
    $('[js-update-template-form]').trigger('reset');
    $('input[id^="updateType"]').prop('checked', false);
    $('[u-template-items]').siblings('[data-item]').remove();

    ITEMS_COUNT = 0;
    recalculateTotal();
}

$(document).on('click', '[u-template]', function(event){
    event.preventDefault();
    $('[js-update-template-form]').trigger('submit');
});

$(document).on('submit', '[js-update-template-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-update-template-form]')[0]);
        updateTemplate(formData);
    }
});

function updateTemplate(formData) {
    if (parseFloat($('[u-template-items-total]').attr('template-items-total')) !== 5) {
        return;
    }
    $('[u-template]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "updatePerformanceAssessmentTemplate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[template-list]').find('[data-template="' + formData.get('id') + '"]').replaceWith(createRow(data));

            resetUpdateTemplateForm();
            $('[js-menu-update-template]').removeClass('is-open');
            checkBodyHidden();
            $('[u-template]').prop("disabled", false);
        },
        error: function (data) {
            $('[u-template]').prop("disabled", false);
        }
    });
}

$(document).on('click', '[js-menu-rate-close-btn]', function(event){
    $('[js-menu-rate]').removeClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[open-rate]', function(event){
    openRateMenu($(this).closest('[data-rate]').data('rate'));
});

function openRateMenu(idRate) {
    var formData = new FormData();
    formData.append('id', idRate);

    $('[open-rate]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "/performance-assessment/getRateInfo",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setRateInfo(data);

            $('[js-menu-rate]').addClass('is-open');
            checkBodyHidden();
            $('[open-rate]').prop("disabled", false);
        },
        error: function (data) {
            $('[open-rate]').prop("disabled", false);
        }
    });
}

function setRateInfo(data) {
    $('[rate-header]').html(data.performanceAssessmentTemplateName);
    $('[rate-date]').html(data.createDate);
    $('[rate-deal]').html('Сделка № ' + data.idDeal);
    $('[rate-score ]').html(data.totalScore);
    $('[rate-score ]').removeClassWild("score_*");
    $('[rate-score ]').addClass((data.totalScore > 0 ? 'score_green' : (data.totalScore === 0 ? 'score_gray' : 'score_red')));

    var rows = '';
    $.each(data.items, function(index, item){
        rows +=
            '<tr class="custom-table__body-row">' +
            '   <td class="custom-table__body-col custom-table__body-col_xxxlarge">' + item.itemName + '</td>' +
            '   <td class="custom-table__body-col custom-table__body-col_center custom-table__body-col_xsmall">' +
            '       <div class="score ' + (item.score > 0 ? 'score_green' : (item.score == 0 ? 'score_gray' : 'score_red')) + '">' + (item.score > 0 ? ('+' + item.score) : (item.score)) + '</div>' +
            '   </td>' +
            '   <td class="custom-table__body-col custom-table__body-col_r16">   ' +
            '       <div open-comment data-item="' + item.id + '" class="button button_white">Посмотреть</div>' +
            '   </td>' +
            '</tr>';
    });
    $('[rate-items]').html(rows);
}

$(document).on('click', '[open-comment]', function(event){
    openCommentMenu($(this).closest('[data-item]').data('item'));
});

function openCommentMenu(idComment) {
    var formData = new FormData();
    formData.append('id', idComment);

    $('[open-comment]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "/performance-assessment/getRateItemInfo",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setRateItemInfo(data);

            $('[js-menu-open-comment]').addClass('is-open');
            checkBodyHidden();
            $('[open-comment]').prop("disabled", false);
        },
        error: function (data) {
            $('[open-comment]').prop("disabled", false);
        }
    });
}

function resetOpenCommentMenu() {
    $('[js-open-comment-form]').trigger('reset');
    $('.input-element__documents-new').html('');
    FILES = new FormData();
    //
    // $('[c-rate-score]').removeClassWild("score_*");
    // $('.wish-score').html('—');
    // $('.wish-score').removeClassWild("score_*");

    $('[comments]').nextAll('.comment').remove();

    $('[debate-btn-block]').removeClass('is-open');
    $('[debate-block]').removeClass('is-open');
    //
    // $('[ex-comment]').removeClass('comment__wrapper_400 comment__wrapper_violet');
    // $('[c-rate-mcomment]').html('');
    // $('[c-rate-mdocuments]').html('');
    // $('[c-rate-mscore]').removeClassWild("score_*");
    // $('[examiner-comment]').removeClass('is-open');
    // $('[manager-comment]').removeClass('is-open');

}
// function setRateItemInfo(data) {
//     resetOpenCommentMenu();
//
//     $('[c-rate-id]').val(data.id);
//     $('[c-rate-id-item]').val(data.idItem);
//     $('[c-rate-item-name]').html(data.itemName);
//
//     if (data.exComment !== null || data.documents.length !== 0) {
//         $('[examiner-comment]').addClass('is-open');
//     }
//
//     $('[c-rate-comment]').html(data.exComment);
//
//     $('[c-rate-score]').html(data.score);
//     $('[c-rate-score]').addClass((data.score > 0 ? 'score_green' : (data.score === 0 ? 'score_gray' : 'score_red')));
//
//     setDocuments(data.documents, $('[c-rate-documents]'));
//
//     if (!data.isExpired && (data.status === 1 || data.status === 4)) {
//         $('[debate-btn-block]').addClass('is-open');
//     }
//
//     if (data.status !== 1 && data.status !== 4) {
//         $('[c-rate-mcomment]').html(data.managerComment);
//         setDocuments(data.managerDocuments , $('[c-rate-mdocuments]'));
//
//         $('[ manager-comment]').addClass('is-open');
//         $('[ex-comment]').addClass('comment__wrapper_400 comment__wrapper_violet');
//
//         $('[c-rate-mscore]').html(data.wishScore);
//         $('[c-rate-mscore]').addClass((data.wishScore > 0 ? 'score_green' : (data.wishScore === 0 ? 'score_gray' : 'score_red')));
//
//     }
//
//     $('[c-rate-mgood]').val(data.goodScore);
//     $('[c-rate-mbad]').val(data.badScore);
// }
function setRateItemInfo(data) {
    resetOpenCommentMenu();

    $('[c-rate-id]').val(data.id);
    $('[c-rate-id-item]').val(data.idItem);
    $('[c-rate-item-name]').html(data.itemName);

    $('[c-rate-score]').html(data.score);
    $('[c-rate-score]').addClass((data.score > 0 ? 'score_green' : (data.score === 0 ? 'score_gray' : 'score_red')));

    var comments = '';
    $.each(data.comments, function(index, comment) {
        var documents = getDocuments(comment.commentFiles);

        if ((documents.length != 0 || comment.text != null) || comment.type == 'manager') {
            comments +=
                '<div class="comment">' +
                '   <div class="comment__wrapper ' + (comment.type == 'examiner' ? 'comment__wrapper_400 comment__wrapper_violet' : 'comment__wrapper_400 comment__wrapper_right') + '">' +
                (comment.type == 'manager' ?
                    '<div class="comment__score"><span>Желаемая оценка </span><div class="score ' + (comment.wishScore > 0 ? 'score_green' : (comment.wishScore === 0 ? 'score_gray' : 'score_red')) + '">' + comment.wishScore + '</div></div>' : '') +
                ((comment.text != null) ? '<div class="comment__text">' + comment.text + '</div>' : '') +
                '       <div class="comment__document-wrapper">' +
                documents +
                '       </div>' +
                '   </div>' +
                '</div>'
        }
    });
    $('[comments]').after(comments);

    if (!data.isExpired && (data.status === 1 || data.status === 4)) {
        $('[debate-btn-block]').addClass('is-open');
    }
    $('[c-rate-mgood]').val(data.goodScore);
    $('[c-rate-mbad]').val(data.badScore);
}

function getDocuments(documents) {
    var documentsBlock = '';
    $.each(documents, function(index, document){
        if (document.type === 'png' || document.type === 'jpeg' || document.type === 'jpg') {
            documentsBlock += '<div class="comment__document">' +
                '   <a class="comment__img" data-fancybox="' + document.name + '" href="/' + document.shortPath + '">  ' +
                '       <img src="/' + document.shortPath + '">' +
                '   </a>' +
                '</div>';
        } else {
            documentsBlock += '<div class="comment__document">' +
                '<a href="' + document.path + '" class="comment__file comment__file_' + document.type + '">' +
                '<div class="comment__file-type">' + document.type + '</div>' +
                // '<div class="comment__file-name">' + document.name + '</div>' +
                '</a>' +
                '</div>';
        }

    });

    return documentsBlock;
}

$(document).on('click', '[js-menu-open-comment-close-btn]', function(event){
    $('[js-menu-open-comment]').removeClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[debate-btn]', function(event){
    $('[debate-btn-block]').removeClass('is-open');
    $('[debate-block]').addClass('is-open');
});

$(document).on('click', '[accept-debate]', function(event) {
    event.preventDefault();
    $('[js-open-comment-form]').trigger('submit');
});
$(document).on('submit', '[js-open-comment-form]', function(event) {
    event.preventDefault();
    if (validateCheckboxForm(this)) {
        var formData = new FormData($('[js-open-comment-form]')[0]);
        addFilesToFormData(formData);

        saveDebate(formData);
    }
});

function saveDebate(formData) {
    $('[accept-debate]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "/performance-assessment/saveDebate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[js-menu-open-comment]').removeClass('is-open');
            checkBodyHidden();

            $('[data-item="' + formData.get('id') + '"]').find('.status').html('На рассмотрении');

            $('[accept-debate]').prop("disabled", false);
            hideLoader();
        },
        error: function (data) {
            $('[accept-debate]').prop("disabled", false);
            hideLoader();
        },
        beforeSend: function() {
            showLoader();
        },
        afterSend: function() {
            hideLoader();
        }
    });
}

$(document).on('change', '.wish-value', function() {
    var score = Number($(this).val());
    var scoreBlock = $('.wish-score');

    scoreBlock.removeClassWild("score_*");
    if (score > 0) {
        scoreBlock.addClass('score_green');
    } else if (score < 0) {
        scoreBlock.addClass('score_red');
    } else {
        scoreBlock.addClass('score_gray');
    }
    scoreBlock.html(score);
});
$(document).on('click', '[js-menu-update-percent-close-btn]', function(event){
    $('[js-menu-update-percent]').removeClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[js-update-percent]', function(event){
    event.preventDefault();
    $('[js-update-percent-form]').trigger('submit');
});
$(document).on('submit', '[js-update-percent-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-update-percent-form]')[0]);
        updatePlanPercent(formData);
    }
});
function updatePlanPercent(formData) {
    $('[js-update-percent]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "updatePlanPercents",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $.each(data, function(index, value) {
                $('[data-day="' + value.dayOfWeek + '"]').html(value.percent);
            });

            $('[js-menu-update-percent]').removeClass('is-open');
            checkBodyHidden();

            $('[js-update-percent]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-percent]').prop("disabled", false);
        }
    });
}




$(document).on('click', '[update-percent]', function(event){
    setPlanPercentInfo();
});
function setPlanPercentInfo(btn) {
    $('[update-percent]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getPlanPercents",
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $.each(data, function(index, value) {
                $('[day-of-week="' + value.dayOfWeek + '"]').val(value.percent);
            });

            setPercentsSum();

            $('[js-menu-update-percent]').addClass('is-open');
            checkBodyHidden();
            $('[update-percent]').prop("disabled", false);
        },
        error: function (data) {
            $('[update-percent]').prop("disabled", false);
        }
    });
}
function setPercentsSum() {
    var tempSum = getPercentSum();
    var sumBlock = $('[percents-sum]');

    if (tempSum < 100) {
        sumBlock.removeClass('grade-value_green').addClass('grade-value_red');
        $('[js-update-percent]').attr("disabled", "disabled");
    } else {
        sumBlock.removeClass('grade-value_red').addClass('grade-value_green');
        $('[js-update-percent]').removeAttr("disabled");
    }

    sumBlock.html(tempSum);
}
function getPercentSum() {
    var sum = 0;

    $('[day-of-week]').each(function() {
        sum += Number($(this).val());
    });

    return sum;
}

$(document).on('keyup', '[day-of-week]', function(event){
    var tempVal = $(this).val();

    if ($.isNumeric(tempVal) || tempVal === "") {
        var tempSum = getPercentSum();
        if (tempSum > 100) {
            $(this).val($(this).val() - (tempSum - 100));
        }
    } else {
        $(this).val('');
    }

    setPercentsSum();
});
$(document).on('click', '[js-update-product]', function(event){
    setProductInfo($(this));
});
function setProductInfo(btn) {
    var formData = new FormData();
    formData.set('id', btn.data('product'));

    $('[js-update-product]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getProduct",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setProductTypes(btn);

            $('[up-product-id]').val(data.id);
            $('[up-product-name]').val(data.name);
            $('[up-product-vendor]').val(data.vendorCode);
            $('[up-product-price]').val(data.price);
            $('[up-product-description]').val(data.description);
            $("input[up-product-theme][value=" + data.theme + "]").prop("checked", true);
            $('[up-product-bg]').val(data.backgroundColor);

            if(!data.isUsed) {
                $('[update-footer]').html($('[update-footer]').html() +
                '<button delete-product type="button" class="button button_white button_right">' +
                '    <span>Удалить</span>' +
                '</button>');
            }

            $('[js-menu-update]').addClass('is-open');
            checkBodyHidden();
            $('[js-update-product]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-product]').prop("disabled", false);
        }
    });
}
$(document).on('click', '[delete-product]', function(event){
    var formData = new FormData();
    var currentId = $('[up-product-id]').val();
    formData.set('id', currentId);

    $('[delete-product]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "deleteProduct",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[data-product="' + currentId + '"]').remove();
            closeUpdateProductMenu();

            $('[delete-product]').prop("disabled", false);
        },
        error: function (data) {
            $('[delete-product]').prop("disabled", false);
        }
    });
});
$(document).on('click', '[js-menu-update-close-btn]', function(event){
    closeUpdateProductMenu();
});
$(document).on('click', '[js-update]', function(event){
    event.preventDefault();
    $('[js-update-form]').trigger('submit');
});
$(document).on('submit', '[js-update-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-update-form]')[0]);
        updateProduct(formData);
    }
});
function updateProduct(formData) {
    $('[js-update]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "updateProduct",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateProductBlock(data);

            closeUpdateProductMenu();

            $('[js-update]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update]').prop("disabled", false);
        }
    });
}


$(document).on('click', '[js-create-product-type]', function(event){
    $('[js-menu-product-type]').addClass('is-open');
    setProjectInfo($(this));
    checkBodyHidden();
});

$(document).on('click', '[js-menu-product-type-close-btn]', function(event){
    $('[js-menu-product-type]').removeClass('is-open');
    $('[js-product-type-form]').trigger('reset');

    checkBodyHidden();
});

function setProjectInfo(btn) {
    var idProject = btn.closest('.products').data('project');
    $('[js-product-type-id-project]').val(idProject);

    var project = btn.closest('.products__title').find('.block-title').html();
    var projectTag = btn.closest('.products__title').find('.block-subtitle').html();
    $('[js-product-type-project]').html(project);
    $('[js-product-type-project-tag]').html(projectTag);
}

$(document).on('click', '[js-save-product-type]', function(event){
    event.preventDefault();
    $('[js-product-type-form]').trigger('submit');
});

$(document).on('submit', '[js-product-type-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-product-type-form]')[0]);
        saveProductType(formData);
    }
});

function saveProductType(formData) {
    $('[js-save-product-type]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveProductType",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            addProductType(data);

            $('[js-menu-product-type]').removeClass('is-open');
            $('[js-product-type-form]').trigger('reset');
            checkBodyHidden();
            $('[js-save-product-type]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-product-type]').prop("disabled", false);
        }
    });
}

function addProductType(data) {
    var projectProducts = $('[data-project="' + data.idProject + '"]');
    projectProducts.find('.tabs__list-wrapper').html('<div js-tab class="tab" data-tab="' + data.idProject + 'type' + data.id + '">' + data.name + '</div>'
        + projectProducts.find('.tabs__list-wrapper').html());

    projectProducts.find('.tabs__blocks').html(
        '<div js-tab-panel class="tab-content" data-type="2" data-tab="' + data.idProject + 'type' + data.id + '">' +
    '       <div class="tab-content__wrapper tab-content__wrapper_overflow-unset">' +
    '           <div class="products__list">' +
    '              <div js-create-product class="product-block product-block_create" data-type="' + data.id + '" data-project="' + data.idProject + '">' +
    '                  <div class="product-block__message">Добавить товар</div>' +
    '              </div>' +
    '          </div>' +
    '       </div>' +
    '    </div>' + projectProducts.find('.tabs__blocks').html());

    projectProducts.find('[js-tab]').first().trigger('click');
}


$(document).on('click', '[js-create-product]', function(event){
    $('[js-menu-product]').addClass('is-open');
    setProductTypes($(this));
    checkBodyHidden();
});

$(document).on('click', '[js-menu-product-close-btn]', function(event){
    closeProductMenu();
});

function closeProductMenu() {
    $('[js-menu-product]').removeClass('is-open');
    $('[js-product-form]').trigger('reset');

    $('.js-labelFile').removeClass('has-file');
    $('.js-fileName').html('Загрузите изображение (290x240px)');

    resetProductSelectors();
    checkBodyHidden();
}
function closeUpdateProductMenu() {
    $('[js-menu-update]').removeClass('is-open');
    $('[js-update-form]').trigger('reset');

    $('.js-labelFile').removeClass('has-file');
    $('.js-fileName').html('Загрузите изображение (290x240px)');

    $('[delete-product]').remove();
    resetProductSelectors();
    checkBodyHidden();
}
function setProductSelectors(btn) {
    $('[product-project]').val(btn.data('project'));

    var attr = btn.attr('data-type');
    if (typeof attr !== typeof undefined && attr !== false) {
        $('[product-type]').val(btn.data('type'));
    }
}

function resetProductSelectors() {
    $('[product-project] option:selected').removeAttr('selected');
    $('[product-type] option:selected').removeAttr('selected');
}
function setProductTypes(btn) {
    var formData = new FormData();
    formData.set('id', btn.data('project'));
    $.ajax({
        type: "POST",
        url: "getProductTypes",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var seloption = "";
            $.each(data, function(index, value){
                seloption += '<option value="' + value.id + '">' + value.name + '</option>';
            });

            $('[product-type]').html(seloption);
            // $('#js-product-type').html(seloption);

            setProductSelectors(btn);
        },
        error: function (data) {
            setProductSelectors(btn);
        }
    });
}

$(document).on('click', '[js-save-product]', function(event){
    event.preventDefault();
    $('[js-product-form]').trigger('submit');
});

$(document).on('submit', '[js-product-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-product-form]')[0]);
        saveProduct(formData);
    }
});

function saveProduct(formData) {
    $('[js-save-product]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveProduct",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            addProduct(data);
            addProductToCommon(data);

            closeProductMenu();

            $('[js-save-product]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-product]').prop("disabled", false);
        }
    });
}
function updateProductBlock(data) {
    var prodBlock = createProduct(data);

    var product = $('[js-tab-panel][data-type!="all"]').find('.product-block[data-product="' + data.id + '"]');
    var productCommon = $('[js-tab-panel][data-type="all"]').find('.product-block[data-product="' + data.id + '"]');

    productCommon.replaceWith(prodBlock);

    if (product.data('project') === data.idProject &&  product.data('type') === data.idProductType) {
        product.replaceWith(prodBlock);
    } else {
        product.remove();
        addProduct(data)
    }
}

function addProduct(data) {
    var productList = $('.products[data-project="' + data.idProject + '"]').find('[js-tab-panel][data-type="' + data.idProductType + '"]').find('.products__list');

    productList.html( createProduct(data)
        + productList.html());
}
function addProductToCommon(data) {
    var productList = $('.products[data-project="' + data.idProject + '"]').find('[js-tab-panel][data-type="all"]').find('.products__list');

    productList.html( createProduct(data)
        + productList.html());
}
function createProduct(data) {
    return '<div js-update-product data-product="' + data.id + '" data-project="' + data.idProject + '" data-type="' + data.idProductType + '" class="product-block" style="background: ' + data.backgroundColor + ';">' +
        '                 <div class="product-block__wrapper ' + data.theme + '" >'
        + (data.backgroundImage !== null ?
            '                    <div class="product-block__background">' +
            '                       <img src="/' + data.backgroundImage + '" alt="">' +
            '                     </div>' : '' ) +
        '                     <div class="product-block__title">' + data.name + '</div>' +
        '                     <div class="product-block__type">' + data.productType + '</div>' +
        '                     <div class="product-block__text product-block__text_gray">Арт: ' + data.vendorCode + '</div>' +
        '                     <div class="product-block__text product-block__text_desc">' + data.description + '</div>' +
        '                     <div class="product-block__price">' + numberWithSpaces(data.price) + ' ₽</div>' +
        '                 </div>' +
        '              </div>';
}

$(document).on('change', '[js-bg-default]', function(event){
    var isChecked = $(this).is(':checked');
    $("[js-bg-default]").prop("checked", false).attr("checked", false).removeAttr("checked");

    if (isChecked) {
        $(this).prop("checked", true);
    }
});

$(document).on('click', '[js-update-category]', function(event){
    setCategoryInfo($(this));
});
$(document).on('click', '[js-menu-update-category-close-btn]', function(event){
    $('[js-menu-update-category]').removeClass('is-open');
    checkBodyHidden();
    $('[js-update-category-form]').trigger('reset');
});
function setCategoryInfo(btn) {
    var formData = new FormData();
    formData.set('id', btn.closest('.tab').data('cat'));

    $('[js-update-category]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getCategory",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[js-update-category-id]').val(data.id);
            $('[js-update-category-project]').val(data.idProject);
            $('[js-update-category-name]').val(data.name);
            if (data.isEmpty) {
                $('[delete-category-block]').addClass('is-open');
            } else {
                $('[delete-category-block]').removeClass('is-open');
            }

            $('[js-menu-update-category]').addClass('is-open');
            checkBodyHidden();
            $('[js-update-category]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-category]').prop("disabled", false);
        }
    });
}
$(document).on('click', '[js-delete-category]', function(event){
    deleteCategory($(this));
});

function deleteCategory(btn) {
    var idProductType = btn.siblings('[name="idDelete"]').val();
    var idProject = btn.siblings('[name="idProject"]').val();
    var formData = new FormData();
    formData.set('id', idProductType);

    $('[js-delete-category]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "deleteCategory",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var categoryTab = $('[data-cat="' + idProductType + '"]').data('tab');
            $('[data-tab="' + categoryTab + '"]').remove();
            $('[data-project="' + idProject + '"]').find('[js-tab]').first().trigger('click');

            $('[js-menu-update-category]').removeClass('is-open');
            checkBodyHidden();
            $('[js-delete-category]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-delete-category]').prop("disabled", false);
        }
    });
}
$(document).on('click', '[js-save-update-category]', function(event){
    event.preventDefault();
    $('[js-update-category-form]').trigger('submit');
});
$(document).on('submit', '[js-update-category-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-update-category-form]')[0]);
        updateCategory(formData);
    }
});
function updateCategory(formData) {
    $('[js-save-update-category]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "updateCategory",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[js-tab][data-cat="' + data.id + '"]').find('span').html(data.name);
            $('.product-block[data-type="' + data.id + '"]').find('[category]').html(data.name);

            $('[js-menu-update-category]').removeClass('is-open');
            checkBodyHidden();

            $('[js-save-update-category]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-update-category]').prop("disabled", false);
        }
    });
}
$(document).ready(function() {
    $.each($(".progress-bar"), function(index, progressBar) {
        var progressWidth = $(progressBar).find('.progress-bar__progress').width();

        $.each($(progressBar).find('.progress-bar__text'), function(index, text) {
            var textWidth = $(text).width();
            var percent = (progressWidth - $(text).position().left)*100/textWidth;
            percent = percent > 100 ? 100 : percent;
            $(text).css({
                'background' : 'linear-gradient(90deg, rgba(255,255,255,1) 0%, rgba(255,255,255,1) ' + percent + '%, rgba(72,30,140,1) ' + percent + '%, rgba(72,30,140,1) 100%)',
                'webkitBackgroundClip' : 'text',
                'webkitTextFillColor' : 'transparent'
            });
        });
    });
});


$(document).on('click', '[js-save-project]', function(event){
    event.preventDefault();
    $('[js-project-form]').trigger('submit');
});
$(document).on('submit', '[js-project-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        saveProject($(this).serializeObject());
    }
});
function saveProject(requestData) {
    $('[js-save-project]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveProject",
        data: JSON.stringify(requestData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            addProjectOnList(data);
            $('[js-menu-create-project]').removeClass('is-open');
            checkBodyHidden();
            $('[js-project-form]').trigger('reset');
            $('[js-save-project]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-project]').prop("disabled", false);
        }
    });
}
function addProjectOnList(data) {
    $('[projects-table]').html(
        $('[projects-table]').html() +
        '<tr class="custom-table__body-row">' +
        '<input type="hidden" p-id value="'+ data.id + '" name="id" required>' +
        '<input type="hidden" p-id-company value="' + data.idCompany + '" name="idCompany" required>' +
        '                        <td class="custom-table__body-col">' + data.id + '</td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_xxxlarge" >' +
        '                            <input p-name name="name"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + data.name + '"' +
        '                                   value="' + data.name + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_last">' +
        '                            <div edit-btns class="column-links display-flex-none">' +
        '                                <div edit-project-accept class="column_mwidth column_mwidth-accept"></div>' +
        '                                <div edit-project-cancel class="column_mwidth column_mwidth-cancel"></div>' +
        '                            </div>' +
        '                            <div edit-menu class="column-links display-flex-none is-open">' +
        '                                <div edit-project class="column_mwidth div-table__body-col_center column_mwidth-edit column_mwidth-edit-b"></div>' +
        '                            </div>' +
        '                        </td>' +
        '                    </tr>'
    );
}

$(document).on('click', '[js-create-project]', function(event){
    $('[js-menu-create-project]').addClass('is-open');
    checkBodyHidden();
});

$(document).on('click', '[js-menu-create-project-close-btn]', function(event){
    $('[js-menu-create-project]').removeClass('is-open');
    $('[js-project-form]').trigger('reset');
    checkBodyHidden();
});


var PROJECTS_INFO_TEMP = {};
$(document).on('click', '[edit-project]', function(event){
    event.preventDefault();
    $(this).closest('[edit-menu]').removeClass('is-open').siblings('[edit-btns]').addClass('is-open');
    var list = {};

    var name = $(this).closest('.custom-table__body-row').find('[p-name]');
    name.removeAttr('disabled');
    list['name'] = name.val();

    $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
    PROJECTS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[p-id]').val()] = list;
});

$(document).on('click', '[edit-project-cancel]', function(event){
    event.preventDefault();
    var values = PROJECTS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[p-id]').val()];

    $(this).closest('.custom-table__body-row').find('[p-name]').val(values.name).attr("disabled", true);

    $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
    delete PROJECTS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[p-id]').val()];
});

$(document).on('click', '[edit-project-accept]', function(event){
    event.preventDefault();
   PROJECT_ACCEPT_BTN = $(this);

    var requestData = new Object();
    requestData.id = $(this).closest('.custom-table__body-row').find('[p-id]').val();
    requestData.name = $(this).closest('.custom-table__body-row').find('[p-name]').val();

    $('[edit-project-accept]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateProject",
        data: JSON.stringify(requestData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            PROJECT_ACCEPT_BTN.closest('.custom-table__body-row').find('[p-name]').val(data.name).attr("disabled", true);

            PROJECT_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
            delete PROJECTS_INFO_TEMP[data.id];

            $('[edit-project-accept]').prop("disabled", false);
        },
        error: function (data) {
            var values = PROJECTS_INFO_TEMP[requestData.id];

            PROJECT_ACCEPT_BTN.closest('.custom-table__body-row').find('[p-name]').val(values.name).attr("disabled", true);

            PROJECT_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
            delete PROJECTS_INFO_TEMP[data.id];
            $('[edit-user-accept]').prop("disabled", false);
        }
    });
});
$(document).on('change', '[qs-filter]', function() {
    $('[qs-filter-form]').trigger('submit');
});
var CURRENT_BTN;
$(document).on('click', '[add-rate]', function() {
    CURRENT_BTN = $(this);
    setDescription();
    setFields();
    $('[js-menu-rate]').addClass('is-open');
    checkBodyHidden();
});
function setDescription() {
    var root = CURRENT_BTN.closest('.custom-table__body-row');

    $('[rate-avatar]').html(root.find('[avatar]').html());
    $('[rate-employee-name]').html(root.find('[employee-name]').html());
    $('[rate-employee-position]').html(root.find('[employee-position]').html());
    $('[rate-employee-department]').html(root.closest('.template-setting').find('[department]').html());

    $('[rate-id-setting]').val(root.find('[data-setting]').data('setting'));
    $('[rate-id-template]').val(root.find('[data-template]').data('template'));
    $('[rate-day]').val(CURRENT_BTN.closest('[data-day]').data('day'));

    $('[rate-date ]').html(
        ("00" + CURRENT_BTN.closest('[data-day]').data('day')).slice(-2)
        + '.' +  ("00" + $('#month').val()).slice(-2)
        + '.' + $('#year').val());
}
function setFields() {
    var idTemplate = CURRENT_BTN.closest('.custom-table__body-row').find('[data-template]').data('template');

    var jsonItem = {};
    jsonItem['id'] = idTemplate;
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getFields",
        data: JSON.stringify(jsonItem),
        dataType: 'json',
        cache: false,
        success: function (data) {
            var fields = $('[rate-fields]');
            $.each(data, function(index, field) {
                fields.html(fields.html() +
                '<div class="menu-rate-field">' +
                    '<input type="hidden" name="fields[' + index + '].field.fieldId" value="' + field.fieldId + '">' +
                    '   <div class="menu-rate-field__title">' + field.fieldName + '</div>' +
                    '   <div rate-filed class="menu-rate-field__rate">' +
                    '       <div class="rate-block">' +
                    '           <div class="rate-block__wrapper">' +
                    '               <div class="rate-block__btn">' +
                    '                   <input type="radio" id="like' + index + '" class="radio radio_like rate-value" name="fields[' + index + '].value" value="' + field.fieldValue + '" required>' +
                    '                   <label for="like' + index + '" class="label"></label>' +
                    '               </div>' +
                    '               <div class="rate-block__btn">' +
                    '                   <input type="radio" id="dislike' + index + '" class="radio radio_dislike rate-value" name="fields[' + index + '].value" value="0" required>' +
                    '                   <label for="dislike' + index + '" class="label"></label>' +
                    '               </div>' +
                    '           </div>' +
                    '       </div>' +
                    '       <div class="grade grade_right">' +
                    '       <div class="grade__values grade__values_without-margin">' +
                    '           <span field-value class="grade-value grade-value_bold">—</span>' +
                    '       </div>' +
                    '    </div>' +
                    '</div>' +
                    '<div class="menu-input menu-input_mt">' +
                    '     <div class="menu-input__title">Ваш комментарий</div>' +
                    '     <div class="menu-input__wrapper">' +
                    '        <textarea name="fields[' + index + '].comment" placeholder="Введите ваш комментарий" class="menu-input__input menu-input__input_textarea menu-input__input_small"></textarea>' +
                    '     </div>' +
                    '</div>' +
                    '<div class="rate-img">' +
                    '   <div class="rate-img__wrapper">' +
                    '       <input type="file" name="fields[' + index + '].img" accept="image/*,image/jpeg" id="fileUpdate' + index + '" class="input-file">' +
                    '       <label for="fileUpdate' + index + '" class="js-labelFile rate-img__label js-upload-banner">' +
                    '           <span class="menu-input__title rate-image__title js-fileName">Загрузите изображение</span>' +
                    '       </label>' +
                    '   </div>' +
                    '</div>' +
                '</div>'
                );
            });
        },
        error: function (data) {

        }
    });

}
$(document).on('click', '[js-menu-rate-close-btn]', function(event) {
    $('[js-menu-rate]').removeClass('is-open');
    checkBodyHidden();

    resetForm();
});
function resetForm() {
    $('[rate-fields]').html('');
    $('[total-rate-value]').val(0);
    $('[total-fields-value]').html(0);

    $('[js-rate-form]').trigger('reset');
}


$(document).on('change', '.rate-value', function() {
    var rate = Number($(this).val());
    $(this).closest('[rate-filed]').find('[field-value]').html(rate);

    countRateTotalValue();
});
function countRateTotalValue() {
    var total = 0;
    $.each($('.rate-value:checked'), function(index){
        total += Number($(this).val())
    });

    $('[total-rate-value]').val(total);
    $('[total-fields-value]').html(total);
}


$(document).on('click', '.rate-star', function(event) {
    var rate = Number($(this).html());
    $(this).closest('[rate-filed]').find('[rate-start]').val(rate);

    var stars = $(this).closest('.rate-stars').find('.rate-star');
    $.each(stars, function(index){
        if (index < rate) {
            $(this).addClass('active');
        } else {
            $(this).removeClass('active');
        }
    });

    countRateValue($(this).closest('[rate-filed]'), rate);
});

function countRateValue(element, rate) {
    var max = Number(element.find('[field-max]').html());

    var value = Math.round(max / 5 * rate);
    element.find('[field-value]').html(value);
    element.find('[rate-value]').val(value);

    countRateValueSum();
}


function countRateValueSum() {
    var total = 0;
    $.each($('[field-value]'), function(index){
        total += Number($(this).html())
    });

    $('[total-rate-value]').val(total);
    $('[total-fields-value]').html(total);
}

$(document).on('click', '[js-save-rate]', function (event) {
    event.preventDefault();
    $('[js-rate-form]').trigger('submit');
});

$(document).on('submit', '[js-rate-form]', function(event) {
    event.preventDefault();
    if (validateCheckboxForm(this)) {
        var formData = new FormData($('[js-rate-form]')[0]);
        saveRate(formData);
    }
});

function saveRate(formData) {
    $('[js-save-rate]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveRate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[js-menu-rate]').removeClass('is-open');
            checkBodyHidden();

            resetForm();

            var total = Number(formData.get('total'));
            CURRENT_BTN.html(total);
            CURRENT_BTN.removeAttr("add-rate").attr({'data-rate': data, 'update-rate': ''});

            CURRENT_BTN.addClass(total >= 90 ? 'rate_green' : (total > 50 ? 'rate_yellow' : 'rate_red'));

            setTotalEmployeeRate(formData.get('idSetting'));

            $('[js-save-rate]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-rate]').prop("disabled", false);
        }
    });
}

function setTotalEmployeeRate(idSetting) {
    var jsonItem = {};
    jsonItem['id'] = Number(idSetting);

    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/rating/getEmployeeTotalRate",
        data: JSON.stringify(jsonItem),
        dataType: 'json',
        cache: false,
        success: function (data) {
            var totalElement = CURRENT_BTN.closest('.custom-table__body-row').find('[total-emloyee-rate]');
            totalElement.removeClass("grade-value_green grade-value_yellow grade-value_red");
            totalElement.addClass(data >= 90 ? 'grade-value_green' : (data > 50 ? 'grade-value_yellow' : 'grade-value_red'));
            totalElement.html(data);
        },
        error: function (data) {
        }
    });
}

$(document).on('click', '[js-debate-rate-btn]', function (event) {
    var jsonItem = {};
    jsonItem['id'] = Number($(this).siblings('[name="id"]').val());

    var attrCheck = $(this).attr('examiner');

    $('[js-debate-rate-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/rating/getFullRateInformation",
        data: JSON.stringify(jsonItem),
        dataType: 'json',
        cache: false,
        success: function (data) {

            if (typeof attrCheck === typeof undefined || attrCheck === false) {
                setRateInformation(data, false);
            } else {
                setRateInformation(data, true);
            }


            $('[js-menu-debate-rate]').addClass('is-open');
            checkBodyHidden();

            $('[js-debate-rate-btn]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-debate-rate-btn]').prop("disabled", false);
        }
    });
});

function setRateInformation(data, isExaminer) {
    $('[rate-id]').val(data.id);
    $('[rate-id-setting]').val(data.idSetting);
    $('[total-fields-value]').html(data.total);
    $('[rate-date]').html(data.date);

    $('[rate-employee-name]').html(data.employee.name);
    $('[rate-employee-position]').html(data.employee.position);
    $('[rate-employee-department]').html(data.employee.department);
    $('[rate-avatar]').html('<span class="avatar-image ' + (data.employee.avatar === null || data.employee.avatar === '' ? 'avatar-image_default' : '') + '" >' +
        (data.employee.avatar === null || data.employee.avatar === '' ? '' : '<img src="/' + data.employee.avatar + '" alt="">') +
        '</span>');

    var fields = $('[rate-fields]');
    $.each(data.fields, function(index, field) {

        fields.html(fields.html() +
            '<div class="menu-rate-field">' +
            '<input type="hidden" name="fields[' + index + '].id" value="' + field.id + '">' +
            '   <div class="menu-rate-field__title">' + field.field.fieldName + '</div>' +
            '   <div rate-filed class="menu-rate-field__rate">' +
            '       <div class="rate-block">' +
            '           <div class="rate-block__wrapper">' +
            '               <div class="rate-block__btn">' +
            '                   <input class="radio active ' + (field.value === 0 ? 'radio_dislike' : 'radio_like') + '">' +
            '                   <label class="label"></label>' +
            '               </div>' +
            '           </div>' +
            '       </div>' +

            '       <div class="grade grade_right">' +
            '       <div class="grade__values grade__values_without-margin">' +
            '           <span class="grade-value grade-value_bold">' + field.value + '</span>' +
            '       </div>' +
            '    </div>' +
            '</div>' +
            '<div class="menu-input menu-input_mt">' +
            '     <div class="menu-input__title">Комментарий специалиста по контролю</div>' +
            '     <div class="menu-input__wrapper">' +
            '        <div placeholder="" class="menu-input__input menu-input__input_textarea menu-input__input_textarea_disabled menu-input__input_small">' + field.comment + '</div>' +
            '     </div>' +
            '</div>' +
            '<div class="rate-img">' +
            '   <div class="rate-img__wrapper">' +
            ((field.imgPath !==  null)
             ?
                '<a class="rate-image" data-fancybox="gallery" href="/' + field.imgPath + '"><img src="/' + field.imgPath + '"></a>'
             :
                '<div class="js-upload-banner rate-image__banner"></div>') +
            '   </div>' +
            '</div>' +
            '<div class="menu-input menu-input_mt">' +
            '     <div class="menu-input__title">' + ((isExaminer) ? 'Комментарий сотрудника' : 'Ваш комментарий') +  '</div>' +
            '     <div class="menu-input__wrapper">' +
            ((isExaminer) ?
            '        <div placeholder="Введите ваш комментарий" class="menu-input__input menu-input__input_textarea menu-input__input_textarea_disabled menu-input__input_small">' + field.exComment + '</div>'
            :
            '       <textarea name="fields[' + index + '].exComment" placeholder="Введите ваш комментарий" class="menu-input__input menu-input__input_textarea menu-input__input_small"></textarea>'
            ) +
            '     </div>' +
            '</div>' +
            '</div>'
        );
    });
}

$(document).on('click', '[js-menu-debate-rate-close-btn]', function(event) {
    $('[js-menu-debate-rate]').removeClass('is-open');
    checkBodyHidden();

    resetDebateForm();
});

function resetDebateForm() {
    $('[rate-fields]').html('');
    $('[total-fields-value]').html(0);

    $('[js-debate-rate-form]').trigger('reset');
}

$(document).on('click', '[js-debate-rate]', function(event) {
    event.preventDefault();
    $('[js-debate-rate-form]').trigger('submit');
});

$(document).on('submit', '[js-debate-rate-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-debate-rate-form]')[0]);
        debateRate(formData);
    }
});

function debateRate(formData) {
    $('[js-debate-rate]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "debateRate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[js-menu-debate-rate]').removeClass('is-open');
            checkBodyHidden();

            resetDebateForm();

            var btn = $('[data-rating="' + formData.get("id") + '"]').find('[js-debate-rate-btn]')
            btn.removeAttr("js-debate-rate-btn");
            btn.addClass('button_debate');
            btn.find('span').html('На рассмотрении');

            $('[js-debate-rate]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-debate-rate]').prop("disabled", false);
        }
    });
}

var ID_RATE_TEMP;

$(document).on('click', '[apply]', function(event) {
    event.preventDefault();
    $('[dialog]').find('.dialog__title').html('Вы действительно согласны с претензией?');
    $('[dialog]').find('.dialog__text').html('Оценка будет удалена');
    $('[dialog]').find('[accept-dialog]').attr('apply-debate', '');
    $('[dialog]').addClass('is-open');

    ID_RATE_TEMP = Number($(this).closest('.apply-block').siblings('[name="id"]').val());
});
$(document).on('click', '[reject]', function(event) {
    event.preventDefault();
    $('[dialog]').find('.dialog__title').html('Вы действительно хотите отклонить претензию?');
    $('[dialog]').find('.dialog__text').html('Оценка будет учитываться');
    $('[dialog]').find('[accept-dialog]').attr('reject-debate', '');
    $('[dialog]').addClass('is-open');

    ID_RATE_TEMP = Number($(this).closest('.apply-block').siblings('[name="id"]').val());
});
$(document).on('click', '[close-dialog]', function(event) {
    removeAcceptBtnAttribute($(this).siblings('[accept-dialog]'));
    $(this).closest('.dialog').removeClass('is-open');
});
$(document).on('click', '[apply-debate]', function(event) {
    event.preventDefault();
    $('[dialog]').removeClass('is-open');
    removeAcceptBtnAttribute($(this));
    debate("applyDebate");

    $('[js-menu-debate-rate]').removeClass('is-open');
    checkBodyHidden();

    resetDebateForm();

});
function debate(link) {
    var jsonItem = {};
    jsonItem['id'] = Number(ID_RATE_TEMP);

    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: link,
        data: JSON.stringify(jsonItem),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[data-rating="' + ID_RATE_TEMP + '"]').remove();
        },
        error: function (data) {
        }
    });
}

$(document).on('click', '[reject-debate]', function(event) {
    event.preventDefault();
    $('[dialog]').removeClass('is-open');

    removeAcceptBtnAttribute($(this));
    debate("rejectDebate");


    $('[js-menu-debate-rate]').removeClass('is-open');
    checkBodyHidden();

    resetDebateForm();
});



$(document).on('mouseenter', '.c-tooltip', function(event) {
    var topOffset = -10;
    var content = $(this).find('.tooltip-content').html();
    var tooltip = $('.tooltip-wrapper');

    if (typeof content !== "undefined" && content !== '') {
        var rect = $(this)[0].getBoundingClientRect();
        tooltip.css({top: $(window).scrollTop() + rect.top + topOffset, left: rect.left});
        tooltip.html(content);
        tooltip.addClass('show');
    }
});
$(document).on('mouseleave', '.c-tooltip', function(event) {
    var tooltip = $('.tooltip-wrapper');
    tooltip.html('');
    tooltip.removeClass('show');
});

$(document).on('click', '[update-rate]', function () {
    CURRENT_BTN = $(this);

    var jsonItem = {};
    jsonItem['id'] = Number($(this).attr('data-rate'));

    $('[update-rate]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/rating/getFullRateInformation",
        data: JSON.stringify(jsonItem),
        dataType: 'json',
        cache: false,
        success: function (data) {
            setUpdateRateInformation(data);

            $('[js-menu-update-rate]').addClass('is-open');
            checkBodyHidden();

            $('[update-rate]').prop("disabled", false);
        },
        error: function (data) {
            $('[update-rate]').prop("disabled", false);
        }
    });
});

$(document).on('click', '[js-menu-update-rate-close-btn]', function () {
    $('[js-menu-update-rate]').removeClass('is-open');
    checkBodyHidden();

    resetUpdateForm();
});
function resetUpdateForm() {
    $('[u-rate-fields]').html('');
    $('[total-rate-value]').val(0);
    $('[total-fields-value]').html(0);

    $('[js-update-rate-form]').trigger('reset');
}

function setUpdateRateInformation(data) {
    $('[u-rate-id]').val(data.id);
    $('[u-rate-id-setting]').val(data.idSetting);
    $('[total-fields-value]').html(data.total);
    $('[total-rate-value]').val(data.total);
    $('[u-rate-date]').html(data.date);

    $('[u-rate-employee-name]').html(data.employee.name);
    $('[u-rate-employee-position]').html(data.employee.position);
    $('[u-rate-employee-department]').html(data.employee.department);
    $('[u-rate-avatar]').html('<span class="avatar-image ' + (data.employee.avatar === null || data.employee.avatar === '' ? 'avatar-image_default' : '') + '" >' +
        (data.employee.avatar === null || data.employee.avatar === '' ? '' : '<img src="/' + data.employee.avatar + '" alt="">') +
        '</span>');

    var fields = $('[u-rate-fields]');
    $.each(data.fields, function(index, field) {

        fields.html(fields.html() +
            '<div class="menu-rate-field">' +
            '<input type="hidden" name="fields[' + index + '].id" value="' + field.id + '">' +
            '   <div class="menu-rate-field__title">' + field.field.fieldName + '</div>' +
            '   <div rate-filed class="menu-rate-field__rate">' +
            '       <div class="rate-block">' +
            '           <div class="rate-block__wrapper">' +
            '               <div class="rate-block__btn">' +
            '                   <input ' + (field.value !== 0 ? 'checked' : '') + ' type="radio" id="like' + index + '" class="radio radio_like rate-value" name="fields[' + index + '].value" value="' + field.field.fieldValue + '" required>' +
            '                   <label for="like' + index + '" class="label"></label>' +
            '               </div>' +
            '               <div class="rate-block__btn">' +
            '                   <input ' + (field.value === 0 ? 'checked' : '') + ' type="radio" id="dislike' + index + '" class="radio radio_dislike rate-value" name="fields[' + index + '].value" value="0" required>' +
            '                   <label for="dislike' + index + '" class="label"></label>' +
            '               </div>' +
            '           </div>' +
            '       </div>' +
            '       <div class="grade grade_right">' +
            '       <div class="grade__values grade__values_without-margin">' +
            '           <span field-value class="grade-value grade-value_bold">' + field.value + '</span>' +
            '       </div>' +
            '    </div>' +
            '</div>' +
            '<div class="menu-input menu-input_mt">' +
            '     <div class="menu-input__title">Ваш комментарий</div>' +
            '     <div class="menu-input__wrapper">' +
            '        <textarea name="fields[' + index + '].comment" placeholder="Введите ваш комментарий" class="menu-input__input menu-input__input_textarea menu-input__input_small">' + field.comment + '</textarea>' +
            '     </div>' +
            '</div>' +
            '<div class="rate-img">' +
            '   <div class="rate-img__wrapper">' +
            ((field.imgPath !==  null)
                ?
                '<a class="rate-image" data-fancybox="gallery" href="/' + field.imgPath + '"><img src="/' + field.imgPath + '"></a>'
                :
                '       <input type="file" name="fields[' + index + '].img" accept="image/*,image/jpeg" id="fileUpdate' + index + '" class="input-file">' +
                '       <label for="fileUpdate' + index + '" class="js-labelFile rate-img__label js-upload-banner">' +
                '           <span class="menu-input__title rate-image__title js-fileName">Загрузите изображение</span>' +
                '       </label>') +
            '   </div>' +
            '</div>' +
            '</div>'
        );
    });
}

$(document).on('click', '[js-update-rate]', function (event) {
    event.preventDefault();
    $('[js-update-rate-form]').trigger('submit');
});

$(document).on('submit', '[js-update-rate-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-update-rate-form]')[0]);
        updateRate(formData);
    }
});

function updateRate(formData) {
    $('[js-update-rate]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "updateRate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[js-menu-update-rate]').removeClass('is-open');
            checkBodyHidden();

            resetUpdateForm();

            var total = Number(formData.get('total'));
            CURRENT_BTN.html(total);

            CURRENT_BTN.removeClass("rate_green rate_yellow rate_red");
            CURRENT_BTN.addClass(total >= 90 ? 'rate_green' : (total > 50 ? 'rate_yellow' : 'rate_red'));

            setTotalEmployeeRate(formData.get('idSetting'));

            $('[js-update-rate]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-rate]').prop("disabled", false);
        }
    });
}

function validateCheckboxForm(form) {

    $(form).validate({
        onkeyup: false,
        onfocusout: false,
        errorPlacement: function(label, element) {
            label.addClass('error-wrapper');
            label.insertAfter(element.siblings('label').last());
        },
        wrapper: 'span'
    });
    $(form).rules('add', {
        messages: {
            required: 'Заполните это поле.',
        }
    });

    return $(form).valid();
}

var FORM_TMP;
$(document).on('click', '[js-delete-rate]', function(event) {
    event.preventDefault();
    $('[dialog]').find('.dialog__title').html('Вы действительно хотите удалить оценку?');
    $('[dialog]').find('.dialog__text').html('Оценка будет удалена');
    $('[dialog]').find('[accept-dialog]').attr('remove-rate', '');
    $('[dialog]').addClass('is-open');
});
$(document).on('click', '[remove-rate]', function(event) {
    event.preventDefault();
    $('[dialog]').removeClass('is-open');
    removeAcceptBtnAttribute($(this));
    deleteRate($('[js-update-rate-form]').serializeObject());
});
function deleteRate(formData) {
    var jsonItem = {};
    jsonItem['id'] = formData['id'];

    $('[js-delete-rate]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "removeRate",
        data: JSON.stringify(jsonItem),
        dataType: 'json',
        cache: false,
        success: function (data) {

            $('[js-menu-update-rate]').removeClass('is-open');
            checkBodyHidden();

            resetUpdateForm();

            CURRENT_BTN.html('—');

            CURRENT_BTN.removeClass("rate_green rate_yellow rate_red");
            CURRENT_BTN.removeAttr("update-rate").removeAttr("data-rate").attr('add-rate', '');

            setTotalEmployeeRate(formData['idSetting']);

            $('[js-delete-rate]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-delete-rate]').prop("disabled", false);
        }
    });
}

$(document).on('change', '[qs-filter]', function() {
    $('[qs-filter-form]').trigger('submit');
});

var JSON_OBJECT = [];
$(document).on('change', '[template-setting]', function() {
    var jsonItem = {};
    jsonItem['year'] = $('#year').val();
    jsonItem['month'] = $(this).closest('[data-month]').data('month');
    jsonItem['idEmployee'] = $(this).closest('[data-employee]').data('employee');
    jsonItem['idDepartment'] = $(this).closest('[data-department]').data('department');
    jsonItem['idTemplate'] = Number($(this).val());

    JSON_OBJECT.push(jsonItem);
    check(JSON_OBJECT);
});
function check(jsonObj) {
    jsonObj.length > 0 ? $('.drop-message').addClass('active') : $('.drop-message').removeClass('active');
}

$(document).on('click', '[setting-btn]', function (event) {
    event.preventDefault();
    $('[setting-form]').trigger('submit');
});

$(document).on('submit', '[setting-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        saveSettings(JSON_OBJECT);
    }
});
function saveSettings(json) {
    $('[setting-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveSettings",
        data: JSON.stringify(json),
        dataType: 'json',
        cache: false,
        success: function (data) {
            JSON_OBJECT = [];
            check(JSON_OBJECT);

            $('[setting-btn]').prop("disabled", false);
        },
        error: function (data) {
            $('[setting-btn]').prop("disabled", false);
        }
    });
}
function getLevelField() {
    return '<div class="rate-level">' +
        '<input rate-level js-rate-level name="templateCoefficients[0].level" type="hidden" value="1">' +
        '<div class="menu-input__input menu-input__input_small menu-input__input_level">1</div>' +
        '<div class="rate-filed__wrapper menu-input__input_level-filed">' +
        '<input rate-level-from name="templateCoefficients[0].levelFrom" autocomplete="off" class="menu-input__input menu-input__input_small " placeholder="0" required>' +
        '</div>' +
        '<div class="level-reverse"></div>' +
        '<div class="rate-filed__wrapper menu-input__input_level-filed">' +
        '<input rate-level-to name="templateCoefficients[0].levelTo" autocomplete="off" class="menu-input__input menu-input__input_small" placeholder="0" required>' +
        '</div>' +
        '<div class="rate-filed__wrapper menu-input__input_rate-value">' +
        '<input rate-level-coef name="templateCoefficients[0].levelCoefficient" autocomplete="off" class="menu-input__input menu-input__input_small " placeholder="0.0" required>' +
        '</div>' +
        '<div class="rate-level__delete"></div>' +
        '</div>';
}

function getRateField() {
    return '<div class="rate-filed">' +
        '<div class="rate-filed__wrapper menu-input__input_rate-filed">' +
        '<input field-name name="templateFields[0].fieldName" autocomplete="off" class="menu-input__input menu-input__input_small " placeholder="Введите название пункта" required>' +
        '</div>' +
        '<div class="rate-filed__wrapper menu-input__input_rate-value">' +
        '<input field-value grade-value name="templateFields[0].fieldValue" autocomplete="off" class="menu-input__input menu-input__input_small " placeholder="0" required>' +
        '</div>' +
        '<div class="rate-field__delete"></div>' +
        '</div>'
}

$(document).on('click', '[js-create-template]', function(event){
    $('[js-menu-create-template]').addClass('is-open');
    $('[js-template-form-department]').val($(this).closest('[data-department]').data('department'));
    checkBodyHidden();
});
$(document).on('click', '[js-menu-create-template-close-btn]', function(event){
    $('[js-menu-create-template]').removeClass('is-open');
    checkBodyHidden();
    resetTemplateForm();
});
function resetTemplateForm() {
    $('[js-template-form]').trigger('reset');

    $('input:checkbox[name="metrics"]').attr('checked', false).prop("checked", false);

    $('.rate-fields').html(getRateField());
    setGradeValuesSum();

    $('.rate-levels').html(getLevelField());
    setLevels();
}
function recountRateField() {
    $('[field-name]').each(function(index) {
        $(this).attr("name", "templateFields[" + index + "].fieldName");
    });
    $('[field-value]').each(function(index) {
        $(this).attr("name", "templateFields[" + index + "].fieldValue");
    });
}
function recountRateLevel() {
    $('[rate-level]').each(function(index) {
        $(this).attr("name", "templateCoefficients[" + index + "].level");
    });
    $('[rate-level-from]').each(function(index) {
        $(this).attr("name", "templateCoefficients[" + index + "].levelFrom");
    });
    $('[rate-level-to]').each(function(index) {
        $(this).attr("name", "templateCoefficients[" + index + "].levelTo");
    });
    $('[rate-level-coef]').each(function(index) {
        $(this).attr("name", "templateCoefficients[" + index + "].levelCoefficient");
    });
}
$(document).on('click', '.rate-field__delete', function(event) {
    $(this).closest('.rate-filed').remove();
    setGradeValuesSum();
    recountRateField();
});
$(document).on('keyup', '[rate-level-from]', function(event){
    var tempVal = $(this).val();

    if (!$.isNumeric(tempVal)) {
        $(this).val('');
    }
});
$(document).on('keyup', '[rate-level-to]', function(event){
    var tempVal = $(this).val();

    if (!$.isNumeric(tempVal)) {
        $(this).val('');
    }
});
$(document).on('keyup', '[rate-level-coef]', function(event){
    var tempVal = $(this).val();

    if (!$.isNumeric(tempVal) && tempVal !== ".") {
        $(this).val('');
    }
});
$(document).on('keyup', '[grade-value]', function(event){
    var tempVal = $(this).val();

    if ($.isNumeric(tempVal) || tempVal === "") {
        var tempSum = sumGradeValues();
        if (tempSum > 100) {
            $(this).val($(this).val() - (tempSum - 100));
        }
    } else {
        $(this).val('');
    }

    setGradeValuesSum();
});
$(document).on('click', '[js-add-rate-filed]', function(event){
    var rateFields = $('.rate-fields');

    var tempLast = rateFields.find('.rate-filed').last();
    var titles = rateFields.find('.rate-titles');

    if (tempLast.length !== 0) {
        tempLast.after(getRateField());
        recountRateField();
    } else {
        titles.after(getRateField());
    }
});
function setGradeValuesSum() {
    var tempSum = sumGradeValues();
    var sumBlock = $('[grade-values-sum]');

    if (tempSum < 100) {
        sumBlock.removeClass('grade-value_green').addClass('grade-value_red');
        $('[js-save-template]').attr("disabled", "disabled");
    } else {
        sumBlock.removeClass('grade-value_red').addClass('grade-value_green');
        $('[js-save-template]').removeAttr("disabled");
    }

    sumBlock.html(tempSum);
}
function sumGradeValues() {
    var sum = 0;

    $('[grade-value]').each(function() {
        sum += Number($(this).val());
    });

    return sum;
}



const $tabs = $('[js-tab]');
const $tabPanels = $('[js-tab-panel]');

$(document).on('click', '[js-tab]', function(event) {
    var $currentTab = $(this);
    var currentActiveId = $currentTab.data('tab');

    $tabs.removeClass('active');
    $currentTab.addClass('active');

    $tabPanels.removeClass('is-open').filter('[data-tab=' + currentActiveId + ']').addClass('is-open');
});



$(document).on('click', '[js-add-rate-level]', function(event){
    var rateLevels = $('.rate-levels');

    var tempLast = rateLevels.find('.rate-level').last();
    var titles = rateLevels.find('.rate-titles');

    if (tempLast.length !== 0) {
        tempLast.after(getLevelField());
        recountRateLevel();
    } else {
        titles.after(getLevelField());
    }

    setLevels();
});
$(document).on('click', '.rate-level__delete', function(event) {
    $(this).closest('.rate-level').remove();
    setLevels();
    recountRateLevel();
});
function setLevels() {
    $('.menu-input__input_level').each(function(index) {
        $(this).html(index + 1);
    });
    $('[js-rate-level]').each(function(index) {
        $(this).val(index + 1);
    });
}

$(document).on('click', '[js-save-template]', function (event) {
    event.preventDefault();
    var attr = $(this).attr('disabled');
    if (typeof attr === typeof undefined || attr === false) {
        $('[js-template-form]').trigger('submit');
    }
});

$(document).on('submit', '[js-template-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-template-form]')[0]);
        saveTemplate(formData);
    }
});

function saveTemplate(formData) {
    $('[js-save-template]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveTemplate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            createTemplate(data);

            $('[js-menu-create-template]').removeClass('is-open');
            checkBodyHidden();
            resetTemplateForm();

            $('[js-save-template]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-template]').prop("disabled", false);
        }
    });
}
function createTemplate(data) {
    var templateList = $('[data-department="' + data.idDepartment + '"]').find('.templates__list');

    var fields = "";
    $.each(data.templateFields, function(index, field){
        fields +=  '<div class="template-field">' +
            '   <div class="template-field__title" >' + field.fieldName + '</div>' +
            '   <div class="template-field__value" >' + field.fieldValue + '</div>' +
            '</div>';
    });

    var coeffs = ""
    $.each(data.templateCoefficients, function(index, coeff){
        coeffs +=  '<div class="c-tooltip__text c-tooltip__text_flex">' +
            '   <span>' + coeff.levelFrom + ' - ' + coeff.levelTo + '</span>' +
            '   <span class="c-tooltip__note">' + coeff.levelCoefficient + '</span>' +
            '</div>';
    });

    var metrics = ""
    $.each(data.metrics, function(index, metric){
        metrics +=  '<div class="c-tooltip__text">' + metric.name + '</div>';
    });

    templateList.html(
        '<div class="template" data-template="' + data.id + '">' +
        '   <div class="template__header">' +
        '       <div class="template-title" >' + data.name + '</div>' +
        '   </div>' +
        '   <div class="template__fields template__fields_told custom-scroll">' +
                fields +
        '   </div>' +
        '   <div class="template__fields">' +
        '       <div class="template-field">' +
        '           <div class="template-field__title">Коэффициенты</div>' +
        '           <div class="template-field__tooltip c-tooltip">' +
        '               <div class="c-tooltip__wrapper c-tooltip__wrapper_medium">' +
                                coeffs +
        '               </div>' +
        '               <span>' +
                                 data.templateCoefficients[0].levelCoefficient + ' - ' + data.templateCoefficients[data.templateCoefficients.length - 1].levelCoefficient +
        '                </span>' +
        '            </div>' +
        '        </div>' +
        '        <div class="template-field">' +
        '            <div class="template-field__title">Метрики учитываются</div>' +
        '            <div class="template-field__tooltip c-tooltip">' +
        '                <div class="c-tooltip__wrapper c-tooltip__wrapper_medium">' +
                                       metrics +
        '                </div>' +
        '                <span >' + data.metrics.length + '</span>' +
        '            </div>' +
        '         </div>' +
        '      </div>' +
        '      <div class="template__footer">' +
        '           <form class="button_full" action="#" js-disable-template-form>' +
        '               <input name="id" type="hidden" value="' + data.id + '">' +
        '                   <button type="button" class="button button_white button_full" js-disable-template-btn>' +
        '                            <span class="hidden-btn hidden-btn_right hidden-btn_right-large hidden-btn_hide">Удалить шаблон</span>' +
        '                   </button>' +
        '           </form>' +
        '       </div>' +
        '</div>'
        + templateList.html()
    );
}

$(document).on('change', '[template-metric]', function(event) {
    var counter = 0;
    $('[template-metric]').each(function(index) {
        var isChecked = $(this).is(':checked');
        if (!isChecked) {
            $(this).attr("name", "templateMetric");
        } else {
            $(this).attr("name", "metrics[" + counter + "].id");
            counter++;
        }
    });
});


var DISABLE_TEMPLATE_FORM;
$(document).on('click', '[js-disable-template-btn]', function(event) {
    event.preventDefault();
    $('[dialog]').find('.dialog__title').html('Вы действительно хотите удалить шаблон?');
    $('[dialog]').find('.dialog__text').html('Шаблон будет помещен в архив');
    $('[dialog]').find('[accept-dialog]').attr('disable-template', '');
    $('[dialog]').addClass('is-open');
    DISABLE_TEMPLATE_FORM =  $(this).closest('[js-disable-template-form]');
});
$(document).on('click', '[close-dialog]', function(event) {
    removeAcceptBtnAttribute($(this).siblings('[accept-dialog]'));
    $(this).closest('.dialog').removeClass('is-open');
});
$(document).on('click', '[disable-template]', function(event) {
    event.preventDefault();
    $('[dialog]').removeClass('is-open');
    removeAcceptBtnAttribute($(this));
    DISABLE_TEMPLATE_FORM.trigger('submit');
});

$(document).on('submit', '[js-disable-template-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        disableTemplate(formData);
    }
});
function disableTemplate(formData) {
    $('[js-disable-template-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "disableTemplate",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-disable-template-btn]').prop("disabled", false);
            $('[data-template="' + formData.id + '"]').remove();
        },
        error: function (data) {
            $('[js-disable-template-btn]').prop("disabled", false);
        }
    });
}

var ENABLE_TEMPLATE_FORM;
$(document).on('click', '[js-enable-template-btn]', function(event) {
    event.preventDefault();
    $('[dialog]').find('.dialog__title').html('Вы действительно хотите восстановить шаблон?');
    $('[dialog]').find('.dialog__text').html('Шаблон будет помещен в список доступных шаблонов');
    $('[dialog]').find('[accept-dialog]').attr('enable-template', '');
    $('[dialog]').addClass('is-open');
    ENABLE_TEMPLATE_FORM =  $(this).closest('[js-enable-template-form]');
});
$(document).on('click', '[enable-template]', function(event) {
    event.preventDefault();
    $('[dialog]').removeClass('is-open');
    removeAcceptBtnAttribute($(this));
    ENABLE_TEMPLATE_FORM.trigger('submit');
});

$(document).on('submit', '[js-enable-template-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        enableTemplate(formData);
    }
});
function enableTemplate(formData) {
    $('[js-enable-template-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "enableTemplate",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-enable-template-btn]').prop("disabled", false);
            $('[data-template="' + formData.id + '"]').remove();
        },
        error: function (data) {
            $('[js-enable-template-btn]').prop("disabled", false);
        }
    });
}


$(document).on('change', '[qs-filter]', function() {
    $('[qs-filter-form]').trigger('submit');
});
/*!
 * Quill Editor v1.3.6
 * https://quilljs.com/
 * Copyright (c) 2014, Jason Chen
 * Copyright (c) 2013, salesforce.com
 */
(function webpackUniversalModuleDefinition(root, factory) {
    if(typeof exports === 'object' && typeof module === 'object')
        module.exports = factory();
    else if(typeof define === 'function' && define.amd)
        define([], factory);
    else if(typeof exports === 'object')
        exports["Quill"] = factory();
    else
        root["Quill"] = factory();
})(typeof self !== 'undefined' ? self : this, function() {
    return /******/ (function(modules) { // webpackBootstrap
        /******/ 	// The module cache
        /******/ 	var installedModules = {};
        /******/
        /******/ 	// The require function
        /******/ 	function __webpack_require__(moduleId) {
            /******/
            /******/ 		// Check if module is in cache
            /******/ 		if(installedModules[moduleId]) {
                /******/ 			return installedModules[moduleId].exports;
                /******/ 		}
            /******/ 		// Create a new module (and put it into the cache)
            /******/ 		var module = installedModules[moduleId] = {
                /******/ 			i: moduleId,
                /******/ 			l: false,
                /******/ 			exports: {}
                /******/ 		};
            /******/
            /******/ 		// Execute the module function
            /******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
            /******/
            /******/ 		// Flag the module as loaded
            /******/ 		module.l = true;
            /******/
            /******/ 		// Return the exports of the module
            /******/ 		return module.exports;
            /******/ 	}
        /******/
        /******/
        /******/ 	// expose the modules object (__webpack_modules__)
        /******/ 	__webpack_require__.m = modules;
        /******/
        /******/ 	// expose the module cache
        /******/ 	__webpack_require__.c = installedModules;
        /******/
        /******/ 	// define getter function for harmony exports
        /******/ 	__webpack_require__.d = function(exports, name, getter) {
            /******/ 		if(!__webpack_require__.o(exports, name)) {
                /******/ 			Object.defineProperty(exports, name, {
                    /******/ 				configurable: false,
                    /******/ 				enumerable: true,
                    /******/ 				get: getter
                    /******/ 			});
                /******/ 		}
            /******/ 	};
        /******/
        /******/ 	// getDefaultExport function for compatibility with non-harmony modules
        /******/ 	__webpack_require__.n = function(module) {
            /******/ 		var getter = module && module.__esModule ?
                /******/ 			function getDefault() { return module['default']; } :
                /******/ 			function getModuleExports() { return module; };
            /******/ 		__webpack_require__.d(getter, 'a', getter);
            /******/ 		return getter;
            /******/ 	};
        /******/
        /******/ 	// Object.prototype.hasOwnProperty.call
        /******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
        /******/
        /******/ 	// __webpack_public_path__
        /******/ 	__webpack_require__.p = "";
        /******/
        /******/ 	// Load entry module and return exports
        /******/ 	return __webpack_require__(__webpack_require__.s = 109);
        /******/ })
    /************************************************************************/
    /******/ ([
        /* 0 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            Object.defineProperty(exports, "__esModule", { value: true });
            var container_1 = __webpack_require__(17);
            var format_1 = __webpack_require__(18);
            var leaf_1 = __webpack_require__(19);
            var scroll_1 = __webpack_require__(45);
            var inline_1 = __webpack_require__(46);
            var block_1 = __webpack_require__(47);
            var embed_1 = __webpack_require__(48);
            var text_1 = __webpack_require__(49);
            var attributor_1 = __webpack_require__(12);
            var class_1 = __webpack_require__(32);
            var style_1 = __webpack_require__(33);
            var store_1 = __webpack_require__(31);
            var Registry = __webpack_require__(1);
            var Parchment = {
                Scope: Registry.Scope,
                create: Registry.create,
                find: Registry.find,
                query: Registry.query,
                register: Registry.register,
                Container: container_1.default,
                Format: format_1.default,
                Leaf: leaf_1.default,
                Embed: embed_1.default,
                Scroll: scroll_1.default,
                Block: block_1.default,
                Inline: inline_1.default,
                Text: text_1.default,
                Attributor: {
                    Attribute: attributor_1.default,
                    Class: class_1.default,
                    Style: style_1.default,
                    Store: store_1.default,
                },
            };
            exports.default = Parchment;


            /***/ }),
        /* 1 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            var __extends = (this && this.__extends) || (function () {
                var extendStatics = Object.setPrototypeOf ||
                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
                return function (d, b) {
                    extendStatics(d, b);
                    function __() { this.constructor = d; }
                    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
                };
            })();
            Object.defineProperty(exports, "__esModule", { value: true });
            var ParchmentError = /** @class */ (function (_super) {
                __extends(ParchmentError, _super);
                function ParchmentError(message) {
                    var _this = this;
                    message = '[Parchment] ' + message;
                    _this = _super.call(this, message) || this;
                    _this.message = message;
                    _this.name = _this.constructor.name;
                    return _this;
                }
                return ParchmentError;
            }(Error));
            exports.ParchmentError = ParchmentError;
            var attributes = {};
            var classes = {};
            var tags = {};
            var types = {};
            exports.DATA_KEY = '__blot';
            var Scope;
            (function (Scope) {
                Scope[Scope["TYPE"] = 3] = "TYPE";
                Scope[Scope["LEVEL"] = 12] = "LEVEL";
                Scope[Scope["ATTRIBUTE"] = 13] = "ATTRIBUTE";
                Scope[Scope["BLOT"] = 14] = "BLOT";
                Scope[Scope["INLINE"] = 7] = "INLINE";
                Scope[Scope["BLOCK"] = 11] = "BLOCK";
                Scope[Scope["BLOCK_BLOT"] = 10] = "BLOCK_BLOT";
                Scope[Scope["INLINE_BLOT"] = 6] = "INLINE_BLOT";
                Scope[Scope["BLOCK_ATTRIBUTE"] = 9] = "BLOCK_ATTRIBUTE";
                Scope[Scope["INLINE_ATTRIBUTE"] = 5] = "INLINE_ATTRIBUTE";
                Scope[Scope["ANY"] = 15] = "ANY";
            })(Scope = exports.Scope || (exports.Scope = {}));
            function create(input, value) {
                var match = query(input);
                if (match == null) {
                    throw new ParchmentError("Unable to create " + input + " blot");
                }
                var BlotClass = match;
                var node =
                    // @ts-ignore
                    input instanceof Node || input['nodeType'] === Node.TEXT_NODE ? input : BlotClass.create(value);
                return new BlotClass(node, value);
            }
            exports.create = create;
            function find(node, bubble) {
                if (bubble === void 0) { bubble = false; }
                if (node == null)
                    return null;
                // @ts-ignore
                if (node[exports.DATA_KEY] != null)
                    return node[exports.DATA_KEY].blot;
                if (bubble)
                    return find(node.parentNode, bubble);
                return null;
            }
            exports.find = find;
            function query(query, scope) {
                if (scope === void 0) { scope = Scope.ANY; }
                var match;
                if (typeof query === 'string') {
                    match = types[query] || attributes[query];
                    // @ts-ignore
                }
                else if (query instanceof Text || query['nodeType'] === Node.TEXT_NODE) {
                    match = types['text'];
                }
                else if (typeof query === 'number') {
                    if (query & Scope.LEVEL & Scope.BLOCK) {
                        match = types['block'];
                    }
                    else if (query & Scope.LEVEL & Scope.INLINE) {
                        match = types['inline'];
                    }
                }
                else if (query instanceof HTMLElement) {
                    var names = (query.getAttribute('class') || '').split(/\s+/);
                    for (var i in names) {
                        match = classes[names[i]];
                        if (match)
                            break;
                    }
                    match = match || tags[query.tagName];
                }
                if (match == null)
                    return null;
                // @ts-ignore
                if (scope & Scope.LEVEL & match.scope && scope & Scope.TYPE & match.scope)
                    return match;
                return null;
            }
            exports.query = query;
            function register() {
                var Definitions = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    Definitions[_i] = arguments[_i];
                }
                if (Definitions.length > 1) {
                    return Definitions.map(function (d) {
                        return register(d);
                    });
                }
                var Definition = Definitions[0];
                if (typeof Definition.blotName !== 'string' && typeof Definition.attrName !== 'string') {
                    throw new ParchmentError('Invalid definition');
                }
                else if (Definition.blotName === 'abstract') {
                    throw new ParchmentError('Cannot register abstract class');
                }
                types[Definition.blotName || Definition.attrName] = Definition;
                if (typeof Definition.keyName === 'string') {
                    attributes[Definition.keyName] = Definition;
                }
                else {
                    if (Definition.className != null) {
                        classes[Definition.className] = Definition;
                    }
                    if (Definition.tagName != null) {
                        if (Array.isArray(Definition.tagName)) {
                            Definition.tagName = Definition.tagName.map(function (tagName) {
                                return tagName.toUpperCase();
                            });
                        }
                        else {
                            Definition.tagName = Definition.tagName.toUpperCase();
                        }
                        var tagNames = Array.isArray(Definition.tagName) ? Definition.tagName : [Definition.tagName];
                        tagNames.forEach(function (tag) {
                            if (tags[tag] == null || Definition.className == null) {
                                tags[tag] = Definition;
                            }
                        });
                    }
                }
                return Definition;
            }
            exports.register = register;


            /***/ }),
        /* 2 */
        /***/ (function(module, exports, __webpack_require__) {

            var diff = __webpack_require__(51);
            var equal = __webpack_require__(11);
            var extend = __webpack_require__(3);
            var op = __webpack_require__(20);


            var NULL_CHARACTER = String.fromCharCode(0);  // Placeholder char for embed in diff()


            var Delta = function (ops) {
                // Assume we are given a well formed ops
                if (Array.isArray(ops)) {
                    this.ops = ops;
                } else if (ops != null && Array.isArray(ops.ops)) {
                    this.ops = ops.ops;
                } else {
                    this.ops = [];
                }
            };


            Delta.prototype.insert = function (text, attributes) {
                var newOp = {};
                if (text.length === 0) return this;
                newOp.insert = text;
                if (attributes != null && typeof attributes === 'object' && Object.keys(attributes).length > 0) {
                    newOp.attributes = attributes;
                }
                return this.push(newOp);
            };

            Delta.prototype['delete'] = function (length) {
                if (length <= 0) return this;
                return this.push({ 'delete': length });
            };

            Delta.prototype.retain = function (length, attributes) {
                if (length <= 0) return this;
                var newOp = { retain: length };
                if (attributes != null && typeof attributes === 'object' && Object.keys(attributes).length > 0) {
                    newOp.attributes = attributes;
                }
                return this.push(newOp);
            };

            Delta.prototype.push = function (newOp) {
                var index = this.ops.length;
                var lastOp = this.ops[index - 1];
                newOp = extend(true, {}, newOp);
                if (typeof lastOp === 'object') {
                    if (typeof newOp['delete'] === 'number' && typeof lastOp['delete'] === 'number') {
                        this.ops[index - 1] = { 'delete': lastOp['delete'] + newOp['delete'] };
                        return this;
                    }
                    // Since it does not matter if we insert before or after deleting at the same index,
                    // always prefer to insert first
                    if (typeof lastOp['delete'] === 'number' && newOp.insert != null) {
                        index -= 1;
                        lastOp = this.ops[index - 1];
                        if (typeof lastOp !== 'object') {
                            this.ops.unshift(newOp);
                            return this;
                        }
                    }
                    if (equal(newOp.attributes, lastOp.attributes)) {
                        if (typeof newOp.insert === 'string' && typeof lastOp.insert === 'string') {
                            this.ops[index - 1] = { insert: lastOp.insert + newOp.insert };
                            if (typeof newOp.attributes === 'object') this.ops[index - 1].attributes = newOp.attributes
                            return this;
                        } else if (typeof newOp.retain === 'number' && typeof lastOp.retain === 'number') {
                            this.ops[index - 1] = { retain: lastOp.retain + newOp.retain };
                            if (typeof newOp.attributes === 'object') this.ops[index - 1].attributes = newOp.attributes
                            return this;
                        }
                    }
                }
                if (index === this.ops.length) {
                    this.ops.push(newOp);
                } else {
                    this.ops.splice(index, 0, newOp);
                }
                return this;
            };

            Delta.prototype.chop = function () {
                var lastOp = this.ops[this.ops.length - 1];
                if (lastOp && lastOp.retain && !lastOp.attributes) {
                    this.ops.pop();
                }
                return this;
            };

            Delta.prototype.filter = function (predicate) {
                return this.ops.filter(predicate);
            };

            Delta.prototype.forEach = function (predicate) {
                this.ops.forEach(predicate);
            };

            Delta.prototype.map = function (predicate) {
                return this.ops.map(predicate);
            };

            Delta.prototype.partition = function (predicate) {
                var passed = [], failed = [];
                this.forEach(function(op) {
                    var target = predicate(op) ? passed : failed;
                    target.push(op);
                });
                return [passed, failed];
            };

            Delta.prototype.reduce = function (predicate, initial) {
                return this.ops.reduce(predicate, initial);
            };

            Delta.prototype.changeLength = function () {
                return this.reduce(function (length, elem) {
                    if (elem.insert) {
                        return length + op.length(elem);
                    } else if (elem.delete) {
                        return length - elem.delete;
                    }
                    return length;
                }, 0);
            };

            Delta.prototype.length = function () {
                return this.reduce(function (length, elem) {
                    return length + op.length(elem);
                }, 0);
            };

            Delta.prototype.slice = function (start, end) {
                start = start || 0;
                if (typeof end !== 'number') end = Infinity;
                var ops = [];
                var iter = op.iterator(this.ops);
                var index = 0;
                while (index < end && iter.hasNext()) {
                    var nextOp;
                    if (index < start) {
                        nextOp = iter.next(start - index);
                    } else {
                        nextOp = iter.next(end - index);
                        ops.push(nextOp);
                    }
                    index += op.length(nextOp);
                }
                return new Delta(ops);
            };


            Delta.prototype.compose = function (other) {
                var thisIter = op.iterator(this.ops);
                var otherIter = op.iterator(other.ops);
                var delta = new Delta();
                while (thisIter.hasNext() || otherIter.hasNext()) {
                    if (otherIter.peekType() === 'insert') {
                        delta.push(otherIter.next());
                    } else if (thisIter.peekType() === 'delete') {
                        delta.push(thisIter.next());
                    } else {
                        var length = Math.min(thisIter.peekLength(), otherIter.peekLength());
                        var thisOp = thisIter.next(length);
                        var otherOp = otherIter.next(length);
                        if (typeof otherOp.retain === 'number') {
                            var newOp = {};
                            if (typeof thisOp.retain === 'number') {
                                newOp.retain = length;
                            } else {
                                newOp.insert = thisOp.insert;
                            }
                            // Preserve null when composing with a retain, otherwise remove it for inserts
                            var attributes = op.attributes.compose(thisOp.attributes, otherOp.attributes, typeof thisOp.retain === 'number');
                            if (attributes) newOp.attributes = attributes;
                            delta.push(newOp);
                            // Other op should be delete, we could be an insert or retain
                            // Insert + delete cancels out
                        } else if (typeof otherOp['delete'] === 'number' && typeof thisOp.retain === 'number') {
                            delta.push(otherOp);
                        }
                    }
                }
                return delta.chop();
            };

            Delta.prototype.concat = function (other) {
                var delta = new Delta(this.ops.slice());
                if (other.ops.length > 0) {
                    delta.push(other.ops[0]);
                    delta.ops = delta.ops.concat(other.ops.slice(1));
                }
                return delta;
            };

            Delta.prototype.diff = function (other, index) {
                if (this.ops === other.ops) {
                    return new Delta();
                }
                var strings = [this, other].map(function (delta) {
                    return delta.map(function (op) {
                        if (op.insert != null) {
                            return typeof op.insert === 'string' ? op.insert : NULL_CHARACTER;
                        }
                        var prep = (delta === other) ? 'on' : 'with';
                        throw new Error('diff() called ' + prep + ' non-document');
                    }).join('');
                });
                var delta = new Delta();
                var diffResult = diff(strings[0], strings[1], index);
                var thisIter = op.iterator(this.ops);
                var otherIter = op.iterator(other.ops);
                diffResult.forEach(function (component) {
                    var length = component[1].length;
                    while (length > 0) {
                        var opLength = 0;
                        switch (component[0]) {
                            case diff.INSERT:
                                opLength = Math.min(otherIter.peekLength(), length);
                                delta.push(otherIter.next(opLength));
                                break;
                            case diff.DELETE:
                                opLength = Math.min(length, thisIter.peekLength());
                                thisIter.next(opLength);
                                delta['delete'](opLength);
                                break;
                            case diff.EQUAL:
                                opLength = Math.min(thisIter.peekLength(), otherIter.peekLength(), length);
                                var thisOp = thisIter.next(opLength);
                                var otherOp = otherIter.next(opLength);
                                if (equal(thisOp.insert, otherOp.insert)) {
                                    delta.retain(opLength, op.attributes.diff(thisOp.attributes, otherOp.attributes));
                                } else {
                                    delta.push(otherOp)['delete'](opLength);
                                }
                                break;
                        }
                        length -= opLength;
                    }
                });
                return delta.chop();
            };

            Delta.prototype.eachLine = function (predicate, newline) {
                newline = newline || '\n';
                var iter = op.iterator(this.ops);
                var line = new Delta();
                var i = 0;
                while (iter.hasNext()) {
                    if (iter.peekType() !== 'insert') return;
                    var thisOp = iter.peek();
                    var start = op.length(thisOp) - iter.peekLength();
                    var index = typeof thisOp.insert === 'string' ?
                        thisOp.insert.indexOf(newline, start) - start : -1;
                    if (index < 0) {
                        line.push(iter.next());
                    } else if (index > 0) {
                        line.push(iter.next(index));
                    } else {
                        if (predicate(line, iter.next(1).attributes || {}, i) === false) {
                            return;
                        }
                        i += 1;
                        line = new Delta();
                    }
                }
                if (line.length() > 0) {
                    predicate(line, {}, i);
                }
            };

            Delta.prototype.transform = function (other, priority) {
                priority = !!priority;
                if (typeof other === 'number') {
                    return this.transformPosition(other, priority);
                }
                var thisIter = op.iterator(this.ops);
                var otherIter = op.iterator(other.ops);
                var delta = new Delta();
                while (thisIter.hasNext() || otherIter.hasNext()) {
                    if (thisIter.peekType() === 'insert' && (priority || otherIter.peekType() !== 'insert')) {
                        delta.retain(op.length(thisIter.next()));
                    } else if (otherIter.peekType() === 'insert') {
                        delta.push(otherIter.next());
                    } else {
                        var length = Math.min(thisIter.peekLength(), otherIter.peekLength());
                        var thisOp = thisIter.next(length);
                        var otherOp = otherIter.next(length);
                        if (thisOp['delete']) {
                            // Our delete either makes their delete redundant or removes their retain
                            continue;
                        } else if (otherOp['delete']) {
                            delta.push(otherOp);
                        } else {
                            // We retain either their retain or insert
                            delta.retain(length, op.attributes.transform(thisOp.attributes, otherOp.attributes, priority));
                        }
                    }
                }
                return delta.chop();
            };

            Delta.prototype.transformPosition = function (index, priority) {
                priority = !!priority;
                var thisIter = op.iterator(this.ops);
                var offset = 0;
                while (thisIter.hasNext() && offset <= index) {
                    var length = thisIter.peekLength();
                    var nextType = thisIter.peekType();
                    thisIter.next();
                    if (nextType === 'delete') {
                        index -= Math.min(length, index - offset);
                        continue;
                    } else if (nextType === 'insert' && (offset < index || !priority)) {
                        index += length;
                    }
                    offset += length;
                }
                return index;
            };


            module.exports = Delta;


            /***/ }),
        /* 3 */
        /***/ (function(module, exports) {

            'use strict';

            var hasOwn = Object.prototype.hasOwnProperty;
            var toStr = Object.prototype.toString;

            var isArray = function isArray(arr) {
                if (typeof Array.isArray === 'function') {
                    return Array.isArray(arr);
                }

                return toStr.call(arr) === '[object Array]';
            };

            var isPlainObject = function isPlainObject(obj) {
                if (!obj || toStr.call(obj) !== '[object Object]') {
                    return false;
                }

                var hasOwnConstructor = hasOwn.call(obj, 'constructor');
                var hasIsPrototypeOf = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');
                // Not own constructor property must be Object
                if (obj.constructor && !hasOwnConstructor && !hasIsPrototypeOf) {
                    return false;
                }

                // Own properties are enumerated firstly, so to speed up,
                // if last one is own, then all properties are own.
                var key;
                for (key in obj) { /**/ }

                return typeof key === 'undefined' || hasOwn.call(obj, key);
            };

            module.exports = function extend() {
                var options, name, src, copy, copyIsArray, clone;
                var target = arguments[0];
                var i = 1;
                var length = arguments.length;
                var deep = false;

                // Handle a deep copy situation
                if (typeof target === 'boolean') {
                    deep = target;
                    target = arguments[1] || {};
                    // skip the boolean and the target
                    i = 2;
                }
                if (target == null || (typeof target !== 'object' && typeof target !== 'function')) {
                    target = {};
                }

                for (; i < length; ++i) {
                    options = arguments[i];
                    // Only deal with non-null/undefined values
                    if (options != null) {
                        // Extend the base object
                        for (name in options) {
                            src = target[name];
                            copy = options[name];

                            // Prevent never-ending loop
                            if (target !== copy) {
                                // Recurse if we're merging plain objects or arrays
                                if (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {
                                    if (copyIsArray) {
                                        copyIsArray = false;
                                        clone = src && isArray(src) ? src : [];
                                    } else {
                                        clone = src && isPlainObject(src) ? src : {};
                                    }

                                    // Never move original objects, clone them
                                    target[name] = extend(deep, clone, copy);

                                    // Don't bring in undefined values
                                } else if (typeof copy !== 'undefined') {
                                    target[name] = copy;
                                }
                            }
                        }
                    }
                }

                // Return the modified object
                return target;
            };


            /***/ }),
        /* 4 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.default = exports.BlockEmbed = exports.bubbleFormats = undefined;

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _extend = __webpack_require__(3);

            var _extend2 = _interopRequireDefault(_extend);

            var _quillDelta = __webpack_require__(2);

            var _quillDelta2 = _interopRequireDefault(_quillDelta);

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _break = __webpack_require__(16);

            var _break2 = _interopRequireDefault(_break);

            var _inline = __webpack_require__(6);

            var _inline2 = _interopRequireDefault(_inline);

            var _text = __webpack_require__(7);

            var _text2 = _interopRequireDefault(_text);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var NEWLINE_LENGTH = 1;

            var BlockEmbed = function (_Parchment$Embed) {
                _inherits(BlockEmbed, _Parchment$Embed);

                function BlockEmbed() {
                    _classCallCheck(this, BlockEmbed);

                    return _possibleConstructorReturn(this, (BlockEmbed.__proto__ || Object.getPrototypeOf(BlockEmbed)).apply(this, arguments));
                }

                _createClass(BlockEmbed, [{
                    key: 'attach',
                    value: function attach() {
                        _get(BlockEmbed.prototype.__proto__ || Object.getPrototypeOf(BlockEmbed.prototype), 'attach', this).call(this);
                        this.attributes = new _parchment2.default.Attributor.Store(this.domNode);
                    }
                }, {
                    key: 'delta',
                    value: function delta() {
                        return new _quillDelta2.default().insert(this.value(), (0, _extend2.default)(this.formats(), this.attributes.values()));
                    }
                }, {
                    key: 'format',
                    value: function format(name, value) {
                        var attribute = _parchment2.default.query(name, _parchment2.default.Scope.BLOCK_ATTRIBUTE);
                        if (attribute != null) {
                            this.attributes.attribute(attribute, value);
                        }
                    }
                }, {
                    key: 'formatAt',
                    value: function formatAt(index, length, name, value) {
                        this.format(name, value);
                    }
                }, {
                    key: 'insertAt',
                    value: function insertAt(index, value, def) {
                        if (typeof value === 'string' && value.endsWith('\n')) {
                            var block = _parchment2.default.create(Block.blotName);
                            this.parent.insertBefore(block, index === 0 ? this : this.next);
                            block.insertAt(0, value.slice(0, -1));
                        } else {
                            _get(BlockEmbed.prototype.__proto__ || Object.getPrototypeOf(BlockEmbed.prototype), 'insertAt', this).call(this, index, value, def);
                        }
                    }
                }]);

                return BlockEmbed;
            }(_parchment2.default.Embed);

            BlockEmbed.scope = _parchment2.default.Scope.BLOCK_BLOT;
// It is important for cursor behavior BlockEmbeds use tags that are block level elements


            var Block = function (_Parchment$Block) {
                _inherits(Block, _Parchment$Block);

                function Block(domNode) {
                    _classCallCheck(this, Block);

                    var _this2 = _possibleConstructorReturn(this, (Block.__proto__ || Object.getPrototypeOf(Block)).call(this, domNode));

                    _this2.cache = {};
                    return _this2;
                }

                _createClass(Block, [{
                    key: 'delta',
                    value: function delta() {
                        if (this.cache.delta == null) {
                            this.cache.delta = this.descendants(_parchment2.default.Leaf).reduce(function (delta, leaf) {
                                if (leaf.length() === 0) {
                                    return delta;
                                } else {
                                    return delta.insert(leaf.value(), bubbleFormats(leaf));
                                }
                            }, new _quillDelta2.default()).insert('\n', bubbleFormats(this));
                        }
                        return this.cache.delta;
                    }
                }, {
                    key: 'deleteAt',
                    value: function deleteAt(index, length) {
                        _get(Block.prototype.__proto__ || Object.getPrototypeOf(Block.prototype), 'deleteAt', this).call(this, index, length);
                        this.cache = {};
                    }
                }, {
                    key: 'formatAt',
                    value: function formatAt(index, length, name, value) {
                        if (length <= 0) return;
                        if (_parchment2.default.query(name, _parchment2.default.Scope.BLOCK)) {
                            if (index + length === this.length()) {
                                this.format(name, value);
                            }
                        } else {
                            _get(Block.prototype.__proto__ || Object.getPrototypeOf(Block.prototype), 'formatAt', this).call(this, index, Math.min(length, this.length() - index - 1), name, value);
                        }
                        this.cache = {};
                    }
                }, {
                    key: 'insertAt',
                    value: function insertAt(index, value, def) {
                        if (def != null) return _get(Block.prototype.__proto__ || Object.getPrototypeOf(Block.prototype), 'insertAt', this).call(this, index, value, def);
                        if (value.length === 0) return;
                        var lines = value.split('\n');
                        var text = lines.shift();
                        if (text.length > 0) {
                            if (index < this.length() - 1 || this.children.tail == null) {
                                _get(Block.prototype.__proto__ || Object.getPrototypeOf(Block.prototype), 'insertAt', this).call(this, Math.min(index, this.length() - 1), text);
                            } else {
                                this.children.tail.insertAt(this.children.tail.length(), text);
                            }
                            this.cache = {};
                        }
                        var block = this;
                        lines.reduce(function (index, line) {
                            block = block.split(index, true);
                            block.insertAt(0, line);
                            return line.length;
                        }, index + text.length);
                    }
                }, {
                    key: 'insertBefore',
                    value: function insertBefore(blot, ref) {
                        var head = this.children.head;
                        _get(Block.prototype.__proto__ || Object.getPrototypeOf(Block.prototype), 'insertBefore', this).call(this, blot, ref);
                        if (head instanceof _break2.default) {
                            head.remove();
                        }
                        this.cache = {};
                    }
                }, {
                    key: 'length',
                    value: function length() {
                        if (this.cache.length == null) {
                            this.cache.length = _get(Block.prototype.__proto__ || Object.getPrototypeOf(Block.prototype), 'length', this).call(this) + NEWLINE_LENGTH;
                        }
                        return this.cache.length;
                    }
                }, {
                    key: 'moveChildren',
                    value: function moveChildren(target, ref) {
                        _get(Block.prototype.__proto__ || Object.getPrototypeOf(Block.prototype), 'moveChildren', this).call(this, target, ref);
                        this.cache = {};
                    }
                }, {
                    key: 'optimize',
                    value: function optimize(context) {
                        _get(Block.prototype.__proto__ || Object.getPrototypeOf(Block.prototype), 'optimize', this).call(this, context);
                        this.cache = {};
                    }
                }, {
                    key: 'path',
                    value: function path(index) {
                        return _get(Block.prototype.__proto__ || Object.getPrototypeOf(Block.prototype), 'path', this).call(this, index, true);
                    }
                }, {
                    key: 'removeChild',
                    value: function removeChild(child) {
                        _get(Block.prototype.__proto__ || Object.getPrototypeOf(Block.prototype), 'removeChild', this).call(this, child);
                        this.cache = {};
                    }
                }, {
                    key: 'split',
                    value: function split(index) {
                        var force = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

                        if (force && (index === 0 || index >= this.length() - NEWLINE_LENGTH)) {
                            var clone = this.clone();
                            if (index === 0) {
                                this.parent.insertBefore(clone, this);
                                return this;
                            } else {
                                this.parent.insertBefore(clone, this.next);
                                return clone;
                            }
                        } else {
                            var next = _get(Block.prototype.__proto__ || Object.getPrototypeOf(Block.prototype), 'split', this).call(this, index, force);
                            this.cache = {};
                            return next;
                        }
                    }
                }]);

                return Block;
            }(_parchment2.default.Block);

            Block.blotName = 'block';
            Block.tagName = 'P';
            Block.defaultChild = 'break';
            Block.allowedChildren = [_inline2.default, _parchment2.default.Embed, _text2.default];

            function bubbleFormats(blot) {
                var formats = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

                if (blot == null) return formats;
                if (typeof blot.formats === 'function') {
                    formats = (0, _extend2.default)(formats, blot.formats());
                }
                if (blot.parent == null || blot.parent.blotName == 'scroll' || blot.parent.statics.scope !== blot.statics.scope) {
                    return formats;
                }
                return bubbleFormats(blot.parent, formats);
            }

            exports.bubbleFormats = bubbleFormats;
            exports.BlockEmbed = BlockEmbed;
            exports.default = Block;

            /***/ }),
        /* 5 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.default = exports.overload = exports.expandConfig = undefined;

            var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

            var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            __webpack_require__(50);

            var _quillDelta = __webpack_require__(2);

            var _quillDelta2 = _interopRequireDefault(_quillDelta);

            var _editor = __webpack_require__(14);

            var _editor2 = _interopRequireDefault(_editor);

            var _emitter3 = __webpack_require__(8);

            var _emitter4 = _interopRequireDefault(_emitter3);

            var _module = __webpack_require__(9);

            var _module2 = _interopRequireDefault(_module);

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _selection = __webpack_require__(15);

            var _selection2 = _interopRequireDefault(_selection);

            var _extend = __webpack_require__(3);

            var _extend2 = _interopRequireDefault(_extend);

            var _logger = __webpack_require__(10);

            var _logger2 = _interopRequireDefault(_logger);

            var _theme = __webpack_require__(34);

            var _theme2 = _interopRequireDefault(_theme);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            var debug = (0, _logger2.default)('quill');

            var Quill = function () {
                _createClass(Quill, null, [{
                    key: 'debug',
                    value: function debug(limit) {
                        if (limit === true) {
                            limit = 'log';
                        }
                        _logger2.default.level(limit);
                    }
                }, {
                    key: 'find',
                    value: function find(node) {
                        return node.__quill || _parchment2.default.find(node);
                    }
                }, {
                    key: 'import',
                    value: function _import(name) {
                        if (this.imports[name] == null) {
                            debug.error('Cannot import ' + name + '. Are you sure it was registered?');
                        }
                        return this.imports[name];
                    }
                }, {
                    key: 'register',
                    value: function register(path, target) {
                        var _this = this;

                        var overwrite = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

                        if (typeof path !== 'string') {
                            var name = path.attrName || path.blotName;
                            if (typeof name === 'string') {
                                // register(Blot | Attributor, overwrite)
                                this.register('formats/' + name, path, target);
                            } else {
                                Object.keys(path).forEach(function (key) {
                                    _this.register(key, path[key], target);
                                });
                            }
                        } else {
                            if (this.imports[path] != null && !overwrite) {
                                debug.warn('Overwriting ' + path + ' with', target);
                            }
                            this.imports[path] = target;
                            if ((path.startsWith('blots/') || path.startsWith('formats/')) && target.blotName !== 'abstract') {
                                _parchment2.default.register(target);
                            } else if (path.startsWith('modules') && typeof target.register === 'function') {
                                target.register();
                            }
                        }
                    }
                }]);

                function Quill(container) {
                    var _this2 = this;

                    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

                    _classCallCheck(this, Quill);

                    this.options = expandConfig(container, options);
                    this.container = this.options.container;
                    if (this.container == null) {
                        return debug.error('Invalid Quill container', container);
                    }
                    if (this.options.debug) {
                        Quill.debug(this.options.debug);
                    }
                    var html = this.container.innerHTML.trim();
                    this.container.classList.add('ql-container');
                    this.container.innerHTML = '';
                    this.container.__quill = this;
                    this.root = this.addContainer('ql-editor');
                    this.root.classList.add('ql-blank');
                    this.root.setAttribute('data-gramm', false);
                    this.scrollingContainer = this.options.scrollingContainer || this.root;
                    this.emitter = new _emitter4.default();
                    this.scroll = _parchment2.default.create(this.root, {
                        emitter: this.emitter,
                        whitelist: this.options.formats
                    });
                    this.editor = new _editor2.default(this.scroll);
                    this.selection = new _selection2.default(this.scroll, this.emitter);
                    this.theme = new this.options.theme(this, this.options);
                    this.keyboard = this.theme.addModule('keyboard');
                    this.clipboard = this.theme.addModule('clipboard');
                    this.history = this.theme.addModule('history');
                    this.theme.init();
                    this.emitter.on(_emitter4.default.events.EDITOR_CHANGE, function (type) {
                        if (type === _emitter4.default.events.TEXT_CHANGE) {
                            _this2.root.classList.toggle('ql-blank', _this2.editor.isBlank());
                        }
                    });
                    this.emitter.on(_emitter4.default.events.SCROLL_UPDATE, function (source, mutations) {
                        var range = _this2.selection.lastRange;
                        var index = range && range.length === 0 ? range.index : undefined;
                        modify.call(_this2, function () {
                            return _this2.editor.update(null, mutations, index);
                        }, source);
                    });
                    var contents = this.clipboard.convert('<div class=\'ql-editor\' style="white-space: normal;">' + html + '<p><br></p></div>');
                    this.setContents(contents);
                    this.history.clear();
                    if (this.options.placeholder) {
                        this.root.setAttribute('data-placeholder', this.options.placeholder);
                    }
                    if (this.options.readOnly) {
                        this.disable();
                    }
                }

                _createClass(Quill, [{
                    key: 'addContainer',
                    value: function addContainer(container) {
                        var refNode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        if (typeof container === 'string') {
                            var className = container;
                            container = document.createElement('div');
                            container.classList.add(className);
                        }
                        this.container.insertBefore(container, refNode);
                        return container;
                    }
                }, {
                    key: 'blur',
                    value: function blur() {
                        this.selection.setRange(null);
                    }
                }, {
                    key: 'deleteText',
                    value: function deleteText(index, length, source) {
                        var _this3 = this;

                        var _overload = overload(index, length, source);

                        var _overload2 = _slicedToArray(_overload, 4);

                        index = _overload2[0];
                        length = _overload2[1];
                        source = _overload2[3];

                        return modify.call(this, function () {
                            return _this3.editor.deleteText(index, length);
                        }, source, index, -1 * length);
                    }
                }, {
                    key: 'disable',
                    value: function disable() {
                        this.enable(false);
                    }
                }, {
                    key: 'enable',
                    value: function enable() {
                        var enabled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

                        this.scroll.enable(enabled);
                        this.container.classList.toggle('ql-disabled', !enabled);
                    }
                }, {
                    key: 'focus',
                    value: function focus() {
                        var scrollTop = this.scrollingContainer.scrollTop;
                        this.selection.focus();
                        this.scrollingContainer.scrollTop = scrollTop;
                        this.scrollIntoView();
                    }
                }, {
                    key: 'format',
                    value: function format(name, value) {
                        var _this4 = this;

                        var source = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _emitter4.default.sources.API;

                        return modify.call(this, function () {
                            var range = _this4.getSelection(true);
                            var change = new _quillDelta2.default();
                            if (range == null) {
                                return change;
                            } else if (_parchment2.default.query(name, _parchment2.default.Scope.BLOCK)) {
                                change = _this4.editor.formatLine(range.index, range.length, _defineProperty({}, name, value));
                            } else if (range.length === 0) {
                                _this4.selection.format(name, value);
                                return change;
                            } else {
                                change = _this4.editor.formatText(range.index, range.length, _defineProperty({}, name, value));
                            }
                            _this4.setSelection(range, _emitter4.default.sources.SILENT);
                            return change;
                        }, source);
                    }
                }, {
                    key: 'formatLine',
                    value: function formatLine(index, length, name, value, source) {
                        var _this5 = this;

                        var formats = void 0;

                        var _overload3 = overload(index, length, name, value, source);

                        var _overload4 = _slicedToArray(_overload3, 4);

                        index = _overload4[0];
                        length = _overload4[1];
                        formats = _overload4[2];
                        source = _overload4[3];

                        return modify.call(this, function () {
                            return _this5.editor.formatLine(index, length, formats);
                        }, source, index, 0);
                    }
                }, {
                    key: 'formatText',
                    value: function formatText(index, length, name, value, source) {
                        var _this6 = this;

                        var formats = void 0;

                        var _overload5 = overload(index, length, name, value, source);

                        var _overload6 = _slicedToArray(_overload5, 4);

                        index = _overload6[0];
                        length = _overload6[1];
                        formats = _overload6[2];
                        source = _overload6[3];

                        return modify.call(this, function () {
                            return _this6.editor.formatText(index, length, formats);
                        }, source, index, 0);
                    }
                }, {
                    key: 'getBounds',
                    value: function getBounds(index) {
                        var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

                        var bounds = void 0;
                        if (typeof index === 'number') {
                            bounds = this.selection.getBounds(index, length);
                        } else {
                            bounds = this.selection.getBounds(index.index, index.length);
                        }
                        var containerBounds = this.container.getBoundingClientRect();
                        return {
                            bottom: bounds.bottom - containerBounds.top,
                            height: bounds.height,
                            left: bounds.left - containerBounds.left,
                            right: bounds.right - containerBounds.left,
                            top: bounds.top - containerBounds.top,
                            width: bounds.width
                        };
                    }
                }, {
                    key: 'getContents',
                    value: function getContents() {
                        var index = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
                        var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.getLength() - index;

                        var _overload7 = overload(index, length);

                        var _overload8 = _slicedToArray(_overload7, 2);

                        index = _overload8[0];
                        length = _overload8[1];

                        return this.editor.getContents(index, length);
                    }
                }, {
                    key: 'getFormat',
                    value: function getFormat() {
                        var index = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.getSelection(true);
                        var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

                        if (typeof index === 'number') {
                            return this.editor.getFormat(index, length);
                        } else {
                            return this.editor.getFormat(index.index, index.length);
                        }
                    }
                }, {
                    key: 'getIndex',
                    value: function getIndex(blot) {
                        return blot.offset(this.scroll);
                    }
                }, {
                    key: 'getLength',
                    value: function getLength() {
                        return this.scroll.length();
                    }
                }, {
                    key: 'getLeaf',
                    value: function getLeaf(index) {
                        return this.scroll.leaf(index);
                    }
                }, {
                    key: 'getLine',
                    value: function getLine(index) {
                        return this.scroll.line(index);
                    }
                }, {
                    key: 'getLines',
                    value: function getLines() {
                        var index = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
                        var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Number.MAX_VALUE;

                        if (typeof index !== 'number') {
                            return this.scroll.lines(index.index, index.length);
                        } else {
                            return this.scroll.lines(index, length);
                        }
                    }
                }, {
                    key: 'getModule',
                    value: function getModule(name) {
                        return this.theme.modules[name];
                    }
                }, {
                    key: 'getSelection',
                    value: function getSelection() {
                        var focus = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

                        if (focus) this.focus();
                        this.update(); // Make sure we access getRange with editor in consistent state
                        return this.selection.getRange()[0];
                    }
                }, {
                    key: 'getText',
                    value: function getText() {
                        var index = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
                        var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.getLength() - index;

                        var _overload9 = overload(index, length);

                        var _overload10 = _slicedToArray(_overload9, 2);

                        index = _overload10[0];
                        length = _overload10[1];

                        return this.editor.getText(index, length);
                    }
                }, {
                    key: 'hasFocus',
                    value: function hasFocus() {
                        return this.selection.hasFocus();
                    }
                }, {
                    key: 'insertEmbed',
                    value: function insertEmbed(index, embed, value) {
                        var _this7 = this;

                        var source = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : Quill.sources.API;

                        return modify.call(this, function () {
                            return _this7.editor.insertEmbed(index, embed, value);
                        }, source, index);
                    }
                }, {
                    key: 'insertText',
                    value: function insertText(index, text, name, value, source) {
                        var _this8 = this;

                        var formats = void 0;

                        var _overload11 = overload(index, 0, name, value, source);

                        var _overload12 = _slicedToArray(_overload11, 4);

                        index = _overload12[0];
                        formats = _overload12[2];
                        source = _overload12[3];

                        return modify.call(this, function () {
                            return _this8.editor.insertText(index, text, formats);
                        }, source, index, text.length);
                    }
                }, {
                    key: 'isEnabled',
                    value: function isEnabled() {
                        return !this.container.classList.contains('ql-disabled');
                    }
                }, {
                    key: 'off',
                    value: function off() {
                        return this.emitter.off.apply(this.emitter, arguments);
                    }
                }, {
                    key: 'on',
                    value: function on() {
                        return this.emitter.on.apply(this.emitter, arguments);
                    }
                }, {
                    key: 'once',
                    value: function once() {
                        return this.emitter.once.apply(this.emitter, arguments);
                    }
                }, {
                    key: 'pasteHTML',
                    value: function pasteHTML(index, html, source) {
                        this.clipboard.dangerouslyPasteHTML(index, html, source);
                    }
                }, {
                    key: 'removeFormat',
                    value: function removeFormat(index, length, source) {
                        var _this9 = this;

                        var _overload13 = overload(index, length, source);

                        var _overload14 = _slicedToArray(_overload13, 4);

                        index = _overload14[0];
                        length = _overload14[1];
                        source = _overload14[3];

                        return modify.call(this, function () {
                            return _this9.editor.removeFormat(index, length);
                        }, source, index);
                    }
                }, {
                    key: 'scrollIntoView',
                    value: function scrollIntoView() {
                        this.selection.scrollIntoView(this.scrollingContainer);
                    }
                }, {
                    key: 'setContents',
                    value: function setContents(delta) {
                        var _this10 = this;

                        var source = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _emitter4.default.sources.API;

                        return modify.call(this, function () {
                            delta = new _quillDelta2.default(delta);
                            var length = _this10.getLength();
                            var deleted = _this10.editor.deleteText(0, length);
                            var applied = _this10.editor.applyDelta(delta);
                            var lastOp = applied.ops[applied.ops.length - 1];
                            if (lastOp != null && typeof lastOp.insert === 'string' && lastOp.insert[lastOp.insert.length - 1] === '\n') {
                                _this10.editor.deleteText(_this10.getLength() - 1, 1);
                                applied.delete(1);
                            }
                            var ret = deleted.compose(applied);
                            return ret;
                        }, source);
                    }
                }, {
                    key: 'setSelection',
                    value: function setSelection(index, length, source) {
                        if (index == null) {
                            this.selection.setRange(null, length || Quill.sources.API);
                        } else {
                            var _overload15 = overload(index, length, source);

                            var _overload16 = _slicedToArray(_overload15, 4);

                            index = _overload16[0];
                            length = _overload16[1];
                            source = _overload16[3];

                            this.selection.setRange(new _selection.Range(index, length), source);
                            if (source !== _emitter4.default.sources.SILENT) {
                                this.selection.scrollIntoView(this.scrollingContainer);
                            }
                        }
                    }
                }, {
                    key: 'setText',
                    value: function setText(text) {
                        var source = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _emitter4.default.sources.API;

                        var delta = new _quillDelta2.default().insert(text);
                        return this.setContents(delta, source);
                    }
                }, {
                    key: 'update',
                    value: function update() {
                        var source = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _emitter4.default.sources.USER;

                        var change = this.scroll.update(source); // Will update selection before selection.update() does if text changes
                        this.selection.update(source);
                        return change;
                    }
                }, {
                    key: 'updateContents',
                    value: function updateContents(delta) {
                        var _this11 = this;

                        var source = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _emitter4.default.sources.API;

                        return modify.call(this, function () {
                            delta = new _quillDelta2.default(delta);
                            return _this11.editor.applyDelta(delta, source);
                        }, source, true);
                    }
                }]);

                return Quill;
            }();

            Quill.DEFAULTS = {
                bounds: null,
                formats: null,
                modules: {},
                placeholder: '',
                readOnly: false,
                scrollingContainer: null,
                strict: true,
                theme: 'default'
            };
            Quill.events = _emitter4.default.events;
            Quill.sources = _emitter4.default.sources;
// eslint-disable-next-line no-undef
            Quill.version =  false ? 'dev' : "1.3.6";

            Quill.imports = {
                'delta': _quillDelta2.default,
                'parchment': _parchment2.default,
                'core/module': _module2.default,
                'core/theme': _theme2.default
            };

            function expandConfig(container, userConfig) {
                userConfig = (0, _extend2.default)(true, {
                    container: container,
                    modules: {
                        clipboard: true,
                        keyboard: true,
                        history: true
                    }
                }, userConfig);
                if (!userConfig.theme || userConfig.theme === Quill.DEFAULTS.theme) {
                    userConfig.theme = _theme2.default;
                } else {
                    userConfig.theme = Quill.import('themes/' + userConfig.theme);
                    if (userConfig.theme == null) {
                        throw new Error('Invalid theme ' + userConfig.theme + '. Did you register it?');
                    }
                }
                var themeConfig = (0, _extend2.default)(true, {}, userConfig.theme.DEFAULTS);
                [themeConfig, userConfig].forEach(function (config) {
                    config.modules = config.modules || {};
                    Object.keys(config.modules).forEach(function (module) {
                        if (config.modules[module] === true) {
                            config.modules[module] = {};
                        }
                    });
                });
                var moduleNames = Object.keys(themeConfig.modules).concat(Object.keys(userConfig.modules));
                var moduleConfig = moduleNames.reduce(function (config, name) {
                    var moduleClass = Quill.import('modules/' + name);
                    if (moduleClass == null) {
                        debug.error('Cannot load ' + name + ' module. Are you sure you registered it?');
                    } else {
                        config[name] = moduleClass.DEFAULTS || {};
                    }
                    return config;
                }, {});
                // Special case toolbar shorthand
                if (userConfig.modules != null && userConfig.modules.toolbar && userConfig.modules.toolbar.constructor !== Object) {
                    userConfig.modules.toolbar = {
                        container: userConfig.modules.toolbar
                    };
                }
                userConfig = (0, _extend2.default)(true, {}, Quill.DEFAULTS, { modules: moduleConfig }, themeConfig, userConfig);
                ['bounds', 'container', 'scrollingContainer'].forEach(function (key) {
                    if (typeof userConfig[key] === 'string') {
                        userConfig[key] = document.querySelector(userConfig[key]);
                    }
                });
                userConfig.modules = Object.keys(userConfig.modules).reduce(function (config, name) {
                    if (userConfig.modules[name]) {
                        config[name] = userConfig.modules[name];
                    }
                    return config;
                }, {});
                return userConfig;
            }

// Handle selection preservation and TEXT_CHANGE emission
// common to modification APIs
            function modify(modifier, source, index, shift) {
                if (this.options.strict && !this.isEnabled() && source === _emitter4.default.sources.USER) {
                    return new _quillDelta2.default();
                }
                var range = index == null ? null : this.getSelection();
                var oldDelta = this.editor.delta;
                var change = modifier();
                if (range != null) {
                    if (index === true) index = range.index;
                    if (shift == null) {
                        range = shiftRange(range, change, source);
                    } else if (shift !== 0) {
                        range = shiftRange(range, index, shift, source);
                    }
                    this.setSelection(range, _emitter4.default.sources.SILENT);
                }
                if (change.length() > 0) {
                    var _emitter;

                    var args = [_emitter4.default.events.TEXT_CHANGE, change, oldDelta, source];
                    (_emitter = this.emitter).emit.apply(_emitter, [_emitter4.default.events.EDITOR_CHANGE].concat(args));
                    if (source !== _emitter4.default.sources.SILENT) {
                        var _emitter2;

                        (_emitter2 = this.emitter).emit.apply(_emitter2, args);
                    }
                }
                return change;
            }

            function overload(index, length, name, value, source) {
                var formats = {};
                if (typeof index.index === 'number' && typeof index.length === 'number') {
                    // Allow for throwaway end (used by insertText/insertEmbed)
                    if (typeof length !== 'number') {
                        source = value, value = name, name = length, length = index.length, index = index.index;
                    } else {
                        length = index.length, index = index.index;
                    }
                } else if (typeof length !== 'number') {
                    source = value, value = name, name = length, length = 0;
                }
                // Handle format being object, two format name/value strings or excluded
                if ((typeof name === 'undefined' ? 'undefined' : _typeof(name)) === 'object') {
                    formats = name;
                    source = value;
                } else if (typeof name === 'string') {
                    if (value != null) {
                        formats[name] = value;
                    } else {
                        source = name;
                    }
                }
                // Handle optional source
                source = source || _emitter4.default.sources.API;
                return [index, length, formats, source];
            }

            function shiftRange(range, index, length, source) {
                if (range == null) return null;
                var start = void 0,
                    end = void 0;
                if (index instanceof _quillDelta2.default) {
                    var _map = [range.index, range.index + range.length].map(function (pos) {
                        return index.transformPosition(pos, source !== _emitter4.default.sources.USER);
                    });

                    var _map2 = _slicedToArray(_map, 2);

                    start = _map2[0];
                    end = _map2[1];
                } else {
                    var _map3 = [range.index, range.index + range.length].map(function (pos) {
                        if (pos < index || pos === index && source === _emitter4.default.sources.USER) return pos;
                        if (length >= 0) {
                            return pos + length;
                        } else {
                            return Math.max(index, pos + length);
                        }
                    });

                    var _map4 = _slicedToArray(_map3, 2);

                    start = _map4[0];
                    end = _map4[1];
                }
                return new _selection.Range(start, end - start);
            }

            exports.expandConfig = expandConfig;
            exports.overload = overload;
            exports.default = Quill;

            /***/ }),
        /* 6 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _text = __webpack_require__(7);

            var _text2 = _interopRequireDefault(_text);

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Inline = function (_Parchment$Inline) {
                _inherits(Inline, _Parchment$Inline);

                function Inline() {
                    _classCallCheck(this, Inline);

                    return _possibleConstructorReturn(this, (Inline.__proto__ || Object.getPrototypeOf(Inline)).apply(this, arguments));
                }

                _createClass(Inline, [{
                    key: 'formatAt',
                    value: function formatAt(index, length, name, value) {
                        if (Inline.compare(this.statics.blotName, name) < 0 && _parchment2.default.query(name, _parchment2.default.Scope.BLOT)) {
                            var blot = this.isolate(index, length);
                            if (value) {
                                blot.wrap(name, value);
                            }
                        } else {
                            _get(Inline.prototype.__proto__ || Object.getPrototypeOf(Inline.prototype), 'formatAt', this).call(this, index, length, name, value);
                        }
                    }
                }, {
                    key: 'optimize',
                    value: function optimize(context) {
                        _get(Inline.prototype.__proto__ || Object.getPrototypeOf(Inline.prototype), 'optimize', this).call(this, context);
                        if (this.parent instanceof Inline && Inline.compare(this.statics.blotName, this.parent.statics.blotName) > 0) {
                            var parent = this.parent.isolate(this.offset(), this.length());
                            this.moveChildren(parent);
                            parent.wrap(this);
                        }
                    }
                }], [{
                    key: 'compare',
                    value: function compare(self, other) {
                        var selfIndex = Inline.order.indexOf(self);
                        var otherIndex = Inline.order.indexOf(other);
                        if (selfIndex >= 0 || otherIndex >= 0) {
                            return selfIndex - otherIndex;
                        } else if (self === other) {
                            return 0;
                        } else if (self < other) {
                            return -1;
                        } else {
                            return 1;
                        }
                    }
                }]);

                return Inline;
            }(_parchment2.default.Inline);

            Inline.allowedChildren = [Inline, _parchment2.default.Embed, _text2.default];
// Lower index means deeper in the DOM tree, since not found (-1) is for embeds
            Inline.order = ['cursor', 'inline', // Must be lower
                'underline', 'strike', 'italic', 'bold', 'script', 'link', 'code' // Must be higher
            ];

            exports.default = Inline;

            /***/ }),
        /* 7 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var TextBlot = function (_Parchment$Text) {
                _inherits(TextBlot, _Parchment$Text);

                function TextBlot() {
                    _classCallCheck(this, TextBlot);

                    return _possibleConstructorReturn(this, (TextBlot.__proto__ || Object.getPrototypeOf(TextBlot)).apply(this, arguments));
                }

                return TextBlot;
            }(_parchment2.default.Text);

            exports.default = TextBlot;

            /***/ }),
        /* 8 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _eventemitter = __webpack_require__(54);

            var _eventemitter2 = _interopRequireDefault(_eventemitter);

            var _logger = __webpack_require__(10);

            var _logger2 = _interopRequireDefault(_logger);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var debug = (0, _logger2.default)('quill:events');

            var EVENTS = ['selectionchange', 'mousedown', 'mouseup', 'click'];

            EVENTS.forEach(function (eventName) {
                document.addEventListener(eventName, function () {
                    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
                        args[_key] = arguments[_key];
                    }

                    [].slice.call(document.querySelectorAll('.ql-container')).forEach(function (node) {
                        // TODO use WeakMap
                        if (node.__quill && node.__quill.emitter) {
                            var _node$__quill$emitter;

                            (_node$__quill$emitter = node.__quill.emitter).handleDOM.apply(_node$__quill$emitter, args);
                        }
                    });
                });
            });

            var Emitter = function (_EventEmitter) {
                _inherits(Emitter, _EventEmitter);

                function Emitter() {
                    _classCallCheck(this, Emitter);

                    var _this = _possibleConstructorReturn(this, (Emitter.__proto__ || Object.getPrototypeOf(Emitter)).call(this));

                    _this.listeners = {};
                    _this.on('error', debug.error);
                    return _this;
                }

                _createClass(Emitter, [{
                    key: 'emit',
                    value: function emit() {
                        debug.log.apply(debug, arguments);
                        _get(Emitter.prototype.__proto__ || Object.getPrototypeOf(Emitter.prototype), 'emit', this).apply(this, arguments);
                    }
                }, {
                    key: 'handleDOM',
                    value: function handleDOM(event) {
                        for (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
                            args[_key2 - 1] = arguments[_key2];
                        }

                        (this.listeners[event.type] || []).forEach(function (_ref) {
                            var node = _ref.node,
                                handler = _ref.handler;

                            if (event.target === node || node.contains(event.target)) {
                                handler.apply(undefined, [event].concat(args));
                            }
                        });
                    }
                }, {
                    key: 'listenDOM',
                    value: function listenDOM(eventName, node, handler) {
                        if (!this.listeners[eventName]) {
                            this.listeners[eventName] = [];
                        }
                        this.listeners[eventName].push({ node: node, handler: handler });
                    }
                }]);

                return Emitter;
            }(_eventemitter2.default);

            Emitter.events = {
                EDITOR_CHANGE: 'editor-change',
                SCROLL_BEFORE_UPDATE: 'scroll-before-update',
                SCROLL_OPTIMIZE: 'scroll-optimize',
                SCROLL_UPDATE: 'scroll-update',
                SELECTION_CHANGE: 'selection-change',
                TEXT_CHANGE: 'text-change'
            };
            Emitter.sources = {
                API: 'api',
                SILENT: 'silent',
                USER: 'user'
            };

            exports.default = Emitter;

            /***/ }),
        /* 9 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            var Module = function Module(quill) {
                var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

                _classCallCheck(this, Module);

                this.quill = quill;
                this.options = options;
            };

            Module.DEFAULTS = {};

            exports.default = Module;

            /***/ }),
        /* 10 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            var levels = ['error', 'warn', 'log', 'info'];
            var level = 'warn';

            function debug(method) {
                if (levels.indexOf(method) <= levels.indexOf(level)) {
                    var _console;

                    for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
                        args[_key - 1] = arguments[_key];
                    }

                    (_console = console)[method].apply(_console, args); // eslint-disable-line no-console
                }
            }

            function namespace(ns) {
                return levels.reduce(function (logger, method) {
                    logger[method] = debug.bind(console, method, ns);
                    return logger;
                }, {});
            }

            debug.level = namespace.level = function (newLevel) {
                level = newLevel;
            };

            exports.default = namespace;

            /***/ }),
        /* 11 */
        /***/ (function(module, exports, __webpack_require__) {

            var pSlice = Array.prototype.slice;
            var objectKeys = __webpack_require__(52);
            var isArguments = __webpack_require__(53);

            var deepEqual = module.exports = function (actual, expected, opts) {
                if (!opts) opts = {};
                // 7.1. All identical values are equivalent, as determined by ===.
                if (actual === expected) {
                    return true;

                } else if (actual instanceof Date && expected instanceof Date) {
                    return actual.getTime() === expected.getTime();

                    // 7.3. Other pairs that do not both pass typeof value == 'object',
                    // equivalence is determined by ==.
                } else if (!actual || !expected || typeof actual != 'object' && typeof expected != 'object') {
                    return opts.strict ? actual === expected : actual == expected;

                    // 7.4. For all other Object pairs, including Array objects, equivalence is
                    // determined by having the same number of owned properties (as verified
                    // with Object.prototype.hasOwnProperty.call), the same set of keys
                    // (although not necessarily the same order), equivalent values for every
                    // corresponding key, and an identical 'prototype' property. Note: this
                    // accounts for both named and indexed properties on Arrays.
                } else {
                    return objEquiv(actual, expected, opts);
                }
            }

            function isUndefinedOrNull(value) {
                return value === null || value === undefined;
            }

            function isBuffer (x) {
                if (!x || typeof x !== 'object' || typeof x.length !== 'number') return false;
                if (typeof x.copy !== 'function' || typeof x.slice !== 'function') {
                    return false;
                }
                if (x.length > 0 && typeof x[0] !== 'number') return false;
                return true;
            }

            function objEquiv(a, b, opts) {
                var i, key;
                if (isUndefinedOrNull(a) || isUndefinedOrNull(b))
                    return false;
                // an identical 'prototype' property.
                if (a.prototype !== b.prototype) return false;
                //~~~I've managed to break Object.keys through screwy arguments passing.
                //   Converting to array solves the problem.
                if (isArguments(a)) {
                    if (!isArguments(b)) {
                        return false;
                    }
                    a = pSlice.call(a);
                    b = pSlice.call(b);
                    return deepEqual(a, b, opts);
                }
                if (isBuffer(a)) {
                    if (!isBuffer(b)) {
                        return false;
                    }
                    if (a.length !== b.length) return false;
                    for (i = 0; i < a.length; i++) {
                        if (a[i] !== b[i]) return false;
                    }
                    return true;
                }
                try {
                    var ka = objectKeys(a),
                        kb = objectKeys(b);
                } catch (e) {//happens when one is a string literal and the other isn't
                    return false;
                }
                // having the same number of owned properties (keys incorporates
                // hasOwnProperty)
                if (ka.length != kb.length)
                    return false;
                //the same set of keys (although not necessarily the same order),
                ka.sort();
                kb.sort();
                //~~~cheap key test
                for (i = ka.length - 1; i >= 0; i--) {
                    if (ka[i] != kb[i])
                        return false;
                }
                //equivalent values for every corresponding key, and
                //~~~possibly expensive deep test
                for (i = ka.length - 1; i >= 0; i--) {
                    key = ka[i];
                    if (!deepEqual(a[key], b[key], opts)) return false;
                }
                return typeof a === typeof b;
            }


            /***/ }),
        /* 12 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            Object.defineProperty(exports, "__esModule", { value: true });
            var Registry = __webpack_require__(1);
            var Attributor = /** @class */ (function () {
                function Attributor(attrName, keyName, options) {
                    if (options === void 0) { options = {}; }
                    this.attrName = attrName;
                    this.keyName = keyName;
                    var attributeBit = Registry.Scope.TYPE & Registry.Scope.ATTRIBUTE;
                    if (options.scope != null) {
                        // Ignore type bits, force attribute bit
                        this.scope = (options.scope & Registry.Scope.LEVEL) | attributeBit;
                    }
                    else {
                        this.scope = Registry.Scope.ATTRIBUTE;
                    }
                    if (options.whitelist != null)
                        this.whitelist = options.whitelist;
                }
                Attributor.keys = function (node) {
                    return [].map.call(node.attributes, function (item) {
                        return item.name;
                    });
                };
                Attributor.prototype.add = function (node, value) {
                    if (!this.canAdd(node, value))
                        return false;
                    node.setAttribute(this.keyName, value);
                    return true;
                };
                Attributor.prototype.canAdd = function (node, value) {
                    var match = Registry.query(node, Registry.Scope.BLOT & (this.scope | Registry.Scope.TYPE));
                    if (match == null)
                        return false;
                    if (this.whitelist == null)
                        return true;
                    if (typeof value === 'string') {
                        return this.whitelist.indexOf(value.replace(/["']/g, '')) > -1;
                    }
                    else {
                        return this.whitelist.indexOf(value) > -1;
                    }
                };
                Attributor.prototype.remove = function (node) {
                    node.removeAttribute(this.keyName);
                };
                Attributor.prototype.value = function (node) {
                    var value = node.getAttribute(this.keyName);
                    if (this.canAdd(node, value) && value) {
                        return value;
                    }
                    return '';
                };
                return Attributor;
            }());
            exports.default = Attributor;


            /***/ }),
        /* 13 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.default = exports.Code = undefined;

            var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _quillDelta = __webpack_require__(2);

            var _quillDelta2 = _interopRequireDefault(_quillDelta);

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _block = __webpack_require__(4);

            var _block2 = _interopRequireDefault(_block);

            var _inline = __webpack_require__(6);

            var _inline2 = _interopRequireDefault(_inline);

            var _text = __webpack_require__(7);

            var _text2 = _interopRequireDefault(_text);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Code = function (_Inline) {
                _inherits(Code, _Inline);

                function Code() {
                    _classCallCheck(this, Code);

                    return _possibleConstructorReturn(this, (Code.__proto__ || Object.getPrototypeOf(Code)).apply(this, arguments));
                }

                return Code;
            }(_inline2.default);

            Code.blotName = 'code';
            Code.tagName = 'CODE';

            var CodeBlock = function (_Block) {
                _inherits(CodeBlock, _Block);

                function CodeBlock() {
                    _classCallCheck(this, CodeBlock);

                    return _possibleConstructorReturn(this, (CodeBlock.__proto__ || Object.getPrototypeOf(CodeBlock)).apply(this, arguments));
                }

                _createClass(CodeBlock, [{
                    key: 'delta',
                    value: function delta() {
                        var _this3 = this;

                        var text = this.domNode.textContent;
                        if (text.endsWith('\n')) {
                            // Should always be true
                            text = text.slice(0, -1);
                        }
                        return text.split('\n').reduce(function (delta, frag) {
                            return delta.insert(frag).insert('\n', _this3.formats());
                        }, new _quillDelta2.default());
                    }
                }, {
                    key: 'format',
                    value: function format(name, value) {
                        if (name === this.statics.blotName && value) return;

                        var _descendant = this.descendant(_text2.default, this.length() - 1),
                            _descendant2 = _slicedToArray(_descendant, 1),
                            text = _descendant2[0];

                        if (text != null) {
                            text.deleteAt(text.length() - 1, 1);
                        }
                        _get(CodeBlock.prototype.__proto__ || Object.getPrototypeOf(CodeBlock.prototype), 'format', this).call(this, name, value);
                    }
                }, {
                    key: 'formatAt',
                    value: function formatAt(index, length, name, value) {
                        if (length === 0) return;
                        if (_parchment2.default.query(name, _parchment2.default.Scope.BLOCK) == null || name === this.statics.blotName && value === this.statics.formats(this.domNode)) {
                            return;
                        }
                        var nextNewline = this.newlineIndex(index);
                        if (nextNewline < 0 || nextNewline >= index + length) return;
                        var prevNewline = this.newlineIndex(index, true) + 1;
                        var isolateLength = nextNewline - prevNewline + 1;
                        var blot = this.isolate(prevNewline, isolateLength);
                        var next = blot.next;
                        blot.format(name, value);
                        if (next instanceof CodeBlock) {
                            next.formatAt(0, index - prevNewline + length - isolateLength, name, value);
                        }
                    }
                }, {
                    key: 'insertAt',
                    value: function insertAt(index, value, def) {
                        if (def != null) return;

                        var _descendant3 = this.descendant(_text2.default, index),
                            _descendant4 = _slicedToArray(_descendant3, 2),
                            text = _descendant4[0],
                            offset = _descendant4[1];

                        text.insertAt(offset, value);
                    }
                }, {
                    key: 'length',
                    value: function length() {
                        var length = this.domNode.textContent.length;
                        if (!this.domNode.textContent.endsWith('\n')) {
                            return length + 1;
                        }
                        return length;
                    }
                }, {
                    key: 'newlineIndex',
                    value: function newlineIndex(searchIndex) {
                        var reverse = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

                        if (!reverse) {
                            var offset = this.domNode.textContent.slice(searchIndex).indexOf('\n');
                            return offset > -1 ? searchIndex + offset : -1;
                        } else {
                            return this.domNode.textContent.slice(0, searchIndex).lastIndexOf('\n');
                        }
                    }
                }, {
                    key: 'optimize',
                    value: function optimize(context) {
                        if (!this.domNode.textContent.endsWith('\n')) {
                            this.appendChild(_parchment2.default.create('text', '\n'));
                        }
                        _get(CodeBlock.prototype.__proto__ || Object.getPrototypeOf(CodeBlock.prototype), 'optimize', this).call(this, context);
                        var next = this.next;
                        if (next != null && next.prev === this && next.statics.blotName === this.statics.blotName && this.statics.formats(this.domNode) === next.statics.formats(next.domNode)) {
                            next.optimize(context);
                            next.moveChildren(this);
                            next.remove();
                        }
                    }
                }, {
                    key: 'replace',
                    value: function replace(target) {
                        _get(CodeBlock.prototype.__proto__ || Object.getPrototypeOf(CodeBlock.prototype), 'replace', this).call(this, target);
                        [].slice.call(this.domNode.querySelectorAll('*')).forEach(function (node) {
                            var blot = _parchment2.default.find(node);
                            if (blot == null) {
                                node.parentNode.removeChild(node);
                            } else if (blot instanceof _parchment2.default.Embed) {
                                blot.remove();
                            } else {
                                blot.unwrap();
                            }
                        });
                    }
                }], [{
                    key: 'create',
                    value: function create(value) {
                        var domNode = _get(CodeBlock.__proto__ || Object.getPrototypeOf(CodeBlock), 'create', this).call(this, value);
                        domNode.setAttribute('spellcheck', false);
                        return domNode;
                    }
                }, {
                    key: 'formats',
                    value: function formats() {
                        return true;
                    }
                }]);

                return CodeBlock;
            }(_block2.default);

            CodeBlock.blotName = 'code-block';
            CodeBlock.tagName = 'PRE';
            CodeBlock.TAB = '  ';

            exports.Code = Code;
            exports.default = CodeBlock;

            /***/ }),
        /* 14 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

            var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _quillDelta = __webpack_require__(2);

            var _quillDelta2 = _interopRequireDefault(_quillDelta);

            var _op = __webpack_require__(20);

            var _op2 = _interopRequireDefault(_op);

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _code = __webpack_require__(13);

            var _code2 = _interopRequireDefault(_code);

            var _cursor = __webpack_require__(24);

            var _cursor2 = _interopRequireDefault(_cursor);

            var _block = __webpack_require__(4);

            var _block2 = _interopRequireDefault(_block);

            var _break = __webpack_require__(16);

            var _break2 = _interopRequireDefault(_break);

            var _clone = __webpack_require__(21);

            var _clone2 = _interopRequireDefault(_clone);

            var _deepEqual = __webpack_require__(11);

            var _deepEqual2 = _interopRequireDefault(_deepEqual);

            var _extend = __webpack_require__(3);

            var _extend2 = _interopRequireDefault(_extend);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            var ASCII = /^[ -~]*$/;

            var Editor = function () {
                function Editor(scroll) {
                    _classCallCheck(this, Editor);

                    this.scroll = scroll;
                    this.delta = this.getDelta();
                }

                _createClass(Editor, [{
                    key: 'applyDelta',
                    value: function applyDelta(delta) {
                        var _this = this;

                        var consumeNextNewline = false;
                        this.scroll.update();
                        var scrollLength = this.scroll.length();
                        this.scroll.batchStart();
                        delta = normalizeDelta(delta);
                        delta.reduce(function (index, op) {
                            var length = op.retain || op.delete || op.insert.length || 1;
                            var attributes = op.attributes || {};
                            if (op.insert != null) {
                                if (typeof op.insert === 'string') {
                                    var text = op.insert;
                                    if (text.endsWith('\n') && consumeNextNewline) {
                                        consumeNextNewline = false;
                                        text = text.slice(0, -1);
                                    }
                                    if (index >= scrollLength && !text.endsWith('\n')) {
                                        consumeNextNewline = true;
                                    }
                                    _this.scroll.insertAt(index, text);

                                    var _scroll$line = _this.scroll.line(index),
                                        _scroll$line2 = _slicedToArray(_scroll$line, 2),
                                        line = _scroll$line2[0],
                                        offset = _scroll$line2[1];

                                    var formats = (0, _extend2.default)({}, (0, _block.bubbleFormats)(line));
                                    if (line instanceof _block2.default) {
                                        var _line$descendant = line.descendant(_parchment2.default.Leaf, offset),
                                            _line$descendant2 = _slicedToArray(_line$descendant, 1),
                                            leaf = _line$descendant2[0];

                                        formats = (0, _extend2.default)(formats, (0, _block.bubbleFormats)(leaf));
                                    }
                                    attributes = _op2.default.attributes.diff(formats, attributes) || {};
                                } else if (_typeof(op.insert) === 'object') {
                                    var key = Object.keys(op.insert)[0]; // There should only be one key
                                    if (key == null) return index;
                                    _this.scroll.insertAt(index, key, op.insert[key]);
                                }
                                scrollLength += length;
                            }
                            Object.keys(attributes).forEach(function (name) {
                                _this.scroll.formatAt(index, length, name, attributes[name]);
                            });
                            return index + length;
                        }, 0);
                        delta.reduce(function (index, op) {
                            if (typeof op.delete === 'number') {
                                _this.scroll.deleteAt(index, op.delete);
                                return index;
                            }
                            return index + (op.retain || op.insert.length || 1);
                        }, 0);
                        this.scroll.batchEnd();
                        return this.update(delta);
                    }
                }, {
                    key: 'deleteText',
                    value: function deleteText(index, length) {
                        this.scroll.deleteAt(index, length);
                        return this.update(new _quillDelta2.default().retain(index).delete(length));
                    }
                }, {
                    key: 'formatLine',
                    value: function formatLine(index, length) {
                        var _this2 = this;

                        var formats = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

                        this.scroll.update();
                        Object.keys(formats).forEach(function (format) {
                            if (_this2.scroll.whitelist != null && !_this2.scroll.whitelist[format]) return;
                            var lines = _this2.scroll.lines(index, Math.max(length, 1));
                            var lengthRemaining = length;
                            lines.forEach(function (line) {
                                var lineLength = line.length();
                                if (!(line instanceof _code2.default)) {
                                    line.format(format, formats[format]);
                                } else {
                                    var codeIndex = index - line.offset(_this2.scroll);
                                    var codeLength = line.newlineIndex(codeIndex + lengthRemaining) - codeIndex + 1;
                                    line.formatAt(codeIndex, codeLength, format, formats[format]);
                                }
                                lengthRemaining -= lineLength;
                            });
                        });
                        this.scroll.optimize();
                        return this.update(new _quillDelta2.default().retain(index).retain(length, (0, _clone2.default)(formats)));
                    }
                }, {
                    key: 'formatText',
                    value: function formatText(index, length) {
                        var _this3 = this;

                        var formats = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

                        Object.keys(formats).forEach(function (format) {
                            _this3.scroll.formatAt(index, length, format, formats[format]);
                        });
                        return this.update(new _quillDelta2.default().retain(index).retain(length, (0, _clone2.default)(formats)));
                    }
                }, {
                    key: 'getContents',
                    value: function getContents(index, length) {
                        return this.delta.slice(index, index + length);
                    }
                }, {
                    key: 'getDelta',
                    value: function getDelta() {
                        return this.scroll.lines().reduce(function (delta, line) {
                            return delta.concat(line.delta());
                        }, new _quillDelta2.default());
                    }
                }, {
                    key: 'getFormat',
                    value: function getFormat(index) {
                        var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

                        var lines = [],
                            leaves = [];
                        if (length === 0) {
                            this.scroll.path(index).forEach(function (path) {
                                var _path = _slicedToArray(path, 1),
                                    blot = _path[0];

                                if (blot instanceof _block2.default) {
                                    lines.push(blot);
                                } else if (blot instanceof _parchment2.default.Leaf) {
                                    leaves.push(blot);
                                }
                            });
                        } else {
                            lines = this.scroll.lines(index, length);
                            leaves = this.scroll.descendants(_parchment2.default.Leaf, index, length);
                        }
                        var formatsArr = [lines, leaves].map(function (blots) {
                            if (blots.length === 0) return {};
                            var formats = (0, _block.bubbleFormats)(blots.shift());
                            while (Object.keys(formats).length > 0) {
                                var blot = blots.shift();
                                if (blot == null) return formats;
                                formats = combineFormats((0, _block.bubbleFormats)(blot), formats);
                            }
                            return formats;
                        });
                        return _extend2.default.apply(_extend2.default, formatsArr);
                    }
                }, {
                    key: 'getText',
                    value: function getText(index, length) {
                        return this.getContents(index, length).filter(function (op) {
                            return typeof op.insert === 'string';
                        }).map(function (op) {
                            return op.insert;
                        }).join('');
                    }
                }, {
                    key: 'insertEmbed',
                    value: function insertEmbed(index, embed, value) {
                        this.scroll.insertAt(index, embed, value);
                        return this.update(new _quillDelta2.default().retain(index).insert(_defineProperty({}, embed, value)));
                    }
                }, {
                    key: 'insertText',
                    value: function insertText(index, text) {
                        var _this4 = this;

                        var formats = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

                        text = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
                        this.scroll.insertAt(index, text);
                        Object.keys(formats).forEach(function (format) {
                            _this4.scroll.formatAt(index, text.length, format, formats[format]);
                        });
                        return this.update(new _quillDelta2.default().retain(index).insert(text, (0, _clone2.default)(formats)));
                    }
                }, {
                    key: 'isBlank',
                    value: function isBlank() {
                        if (this.scroll.children.length == 0) return true;
                        if (this.scroll.children.length > 1) return false;
                        var block = this.scroll.children.head;
                        if (block.statics.blotName !== _block2.default.blotName) return false;
                        if (block.children.length > 1) return false;
                        return block.children.head instanceof _break2.default;
                    }
                }, {
                    key: 'removeFormat',
                    value: function removeFormat(index, length) {
                        var text = this.getText(index, length);

                        var _scroll$line3 = this.scroll.line(index + length),
                            _scroll$line4 = _slicedToArray(_scroll$line3, 2),
                            line = _scroll$line4[0],
                            offset = _scroll$line4[1];

                        var suffixLength = 0,
                            suffix = new _quillDelta2.default();
                        if (line != null) {
                            if (!(line instanceof _code2.default)) {
                                suffixLength = line.length() - offset;
                            } else {
                                suffixLength = line.newlineIndex(offset) - offset + 1;
                            }
                            suffix = line.delta().slice(offset, offset + suffixLength - 1).insert('\n');
                        }
                        var contents = this.getContents(index, length + suffixLength);
                        var diff = contents.diff(new _quillDelta2.default().insert(text).concat(suffix));
                        var delta = new _quillDelta2.default().retain(index).concat(diff);
                        return this.applyDelta(delta);
                    }
                }, {
                    key: 'update',
                    value: function update(change) {
                        var mutations = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
                        var cursorIndex = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : undefined;

                        var oldDelta = this.delta;
                        if (mutations.length === 1 && mutations[0].type === 'characterData' && mutations[0].target.data.match(ASCII) && _parchment2.default.find(mutations[0].target)) {
                            // Optimization for character changes
                            var textBlot = _parchment2.default.find(mutations[0].target);
                            var formats = (0, _block.bubbleFormats)(textBlot);
                            var index = textBlot.offset(this.scroll);
                            var oldValue = mutations[0].oldValue.replace(_cursor2.default.CONTENTS, '');
                            var oldText = new _quillDelta2.default().insert(oldValue);
                            var newText = new _quillDelta2.default().insert(textBlot.value());
                            var diffDelta = new _quillDelta2.default().retain(index).concat(oldText.diff(newText, cursorIndex));
                            change = diffDelta.reduce(function (delta, op) {
                                if (op.insert) {
                                    return delta.insert(op.insert, formats);
                                } else {
                                    return delta.push(op);
                                }
                            }, new _quillDelta2.default());
                            this.delta = oldDelta.compose(change);
                        } else {
                            this.delta = this.getDelta();
                            if (!change || !(0, _deepEqual2.default)(oldDelta.compose(change), this.delta)) {
                                change = oldDelta.diff(this.delta, cursorIndex);
                            }
                        }
                        return change;
                    }
                }]);

                return Editor;
            }();

            function combineFormats(formats, combined) {
                return Object.keys(combined).reduce(function (merged, name) {
                    if (formats[name] == null) return merged;
                    if (combined[name] === formats[name]) {
                        merged[name] = combined[name];
                    } else if (Array.isArray(combined[name])) {
                        if (combined[name].indexOf(formats[name]) < 0) {
                            merged[name] = combined[name].concat([formats[name]]);
                        }
                    } else {
                        merged[name] = [combined[name], formats[name]];
                    }
                    return merged;
                }, {});
            }

            function normalizeDelta(delta) {
                return delta.reduce(function (delta, op) {
                    if (op.insert === 1) {
                        var attributes = (0, _clone2.default)(op.attributes);
                        delete attributes['image'];
                        return delta.insert({ image: op.attributes.image }, attributes);
                    }
                    if (op.attributes != null && (op.attributes.list === true || op.attributes.bullet === true)) {
                        op = (0, _clone2.default)(op);
                        if (op.attributes.list) {
                            op.attributes.list = 'ordered';
                        } else {
                            op.attributes.list = 'bullet';
                            delete op.attributes.bullet;
                        }
                    }
                    if (typeof op.insert === 'string') {
                        var text = op.insert.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
                        return delta.insert(text, op.attributes);
                    }
                    return delta.push(op);
                }, new _quillDelta2.default());
            }

            exports.default = Editor;

            /***/ }),
        /* 15 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.default = exports.Range = undefined;

            var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _clone = __webpack_require__(21);

            var _clone2 = _interopRequireDefault(_clone);

            var _deepEqual = __webpack_require__(11);

            var _deepEqual2 = _interopRequireDefault(_deepEqual);

            var _emitter3 = __webpack_require__(8);

            var _emitter4 = _interopRequireDefault(_emitter3);

            var _logger = __webpack_require__(10);

            var _logger2 = _interopRequireDefault(_logger);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            var debug = (0, _logger2.default)('quill:selection');

            var Range = function Range(index) {
                var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

                _classCallCheck(this, Range);

                this.index = index;
                this.length = length;
            };

            var Selection = function () {
                function Selection(scroll, emitter) {
                    var _this = this;

                    _classCallCheck(this, Selection);

                    this.emitter = emitter;
                    this.scroll = scroll;
                    this.composing = false;
                    this.mouseDown = false;
                    this.root = this.scroll.domNode;
                    this.cursor = _parchment2.default.create('cursor', this);
                    // savedRange is last non-null range
                    this.lastRange = this.savedRange = new Range(0, 0);
                    this.handleComposition();
                    this.handleDragging();
                    this.emitter.listenDOM('selectionchange', document, function () {
                        if (!_this.mouseDown) {
                            setTimeout(_this.update.bind(_this, _emitter4.default.sources.USER), 1);
                        }
                    });
                    this.emitter.on(_emitter4.default.events.EDITOR_CHANGE, function (type, delta) {
                        if (type === _emitter4.default.events.TEXT_CHANGE && delta.length() > 0) {
                            _this.update(_emitter4.default.sources.SILENT);
                        }
                    });
                    this.emitter.on(_emitter4.default.events.SCROLL_BEFORE_UPDATE, function () {
                        if (!_this.hasFocus()) return;
                        var native = _this.getNativeRange();
                        if (native == null) return;
                        if (native.start.node === _this.cursor.textNode) return; // cursor.restore() will handle
                        // TODO unclear if this has negative side effects
                        _this.emitter.once(_emitter4.default.events.SCROLL_UPDATE, function () {
                            try {
                                _this.setNativeRange(native.start.node, native.start.offset, native.end.node, native.end.offset);
                            } catch (ignored) {}
                        });
                    });
                    this.emitter.on(_emitter4.default.events.SCROLL_OPTIMIZE, function (mutations, context) {
                        if (context.range) {
                            var _context$range = context.range,
                                startNode = _context$range.startNode,
                                startOffset = _context$range.startOffset,
                                endNode = _context$range.endNode,
                                endOffset = _context$range.endOffset;

                            _this.setNativeRange(startNode, startOffset, endNode, endOffset);
                        }
                    });
                    this.update(_emitter4.default.sources.SILENT);
                }

                _createClass(Selection, [{
                    key: 'handleComposition',
                    value: function handleComposition() {
                        var _this2 = this;

                        this.root.addEventListener('compositionstart', function () {
                            _this2.composing = true;
                        });
                        this.root.addEventListener('compositionend', function () {
                            _this2.composing = false;
                            if (_this2.cursor.parent) {
                                var range = _this2.cursor.restore();
                                if (!range) return;
                                setTimeout(function () {
                                    _this2.setNativeRange(range.startNode, range.startOffset, range.endNode, range.endOffset);
                                }, 1);
                            }
                        });
                    }
                }, {
                    key: 'handleDragging',
                    value: function handleDragging() {
                        var _this3 = this;

                        this.emitter.listenDOM('mousedown', document.body, function () {
                            _this3.mouseDown = true;
                        });
                        this.emitter.listenDOM('mouseup', document.body, function () {
                            _this3.mouseDown = false;
                            _this3.update(_emitter4.default.sources.USER);
                        });
                    }
                }, {
                    key: 'focus',
                    value: function focus() {
                        if (this.hasFocus()) return;
                        this.root.focus();
                        this.setRange(this.savedRange);
                    }
                }, {
                    key: 'format',
                    value: function format(_format, value) {
                        if (this.scroll.whitelist != null && !this.scroll.whitelist[_format]) return;
                        this.scroll.update();
                        var nativeRange = this.getNativeRange();
                        if (nativeRange == null || !nativeRange.native.collapsed || _parchment2.default.query(_format, _parchment2.default.Scope.BLOCK)) return;
                        if (nativeRange.start.node !== this.cursor.textNode) {
                            var blot = _parchment2.default.find(nativeRange.start.node, false);
                            if (blot == null) return;
                            // TODO Give blot ability to not split
                            if (blot instanceof _parchment2.default.Leaf) {
                                var after = blot.split(nativeRange.start.offset);
                                blot.parent.insertBefore(this.cursor, after);
                            } else {
                                blot.insertBefore(this.cursor, nativeRange.start.node); // Should never happen
                            }
                            this.cursor.attach();
                        }
                        this.cursor.format(_format, value);
                        this.scroll.optimize();
                        this.setNativeRange(this.cursor.textNode, this.cursor.textNode.data.length);
                        this.update();
                    }
                }, {
                    key: 'getBounds',
                    value: function getBounds(index) {
                        var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

                        var scrollLength = this.scroll.length();
                        index = Math.min(index, scrollLength - 1);
                        length = Math.min(index + length, scrollLength - 1) - index;
                        var node = void 0,
                            _scroll$leaf = this.scroll.leaf(index),
                            _scroll$leaf2 = _slicedToArray(_scroll$leaf, 2),
                            leaf = _scroll$leaf2[0],
                            offset = _scroll$leaf2[1];
                        if (leaf == null) return null;

                        var _leaf$position = leaf.position(offset, true);

                        var _leaf$position2 = _slicedToArray(_leaf$position, 2);

                        node = _leaf$position2[0];
                        offset = _leaf$position2[1];

                        var range = document.createRange();
                        if (length > 0) {
                            range.setStart(node, offset);

                            var _scroll$leaf3 = this.scroll.leaf(index + length);

                            var _scroll$leaf4 = _slicedToArray(_scroll$leaf3, 2);

                            leaf = _scroll$leaf4[0];
                            offset = _scroll$leaf4[1];

                            if (leaf == null) return null;

                            var _leaf$position3 = leaf.position(offset, true);

                            var _leaf$position4 = _slicedToArray(_leaf$position3, 2);

                            node = _leaf$position4[0];
                            offset = _leaf$position4[1];

                            range.setEnd(node, offset);
                            return range.getBoundingClientRect();
                        } else {
                            var side = 'left';
                            var rect = void 0;
                            if (node instanceof Text) {
                                if (offset < node.data.length) {
                                    range.setStart(node, offset);
                                    range.setEnd(node, offset + 1);
                                } else {
                                    range.setStart(node, offset - 1);
                                    range.setEnd(node, offset);
                                    side = 'right';
                                }
                                rect = range.getBoundingClientRect();
                            } else {
                                rect = leaf.domNode.getBoundingClientRect();
                                if (offset > 0) side = 'right';
                            }
                            return {
                                bottom: rect.top + rect.height,
                                height: rect.height,
                                left: rect[side],
                                right: rect[side],
                                top: rect.top,
                                width: 0
                            };
                        }
                    }
                }, {
                    key: 'getNativeRange',
                    value: function getNativeRange() {
                        var selection = document.getSelection();
                        if (selection == null || selection.rangeCount <= 0) return null;
                        var nativeRange = selection.getRangeAt(0);
                        if (nativeRange == null) return null;
                        var range = this.normalizeNative(nativeRange);
                        debug.info('getNativeRange', range);
                        return range;
                    }
                }, {
                    key: 'getRange',
                    value: function getRange() {
                        var normalized = this.getNativeRange();
                        if (normalized == null) return [null, null];
                        var range = this.normalizedToRange(normalized);
                        return [range, normalized];
                    }
                }, {
                    key: 'hasFocus',
                    value: function hasFocus() {
                        return document.activeElement === this.root;
                    }
                }, {
                    key: 'normalizedToRange',
                    value: function normalizedToRange(range) {
                        var _this4 = this;

                        var positions = [[range.start.node, range.start.offset]];
                        if (!range.native.collapsed) {
                            positions.push([range.end.node, range.end.offset]);
                        }
                        var indexes = positions.map(function (position) {
                            var _position = _slicedToArray(position, 2),
                                node = _position[0],
                                offset = _position[1];

                            var blot = _parchment2.default.find(node, true);
                            var index = blot.offset(_this4.scroll);
                            if (offset === 0) {
                                return index;
                            } else if (blot instanceof _parchment2.default.Container) {
                                return index + blot.length();
                            } else {
                                return index + blot.index(node, offset);
                            }
                        });
                        var end = Math.min(Math.max.apply(Math, _toConsumableArray(indexes)), this.scroll.length() - 1);
                        var start = Math.min.apply(Math, [end].concat(_toConsumableArray(indexes)));
                        return new Range(start, end - start);
                    }
                }, {
                    key: 'normalizeNative',
                    value: function normalizeNative(nativeRange) {
                        if (!contains(this.root, nativeRange.startContainer) || !nativeRange.collapsed && !contains(this.root, nativeRange.endContainer)) {
                            return null;
                        }
                        var range = {
                            start: { node: nativeRange.startContainer, offset: nativeRange.startOffset },
                            end: { node: nativeRange.endContainer, offset: nativeRange.endOffset },
                            native: nativeRange
                        };
                        [range.start, range.end].forEach(function (position) {
                            var node = position.node,
                                offset = position.offset;
                            while (!(node instanceof Text) && node.childNodes.length > 0) {
                                if (node.childNodes.length > offset) {
                                    node = node.childNodes[offset];
                                    offset = 0;
                                } else if (node.childNodes.length === offset) {
                                    node = node.lastChild;
                                    offset = node instanceof Text ? node.data.length : node.childNodes.length + 1;
                                } else {
                                    break;
                                }
                            }
                            position.node = node, position.offset = offset;
                        });
                        return range;
                    }
                }, {
                    key: 'rangeToNative',
                    value: function rangeToNative(range) {
                        var _this5 = this;

                        var indexes = range.collapsed ? [range.index] : [range.index, range.index + range.length];
                        var args = [];
                        var scrollLength = this.scroll.length();
                        indexes.forEach(function (index, i) {
                            index = Math.min(scrollLength - 1, index);
                            var node = void 0,
                                _scroll$leaf5 = _this5.scroll.leaf(index),
                                _scroll$leaf6 = _slicedToArray(_scroll$leaf5, 2),
                                leaf = _scroll$leaf6[0],
                                offset = _scroll$leaf6[1];
                            var _leaf$position5 = leaf.position(offset, i !== 0);

                            var _leaf$position6 = _slicedToArray(_leaf$position5, 2);

                            node = _leaf$position6[0];
                            offset = _leaf$position6[1];

                            args.push(node, offset);
                        });
                        if (args.length < 2) {
                            args = args.concat(args);
                        }
                        return args;
                    }
                }, {
                    key: 'scrollIntoView',
                    value: function scrollIntoView(scrollingContainer) {
                        var range = this.lastRange;
                        if (range == null) return;
                        var bounds = this.getBounds(range.index, range.length);
                        if (bounds == null) return;
                        var limit = this.scroll.length() - 1;

                        var _scroll$line = this.scroll.line(Math.min(range.index, limit)),
                            _scroll$line2 = _slicedToArray(_scroll$line, 1),
                            first = _scroll$line2[0];

                        var last = first;
                        if (range.length > 0) {
                            var _scroll$line3 = this.scroll.line(Math.min(range.index + range.length, limit));

                            var _scroll$line4 = _slicedToArray(_scroll$line3, 1);

                            last = _scroll$line4[0];
                        }
                        if (first == null || last == null) return;
                        var scrollBounds = scrollingContainer.getBoundingClientRect();
                        if (bounds.top < scrollBounds.top) {
                            scrollingContainer.scrollTop -= scrollBounds.top - bounds.top;
                        } else if (bounds.bottom > scrollBounds.bottom) {
                            scrollingContainer.scrollTop += bounds.bottom - scrollBounds.bottom;
                        }
                    }
                }, {
                    key: 'setNativeRange',
                    value: function setNativeRange(startNode, startOffset) {
                        var endNode = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : startNode;
                        var endOffset = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : startOffset;
                        var force = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;

                        debug.info('setNativeRange', startNode, startOffset, endNode, endOffset);
                        if (startNode != null && (this.root.parentNode == null || startNode.parentNode == null || endNode.parentNode == null)) {
                            return;
                        }
                        var selection = document.getSelection();
                        if (selection == null) return;
                        if (startNode != null) {
                            if (!this.hasFocus()) this.root.focus();
                            var native = (this.getNativeRange() || {}).native;
                            if (native == null || force || startNode !== native.startContainer || startOffset !== native.startOffset || endNode !== native.endContainer || endOffset !== native.endOffset) {

                                if (startNode.tagName == "BR") {
                                    startOffset = [].indexOf.call(startNode.parentNode.childNodes, startNode);
                                    startNode = startNode.parentNode;
                                }
                                if (endNode.tagName == "BR") {
                                    endOffset = [].indexOf.call(endNode.parentNode.childNodes, endNode);
                                    endNode = endNode.parentNode;
                                }
                                var range = document.createRange();
                                range.setStart(startNode, startOffset);
                                range.setEnd(endNode, endOffset);
                                selection.removeAllRanges();
                                selection.addRange(range);
                            }
                        } else {
                            selection.removeAllRanges();
                            this.root.blur();
                            document.body.focus(); // root.blur() not enough on IE11+Travis+SauceLabs (but not local VMs)
                        }
                    }
                }, {
                    key: 'setRange',
                    value: function setRange(range) {
                        var force = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
                        var source = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _emitter4.default.sources.API;

                        if (typeof force === 'string') {
                            source = force;
                            force = false;
                        }
                        debug.info('setRange', range);
                        if (range != null) {
                            var args = this.rangeToNative(range);
                            this.setNativeRange.apply(this, _toConsumableArray(args).concat([force]));
                        } else {
                            this.setNativeRange(null);
                        }
                        this.update(source);
                    }
                }, {
                    key: 'update',
                    value: function update() {
                        var source = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _emitter4.default.sources.USER;

                        var oldRange = this.lastRange;

                        var _getRange = this.getRange(),
                            _getRange2 = _slicedToArray(_getRange, 2),
                            lastRange = _getRange2[0],
                            nativeRange = _getRange2[1];

                        this.lastRange = lastRange;
                        if (this.lastRange != null) {
                            this.savedRange = this.lastRange;
                        }
                        if (!(0, _deepEqual2.default)(oldRange, this.lastRange)) {
                            var _emitter;

                            if (!this.composing && nativeRange != null && nativeRange.native.collapsed && nativeRange.start.node !== this.cursor.textNode) {
                                this.cursor.restore();
                            }
                            var args = [_emitter4.default.events.SELECTION_CHANGE, (0, _clone2.default)(this.lastRange), (0, _clone2.default)(oldRange), source];
                            (_emitter = this.emitter).emit.apply(_emitter, [_emitter4.default.events.EDITOR_CHANGE].concat(args));
                            if (source !== _emitter4.default.sources.SILENT) {
                                var _emitter2;

                                (_emitter2 = this.emitter).emit.apply(_emitter2, args);
                            }
                        }
                    }
                }]);

                return Selection;
            }();

            function contains(parent, descendant) {
                try {
                    // Firefox inserts inaccessible nodes around video elements
                    descendant.parentNode;
                } catch (e) {
                    return false;
                }
                // IE11 has bug with Text nodes
                // https://connect.microsoft.com/IE/feedback/details/780874/node-contains-is-incorrect
                if (descendant instanceof Text) {
                    descendant = descendant.parentNode;
                }
                return parent.contains(descendant);
            }

            exports.Range = Range;
            exports.default = Selection;

            /***/ }),
        /* 16 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Break = function (_Parchment$Embed) {
                _inherits(Break, _Parchment$Embed);

                function Break() {
                    _classCallCheck(this, Break);

                    return _possibleConstructorReturn(this, (Break.__proto__ || Object.getPrototypeOf(Break)).apply(this, arguments));
                }

                _createClass(Break, [{
                    key: 'insertInto',
                    value: function insertInto(parent, ref) {
                        if (parent.children.length === 0) {
                            _get(Break.prototype.__proto__ || Object.getPrototypeOf(Break.prototype), 'insertInto', this).call(this, parent, ref);
                        } else {
                            this.remove();
                        }
                    }
                }, {
                    key: 'length',
                    value: function length() {
                        return 0;
                    }
                }, {
                    key: 'value',
                    value: function value() {
                        return '';
                    }
                }], [{
                    key: 'value',
                    value: function value() {
                        return undefined;
                    }
                }]);

                return Break;
            }(_parchment2.default.Embed);

            Break.blotName = 'break';
            Break.tagName = 'BR';

            exports.default = Break;

            /***/ }),
        /* 17 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            var __extends = (this && this.__extends) || (function () {
                var extendStatics = Object.setPrototypeOf ||
                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
                return function (d, b) {
                    extendStatics(d, b);
                    function __() { this.constructor = d; }
                    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
                };
            })();
            Object.defineProperty(exports, "__esModule", { value: true });
            var linked_list_1 = __webpack_require__(44);
            var shadow_1 = __webpack_require__(30);
            var Registry = __webpack_require__(1);
            var ContainerBlot = /** @class */ (function (_super) {
                __extends(ContainerBlot, _super);
                function ContainerBlot(domNode) {
                    var _this = _super.call(this, domNode) || this;
                    _this.build();
                    return _this;
                }
                ContainerBlot.prototype.appendChild = function (other) {
                    this.insertBefore(other);
                };
                ContainerBlot.prototype.attach = function () {
                    _super.prototype.attach.call(this);
                    this.children.forEach(function (child) {
                        child.attach();
                    });
                };
                ContainerBlot.prototype.build = function () {
                    var _this = this;
                    this.children = new linked_list_1.default();
                    // Need to be reversed for if DOM nodes already in order
                    [].slice
                        .call(this.domNode.childNodes)
                        .reverse()
                        .forEach(function (node) {
                            try {
                                var child = makeBlot(node);
                                _this.insertBefore(child, _this.children.head || undefined);
                            }
                            catch (err) {
                                if (err instanceof Registry.ParchmentError)
                                    return;
                                else
                                    throw err;
                            }
                        });
                };
                ContainerBlot.prototype.deleteAt = function (index, length) {
                    if (index === 0 && length === this.length()) {
                        return this.remove();
                    }
                    this.children.forEachAt(index, length, function (child, offset, length) {
                        child.deleteAt(offset, length);
                    });
                };
                ContainerBlot.prototype.descendant = function (criteria, index) {
                    var _a = this.children.find(index), child = _a[0], offset = _a[1];
                    if ((criteria.blotName == null && criteria(child)) ||
                        (criteria.blotName != null && child instanceof criteria)) {
                        return [child, offset];
                    }
                    else if (child instanceof ContainerBlot) {
                        return child.descendant(criteria, offset);
                    }
                    else {
                        return [null, -1];
                    }
                };
                ContainerBlot.prototype.descendants = function (criteria, index, length) {
                    if (index === void 0) { index = 0; }
                    if (length === void 0) { length = Number.MAX_VALUE; }
                    var descendants = [];
                    var lengthLeft = length;
                    this.children.forEachAt(index, length, function (child, index, length) {
                        if ((criteria.blotName == null && criteria(child)) ||
                            (criteria.blotName != null && child instanceof criteria)) {
                            descendants.push(child);
                        }
                        if (child instanceof ContainerBlot) {
                            descendants = descendants.concat(child.descendants(criteria, index, lengthLeft));
                        }
                        lengthLeft -= length;
                    });
                    return descendants;
                };
                ContainerBlot.prototype.detach = function () {
                    this.children.forEach(function (child) {
                        child.detach();
                    });
                    _super.prototype.detach.call(this);
                };
                ContainerBlot.prototype.formatAt = function (index, length, name, value) {
                    this.children.forEachAt(index, length, function (child, offset, length) {
                        child.formatAt(offset, length, name, value);
                    });
                };
                ContainerBlot.prototype.insertAt = function (index, value, def) {
                    var _a = this.children.find(index), child = _a[0], offset = _a[1];
                    if (child) {
                        child.insertAt(offset, value, def);
                    }
                    else {
                        var blot = def == null ? Registry.create('text', value) : Registry.create(value, def);
                        this.appendChild(blot);
                    }
                };
                ContainerBlot.prototype.insertBefore = function (childBlot, refBlot) {
                    if (this.statics.allowedChildren != null &&
                        !this.statics.allowedChildren.some(function (child) {
                            return childBlot instanceof child;
                        })) {
                        throw new Registry.ParchmentError("Cannot insert " + childBlot.statics.blotName + " into " + this.statics.blotName);
                    }
                    childBlot.insertInto(this, refBlot);
                };
                ContainerBlot.prototype.length = function () {
                    return this.children.reduce(function (memo, child) {
                        return memo + child.length();
                    }, 0);
                };
                ContainerBlot.prototype.moveChildren = function (targetParent, refNode) {
                    this.children.forEach(function (child) {
                        targetParent.insertBefore(child, refNode);
                    });
                };
                ContainerBlot.prototype.optimize = function (context) {
                    _super.prototype.optimize.call(this, context);
                    if (this.children.length === 0) {
                        if (this.statics.defaultChild != null) {
                            var child = Registry.create(this.statics.defaultChild);
                            this.appendChild(child);
                            child.optimize(context);
                        }
                        else {
                            this.remove();
                        }
                    }
                };
                ContainerBlot.prototype.path = function (index, inclusive) {
                    if (inclusive === void 0) { inclusive = false; }
                    var _a = this.children.find(index, inclusive), child = _a[0], offset = _a[1];
                    var position = [[this, index]];
                    if (child instanceof ContainerBlot) {
                        return position.concat(child.path(offset, inclusive));
                    }
                    else if (child != null) {
                        position.push([child, offset]);
                    }
                    return position;
                };
                ContainerBlot.prototype.removeChild = function (child) {
                    this.children.remove(child);
                };
                ContainerBlot.prototype.replace = function (target) {
                    if (target instanceof ContainerBlot) {
                        target.moveChildren(this);
                    }
                    _super.prototype.replace.call(this, target);
                };
                ContainerBlot.prototype.split = function (index, force) {
                    if (force === void 0) { force = false; }
                    if (!force) {
                        if (index === 0)
                            return this;
                        if (index === this.length())
                            return this.next;
                    }
                    var after = this.clone();
                    this.parent.insertBefore(after, this.next);
                    this.children.forEachAt(index, this.length(), function (child, offset, length) {
                        child = child.split(offset, force);
                        after.appendChild(child);
                    });
                    return after;
                };
                ContainerBlot.prototype.unwrap = function () {
                    this.moveChildren(this.parent, this.next);
                    this.remove();
                };
                ContainerBlot.prototype.update = function (mutations, context) {
                    var _this = this;
                    var addedNodes = [];
                    var removedNodes = [];
                    mutations.forEach(function (mutation) {
                        if (mutation.target === _this.domNode && mutation.type === 'childList') {
                            addedNodes.push.apply(addedNodes, mutation.addedNodes);
                            removedNodes.push.apply(removedNodes, mutation.removedNodes);
                        }
                    });
                    removedNodes.forEach(function (node) {
                        // Check node has actually been removed
                        // One exception is Chrome does not immediately remove IFRAMEs
                        // from DOM but MutationRecord is correct in its reported removal
                        if (node.parentNode != null &&
                            // @ts-ignore
                            node.tagName !== 'IFRAME' &&
                            document.body.compareDocumentPosition(node) & Node.DOCUMENT_POSITION_CONTAINED_BY) {
                            return;
                        }
                        var blot = Registry.find(node);
                        if (blot == null)
                            return;
                        if (blot.domNode.parentNode == null || blot.domNode.parentNode === _this.domNode) {
                            blot.detach();
                        }
                    });
                    addedNodes
                        .filter(function (node) {
                            return node.parentNode == _this.domNode;
                        })
                        .sort(function (a, b) {
                            if (a === b)
                                return 0;
                            if (a.compareDocumentPosition(b) & Node.DOCUMENT_POSITION_FOLLOWING) {
                                return 1;
                            }
                            return -1;
                        })
                        .forEach(function (node) {
                            var refBlot = null;
                            if (node.nextSibling != null) {
                                refBlot = Registry.find(node.nextSibling);
                            }
                            var blot = makeBlot(node);
                            if (blot.next != refBlot || blot.next == null) {
                                if (blot.parent != null) {
                                    blot.parent.removeChild(_this);
                                }
                                _this.insertBefore(blot, refBlot || undefined);
                            }
                        });
                };
                return ContainerBlot;
            }(shadow_1.default));
            function makeBlot(node) {
                var blot = Registry.find(node);
                if (blot == null) {
                    try {
                        blot = Registry.create(node);
                    }
                    catch (e) {
                        blot = Registry.create(Registry.Scope.INLINE);
                        [].slice.call(node.childNodes).forEach(function (child) {
                            // @ts-ignore
                            blot.domNode.appendChild(child);
                        });
                        if (node.parentNode) {
                            node.parentNode.replaceChild(blot.domNode, node);
                        }
                        blot.attach();
                    }
                }
                return blot;
            }
            exports.default = ContainerBlot;


            /***/ }),
        /* 18 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            var __extends = (this && this.__extends) || (function () {
                var extendStatics = Object.setPrototypeOf ||
                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
                return function (d, b) {
                    extendStatics(d, b);
                    function __() { this.constructor = d; }
                    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
                };
            })();
            Object.defineProperty(exports, "__esModule", { value: true });
            var attributor_1 = __webpack_require__(12);
            var store_1 = __webpack_require__(31);
            var container_1 = __webpack_require__(17);
            var Registry = __webpack_require__(1);
            var FormatBlot = /** @class */ (function (_super) {
                __extends(FormatBlot, _super);
                function FormatBlot(domNode) {
                    var _this = _super.call(this, domNode) || this;
                    _this.attributes = new store_1.default(_this.domNode);
                    return _this;
                }
                FormatBlot.formats = function (domNode) {
                    if (typeof this.tagName === 'string') {
                        return true;
                    }
                    else if (Array.isArray(this.tagName)) {
                        return domNode.tagName.toLowerCase();
                    }
                    return undefined;
                };
                FormatBlot.prototype.format = function (name, value) {
                    var format = Registry.query(name);
                    if (format instanceof attributor_1.default) {
                        this.attributes.attribute(format, value);
                    }
                    else if (value) {
                        if (format != null && (name !== this.statics.blotName || this.formats()[name] !== value)) {
                            this.replaceWith(name, value);
                        }
                    }
                };
                FormatBlot.prototype.formats = function () {
                    var formats = this.attributes.values();
                    var format = this.statics.formats(this.domNode);
                    if (format != null) {
                        formats[this.statics.blotName] = format;
                    }
                    return formats;
                };
                FormatBlot.prototype.replaceWith = function (name, value) {
                    var replacement = _super.prototype.replaceWith.call(this, name, value);
                    this.attributes.copy(replacement);
                    return replacement;
                };
                FormatBlot.prototype.update = function (mutations, context) {
                    var _this = this;
                    _super.prototype.update.call(this, mutations, context);
                    if (mutations.some(function (mutation) {
                            return mutation.target === _this.domNode && mutation.type === 'attributes';
                        })) {
                        this.attributes.build();
                    }
                };
                FormatBlot.prototype.wrap = function (name, value) {
                    var wrapper = _super.prototype.wrap.call(this, name, value);
                    if (wrapper instanceof FormatBlot && wrapper.statics.scope === this.statics.scope) {
                        this.attributes.move(wrapper);
                    }
                    return wrapper;
                };
                return FormatBlot;
            }(container_1.default));
            exports.default = FormatBlot;


            /***/ }),
        /* 19 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            var __extends = (this && this.__extends) || (function () {
                var extendStatics = Object.setPrototypeOf ||
                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
                return function (d, b) {
                    extendStatics(d, b);
                    function __() { this.constructor = d; }
                    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
                };
            })();
            Object.defineProperty(exports, "__esModule", { value: true });
            var shadow_1 = __webpack_require__(30);
            var Registry = __webpack_require__(1);
            var LeafBlot = /** @class */ (function (_super) {
                __extends(LeafBlot, _super);
                function LeafBlot() {
                    return _super !== null && _super.apply(this, arguments) || this;
                }
                LeafBlot.value = function (domNode) {
                    return true;
                };
                LeafBlot.prototype.index = function (node, offset) {
                    if (this.domNode === node ||
                        this.domNode.compareDocumentPosition(node) & Node.DOCUMENT_POSITION_CONTAINED_BY) {
                        return Math.min(offset, 1);
                    }
                    return -1;
                };
                LeafBlot.prototype.position = function (index, inclusive) {
                    var offset = [].indexOf.call(this.parent.domNode.childNodes, this.domNode);
                    if (index > 0)
                        offset += 1;
                    return [this.parent.domNode, offset];
                };
                LeafBlot.prototype.value = function () {
                    return _a = {}, _a[this.statics.blotName] = this.statics.value(this.domNode) || true, _a;
                    var _a;
                };
                LeafBlot.scope = Registry.Scope.INLINE_BLOT;
                return LeafBlot;
            }(shadow_1.default));
            exports.default = LeafBlot;


            /***/ }),
        /* 20 */
        /***/ (function(module, exports, __webpack_require__) {

            var equal = __webpack_require__(11);
            var extend = __webpack_require__(3);


            var lib = {
                attributes: {
                    compose: function (a, b, keepNull) {
                        if (typeof a !== 'object') a = {};
                        if (typeof b !== 'object') b = {};
                        var attributes = extend(true, {}, b);
                        if (!keepNull) {
                            attributes = Object.keys(attributes).reduce(function (copy, key) {
                                if (attributes[key] != null) {
                                    copy[key] = attributes[key];
                                }
                                return copy;
                            }, {});
                        }
                        for (var key in a) {
                            if (a[key] !== undefined && b[key] === undefined) {
                                attributes[key] = a[key];
                            }
                        }
                        return Object.keys(attributes).length > 0 ? attributes : undefined;
                    },

                    diff: function(a, b) {
                        if (typeof a !== 'object') a = {};
                        if (typeof b !== 'object') b = {};
                        var attributes = Object.keys(a).concat(Object.keys(b)).reduce(function (attributes, key) {
                            if (!equal(a[key], b[key])) {
                                attributes[key] = b[key] === undefined ? null : b[key];
                            }
                            return attributes;
                        }, {});
                        return Object.keys(attributes).length > 0 ? attributes : undefined;
                    },

                    transform: function (a, b, priority) {
                        if (typeof a !== 'object') return b;
                        if (typeof b !== 'object') return undefined;
                        if (!priority) return b;  // b simply overwrites us without priority
                        var attributes = Object.keys(b).reduce(function (attributes, key) {
                            if (a[key] === undefined) attributes[key] = b[key];  // null is a valid value
                            return attributes;
                        }, {});
                        return Object.keys(attributes).length > 0 ? attributes : undefined;
                    }
                },

                iterator: function (ops) {
                    return new Iterator(ops);
                },

                length: function (op) {
                    if (typeof op['delete'] === 'number') {
                        return op['delete'];
                    } else if (typeof op.retain === 'number') {
                        return op.retain;
                    } else {
                        return typeof op.insert === 'string' ? op.insert.length : 1;
                    }
                }
            };


            function Iterator(ops) {
                this.ops = ops;
                this.index = 0;
                this.offset = 0;
            };

            Iterator.prototype.hasNext = function () {
                return this.peekLength() < Infinity;
            };

            Iterator.prototype.next = function (length) {
                if (!length) length = Infinity;
                var nextOp = this.ops[this.index];
                if (nextOp) {
                    var offset = this.offset;
                    var opLength = lib.length(nextOp)
                    if (length >= opLength - offset) {
                        length = opLength - offset;
                        this.index += 1;
                        this.offset = 0;
                    } else {
                        this.offset += length;
                    }
                    if (typeof nextOp['delete'] === 'number') {
                        return { 'delete': length };
                    } else {
                        var retOp = {};
                        if (nextOp.attributes) {
                            retOp.attributes = nextOp.attributes;
                        }
                        if (typeof nextOp.retain === 'number') {
                            retOp.retain = length;
                        } else if (typeof nextOp.insert === 'string') {
                            retOp.insert = nextOp.insert.substr(offset, length);
                        } else {
                            // offset should === 0, length should === 1
                            retOp.insert = nextOp.insert;
                        }
                        return retOp;
                    }
                } else {
                    return { retain: Infinity };
                }
            };

            Iterator.prototype.peek = function () {
                return this.ops[this.index];
            };

            Iterator.prototype.peekLength = function () {
                if (this.ops[this.index]) {
                    // Should never return 0 if our index is being managed correctly
                    return lib.length(this.ops[this.index]) - this.offset;
                } else {
                    return Infinity;
                }
            };

            Iterator.prototype.peekType = function () {
                if (this.ops[this.index]) {
                    if (typeof this.ops[this.index]['delete'] === 'number') {
                        return 'delete';
                    } else if (typeof this.ops[this.index].retain === 'number') {
                        return 'retain';
                    } else {
                        return 'insert';
                    }
                }
                return 'retain';
            };


            module.exports = lib;


            /***/ }),
        /* 21 */
        /***/ (function(module, exports) {

            var clone = (function() {
                'use strict';

                function _instanceof(obj, type) {
                    return type != null && obj instanceof type;
                }

                var nativeMap;
                try {
                    nativeMap = Map;
                } catch(_) {
                    // maybe a reference error because no `Map`. Give it a dummy value that no
                    // value will ever be an instanceof.
                    nativeMap = function() {};
                }

                var nativeSet;
                try {
                    nativeSet = Set;
                } catch(_) {
                    nativeSet = function() {};
                }

                var nativePromise;
                try {
                    nativePromise = Promise;
                } catch(_) {
                    nativePromise = function() {};
                }

                /**
                 * Clones (copies) an Object using deep copying.
                 *
                 * This function supports circular references by default, but if you are certain
                 * there are no circular references in your object, you can save some CPU time
                 * by calling clone(obj, false).
                 *
                 * Caution: if `circular` is false and `parent` contains circular references,
                 * your program may enter an infinite loop and crash.
                 *
                 * @param `parent` - the object to be cloned
                 * @param `circular` - set to true if the object to be cloned may contain
                 *    circular references. (optional - true by default)
                 * @param `depth` - set to a number if the object is only to be cloned to
                 *    a particular depth. (optional - defaults to Infinity)
                 * @param `prototype` - sets the prototype to be used when cloning an object.
                 *    (optional - defaults to parent prototype).
                 * @param `includeNonEnumerable` - set to true if the non-enumerable properties
                 *    should be cloned as well. Non-enumerable properties on the prototype
                 *    chain will be ignored. (optional - false by default)
                 */
                function clone(parent, circular, depth, prototype, includeNonEnumerable) {
                    if (typeof circular === 'object') {
                        depth = circular.depth;
                        prototype = circular.prototype;
                        includeNonEnumerable = circular.includeNonEnumerable;
                        circular = circular.circular;
                    }
                    // maintain two arrays for circular references, where corresponding parents
                    // and children have the same index
                    var allParents = [];
                    var allChildren = [];

                    var useBuffer = typeof Buffer != 'undefined';

                    if (typeof circular == 'undefined')
                        circular = true;

                    if (typeof depth == 'undefined')
                        depth = Infinity;

                    // recurse this function so we don't reset allParents and allChildren
                    function _clone(parent, depth) {
                        // cloning null always returns null
                        if (parent === null)
                            return null;

                        if (depth === 0)
                            return parent;

                        var child;
                        var proto;
                        if (typeof parent != 'object') {
                            return parent;
                        }

                        if (_instanceof(parent, nativeMap)) {
                            child = new nativeMap();
                        } else if (_instanceof(parent, nativeSet)) {
                            child = new nativeSet();
                        } else if (_instanceof(parent, nativePromise)) {
                            child = new nativePromise(function (resolve, reject) {
                                parent.then(function(value) {
                                    resolve(_clone(value, depth - 1));
                                }, function(err) {
                                    reject(_clone(err, depth - 1));
                                });
                            });
                        } else if (clone.__isArray(parent)) {
                            child = [];
                        } else if (clone.__isRegExp(parent)) {
                            child = new RegExp(parent.source, __getRegExpFlags(parent));
                            if (parent.lastIndex) child.lastIndex = parent.lastIndex;
                        } else if (clone.__isDate(parent)) {
                            child = new Date(parent.getTime());
                        } else if (useBuffer && Buffer.isBuffer(parent)) {
                            child = new Buffer(parent.length);
                            parent.copy(child);
                            return child;
                        } else if (_instanceof(parent, Error)) {
                            child = Object.create(parent);
                        } else {
                            if (typeof prototype == 'undefined') {
                                proto = Object.getPrototypeOf(parent);
                                child = Object.create(proto);
                            }
                            else {
                                child = Object.create(prototype);
                                proto = prototype;
                            }
                        }

                        if (circular) {
                            var index = allParents.indexOf(parent);

                            if (index != -1) {
                                return allChildren[index];
                            }
                            allParents.push(parent);
                            allChildren.push(child);
                        }

                        if (_instanceof(parent, nativeMap)) {
                            parent.forEach(function(value, key) {
                                var keyChild = _clone(key, depth - 1);
                                var valueChild = _clone(value, depth - 1);
                                child.set(keyChild, valueChild);
                            });
                        }
                        if (_instanceof(parent, nativeSet)) {
                            parent.forEach(function(value) {
                                var entryChild = _clone(value, depth - 1);
                                child.add(entryChild);
                            });
                        }

                        for (var i in parent) {
                            var attrs;
                            if (proto) {
                                attrs = Object.getOwnPropertyDescriptor(proto, i);
                            }

                            if (attrs && attrs.set == null) {
                                continue;
                            }
                            child[i] = _clone(parent[i], depth - 1);
                        }

                        if (Object.getOwnPropertySymbols) {
                            var symbols = Object.getOwnPropertySymbols(parent);
                            for (var i = 0; i < symbols.length; i++) {
                                // Don't need to worry about cloning a symbol because it is a primitive,
                                // like a number or string.
                                var symbol = symbols[i];
                                var descriptor = Object.getOwnPropertyDescriptor(parent, symbol);
                                if (descriptor && !descriptor.enumerable && !includeNonEnumerable) {
                                    continue;
                                }
                                child[symbol] = _clone(parent[symbol], depth - 1);
                                if (!descriptor.enumerable) {
                                    Object.defineProperty(child, symbol, {
                                        enumerable: false
                                    });
                                }
                            }
                        }

                        if (includeNonEnumerable) {
                            var allPropertyNames = Object.getOwnPropertyNames(parent);
                            for (var i = 0; i < allPropertyNames.length; i++) {
                                var propertyName = allPropertyNames[i];
                                var descriptor = Object.getOwnPropertyDescriptor(parent, propertyName);
                                if (descriptor && descriptor.enumerable) {
                                    continue;
                                }
                                child[propertyName] = _clone(parent[propertyName], depth - 1);
                                Object.defineProperty(child, propertyName, {
                                    enumerable: false
                                });
                            }
                        }

                        return child;
                    }

                    return _clone(parent, depth);
                }

                /**
                 * Simple flat clone using prototype, accepts only objects, usefull for property
                 * override on FLAT configuration object (no nested props).
                 *
                 * USE WITH CAUTION! This may not behave as you wish if you do not know how this
                 * works.
                 */
                clone.clonePrototype = function clonePrototype(parent) {
                    if (parent === null)
                        return null;

                    var c = function () {};
                    c.prototype = parent;
                    return new c();
                };

// private utility functions

                function __objToStr(o) {
                    return Object.prototype.toString.call(o);
                }
                clone.__objToStr = __objToStr;

                function __isDate(o) {
                    return typeof o === 'object' && __objToStr(o) === '[object Date]';
                }
                clone.__isDate = __isDate;

                function __isArray(o) {
                    return typeof o === 'object' && __objToStr(o) === '[object Array]';
                }
                clone.__isArray = __isArray;

                function __isRegExp(o) {
                    return typeof o === 'object' && __objToStr(o) === '[object RegExp]';
                }
                clone.__isRegExp = __isRegExp;

                function __getRegExpFlags(re) {
                    var flags = '';
                    if (re.global) flags += 'g';
                    if (re.ignoreCase) flags += 'i';
                    if (re.multiline) flags += 'm';
                    return flags;
                }
                clone.__getRegExpFlags = __getRegExpFlags;

                return clone;
            })();

            if (typeof module === 'object' && module.exports) {
                module.exports = clone;
            }


            /***/ }),
        /* 22 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _emitter = __webpack_require__(8);

            var _emitter2 = _interopRequireDefault(_emitter);

            var _block = __webpack_require__(4);

            var _block2 = _interopRequireDefault(_block);

            var _break = __webpack_require__(16);

            var _break2 = _interopRequireDefault(_break);

            var _code = __webpack_require__(13);

            var _code2 = _interopRequireDefault(_code);

            var _container = __webpack_require__(25);

            var _container2 = _interopRequireDefault(_container);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            function isLine(blot) {
                return blot instanceof _block2.default || blot instanceof _block.BlockEmbed;
            }

            var Scroll = function (_Parchment$Scroll) {
                _inherits(Scroll, _Parchment$Scroll);

                function Scroll(domNode, config) {
                    _classCallCheck(this, Scroll);

                    var _this = _possibleConstructorReturn(this, (Scroll.__proto__ || Object.getPrototypeOf(Scroll)).call(this, domNode));

                    _this.emitter = config.emitter;
                    if (Array.isArray(config.whitelist)) {
                        _this.whitelist = config.whitelist.reduce(function (whitelist, format) {
                            whitelist[format] = true;
                            return whitelist;
                        }, {});
                    }
                    // Some reason fixes composition issues with character languages in Windows/Chrome, Safari
                    _this.domNode.addEventListener('DOMNodeInserted', function () {});
                    _this.optimize();
                    _this.enable();
                    return _this;
                }

                _createClass(Scroll, [{
                    key: 'batchStart',
                    value: function batchStart() {
                        this.batch = true;
                    }
                }, {
                    key: 'batchEnd',
                    value: function batchEnd() {
                        this.batch = false;
                        this.optimize();
                    }
                }, {
                    key: 'deleteAt',
                    value: function deleteAt(index, length) {
                        var _line = this.line(index),
                            _line2 = _slicedToArray(_line, 2),
                            first = _line2[0],
                            offset = _line2[1];

                        var _line3 = this.line(index + length),
                            _line4 = _slicedToArray(_line3, 1),
                            last = _line4[0];

                        _get(Scroll.prototype.__proto__ || Object.getPrototypeOf(Scroll.prototype), 'deleteAt', this).call(this, index, length);
                        if (last != null && first !== last && offset > 0) {
                            if (first instanceof _block.BlockEmbed || last instanceof _block.BlockEmbed) {
                                this.optimize();
                                return;
                            }
                            if (first instanceof _code2.default) {
                                var newlineIndex = first.newlineIndex(first.length(), true);
                                if (newlineIndex > -1) {
                                    first = first.split(newlineIndex + 1);
                                    if (first === last) {
                                        this.optimize();
                                        return;
                                    }
                                }
                            } else if (last instanceof _code2.default) {
                                var _newlineIndex = last.newlineIndex(0);
                                if (_newlineIndex > -1) {
                                    last.split(_newlineIndex + 1);
                                }
                            }
                            var ref = last.children.head instanceof _break2.default ? null : last.children.head;
                            first.moveChildren(last, ref);
                            first.remove();
                        }
                        this.optimize();
                    }
                }, {
                    key: 'enable',
                    value: function enable() {
                        var enabled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

                        this.domNode.setAttribute('contenteditable', enabled);
                    }
                }, {
                    key: 'formatAt',
                    value: function formatAt(index, length, format, value) {
                        if (this.whitelist != null && !this.whitelist[format]) return;
                        _get(Scroll.prototype.__proto__ || Object.getPrototypeOf(Scroll.prototype), 'formatAt', this).call(this, index, length, format, value);
                        this.optimize();
                    }
                }, {
                    key: 'insertAt',
                    value: function insertAt(index, value, def) {
                        if (def != null && this.whitelist != null && !this.whitelist[value]) return;
                        if (index >= this.length()) {
                            if (def == null || _parchment2.default.query(value, _parchment2.default.Scope.BLOCK) == null) {
                                var blot = _parchment2.default.create(this.statics.defaultChild);
                                this.appendChild(blot);
                                if (def == null && value.endsWith('\n')) {
                                    value = value.slice(0, -1);
                                }
                                blot.insertAt(0, value, def);
                            } else {
                                var embed = _parchment2.default.create(value, def);
                                this.appendChild(embed);
                            }
                        } else {
                            _get(Scroll.prototype.__proto__ || Object.getPrototypeOf(Scroll.prototype), 'insertAt', this).call(this, index, value, def);
                        }
                        this.optimize();
                    }
                }, {
                    key: 'insertBefore',
                    value: function insertBefore(blot, ref) {
                        if (blot.statics.scope === _parchment2.default.Scope.INLINE_BLOT) {
                            var wrapper = _parchment2.default.create(this.statics.defaultChild);
                            wrapper.appendChild(blot);
                            blot = wrapper;
                        }
                        _get(Scroll.prototype.__proto__ || Object.getPrototypeOf(Scroll.prototype), 'insertBefore', this).call(this, blot, ref);
                    }
                }, {
                    key: 'leaf',
                    value: function leaf(index) {
                        return this.path(index).pop() || [null, -1];
                    }
                }, {
                    key: 'line',
                    value: function line(index) {
                        if (index === this.length()) {
                            return this.line(index - 1);
                        }
                        return this.descendant(isLine, index);
                    }
                }, {
                    key: 'lines',
                    value: function lines() {
                        var index = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
                        var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Number.MAX_VALUE;

                        var getLines = function getLines(blot, index, length) {
                            var lines = [],
                                lengthLeft = length;
                            blot.children.forEachAt(index, length, function (child, index, length) {
                                if (isLine(child)) {
                                    lines.push(child);
                                } else if (child instanceof _parchment2.default.Container) {
                                    lines = lines.concat(getLines(child, index, lengthLeft));
                                }
                                lengthLeft -= length;
                            });
                            return lines;
                        };
                        return getLines(this, index, length);
                    }
                }, {
                    key: 'optimize',
                    value: function optimize() {
                        var mutations = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
                        var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

                        if (this.batch === true) return;
                        _get(Scroll.prototype.__proto__ || Object.getPrototypeOf(Scroll.prototype), 'optimize', this).call(this, mutations, context);
                        if (mutations.length > 0) {
                            this.emitter.emit(_emitter2.default.events.SCROLL_OPTIMIZE, mutations, context);
                        }
                    }
                }, {
                    key: 'path',
                    value: function path(index) {
                        return _get(Scroll.prototype.__proto__ || Object.getPrototypeOf(Scroll.prototype), 'path', this).call(this, index).slice(1); // Exclude self
                    }
                }, {
                    key: 'update',
                    value: function update(mutations) {
                        if (this.batch === true) return;
                        var source = _emitter2.default.sources.USER;
                        if (typeof mutations === 'string') {
                            source = mutations;
                        }
                        if (!Array.isArray(mutations)) {
                            mutations = this.observer.takeRecords();
                        }
                        if (mutations.length > 0) {
                            this.emitter.emit(_emitter2.default.events.SCROLL_BEFORE_UPDATE, source, mutations);
                        }
                        _get(Scroll.prototype.__proto__ || Object.getPrototypeOf(Scroll.prototype), 'update', this).call(this, mutations.concat([])); // pass copy
                        if (mutations.length > 0) {
                            this.emitter.emit(_emitter2.default.events.SCROLL_UPDATE, source, mutations);
                        }
                    }
                }]);

                return Scroll;
            }(_parchment2.default.Scroll);

            Scroll.blotName = 'scroll';
            Scroll.className = 'ql-editor';
            Scroll.tagName = 'DIV';
            Scroll.defaultChild = 'block';
            Scroll.allowedChildren = [_block2.default, _block.BlockEmbed, _container2.default];

            exports.default = Scroll;

            /***/ }),
        /* 23 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.SHORTKEY = exports.default = undefined;

            var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

            var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _clone = __webpack_require__(21);

            var _clone2 = _interopRequireDefault(_clone);

            var _deepEqual = __webpack_require__(11);

            var _deepEqual2 = _interopRequireDefault(_deepEqual);

            var _extend = __webpack_require__(3);

            var _extend2 = _interopRequireDefault(_extend);

            var _quillDelta = __webpack_require__(2);

            var _quillDelta2 = _interopRequireDefault(_quillDelta);

            var _op = __webpack_require__(20);

            var _op2 = _interopRequireDefault(_op);

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _quill = __webpack_require__(5);

            var _quill2 = _interopRequireDefault(_quill);

            var _logger = __webpack_require__(10);

            var _logger2 = _interopRequireDefault(_logger);

            var _module = __webpack_require__(9);

            var _module2 = _interopRequireDefault(_module);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var debug = (0, _logger2.default)('quill:keyboard');

            var SHORTKEY = /Mac/i.test(navigator.platform) ? 'metaKey' : 'ctrlKey';

            var Keyboard = function (_Module) {
                _inherits(Keyboard, _Module);

                _createClass(Keyboard, null, [{
                    key: 'match',
                    value: function match(evt, binding) {
                        binding = normalize(binding);
                        if (['altKey', 'ctrlKey', 'metaKey', 'shiftKey'].some(function (key) {
                                return !!binding[key] !== evt[key] && binding[key] !== null;
                            })) {
                            return false;
                        }
                        return binding.key === (evt.which || evt.keyCode);
                    }
                }]);

                function Keyboard(quill, options) {
                    _classCallCheck(this, Keyboard);

                    var _this = _possibleConstructorReturn(this, (Keyboard.__proto__ || Object.getPrototypeOf(Keyboard)).call(this, quill, options));

                    _this.bindings = {};
                    Object.keys(_this.options.bindings).forEach(function (name) {
                        if (name === 'list autofill' && quill.scroll.whitelist != null && !quill.scroll.whitelist['list']) {
                            return;
                        }
                        if (_this.options.bindings[name]) {
                            _this.addBinding(_this.options.bindings[name]);
                        }
                    });
                    _this.addBinding({ key: Keyboard.keys.ENTER, shiftKey: null }, handleEnter);
                    _this.addBinding({ key: Keyboard.keys.ENTER, metaKey: null, ctrlKey: null, altKey: null }, function () {});
                    if (/Firefox/i.test(navigator.userAgent)) {
                        // Need to handle delete and backspace for Firefox in the general case #1171
                        _this.addBinding({ key: Keyboard.keys.BACKSPACE }, { collapsed: true }, handleBackspace);
                        _this.addBinding({ key: Keyboard.keys.DELETE }, { collapsed: true }, handleDelete);
                    } else {
                        _this.addBinding({ key: Keyboard.keys.BACKSPACE }, { collapsed: true, prefix: /^.?$/ }, handleBackspace);
                        _this.addBinding({ key: Keyboard.keys.DELETE }, { collapsed: true, suffix: /^.?$/ }, handleDelete);
                    }
                    _this.addBinding({ key: Keyboard.keys.BACKSPACE }, { collapsed: false }, handleDeleteRange);
                    _this.addBinding({ key: Keyboard.keys.DELETE }, { collapsed: false }, handleDeleteRange);
                    _this.addBinding({ key: Keyboard.keys.BACKSPACE, altKey: null, ctrlKey: null, metaKey: null, shiftKey: null }, { collapsed: true, offset: 0 }, handleBackspace);
                    _this.listen();
                    return _this;
                }

                _createClass(Keyboard, [{
                    key: 'addBinding',
                    value: function addBinding(key) {
                        var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
                        var handler = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

                        var binding = normalize(key);
                        if (binding == null || binding.key == null) {
                            return debug.warn('Attempted to add invalid keyboard binding', binding);
                        }
                        if (typeof context === 'function') {
                            context = { handler: context };
                        }
                        if (typeof handler === 'function') {
                            handler = { handler: handler };
                        }
                        binding = (0, _extend2.default)(binding, context, handler);
                        this.bindings[binding.key] = this.bindings[binding.key] || [];
                        this.bindings[binding.key].push(binding);
                    }
                }, {
                    key: 'listen',
                    value: function listen() {
                        var _this2 = this;

                        this.quill.root.addEventListener('keydown', function (evt) {
                            if (evt.defaultPrevented) return;
                            var which = evt.which || evt.keyCode;
                            var bindings = (_this2.bindings[which] || []).filter(function (binding) {
                                return Keyboard.match(evt, binding);
                            });
                            if (bindings.length === 0) return;
                            var range = _this2.quill.getSelection();
                            if (range == null || !_this2.quill.hasFocus()) return;

                            var _quill$getLine = _this2.quill.getLine(range.index),
                                _quill$getLine2 = _slicedToArray(_quill$getLine, 2),
                                line = _quill$getLine2[0],
                                offset = _quill$getLine2[1];

                            var _quill$getLeaf = _this2.quill.getLeaf(range.index),
                                _quill$getLeaf2 = _slicedToArray(_quill$getLeaf, 2),
                                leafStart = _quill$getLeaf2[0],
                                offsetStart = _quill$getLeaf2[1];

                            var _ref = range.length === 0 ? [leafStart, offsetStart] : _this2.quill.getLeaf(range.index + range.length),
                                _ref2 = _slicedToArray(_ref, 2),
                                leafEnd = _ref2[0],
                                offsetEnd = _ref2[1];

                            var prefixText = leafStart instanceof _parchment2.default.Text ? leafStart.value().slice(0, offsetStart) : '';
                            var suffixText = leafEnd instanceof _parchment2.default.Text ? leafEnd.value().slice(offsetEnd) : '';
                            var curContext = {
                                collapsed: range.length === 0,
                                empty: range.length === 0 && line.length() <= 1,
                                format: _this2.quill.getFormat(range),
                                offset: offset,
                                prefix: prefixText,
                                suffix: suffixText
                            };
                            var prevented = bindings.some(function (binding) {
                                if (binding.collapsed != null && binding.collapsed !== curContext.collapsed) return false;
                                if (binding.empty != null && binding.empty !== curContext.empty) return false;
                                if (binding.offset != null && binding.offset !== curContext.offset) return false;
                                if (Array.isArray(binding.format)) {
                                    // any format is present
                                    if (binding.format.every(function (name) {
                                            return curContext.format[name] == null;
                                        })) {
                                        return false;
                                    }
                                } else if (_typeof(binding.format) === 'object') {
                                    // all formats must match
                                    if (!Object.keys(binding.format).every(function (name) {
                                            if (binding.format[name] === true) return curContext.format[name] != null;
                                            if (binding.format[name] === false) return curContext.format[name] == null;
                                            return (0, _deepEqual2.default)(binding.format[name], curContext.format[name]);
                                        })) {
                                        return false;
                                    }
                                }
                                if (binding.prefix != null && !binding.prefix.test(curContext.prefix)) return false;
                                if (binding.suffix != null && !binding.suffix.test(curContext.suffix)) return false;
                                return binding.handler.call(_this2, range, curContext) !== true;
                            });
                            if (prevented) {
                                evt.preventDefault();
                            }
                        });
                    }
                }]);

                return Keyboard;
            }(_module2.default);

            Keyboard.keys = {
                BACKSPACE: 8,
                TAB: 9,
                ENTER: 13,
                ESCAPE: 27,
                LEFT: 37,
                UP: 38,
                RIGHT: 39,
                DOWN: 40,
                DELETE: 46
            };

            Keyboard.DEFAULTS = {
                bindings: {
                    'bold': makeFormatHandler('bold'),
                    'italic': makeFormatHandler('italic'),
                    'underline': makeFormatHandler('underline'),
                    'indent': {
                        // highlight tab or tab at beginning of list, indent or blockquote
                        key: Keyboard.keys.TAB,
                        format: ['blockquote', 'indent', 'list'],
                        handler: function handler(range, context) {
                            if (context.collapsed && context.offset !== 0) return true;
                            this.quill.format('indent', '+1', _quill2.default.sources.USER);
                        }
                    },
                    'outdent': {
                        key: Keyboard.keys.TAB,
                        shiftKey: true,
                        format: ['blockquote', 'indent', 'list'],
                        // highlight tab or tab at beginning of list, indent or blockquote
                        handler: function handler(range, context) {
                            if (context.collapsed && context.offset !== 0) return true;
                            this.quill.format('indent', '-1', _quill2.default.sources.USER);
                        }
                    },
                    'outdent backspace': {
                        key: Keyboard.keys.BACKSPACE,
                        collapsed: true,
                        shiftKey: null,
                        metaKey: null,
                        ctrlKey: null,
                        altKey: null,
                        format: ['indent', 'list'],
                        offset: 0,
                        handler: function handler(range, context) {
                            if (context.format.indent != null) {
                                this.quill.format('indent', '-1', _quill2.default.sources.USER);
                            } else if (context.format.list != null) {
                                this.quill.format('list', false, _quill2.default.sources.USER);
                            }
                        }
                    },
                    'indent code-block': makeCodeBlockHandler(true),
                    'outdent code-block': makeCodeBlockHandler(false),
                    'remove tab': {
                        key: Keyboard.keys.TAB,
                        shiftKey: true,
                        collapsed: true,
                        prefix: /\t$/,
                        handler: function handler(range) {
                            this.quill.deleteText(range.index - 1, 1, _quill2.default.sources.USER);
                        }
                    },
                    'tab': {
                        key: Keyboard.keys.TAB,
                        handler: function handler(range) {
                            this.quill.history.cutoff();
                            var delta = new _quillDelta2.default().retain(range.index).delete(range.length).insert('\t');
                            this.quill.updateContents(delta, _quill2.default.sources.USER);
                            this.quill.history.cutoff();
                            this.quill.setSelection(range.index + 1, _quill2.default.sources.SILENT);
                        }
                    },
                    'list empty enter': {
                        key: Keyboard.keys.ENTER,
                        collapsed: true,
                        format: ['list'],
                        empty: true,
                        handler: function handler(range, context) {
                            this.quill.format('list', false, _quill2.default.sources.USER);
                            if (context.format.indent) {
                                this.quill.format('indent', false, _quill2.default.sources.USER);
                            }
                        }
                    },
                    'checklist enter': {
                        key: Keyboard.keys.ENTER,
                        collapsed: true,
                        format: { list: 'checked' },
                        handler: function handler(range) {
                            var _quill$getLine3 = this.quill.getLine(range.index),
                                _quill$getLine4 = _slicedToArray(_quill$getLine3, 2),
                                line = _quill$getLine4[0],
                                offset = _quill$getLine4[1];

                            var formats = (0, _extend2.default)({}, line.formats(), { list: 'checked' });
                            var delta = new _quillDelta2.default().retain(range.index).insert('\n', formats).retain(line.length() - offset - 1).retain(1, { list: 'unchecked' });
                            this.quill.updateContents(delta, _quill2.default.sources.USER);
                            this.quill.setSelection(range.index + 1, _quill2.default.sources.SILENT);
                            this.quill.scrollIntoView();
                        }
                    },
                    'header enter': {
                        key: Keyboard.keys.ENTER,
                        collapsed: true,
                        format: ['header'],
                        suffix: /^$/,
                        handler: function handler(range, context) {
                            var _quill$getLine5 = this.quill.getLine(range.index),
                                _quill$getLine6 = _slicedToArray(_quill$getLine5, 2),
                                line = _quill$getLine6[0],
                                offset = _quill$getLine6[1];

                            var delta = new _quillDelta2.default().retain(range.index).insert('\n', context.format).retain(line.length() - offset - 1).retain(1, { header: null });
                            this.quill.updateContents(delta, _quill2.default.sources.USER);
                            this.quill.setSelection(range.index + 1, _quill2.default.sources.SILENT);
                            this.quill.scrollIntoView();
                        }
                    },
                    'list autofill': {
                        key: ' ',
                        collapsed: true,
                        format: { list: false },
                        prefix: /^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,
                        handler: function handler(range, context) {
                            var length = context.prefix.length;

                            var _quill$getLine7 = this.quill.getLine(range.index),
                                _quill$getLine8 = _slicedToArray(_quill$getLine7, 2),
                                line = _quill$getLine8[0],
                                offset = _quill$getLine8[1];

                            if (offset > length) return true;
                            var value = void 0;
                            switch (context.prefix.trim()) {
                                case '[]':case '[ ]':
                                value = 'unchecked';
                                break;
                                case '[x]':
                                    value = 'checked';
                                    break;
                                case '-':case '*':
                                value = 'bullet';
                                break;
                                default:
                                    value = 'ordered';
                            }
                            this.quill.insertText(range.index, ' ', _quill2.default.sources.USER);
                            this.quill.history.cutoff();
                            var delta = new _quillDelta2.default().retain(range.index - offset).delete(length + 1).retain(line.length() - 2 - offset).retain(1, { list: value });
                            this.quill.updateContents(delta, _quill2.default.sources.USER);
                            this.quill.history.cutoff();
                            this.quill.setSelection(range.index - length, _quill2.default.sources.SILENT);
                        }
                    },
                    'code exit': {
                        key: Keyboard.keys.ENTER,
                        collapsed: true,
                        format: ['code-block'],
                        prefix: /\n\n$/,
                        suffix: /^\s+$/,
                        handler: function handler(range) {
                            var _quill$getLine9 = this.quill.getLine(range.index),
                                _quill$getLine10 = _slicedToArray(_quill$getLine9, 2),
                                line = _quill$getLine10[0],
                                offset = _quill$getLine10[1];

                            var delta = new _quillDelta2.default().retain(range.index + line.length() - offset - 2).retain(1, { 'code-block': null }).delete(1);
                            this.quill.updateContents(delta, _quill2.default.sources.USER);
                        }
                    },
                    'embed left': makeEmbedArrowHandler(Keyboard.keys.LEFT, false),
                    'embed left shift': makeEmbedArrowHandler(Keyboard.keys.LEFT, true),
                    'embed right': makeEmbedArrowHandler(Keyboard.keys.RIGHT, false),
                    'embed right shift': makeEmbedArrowHandler(Keyboard.keys.RIGHT, true)
                }
            };

            function makeEmbedArrowHandler(key, shiftKey) {
                var _ref3;

                var where = key === Keyboard.keys.LEFT ? 'prefix' : 'suffix';
                return _ref3 = {
                    key: key,
                    shiftKey: shiftKey,
                    altKey: null
                }, _defineProperty(_ref3, where, /^$/), _defineProperty(_ref3, 'handler', function handler(range) {
                    var index = range.index;
                    if (key === Keyboard.keys.RIGHT) {
                        index += range.length + 1;
                    }

                    var _quill$getLeaf3 = this.quill.getLeaf(index),
                        _quill$getLeaf4 = _slicedToArray(_quill$getLeaf3, 1),
                        leaf = _quill$getLeaf4[0];

                    if (!(leaf instanceof _parchment2.default.Embed)) return true;
                    if (key === Keyboard.keys.LEFT) {
                        if (shiftKey) {
                            this.quill.setSelection(range.index - 1, range.length + 1, _quill2.default.sources.USER);
                        } else {
                            this.quill.setSelection(range.index - 1, _quill2.default.sources.USER);
                        }
                    } else {
                        if (shiftKey) {
                            this.quill.setSelection(range.index, range.length + 1, _quill2.default.sources.USER);
                        } else {
                            this.quill.setSelection(range.index + range.length + 1, _quill2.default.sources.USER);
                        }
                    }
                    return false;
                }), _ref3;
            }

            function handleBackspace(range, context) {
                if (range.index === 0 || this.quill.getLength() <= 1) return;

                var _quill$getLine11 = this.quill.getLine(range.index),
                    _quill$getLine12 = _slicedToArray(_quill$getLine11, 1),
                    line = _quill$getLine12[0];

                var formats = {};
                if (context.offset === 0) {
                    var _quill$getLine13 = this.quill.getLine(range.index - 1),
                        _quill$getLine14 = _slicedToArray(_quill$getLine13, 1),
                        prev = _quill$getLine14[0];

                    if (prev != null && prev.length() > 1) {
                        var curFormats = line.formats();
                        var prevFormats = this.quill.getFormat(range.index - 1, 1);
                        formats = _op2.default.attributes.diff(curFormats, prevFormats) || {};
                    }
                }
                // Check for astral symbols
                var length = /[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(context.prefix) ? 2 : 1;
                this.quill.deleteText(range.index - length, length, _quill2.default.sources.USER);
                if (Object.keys(formats).length > 0) {
                    this.quill.formatLine(range.index - length, length, formats, _quill2.default.sources.USER);
                }
                this.quill.focus();
            }

            function handleDelete(range, context) {
                // Check for astral symbols
                var length = /^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(context.suffix) ? 2 : 1;
                if (range.index >= this.quill.getLength() - length) return;
                var formats = {},
                    nextLength = 0;

                var _quill$getLine15 = this.quill.getLine(range.index),
                    _quill$getLine16 = _slicedToArray(_quill$getLine15, 1),
                    line = _quill$getLine16[0];

                if (context.offset >= line.length() - 1) {
                    var _quill$getLine17 = this.quill.getLine(range.index + 1),
                        _quill$getLine18 = _slicedToArray(_quill$getLine17, 1),
                        next = _quill$getLine18[0];

                    if (next) {
                        var curFormats = line.formats();
                        var nextFormats = this.quill.getFormat(range.index, 1);
                        formats = _op2.default.attributes.diff(curFormats, nextFormats) || {};
                        nextLength = next.length();
                    }
                }
                this.quill.deleteText(range.index, length, _quill2.default.sources.USER);
                if (Object.keys(formats).length > 0) {
                    this.quill.formatLine(range.index + nextLength - 1, length, formats, _quill2.default.sources.USER);
                }
            }

            function handleDeleteRange(range) {
                var lines = this.quill.getLines(range);
                var formats = {};
                if (lines.length > 1) {
                    var firstFormats = lines[0].formats();
                    var lastFormats = lines[lines.length - 1].formats();
                    formats = _op2.default.attributes.diff(lastFormats, firstFormats) || {};
                }
                this.quill.deleteText(range, _quill2.default.sources.USER);
                if (Object.keys(formats).length > 0) {
                    this.quill.formatLine(range.index, 1, formats, _quill2.default.sources.USER);
                }
                this.quill.setSelection(range.index, _quill2.default.sources.SILENT);
                this.quill.focus();
            }

            function handleEnter(range, context) {
                var _this3 = this;

                if (range.length > 0) {
                    this.quill.scroll.deleteAt(range.index, range.length); // So we do not trigger text-change
                }
                var lineFormats = Object.keys(context.format).reduce(function (lineFormats, format) {
                    if (_parchment2.default.query(format, _parchment2.default.Scope.BLOCK) && !Array.isArray(context.format[format])) {
                        lineFormats[format] = context.format[format];
                    }
                    return lineFormats;
                }, {});
                this.quill.insertText(range.index, '\n', lineFormats, _quill2.default.sources.USER);
                // Earlier scroll.deleteAt might have messed up our selection,
                // so insertText's built in selection preservation is not reliable
                this.quill.setSelection(range.index + 1, _quill2.default.sources.SILENT);
                this.quill.focus();
                Object.keys(context.format).forEach(function (name) {
                    if (lineFormats[name] != null) return;
                    if (Array.isArray(context.format[name])) return;
                    if (name === 'link') return;
                    _this3.quill.format(name, context.format[name], _quill2.default.sources.USER);
                });
            }

            function makeCodeBlockHandler(indent) {
                return {
                    key: Keyboard.keys.TAB,
                    shiftKey: !indent,
                    format: { 'code-block': true },
                    handler: function handler(range) {
                        var CodeBlock = _parchment2.default.query('code-block');
                        var index = range.index,
                            length = range.length;

                        var _quill$scroll$descend = this.quill.scroll.descendant(CodeBlock, index),
                            _quill$scroll$descend2 = _slicedToArray(_quill$scroll$descend, 2),
                            block = _quill$scroll$descend2[0],
                            offset = _quill$scroll$descend2[1];

                        if (block == null) return;
                        var scrollIndex = this.quill.getIndex(block);
                        var start = block.newlineIndex(offset, true) + 1;
                        var end = block.newlineIndex(scrollIndex + offset + length);
                        var lines = block.domNode.textContent.slice(start, end).split('\n');
                        offset = 0;
                        lines.forEach(function (line, i) {
                            if (indent) {
                                block.insertAt(start + offset, CodeBlock.TAB);
                                offset += CodeBlock.TAB.length;
                                if (i === 0) {
                                    index += CodeBlock.TAB.length;
                                } else {
                                    length += CodeBlock.TAB.length;
                                }
                            } else if (line.startsWith(CodeBlock.TAB)) {
                                block.deleteAt(start + offset, CodeBlock.TAB.length);
                                offset -= CodeBlock.TAB.length;
                                if (i === 0) {
                                    index -= CodeBlock.TAB.length;
                                } else {
                                    length -= CodeBlock.TAB.length;
                                }
                            }
                            offset += line.length + 1;
                        });
                        this.quill.update(_quill2.default.sources.USER);
                        this.quill.setSelection(index, length, _quill2.default.sources.SILENT);
                    }
                };
            }

            function makeFormatHandler(format) {
                return {
                    key: format[0].toUpperCase(),
                    shortKey: true,
                    handler: function handler(range, context) {
                        this.quill.format(format, !context.format[format], _quill2.default.sources.USER);
                    }
                };
            }

            function normalize(binding) {
                if (typeof binding === 'string' || typeof binding === 'number') {
                    return normalize({ key: binding });
                }
                if ((typeof binding === 'undefined' ? 'undefined' : _typeof(binding)) === 'object') {
                    binding = (0, _clone2.default)(binding, false);
                }
                if (typeof binding.key === 'string') {
                    if (Keyboard.keys[binding.key.toUpperCase()] != null) {
                        binding.key = Keyboard.keys[binding.key.toUpperCase()];
                    } else if (binding.key.length === 1) {
                        binding.key = binding.key.toUpperCase().charCodeAt(0);
                    } else {
                        return null;
                    }
                }
                if (binding.shortKey) {
                    binding[SHORTKEY] = binding.shortKey;
                    delete binding.shortKey;
                }
                return binding;
            }

            exports.default = Keyboard;
            exports.SHORTKEY = SHORTKEY;

            /***/ }),
        /* 24 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _text = __webpack_require__(7);

            var _text2 = _interopRequireDefault(_text);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Cursor = function (_Parchment$Embed) {
                _inherits(Cursor, _Parchment$Embed);

                _createClass(Cursor, null, [{
                    key: 'value',
                    value: function value() {
                        return undefined;
                    }
                }]);

                function Cursor(domNode, selection) {
                    _classCallCheck(this, Cursor);

                    var _this = _possibleConstructorReturn(this, (Cursor.__proto__ || Object.getPrototypeOf(Cursor)).call(this, domNode));

                    _this.selection = selection;
                    _this.textNode = document.createTextNode(Cursor.CONTENTS);
                    _this.domNode.appendChild(_this.textNode);
                    _this._length = 0;
                    return _this;
                }

                _createClass(Cursor, [{
                    key: 'detach',
                    value: function detach() {
                        // super.detach() will also clear domNode.__blot
                        if (this.parent != null) this.parent.removeChild(this);
                    }
                }, {
                    key: 'format',
                    value: function format(name, value) {
                        if (this._length !== 0) {
                            return _get(Cursor.prototype.__proto__ || Object.getPrototypeOf(Cursor.prototype), 'format', this).call(this, name, value);
                        }
                        var target = this,
                            index = 0;
                        while (target != null && target.statics.scope !== _parchment2.default.Scope.BLOCK_BLOT) {
                            index += target.offset(target.parent);
                            target = target.parent;
                        }
                        if (target != null) {
                            this._length = Cursor.CONTENTS.length;
                            target.optimize();
                            target.formatAt(index, Cursor.CONTENTS.length, name, value);
                            this._length = 0;
                        }
                    }
                }, {
                    key: 'index',
                    value: function index(node, offset) {
                        if (node === this.textNode) return 0;
                        return _get(Cursor.prototype.__proto__ || Object.getPrototypeOf(Cursor.prototype), 'index', this).call(this, node, offset);
                    }
                }, {
                    key: 'length',
                    value: function length() {
                        return this._length;
                    }
                }, {
                    key: 'position',
                    value: function position() {
                        return [this.textNode, this.textNode.data.length];
                    }
                }, {
                    key: 'remove',
                    value: function remove() {
                        _get(Cursor.prototype.__proto__ || Object.getPrototypeOf(Cursor.prototype), 'remove', this).call(this);
                        this.parent = null;
                    }
                }, {
                    key: 'restore',
                    value: function restore() {
                        if (this.selection.composing || this.parent == null) return;
                        var textNode = this.textNode;
                        var range = this.selection.getNativeRange();
                        var restoreText = void 0,
                            start = void 0,
                            end = void 0;
                        if (range != null && range.start.node === textNode && range.end.node === textNode) {
                            var _ref = [textNode, range.start.offset, range.end.offset];
                            restoreText = _ref[0];
                            start = _ref[1];
                            end = _ref[2];
                        }
                        // Link format will insert text outside of anchor tag
                        while (this.domNode.lastChild != null && this.domNode.lastChild !== this.textNode) {
                            this.domNode.parentNode.insertBefore(this.domNode.lastChild, this.domNode);
                        }
                        if (this.textNode.data !== Cursor.CONTENTS) {
                            var text = this.textNode.data.split(Cursor.CONTENTS).join('');
                            if (this.next instanceof _text2.default) {
                                restoreText = this.next.domNode;
                                this.next.insertAt(0, text);
                                this.textNode.data = Cursor.CONTENTS;
                            } else {
                                this.textNode.data = text;
                                this.parent.insertBefore(_parchment2.default.create(this.textNode), this);
                                this.textNode = document.createTextNode(Cursor.CONTENTS);
                                this.domNode.appendChild(this.textNode);
                            }
                        }
                        this.remove();
                        if (start != null) {
                            var _map = [start, end].map(function (offset) {
                                return Math.max(0, Math.min(restoreText.data.length, offset - 1));
                            });

                            var _map2 = _slicedToArray(_map, 2);

                            start = _map2[0];
                            end = _map2[1];

                            return {
                                startNode: restoreText,
                                startOffset: start,
                                endNode: restoreText,
                                endOffset: end
                            };
                        }
                    }
                }, {
                    key: 'update',
                    value: function update(mutations, context) {
                        var _this2 = this;

                        if (mutations.some(function (mutation) {
                                return mutation.type === 'characterData' && mutation.target === _this2.textNode;
                            })) {
                            var range = this.restore();
                            if (range) context.range = range;
                        }
                    }
                }, {
                    key: 'value',
                    value: function value() {
                        return '';
                    }
                }]);

                return Cursor;
            }(_parchment2.default.Embed);

            Cursor.blotName = 'cursor';
            Cursor.className = 'ql-cursor';
            Cursor.tagName = 'span';
            Cursor.CONTENTS = '\uFEFF'; // Zero width no break space


            exports.default = Cursor;

            /***/ }),
        /* 25 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _block = __webpack_require__(4);

            var _block2 = _interopRequireDefault(_block);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Container = function (_Parchment$Container) {
                _inherits(Container, _Parchment$Container);

                function Container() {
                    _classCallCheck(this, Container);

                    return _possibleConstructorReturn(this, (Container.__proto__ || Object.getPrototypeOf(Container)).apply(this, arguments));
                }

                return Container;
            }(_parchment2.default.Container);

            Container.allowedChildren = [_block2.default, _block.BlockEmbed, Container];

            exports.default = Container;

            /***/ }),
        /* 26 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.ColorStyle = exports.ColorClass = exports.ColorAttributor = undefined;

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var ColorAttributor = function (_Parchment$Attributor) {
                _inherits(ColorAttributor, _Parchment$Attributor);

                function ColorAttributor() {
                    _classCallCheck(this, ColorAttributor);

                    return _possibleConstructorReturn(this, (ColorAttributor.__proto__ || Object.getPrototypeOf(ColorAttributor)).apply(this, arguments));
                }

                _createClass(ColorAttributor, [{
                    key: 'value',
                    value: function value(domNode) {
                        var value = _get(ColorAttributor.prototype.__proto__ || Object.getPrototypeOf(ColorAttributor.prototype), 'value', this).call(this, domNode);
                        if (!value.startsWith('rgb(')) return value;
                        value = value.replace(/^[^\d]+/, '').replace(/[^\d]+$/, '');
                        return '#' + value.split(',').map(function (component) {
                            return ('00' + parseInt(component).toString(16)).slice(-2);
                        }).join('');
                    }
                }]);

                return ColorAttributor;
            }(_parchment2.default.Attributor.Style);

            var ColorClass = new _parchment2.default.Attributor.Class('color', 'ql-color', {
                scope: _parchment2.default.Scope.INLINE
            });
            var ColorStyle = new ColorAttributor('color', 'color', {
                scope: _parchment2.default.Scope.INLINE
            });

            exports.ColorAttributor = ColorAttributor;
            exports.ColorClass = ColorClass;
            exports.ColorStyle = ColorStyle;

            /***/ }),
        /* 27 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.sanitize = exports.default = undefined;

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _inline = __webpack_require__(6);

            var _inline2 = _interopRequireDefault(_inline);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Link = function (_Inline) {
                _inherits(Link, _Inline);

                function Link() {
                    _classCallCheck(this, Link);

                    return _possibleConstructorReturn(this, (Link.__proto__ || Object.getPrototypeOf(Link)).apply(this, arguments));
                }

                _createClass(Link, [{
                    key: 'format',
                    value: function format(name, value) {
                        if (name !== this.statics.blotName || !value) return _get(Link.prototype.__proto__ || Object.getPrototypeOf(Link.prototype), 'format', this).call(this, name, value);
                        value = this.constructor.sanitize(value);
                        this.domNode.setAttribute('href', value);
                    }
                }], [{
                    key: 'create',
                    value: function create(value) {
                        var node = _get(Link.__proto__ || Object.getPrototypeOf(Link), 'create', this).call(this, value);
                        value = this.sanitize(value);
                        node.setAttribute('href', value);
                        node.setAttribute('target', '_blank');
                        return node;
                    }
                }, {
                    key: 'formats',
                    value: function formats(domNode) {
                        return domNode.getAttribute('href');
                    }
                }, {
                    key: 'sanitize',
                    value: function sanitize(url) {
                        return _sanitize(url, this.PROTOCOL_WHITELIST) ? url : this.SANITIZED_URL;
                    }
                }]);

                return Link;
            }(_inline2.default);

            Link.blotName = 'link';
            Link.tagName = 'A';
            Link.SANITIZED_URL = 'about:blank';
            Link.PROTOCOL_WHITELIST = ['http', 'https', 'mailto', 'tel'];

            function _sanitize(url, protocols) {
                var anchor = document.createElement('a');
                anchor.href = url;
                var protocol = anchor.href.slice(0, anchor.href.indexOf(':'));
                return protocols.indexOf(protocol) > -1;
            }

            exports.default = Link;
            exports.sanitize = _sanitize;

            /***/ }),
        /* 28 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _keyboard = __webpack_require__(23);

            var _keyboard2 = _interopRequireDefault(_keyboard);

            var _dropdown = __webpack_require__(107);

            var _dropdown2 = _interopRequireDefault(_dropdown);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            var optionsCounter = 0;

            function toggleAriaAttribute(element, attribute) {
                element.setAttribute(attribute, !(element.getAttribute(attribute) === 'true'));
            }

            var Picker = function () {
                function Picker(select) {
                    var _this = this;

                    _classCallCheck(this, Picker);

                    this.select = select;
                    this.container = document.createElement('span');
                    this.buildPicker();
                    this.select.style.display = 'none';
                    this.select.parentNode.insertBefore(this.container, this.select);

                    this.label.addEventListener('mousedown', function () {
                        _this.togglePicker();
                    });
                    this.label.addEventListener('keydown', function (event) {
                        switch (event.keyCode) {
                            // Allows the "Enter" key to open the picker
                            case _keyboard2.default.keys.ENTER:
                                _this.togglePicker();
                                break;

                            // Allows the "Escape" key to close the picker
                            case _keyboard2.default.keys.ESCAPE:
                                _this.escape();
                                event.preventDefault();
                                break;
                            default:
                        }
                    });
                    this.select.addEventListener('change', this.update.bind(this));
                }

                _createClass(Picker, [{
                    key: 'togglePicker',
                    value: function togglePicker() {
                        this.container.classList.toggle('ql-expanded');
                        // Toggle aria-expanded and aria-hidden to make the picker accessible
                        toggleAriaAttribute(this.label, 'aria-expanded');
                        toggleAriaAttribute(this.options, 'aria-hidden');
                    }
                }, {
                    key: 'buildItem',
                    value: function buildItem(option) {
                        var _this2 = this;

                        var item = document.createElement('span');
                        item.tabIndex = '0';
                        item.setAttribute('role', 'button');

                        item.classList.add('ql-picker-item');
                        if (option.hasAttribute('value')) {
                            item.setAttribute('data-value', option.getAttribute('value'));
                        }
                        if (option.textContent) {
                            item.setAttribute('data-label', option.textContent);
                        }
                        item.addEventListener('click', function () {
                            _this2.selectItem(item, true);
                        });
                        item.addEventListener('keydown', function (event) {
                            switch (event.keyCode) {
                                // Allows the "Enter" key to select an item
                                case _keyboard2.default.keys.ENTER:
                                    _this2.selectItem(item, true);
                                    event.preventDefault();
                                    break;

                                // Allows the "Escape" key to close the picker
                                case _keyboard2.default.keys.ESCAPE:
                                    _this2.escape();
                                    event.preventDefault();
                                    break;
                                default:
                            }
                        });

                        return item;
                    }
                }, {
                    key: 'buildLabel',
                    value: function buildLabel() {
                        var label = document.createElement('span');
                        label.classList.add('ql-picker-label');
                        label.innerHTML = _dropdown2.default;
                        label.tabIndex = '0';
                        label.setAttribute('role', 'button');
                        label.setAttribute('aria-expanded', 'false');
                        this.container.appendChild(label);
                        return label;
                    }
                }, {
                    key: 'buildOptions',
                    value: function buildOptions() {
                        var _this3 = this;

                        var options = document.createElement('span');
                        options.classList.add('ql-picker-options');

                        // Don't want screen readers to read this until options are visible
                        options.setAttribute('aria-hidden', 'true');
                        options.tabIndex = '-1';

                        // Need a unique id for aria-controls
                        options.id = 'ql-picker-options-' + optionsCounter;
                        optionsCounter += 1;
                        this.label.setAttribute('aria-controls', options.id);

                        this.options = options;

                        [].slice.call(this.select.options).forEach(function (option) {
                            var item = _this3.buildItem(option);
                            options.appendChild(item);
                            if (option.selected === true) {
                                _this3.selectItem(item);
                            }
                        });
                        this.container.appendChild(options);
                    }
                }, {
                    key: 'buildPicker',
                    value: function buildPicker() {
                        var _this4 = this;

                        [].slice.call(this.select.attributes).forEach(function (item) {
                            _this4.container.setAttribute(item.name, item.value);
                        });
                        this.container.classList.add('ql-picker');
                        this.label = this.buildLabel();
                        this.buildOptions();
                    }
                }, {
                    key: 'escape',
                    value: function escape() {
                        var _this5 = this;

                        // Close menu and return focus to trigger label
                        this.close();
                        // Need setTimeout for accessibility to ensure that the browser executes
                        // focus on the next process thread and after any DOM content changes
                        setTimeout(function () {
                            return _this5.label.focus();
                        }, 1);
                    }
                }, {
                    key: 'close',
                    value: function close() {
                        this.container.classList.remove('ql-expanded');
                        this.label.setAttribute('aria-expanded', 'false');
                        this.options.setAttribute('aria-hidden', 'true');
                    }
                }, {
                    key: 'selectItem',
                    value: function selectItem(item) {
                        var trigger = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

                        var selected = this.container.querySelector('.ql-selected');
                        if (item === selected) return;
                        if (selected != null) {
                            selected.classList.remove('ql-selected');
                        }
                        if (item == null) return;
                        item.classList.add('ql-selected');
                        this.select.selectedIndex = [].indexOf.call(item.parentNode.children, item);
                        if (item.hasAttribute('data-value')) {
                            this.label.setAttribute('data-value', item.getAttribute('data-value'));
                        } else {
                            this.label.removeAttribute('data-value');
                        }
                        if (item.hasAttribute('data-label')) {
                            this.label.setAttribute('data-label', item.getAttribute('data-label'));
                        } else {
                            this.label.removeAttribute('data-label');
                        }
                        if (trigger) {
                            if (typeof Event === 'function') {
                                this.select.dispatchEvent(new Event('change'));
                            } else if ((typeof Event === 'undefined' ? 'undefined' : _typeof(Event)) === 'object') {
                                // IE11
                                var event = document.createEvent('Event');
                                event.initEvent('change', true, true);
                                this.select.dispatchEvent(event);
                            }
                            this.close();
                        }
                    }
                }, {
                    key: 'update',
                    value: function update() {
                        var option = void 0;
                        if (this.select.selectedIndex > -1) {
                            var item = this.container.querySelector('.ql-picker-options').children[this.select.selectedIndex];
                            option = this.select.options[this.select.selectedIndex];
                            this.selectItem(item);
                        } else {
                            this.selectItem(null);
                        }
                        var isActive = option != null && option !== this.select.querySelector('option[selected]');
                        this.label.classList.toggle('ql-active', isActive);
                    }
                }]);

                return Picker;
            }();

            exports.default = Picker;

            /***/ }),
        /* 29 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _quill = __webpack_require__(5);

            var _quill2 = _interopRequireDefault(_quill);

            var _block = __webpack_require__(4);

            var _block2 = _interopRequireDefault(_block);

            var _break = __webpack_require__(16);

            var _break2 = _interopRequireDefault(_break);

            var _container = __webpack_require__(25);

            var _container2 = _interopRequireDefault(_container);

            var _cursor = __webpack_require__(24);

            var _cursor2 = _interopRequireDefault(_cursor);

            var _embed = __webpack_require__(35);

            var _embed2 = _interopRequireDefault(_embed);

            var _inline = __webpack_require__(6);

            var _inline2 = _interopRequireDefault(_inline);

            var _scroll = __webpack_require__(22);

            var _scroll2 = _interopRequireDefault(_scroll);

            var _text = __webpack_require__(7);

            var _text2 = _interopRequireDefault(_text);

            var _clipboard = __webpack_require__(55);

            var _clipboard2 = _interopRequireDefault(_clipboard);

            var _history = __webpack_require__(42);

            var _history2 = _interopRequireDefault(_history);

            var _keyboard = __webpack_require__(23);

            var _keyboard2 = _interopRequireDefault(_keyboard);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            _quill2.default.register({
                'blots/block': _block2.default,
                'blots/block/embed': _block.BlockEmbed,
                'blots/break': _break2.default,
                'blots/container': _container2.default,
                'blots/cursor': _cursor2.default,
                'blots/embed': _embed2.default,
                'blots/inline': _inline2.default,
                'blots/scroll': _scroll2.default,
                'blots/text': _text2.default,

                'modules/clipboard': _clipboard2.default,
                'modules/history': _history2.default,
                'modules/keyboard': _keyboard2.default
            });

            _parchment2.default.register(_block2.default, _break2.default, _cursor2.default, _inline2.default, _scroll2.default, _text2.default);

            exports.default = _quill2.default;

            /***/ }),
        /* 30 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            Object.defineProperty(exports, "__esModule", { value: true });
            var Registry = __webpack_require__(1);
            var ShadowBlot = /** @class */ (function () {
                function ShadowBlot(domNode) {
                    this.domNode = domNode;
                    // @ts-ignore
                    this.domNode[Registry.DATA_KEY] = { blot: this };
                }
                Object.defineProperty(ShadowBlot.prototype, "statics", {
                    // Hack for accessing inherited static methods
                    get: function () {
                        return this.constructor;
                    },
                    enumerable: true,
                    configurable: true
                });
                ShadowBlot.create = function (value) {
                    if (this.tagName == null) {
                        throw new Registry.ParchmentError('Blot definition missing tagName');
                    }
                    var node;
                    if (Array.isArray(this.tagName)) {
                        if (typeof value === 'string') {
                            value = value.toUpperCase();
                            if (parseInt(value).toString() === value) {
                                value = parseInt(value);
                            }
                        }
                        if (typeof value === 'number') {
                            node = document.createElement(this.tagName[value - 1]);
                        }
                        else if (this.tagName.indexOf(value) > -1) {
                            node = document.createElement(value);
                        }
                        else {
                            node = document.createElement(this.tagName[0]);
                        }
                    }
                    else {
                        node = document.createElement(this.tagName);
                    }
                    if (this.className) {
                        node.classList.add(this.className);
                    }
                    return node;
                };
                ShadowBlot.prototype.attach = function () {
                    if (this.parent != null) {
                        this.scroll = this.parent.scroll;
                    }
                };
                ShadowBlot.prototype.clone = function () {
                    var domNode = this.domNode.cloneNode(false);
                    return Registry.create(domNode);
                };
                ShadowBlot.prototype.detach = function () {
                    if (this.parent != null)
                        this.parent.removeChild(this);
                    // @ts-ignore
                    delete this.domNode[Registry.DATA_KEY];
                };
                ShadowBlot.prototype.deleteAt = function (index, length) {
                    var blot = this.isolate(index, length);
                    blot.remove();
                };
                ShadowBlot.prototype.formatAt = function (index, length, name, value) {
                    var blot = this.isolate(index, length);
                    if (Registry.query(name, Registry.Scope.BLOT) != null && value) {
                        blot.wrap(name, value);
                    }
                    else if (Registry.query(name, Registry.Scope.ATTRIBUTE) != null) {
                        var parent = Registry.create(this.statics.scope);
                        blot.wrap(parent);
                        parent.format(name, value);
                    }
                };
                ShadowBlot.prototype.insertAt = function (index, value, def) {
                    var blot = def == null ? Registry.create('text', value) : Registry.create(value, def);
                    var ref = this.split(index);
                    this.parent.insertBefore(blot, ref);
                };
                ShadowBlot.prototype.insertInto = function (parentBlot, refBlot) {
                    if (refBlot === void 0) { refBlot = null; }
                    if (this.parent != null) {
                        this.parent.children.remove(this);
                    }
                    var refDomNode = null;
                    parentBlot.children.insertBefore(this, refBlot);
                    if (refBlot != null) {
                        refDomNode = refBlot.domNode;
                    }
                    if (this.domNode.parentNode != parentBlot.domNode ||
                        this.domNode.nextSibling != refDomNode) {
                        parentBlot.domNode.insertBefore(this.domNode, refDomNode);
                    }
                    this.parent = parentBlot;
                    this.attach();
                };
                ShadowBlot.prototype.isolate = function (index, length) {
                    var target = this.split(index);
                    target.split(length);
                    return target;
                };
                ShadowBlot.prototype.length = function () {
                    return 1;
                };
                ShadowBlot.prototype.offset = function (root) {
                    if (root === void 0) { root = this.parent; }
                    if (this.parent == null || this == root)
                        return 0;
                    return this.parent.children.offset(this) + this.parent.offset(root);
                };
                ShadowBlot.prototype.optimize = function (context) {
                    // TODO clean up once we use WeakMap
                    // @ts-ignore
                    if (this.domNode[Registry.DATA_KEY] != null) {
                        // @ts-ignore
                        delete this.domNode[Registry.DATA_KEY].mutations;
                    }
                };
                ShadowBlot.prototype.remove = function () {
                    if (this.domNode.parentNode != null) {
                        this.domNode.parentNode.removeChild(this.domNode);
                    }
                    this.detach();
                };
                ShadowBlot.prototype.replace = function (target) {
                    if (target.parent == null)
                        return;
                    target.parent.insertBefore(this, target.next);
                    target.remove();
                };
                ShadowBlot.prototype.replaceWith = function (name, value) {
                    var replacement = typeof name === 'string' ? Registry.create(name, value) : name;
                    replacement.replace(this);
                    return replacement;
                };
                ShadowBlot.prototype.split = function (index, force) {
                    return index === 0 ? this : this.next;
                };
                ShadowBlot.prototype.update = function (mutations, context) {
                    // Nothing to do by default
                };
                ShadowBlot.prototype.wrap = function (name, value) {
                    var wrapper = typeof name === 'string' ? Registry.create(name, value) : name;
                    if (this.parent != null) {
                        this.parent.insertBefore(wrapper, this.next);
                    }
                    wrapper.appendChild(this);
                    return wrapper;
                };
                ShadowBlot.blotName = 'abstract';
                return ShadowBlot;
            }());
            exports.default = ShadowBlot;


            /***/ }),
        /* 31 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            Object.defineProperty(exports, "__esModule", { value: true });
            var attributor_1 = __webpack_require__(12);
            var class_1 = __webpack_require__(32);
            var style_1 = __webpack_require__(33);
            var Registry = __webpack_require__(1);
            var AttributorStore = /** @class */ (function () {
                function AttributorStore(domNode) {
                    this.attributes = {};
                    this.domNode = domNode;
                    this.build();
                }
                AttributorStore.prototype.attribute = function (attribute, value) {
                    // verb
                    if (value) {
                        if (attribute.add(this.domNode, value)) {
                            if (attribute.value(this.domNode) != null) {
                                this.attributes[attribute.attrName] = attribute;
                            }
                            else {
                                delete this.attributes[attribute.attrName];
                            }
                        }
                    }
                    else {
                        attribute.remove(this.domNode);
                        delete this.attributes[attribute.attrName];
                    }
                };
                AttributorStore.prototype.build = function () {
                    var _this = this;
                    this.attributes = {};
                    var attributes = attributor_1.default.keys(this.domNode);
                    var classes = class_1.default.keys(this.domNode);
                    var styles = style_1.default.keys(this.domNode);
                    attributes
                        .concat(classes)
                        .concat(styles)
                        .forEach(function (name) {
                            var attr = Registry.query(name, Registry.Scope.ATTRIBUTE);
                            if (attr instanceof attributor_1.default) {
                                _this.attributes[attr.attrName] = attr;
                            }
                        });
                };
                AttributorStore.prototype.copy = function (target) {
                    var _this = this;
                    Object.keys(this.attributes).forEach(function (key) {
                        var value = _this.attributes[key].value(_this.domNode);
                        target.format(key, value);
                    });
                };
                AttributorStore.prototype.move = function (target) {
                    var _this = this;
                    this.copy(target);
                    Object.keys(this.attributes).forEach(function (key) {
                        _this.attributes[key].remove(_this.domNode);
                    });
                    this.attributes = {};
                };
                AttributorStore.prototype.values = function () {
                    var _this = this;
                    return Object.keys(this.attributes).reduce(function (attributes, name) {
                        attributes[name] = _this.attributes[name].value(_this.domNode);
                        return attributes;
                    }, {});
                };
                return AttributorStore;
            }());
            exports.default = AttributorStore;


            /***/ }),
        /* 32 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            var __extends = (this && this.__extends) || (function () {
                var extendStatics = Object.setPrototypeOf ||
                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
                return function (d, b) {
                    extendStatics(d, b);
                    function __() { this.constructor = d; }
                    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
                };
            })();
            Object.defineProperty(exports, "__esModule", { value: true });
            var attributor_1 = __webpack_require__(12);
            function match(node, prefix) {
                var className = node.getAttribute('class') || '';
                return className.split(/\s+/).filter(function (name) {
                    return name.indexOf(prefix + "-") === 0;
                });
            }
            var ClassAttributor = /** @class */ (function (_super) {
                __extends(ClassAttributor, _super);
                function ClassAttributor() {
                    return _super !== null && _super.apply(this, arguments) || this;
                }
                ClassAttributor.keys = function (node) {
                    return (node.getAttribute('class') || '').split(/\s+/).map(function (name) {
                        return name
                            .split('-')
                            .slice(0, -1)
                            .join('-');
                    });
                };
                ClassAttributor.prototype.add = function (node, value) {
                    if (!this.canAdd(node, value))
                        return false;
                    this.remove(node);
                    node.classList.add(this.keyName + "-" + value);
                    return true;
                };
                ClassAttributor.prototype.remove = function (node) {
                    var matches = match(node, this.keyName);
                    matches.forEach(function (name) {
                        node.classList.remove(name);
                    });
                    if (node.classList.length === 0) {
                        node.removeAttribute('class');
                    }
                };
                ClassAttributor.prototype.value = function (node) {
                    var result = match(node, this.keyName)[0] || '';
                    var value = result.slice(this.keyName.length + 1); // +1 for hyphen
                    return this.canAdd(node, value) ? value : '';
                };
                return ClassAttributor;
            }(attributor_1.default));
            exports.default = ClassAttributor;


            /***/ }),
        /* 33 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            var __extends = (this && this.__extends) || (function () {
                var extendStatics = Object.setPrototypeOf ||
                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
                return function (d, b) {
                    extendStatics(d, b);
                    function __() { this.constructor = d; }
                    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
                };
            })();
            Object.defineProperty(exports, "__esModule", { value: true });
            var attributor_1 = __webpack_require__(12);
            function camelize(name) {
                var parts = name.split('-');
                var rest = parts
                    .slice(1)
                    .map(function (part) {
                        return part[0].toUpperCase() + part.slice(1);
                    })
                    .join('');
                return parts[0] + rest;
            }
            var StyleAttributor = /** @class */ (function (_super) {
                __extends(StyleAttributor, _super);
                function StyleAttributor() {
                    return _super !== null && _super.apply(this, arguments) || this;
                }
                StyleAttributor.keys = function (node) {
                    return (node.getAttribute('style') || '').split(';').map(function (value) {
                        var arr = value.split(':');
                        return arr[0].trim();
                    });
                };
                StyleAttributor.prototype.add = function (node, value) {
                    if (!this.canAdd(node, value))
                        return false;
                    // @ts-ignore
                    node.style[camelize(this.keyName)] = value;
                    return true;
                };
                StyleAttributor.prototype.remove = function (node) {
                    // @ts-ignore
                    node.style[camelize(this.keyName)] = '';
                    if (!node.getAttribute('style')) {
                        node.removeAttribute('style');
                    }
                };
                StyleAttributor.prototype.value = function (node) {
                    // @ts-ignore
                    var value = node.style[camelize(this.keyName)];
                    return this.canAdd(node, value) ? value : '';
                };
                return StyleAttributor;
            }(attributor_1.default));
            exports.default = StyleAttributor;


            /***/ }),
        /* 34 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            var Theme = function () {
                function Theme(quill, options) {
                    _classCallCheck(this, Theme);

                    this.quill = quill;
                    this.options = options;
                    this.modules = {};
                }

                _createClass(Theme, [{
                    key: 'init',
                    value: function init() {
                        var _this = this;

                        Object.keys(this.options.modules).forEach(function (name) {
                            if (_this.modules[name] == null) {
                                _this.addModule(name);
                            }
                        });
                    }
                }, {
                    key: 'addModule',
                    value: function addModule(name) {
                        var moduleClass = this.quill.constructor.import('modules/' + name);
                        this.modules[name] = new moduleClass(this.quill, this.options.modules[name] || {});
                        return this.modules[name];
                    }
                }]);

                return Theme;
            }();

            Theme.DEFAULTS = {
                modules: {}
            };
            Theme.themes = {
                'default': Theme
            };

            exports.default = Theme;

            /***/ }),
        /* 35 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _text = __webpack_require__(7);

            var _text2 = _interopRequireDefault(_text);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var GUARD_TEXT = '\uFEFF';

            var Embed = function (_Parchment$Embed) {
                _inherits(Embed, _Parchment$Embed);

                function Embed(node) {
                    _classCallCheck(this, Embed);

                    var _this = _possibleConstructorReturn(this, (Embed.__proto__ || Object.getPrototypeOf(Embed)).call(this, node));

                    _this.contentNode = document.createElement('span');
                    _this.contentNode.setAttribute('contenteditable', false);
                    [].slice.call(_this.domNode.childNodes).forEach(function (childNode) {
                        _this.contentNode.appendChild(childNode);
                    });
                    _this.leftGuard = document.createTextNode(GUARD_TEXT);
                    _this.rightGuard = document.createTextNode(GUARD_TEXT);
                    _this.domNode.appendChild(_this.leftGuard);
                    _this.domNode.appendChild(_this.contentNode);
                    _this.domNode.appendChild(_this.rightGuard);
                    return _this;
                }

                _createClass(Embed, [{
                    key: 'index',
                    value: function index(node, offset) {
                        if (node === this.leftGuard) return 0;
                        if (node === this.rightGuard) return 1;
                        return _get(Embed.prototype.__proto__ || Object.getPrototypeOf(Embed.prototype), 'index', this).call(this, node, offset);
                    }
                }, {
                    key: 'restore',
                    value: function restore(node) {
                        var range = void 0,
                            textNode = void 0;
                        var text = node.data.split(GUARD_TEXT).join('');
                        if (node === this.leftGuard) {
                            if (this.prev instanceof _text2.default) {
                                var prevLength = this.prev.length();
                                this.prev.insertAt(prevLength, text);
                                range = {
                                    startNode: this.prev.domNode,
                                    startOffset: prevLength + text.length
                                };
                            } else {
                                textNode = document.createTextNode(text);
                                this.parent.insertBefore(_parchment2.default.create(textNode), this);
                                range = {
                                    startNode: textNode,
                                    startOffset: text.length
                                };
                            }
                        } else if (node === this.rightGuard) {
                            if (this.next instanceof _text2.default) {
                                this.next.insertAt(0, text);
                                range = {
                                    startNode: this.next.domNode,
                                    startOffset: text.length
                                };
                            } else {
                                textNode = document.createTextNode(text);
                                this.parent.insertBefore(_parchment2.default.create(textNode), this.next);
                                range = {
                                    startNode: textNode,
                                    startOffset: text.length
                                };
                            }
                        }
                        node.data = GUARD_TEXT;
                        return range;
                    }
                }, {
                    key: 'update',
                    value: function update(mutations, context) {
                        var _this2 = this;

                        mutations.forEach(function (mutation) {
                            if (mutation.type === 'characterData' && (mutation.target === _this2.leftGuard || mutation.target === _this2.rightGuard)) {
                                var range = _this2.restore(mutation.target);
                                if (range) context.range = range;
                            }
                        });
                    }
                }]);

                return Embed;
            }(_parchment2.default.Embed);

            exports.default = Embed;

            /***/ }),
        /* 36 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.AlignStyle = exports.AlignClass = exports.AlignAttribute = undefined;

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            var config = {
                scope: _parchment2.default.Scope.BLOCK,
                whitelist: ['right', 'center', 'justify']
            };

            var AlignAttribute = new _parchment2.default.Attributor.Attribute('align', 'align', config);
            var AlignClass = new _parchment2.default.Attributor.Class('align', 'ql-align', config);
            var AlignStyle = new _parchment2.default.Attributor.Style('align', 'text-align', config);

            exports.AlignAttribute = AlignAttribute;
            exports.AlignClass = AlignClass;
            exports.AlignStyle = AlignStyle;

            /***/ }),
        /* 37 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.BackgroundStyle = exports.BackgroundClass = undefined;

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _color = __webpack_require__(26);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            var BackgroundClass = new _parchment2.default.Attributor.Class('background', 'ql-bg', {
                scope: _parchment2.default.Scope.INLINE
            });
            var BackgroundStyle = new _color.ColorAttributor('background', 'background-color', {
                scope: _parchment2.default.Scope.INLINE
            });

            exports.BackgroundClass = BackgroundClass;
            exports.BackgroundStyle = BackgroundStyle;

            /***/ }),
        /* 38 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.DirectionStyle = exports.DirectionClass = exports.DirectionAttribute = undefined;

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            var config = {
                scope: _parchment2.default.Scope.BLOCK,
                whitelist: ['rtl']
            };

            var DirectionAttribute = new _parchment2.default.Attributor.Attribute('direction', 'dir', config);
            var DirectionClass = new _parchment2.default.Attributor.Class('direction', 'ql-direction', config);
            var DirectionStyle = new _parchment2.default.Attributor.Style('direction', 'direction', config);

            exports.DirectionAttribute = DirectionAttribute;
            exports.DirectionClass = DirectionClass;
            exports.DirectionStyle = DirectionStyle;

            /***/ }),
        /* 39 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.FontClass = exports.FontStyle = undefined;

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var config = {
                scope: _parchment2.default.Scope.INLINE,
                whitelist: ['serif', 'monospace']
            };

            var FontClass = new _parchment2.default.Attributor.Class('font', 'ql-font', config);

            var FontStyleAttributor = function (_Parchment$Attributor) {
                _inherits(FontStyleAttributor, _Parchment$Attributor);

                function FontStyleAttributor() {
                    _classCallCheck(this, FontStyleAttributor);

                    return _possibleConstructorReturn(this, (FontStyleAttributor.__proto__ || Object.getPrototypeOf(FontStyleAttributor)).apply(this, arguments));
                }

                _createClass(FontStyleAttributor, [{
                    key: 'value',
                    value: function value(node) {
                        return _get(FontStyleAttributor.prototype.__proto__ || Object.getPrototypeOf(FontStyleAttributor.prototype), 'value', this).call(this, node).replace(/["']/g, '');
                    }
                }]);

                return FontStyleAttributor;
            }(_parchment2.default.Attributor.Style);

            var FontStyle = new FontStyleAttributor('font', 'font-family', config);

            exports.FontStyle = FontStyle;
            exports.FontClass = FontClass;

            /***/ }),
        /* 40 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.SizeStyle = exports.SizeClass = undefined;

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            var SizeClass = new _parchment2.default.Attributor.Class('size', 'ql-size', {
                scope: _parchment2.default.Scope.INLINE,
                whitelist: ['small', 'large', 'huge']
            });
            var SizeStyle = new _parchment2.default.Attributor.Style('size', 'font-size', {
                scope: _parchment2.default.Scope.INLINE,
                whitelist: ['10px', '18px', '32px']
            });

            exports.SizeClass = SizeClass;
            exports.SizeStyle = SizeStyle;

            /***/ }),
        /* 41 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            module.exports = {
                'align': {
                    '': __webpack_require__(76),
                    'center': __webpack_require__(77),
                    'right': __webpack_require__(78),
                    'justify': __webpack_require__(79)
                },
                'background': __webpack_require__(80),
                'blockquote': __webpack_require__(81),
                'bold': __webpack_require__(82),
                'clean': __webpack_require__(83),
                'code': __webpack_require__(58),
                'code-block': __webpack_require__(58),
                'color': __webpack_require__(84),
                'direction': {
                    '': __webpack_require__(85),
                    'rtl': __webpack_require__(86)
                },
                'float': {
                    'center': __webpack_require__(87),
                    'full': __webpack_require__(88),
                    'left': __webpack_require__(89),
                    'right': __webpack_require__(90)
                },
                'formula': __webpack_require__(91),
                'header': {
                    '1': __webpack_require__(92),
                    '2': __webpack_require__(93)
                },
                'italic': __webpack_require__(94),
                'image': __webpack_require__(95),
                'indent': {
                    '+1': __webpack_require__(96),
                    '-1': __webpack_require__(97)
                },
                'link': __webpack_require__(98),
                'list': {
                    'ordered': __webpack_require__(99),
                    'bullet': __webpack_require__(100),
                    'check': __webpack_require__(101)
                },
                'script': {
                    'sub': __webpack_require__(102),
                    'super': __webpack_require__(103)
                },
                'strike': __webpack_require__(104),
                'underline': __webpack_require__(105),
                'video': __webpack_require__(106)
            };

            /***/ }),
        /* 42 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.getLastChangeIndex = exports.default = undefined;

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _quill = __webpack_require__(5);

            var _quill2 = _interopRequireDefault(_quill);

            var _module = __webpack_require__(9);

            var _module2 = _interopRequireDefault(_module);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var History = function (_Module) {
                _inherits(History, _Module);

                function History(quill, options) {
                    _classCallCheck(this, History);

                    var _this = _possibleConstructorReturn(this, (History.__proto__ || Object.getPrototypeOf(History)).call(this, quill, options));

                    _this.lastRecorded = 0;
                    _this.ignoreChange = false;
                    _this.clear();
                    _this.quill.on(_quill2.default.events.EDITOR_CHANGE, function (eventName, delta, oldDelta, source) {
                        if (eventName !== _quill2.default.events.TEXT_CHANGE || _this.ignoreChange) return;
                        if (!_this.options.userOnly || source === _quill2.default.sources.USER) {
                            _this.record(delta, oldDelta);
                        } else {
                            _this.transform(delta);
                        }
                    });
                    _this.quill.keyboard.addBinding({ key: 'Z', shortKey: true }, _this.undo.bind(_this));
                    _this.quill.keyboard.addBinding({ key: 'Z', shortKey: true, shiftKey: true }, _this.redo.bind(_this));
                    if (/Win/i.test(navigator.platform)) {
                        _this.quill.keyboard.addBinding({ key: 'Y', shortKey: true }, _this.redo.bind(_this));
                    }
                    return _this;
                }

                _createClass(History, [{
                    key: 'change',
                    value: function change(source, dest) {
                        if (this.stack[source].length === 0) return;
                        var delta = this.stack[source].pop();
                        this.stack[dest].push(delta);
                        this.lastRecorded = 0;
                        this.ignoreChange = true;
                        this.quill.updateContents(delta[source], _quill2.default.sources.USER);
                        this.ignoreChange = false;
                        var index = getLastChangeIndex(delta[source]);
                        this.quill.setSelection(index);
                    }
                }, {
                    key: 'clear',
                    value: function clear() {
                        this.stack = { undo: [], redo: [] };
                    }
                }, {
                    key: 'cutoff',
                    value: function cutoff() {
                        this.lastRecorded = 0;
                    }
                }, {
                    key: 'record',
                    value: function record(changeDelta, oldDelta) {
                        if (changeDelta.ops.length === 0) return;
                        this.stack.redo = [];
                        var undoDelta = this.quill.getContents().diff(oldDelta);
                        var timestamp = Date.now();
                        if (this.lastRecorded + this.options.delay > timestamp && this.stack.undo.length > 0) {
                            var delta = this.stack.undo.pop();
                            undoDelta = undoDelta.compose(delta.undo);
                            changeDelta = delta.redo.compose(changeDelta);
                        } else {
                            this.lastRecorded = timestamp;
                        }
                        this.stack.undo.push({
                            redo: changeDelta,
                            undo: undoDelta
                        });
                        if (this.stack.undo.length > this.options.maxStack) {
                            this.stack.undo.shift();
                        }
                    }
                }, {
                    key: 'redo',
                    value: function redo() {
                        this.change('redo', 'undo');
                    }
                }, {
                    key: 'transform',
                    value: function transform(delta) {
                        this.stack.undo.forEach(function (change) {
                            change.undo = delta.transform(change.undo, true);
                            change.redo = delta.transform(change.redo, true);
                        });
                        this.stack.redo.forEach(function (change) {
                            change.undo = delta.transform(change.undo, true);
                            change.redo = delta.transform(change.redo, true);
                        });
                    }
                }, {
                    key: 'undo',
                    value: function undo() {
                        this.change('undo', 'redo');
                    }
                }]);

                return History;
            }(_module2.default);

            History.DEFAULTS = {
                delay: 1000,
                maxStack: 100,
                userOnly: false
            };

            function endsWithNewlineChange(delta) {
                var lastOp = delta.ops[delta.ops.length - 1];
                if (lastOp == null) return false;
                if (lastOp.insert != null) {
                    return typeof lastOp.insert === 'string' && lastOp.insert.endsWith('\n');
                }
                if (lastOp.attributes != null) {
                    return Object.keys(lastOp.attributes).some(function (attr) {
                        return _parchment2.default.query(attr, _parchment2.default.Scope.BLOCK) != null;
                    });
                }
                return false;
            }

            function getLastChangeIndex(delta) {
                var deleteLength = delta.reduce(function (length, op) {
                    length += op.delete || 0;
                    return length;
                }, 0);
                var changeIndex = delta.length() - deleteLength;
                if (endsWithNewlineChange(delta)) {
                    changeIndex -= 1;
                }
                return changeIndex;
            }

            exports.default = History;
            exports.getLastChangeIndex = getLastChangeIndex;

            /***/ }),
        /* 43 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.default = exports.BaseTooltip = undefined;

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _extend = __webpack_require__(3);

            var _extend2 = _interopRequireDefault(_extend);

            var _quillDelta = __webpack_require__(2);

            var _quillDelta2 = _interopRequireDefault(_quillDelta);

            var _emitter = __webpack_require__(8);

            var _emitter2 = _interopRequireDefault(_emitter);

            var _keyboard = __webpack_require__(23);

            var _keyboard2 = _interopRequireDefault(_keyboard);

            var _theme = __webpack_require__(34);

            var _theme2 = _interopRequireDefault(_theme);

            var _colorPicker = __webpack_require__(59);

            var _colorPicker2 = _interopRequireDefault(_colorPicker);

            var _iconPicker = __webpack_require__(60);

            var _iconPicker2 = _interopRequireDefault(_iconPicker);

            var _picker = __webpack_require__(28);

            var _picker2 = _interopRequireDefault(_picker);

            var _tooltip = __webpack_require__(61);

            var _tooltip2 = _interopRequireDefault(_tooltip);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var ALIGNS = [false, 'center', 'right', 'justify'];

            var COLORS = ["#000000", "#e60000", "#ff9900", "#ffff00", "#008a00", "#0066cc", "#9933ff", "#ffffff", "#facccc", "#ffebcc", "#ffffcc", "#cce8cc", "#cce0f5", "#ebd6ff", "#bbbbbb", "#f06666", "#ffc266", "#ffff66", "#66b966", "#66a3e0", "#c285ff", "#888888", "#a10000", "#b26b00", "#b2b200", "#006100", "#0047b2", "#6b24b2", "#444444", "#5c0000", "#663d00", "#666600", "#003700", "#002966", "#3d1466"];

            var FONTS = [false, 'serif', 'monospace'];

            var HEADERS = ['1', '2', '3', false];

            var SIZES = ['small', false, 'large', 'huge'];

            var BaseTheme = function (_Theme) {
                _inherits(BaseTheme, _Theme);

                function BaseTheme(quill, options) {
                    _classCallCheck(this, BaseTheme);

                    var _this = _possibleConstructorReturn(this, (BaseTheme.__proto__ || Object.getPrototypeOf(BaseTheme)).call(this, quill, options));

                    var listener = function listener(e) {
                        if (!document.body.contains(quill.root)) {
                            return document.body.removeEventListener('click', listener);
                        }
                        if (_this.tooltip != null && !_this.tooltip.root.contains(e.target) && document.activeElement !== _this.tooltip.textbox && !_this.quill.hasFocus()) {
                            _this.tooltip.hide();
                        }
                        if (_this.pickers != null) {
                            _this.pickers.forEach(function (picker) {
                                if (!picker.container.contains(e.target)) {
                                    picker.close();
                                }
                            });
                        }
                    };
                    quill.emitter.listenDOM('click', document.body, listener);
                    return _this;
                }

                _createClass(BaseTheme, [{
                    key: 'addModule',
                    value: function addModule(name) {
                        var module = _get(BaseTheme.prototype.__proto__ || Object.getPrototypeOf(BaseTheme.prototype), 'addModule', this).call(this, name);
                        if (name === 'toolbar') {
                            this.extendToolbar(module);
                        }
                        return module;
                    }
                }, {
                    key: 'buildButtons',
                    value: function buildButtons(buttons, icons) {
                        buttons.forEach(function (button) {
                            var className = button.getAttribute('class') || '';
                            className.split(/\s+/).forEach(function (name) {
                                if (!name.startsWith('ql-')) return;
                                name = name.slice('ql-'.length);
                                if (icons[name] == null) return;
                                if (name === 'direction') {
                                    button.innerHTML = icons[name][''] + icons[name]['rtl'];
                                } else if (typeof icons[name] === 'string') {
                                    button.innerHTML = icons[name];
                                } else {
                                    var value = button.value || '';
                                    if (value != null && icons[name][value]) {
                                        button.innerHTML = icons[name][value];
                                    }
                                }
                            });
                        });
                    }
                }, {
                    key: 'buildPickers',
                    value: function buildPickers(selects, icons) {
                        var _this2 = this;

                        this.pickers = selects.map(function (select) {
                            if (select.classList.contains('ql-align')) {
                                if (select.querySelector('option') == null) {
                                    fillSelect(select, ALIGNS);
                                }
                                return new _iconPicker2.default(select, icons.align);
                            } else if (select.classList.contains('ql-background') || select.classList.contains('ql-color')) {
                                var format = select.classList.contains('ql-background') ? 'background' : 'color';
                                if (select.querySelector('option') == null) {
                                    fillSelect(select, COLORS, format === 'background' ? '#ffffff' : '#000000');
                                }
                                return new _colorPicker2.default(select, icons[format]);
                            } else {
                                if (select.querySelector('option') == null) {
                                    if (select.classList.contains('ql-font')) {
                                        fillSelect(select, FONTS);
                                    } else if (select.classList.contains('ql-header')) {
                                        fillSelect(select, HEADERS);
                                    } else if (select.classList.contains('ql-size')) {
                                        fillSelect(select, SIZES);
                                    }
                                }
                                return new _picker2.default(select);
                            }
                        });
                        var update = function update() {
                            _this2.pickers.forEach(function (picker) {
                                picker.update();
                            });
                        };
                        this.quill.on(_emitter2.default.events.EDITOR_CHANGE, update);
                    }
                }]);

                return BaseTheme;
            }(_theme2.default);

            BaseTheme.DEFAULTS = (0, _extend2.default)(true, {}, _theme2.default.DEFAULTS, {
                modules: {
                    toolbar: {
                        handlers: {
                            formula: function formula() {
                                this.quill.theme.tooltip.edit('formula');
                            },
                            image: function image() {
                                var _this3 = this;

                                var fileInput = this.container.querySelector('input.ql-image[type=file]');
                                if (fileInput == null) {
                                    fileInput = document.createElement('input');
                                    fileInput.setAttribute('type', 'file');
                                    fileInput.setAttribute('accept', 'image/png, image/gif, image/jpeg, image/bmp, image/x-icon');
                                    fileInput.classList.add('ql-image');
                                    fileInput.addEventListener('change', function () {
                                        if (fileInput.files != null && fileInput.files[0] != null) {
                                            var reader = new FileReader();
                                            reader.onload = function (e) {
                                                var range = _this3.quill.getSelection(true);
                                                _this3.quill.updateContents(new _quillDelta2.default().retain(range.index).delete(range.length).insert({ image: e.target.result }), _emitter2.default.sources.USER);
                                                _this3.quill.setSelection(range.index + 1, _emitter2.default.sources.SILENT);
                                                fileInput.value = "";
                                            };
                                            reader.readAsDataURL(fileInput.files[0]);
                                        }
                                    });
                                    this.container.appendChild(fileInput);
                                }
                                fileInput.click();
                            },
                            video: function video() {
                                this.quill.theme.tooltip.edit('video');
                            }
                        }
                    }
                }
            });

            var BaseTooltip = function (_Tooltip) {
                _inherits(BaseTooltip, _Tooltip);

                function BaseTooltip(quill, boundsContainer) {
                    _classCallCheck(this, BaseTooltip);

                    var _this4 = _possibleConstructorReturn(this, (BaseTooltip.__proto__ || Object.getPrototypeOf(BaseTooltip)).call(this, quill, boundsContainer));

                    _this4.textbox = _this4.root.querySelector('input[type="text"]');
                    _this4.listen();
                    return _this4;
                }

                _createClass(BaseTooltip, [{
                    key: 'listen',
                    value: function listen() {
                        var _this5 = this;

                        this.textbox.addEventListener('keydown', function (event) {
                            if (_keyboard2.default.match(event, 'enter')) {
                                _this5.save();
                                event.preventDefault();
                            } else if (_keyboard2.default.match(event, 'escape')) {
                                _this5.cancel();
                                event.preventDefault();
                            }
                        });
                    }
                }, {
                    key: 'cancel',
                    value: function cancel() {
                        this.hide();
                    }
                }, {
                    key: 'edit',
                    value: function edit() {
                        var mode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'link';
                        var preview = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        this.root.classList.remove('ql-hidden');
                        this.root.classList.add('ql-editing');
                        if (preview != null) {
                            this.textbox.value = preview;
                        } else if (mode !== this.root.getAttribute('data-mode')) {
                            this.textbox.value = '';
                        }
                        this.position(this.quill.getBounds(this.quill.selection.savedRange));
                        this.textbox.select();
                        this.textbox.setAttribute('placeholder', this.textbox.getAttribute('data-' + mode) || '');
                        this.root.setAttribute('data-mode', mode);
                    }
                }, {
                    key: 'restoreFocus',
                    value: function restoreFocus() {
                        var scrollTop = this.quill.scrollingContainer.scrollTop;
                        this.quill.focus();
                        this.quill.scrollingContainer.scrollTop = scrollTop;
                    }
                }, {
                    key: 'save',
                    value: function save() {
                        var value = this.textbox.value;
                        switch (this.root.getAttribute('data-mode')) {
                            case 'link':
                            {
                                var scrollTop = this.quill.root.scrollTop;
                                if (this.linkRange) {
                                    this.quill.formatText(this.linkRange, 'link', value, _emitter2.default.sources.USER);
                                    delete this.linkRange;
                                } else {
                                    this.restoreFocus();
                                    this.quill.format('link', value, _emitter2.default.sources.USER);
                                }
                                this.quill.root.scrollTop = scrollTop;
                                break;
                            }
                            case 'video':
                            {
                                value = extractVideoUrl(value);
                            } // eslint-disable-next-line no-fallthrough
                            case 'formula':
                            {
                                if (!value) break;
                                var range = this.quill.getSelection(true);
                                if (range != null) {
                                    var index = range.index + range.length;
                                    this.quill.insertEmbed(index, this.root.getAttribute('data-mode'), value, _emitter2.default.sources.USER);
                                    if (this.root.getAttribute('data-mode') === 'formula') {
                                        this.quill.insertText(index + 1, ' ', _emitter2.default.sources.USER);
                                    }
                                    this.quill.setSelection(index + 2, _emitter2.default.sources.USER);
                                }
                                break;
                            }
                            default:
                        }
                        this.textbox.value = '';
                        this.hide();
                    }
                }]);

                return BaseTooltip;
            }(_tooltip2.default);

            function extractVideoUrl(url) {
                var match = url.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/) || url.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);
                if (match) {
                    return (match[1] || 'https') + '://www.youtube.com/embed/' + match[2] + '?showinfo=0';
                }
                if (match = url.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/)) {
                    // eslint-disable-line no-cond-assign
                    return (match[1] || 'https') + '://player.vimeo.com/video/' + match[2] + '/';
                }
                return url;
            }

            function fillSelect(select, values) {
                var defaultValue = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

                values.forEach(function (value) {
                    var option = document.createElement('option');
                    if (value === defaultValue) {
                        option.setAttribute('selected', 'selected');
                    } else {
                        option.setAttribute('value', value);
                    }
                    select.appendChild(option);
                });
            }

            exports.BaseTooltip = BaseTooltip;
            exports.default = BaseTheme;

            /***/ }),
        /* 44 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            Object.defineProperty(exports, "__esModule", { value: true });
            var LinkedList = /** @class */ (function () {
                function LinkedList() {
                    this.head = this.tail = null;
                    this.length = 0;
                }
                LinkedList.prototype.append = function () {
                    var nodes = [];
                    for (var _i = 0; _i < arguments.length; _i++) {
                        nodes[_i] = arguments[_i];
                    }
                    this.insertBefore(nodes[0], null);
                    if (nodes.length > 1) {
                        this.append.apply(this, nodes.slice(1));
                    }
                };
                LinkedList.prototype.contains = function (node) {
                    var cur, next = this.iterator();
                    while ((cur = next())) {
                        if (cur === node)
                            return true;
                    }
                    return false;
                };
                LinkedList.prototype.insertBefore = function (node, refNode) {
                    if (!node)
                        return;
                    node.next = refNode;
                    if (refNode != null) {
                        node.prev = refNode.prev;
                        if (refNode.prev != null) {
                            refNode.prev.next = node;
                        }
                        refNode.prev = node;
                        if (refNode === this.head) {
                            this.head = node;
                        }
                    }
                    else if (this.tail != null) {
                        this.tail.next = node;
                        node.prev = this.tail;
                        this.tail = node;
                    }
                    else {
                        node.prev = null;
                        this.head = this.tail = node;
                    }
                    this.length += 1;
                };
                LinkedList.prototype.offset = function (target) {
                    var index = 0, cur = this.head;
                    while (cur != null) {
                        if (cur === target)
                            return index;
                        index += cur.length();
                        cur = cur.next;
                    }
                    return -1;
                };
                LinkedList.prototype.remove = function (node) {
                    if (!this.contains(node))
                        return;
                    if (node.prev != null)
                        node.prev.next = node.next;
                    if (node.next != null)
                        node.next.prev = node.prev;
                    if (node === this.head)
                        this.head = node.next;
                    if (node === this.tail)
                        this.tail = node.prev;
                    this.length -= 1;
                };
                LinkedList.prototype.iterator = function (curNode) {
                    if (curNode === void 0) { curNode = this.head; }
                    // TODO use yield when we can
                    return function () {
                        var ret = curNode;
                        if (curNode != null)
                            curNode = curNode.next;
                        return ret;
                    };
                };
                LinkedList.prototype.find = function (index, inclusive) {
                    if (inclusive === void 0) { inclusive = false; }
                    var cur, next = this.iterator();
                    while ((cur = next())) {
                        var length = cur.length();
                        if (index < length ||
                            (inclusive && index === length && (cur.next == null || cur.next.length() !== 0))) {
                            return [cur, index];
                        }
                        index -= length;
                    }
                    return [null, 0];
                };
                LinkedList.prototype.forEach = function (callback) {
                    var cur, next = this.iterator();
                    while ((cur = next())) {
                        callback(cur);
                    }
                };
                LinkedList.prototype.forEachAt = function (index, length, callback) {
                    if (length <= 0)
                        return;
                    var _a = this.find(index), startNode = _a[0], offset = _a[1];
                    var cur, curIndex = index - offset, next = this.iterator(startNode);
                    while ((cur = next()) && curIndex < index + length) {
                        var curLength = cur.length();
                        if (index > curIndex) {
                            callback(cur, index - curIndex, Math.min(length, curIndex + curLength - index));
                        }
                        else {
                            callback(cur, 0, Math.min(curLength, index + length - curIndex));
                        }
                        curIndex += curLength;
                    }
                };
                LinkedList.prototype.map = function (callback) {
                    return this.reduce(function (memo, cur) {
                        memo.push(callback(cur));
                        return memo;
                    }, []);
                };
                LinkedList.prototype.reduce = function (callback, memo) {
                    var cur, next = this.iterator();
                    while ((cur = next())) {
                        memo = callback(memo, cur);
                    }
                    return memo;
                };
                return LinkedList;
            }());
            exports.default = LinkedList;


            /***/ }),
        /* 45 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            var __extends = (this && this.__extends) || (function () {
                var extendStatics = Object.setPrototypeOf ||
                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
                return function (d, b) {
                    extendStatics(d, b);
                    function __() { this.constructor = d; }
                    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
                };
            })();
            Object.defineProperty(exports, "__esModule", { value: true });
            var container_1 = __webpack_require__(17);
            var Registry = __webpack_require__(1);
            var OBSERVER_CONFIG = {
                attributes: true,
                characterData: true,
                characterDataOldValue: true,
                childList: true,
                subtree: true,
            };
            var MAX_OPTIMIZE_ITERATIONS = 100;
            var ScrollBlot = /** @class */ (function (_super) {
                __extends(ScrollBlot, _super);
                function ScrollBlot(node) {
                    var _this = _super.call(this, node) || this;
                    _this.scroll = _this;
                    _this.observer = new MutationObserver(function (mutations) {
                        _this.update(mutations);
                    });
                    _this.observer.observe(_this.domNode, OBSERVER_CONFIG);
                    _this.attach();
                    return _this;
                }
                ScrollBlot.prototype.detach = function () {
                    _super.prototype.detach.call(this);
                    this.observer.disconnect();
                };
                ScrollBlot.prototype.deleteAt = function (index, length) {
                    this.update();
                    if (index === 0 && length === this.length()) {
                        this.children.forEach(function (child) {
                            child.remove();
                        });
                    }
                    else {
                        _super.prototype.deleteAt.call(this, index, length);
                    }
                };
                ScrollBlot.prototype.formatAt = function (index, length, name, value) {
                    this.update();
                    _super.prototype.formatAt.call(this, index, length, name, value);
                };
                ScrollBlot.prototype.insertAt = function (index, value, def) {
                    this.update();
                    _super.prototype.insertAt.call(this, index, value, def);
                };
                ScrollBlot.prototype.optimize = function (mutations, context) {
                    var _this = this;
                    if (mutations === void 0) { mutations = []; }
                    if (context === void 0) { context = {}; }
                    _super.prototype.optimize.call(this, context);
                    // We must modify mutations directly, cannot make copy and then modify
                    var records = [].slice.call(this.observer.takeRecords());
                    // Array.push currently seems to be implemented by a non-tail recursive function
                    // so we cannot just mutations.push.apply(mutations, this.observer.takeRecords());
                    while (records.length > 0)
                        mutations.push(records.pop());
                    // TODO use WeakMap
                    var mark = function (blot, markParent) {
                        if (markParent === void 0) { markParent = true; }
                        if (blot == null || blot === _this)
                            return;
                        if (blot.domNode.parentNode == null)
                            return;
                        // @ts-ignore
                        if (blot.domNode[Registry.DATA_KEY].mutations == null) {
                            // @ts-ignore
                            blot.domNode[Registry.DATA_KEY].mutations = [];
                        }
                        if (markParent)
                            mark(blot.parent);
                    };
                    var optimize = function (blot) {
                        // Post-order traversal
                        if (
                            // @ts-ignore
                        blot.domNode[Registry.DATA_KEY] == null ||
                        // @ts-ignore
                        blot.domNode[Registry.DATA_KEY].mutations == null) {
                            return;
                        }
                        if (blot instanceof container_1.default) {
                            blot.children.forEach(optimize);
                        }
                        blot.optimize(context);
                    };
                    var remaining = mutations;
                    for (var i = 0; remaining.length > 0; i += 1) {
                        if (i >= MAX_OPTIMIZE_ITERATIONS) {
                            throw new Error('[Parchment] Maximum optimize iterations reached');
                        }
                        remaining.forEach(function (mutation) {
                            var blot = Registry.find(mutation.target, true);
                            if (blot == null)
                                return;
                            if (blot.domNode === mutation.target) {
                                if (mutation.type === 'childList') {
                                    mark(Registry.find(mutation.previousSibling, false));
                                    [].forEach.call(mutation.addedNodes, function (node) {
                                        var child = Registry.find(node, false);
                                        mark(child, false);
                                        if (child instanceof container_1.default) {
                                            child.children.forEach(function (grandChild) {
                                                mark(grandChild, false);
                                            });
                                        }
                                    });
                                }
                                else if (mutation.type === 'attributes') {
                                    mark(blot.prev);
                                }
                            }
                            mark(blot);
                        });
                        this.children.forEach(optimize);
                        remaining = [].slice.call(this.observer.takeRecords());
                        records = remaining.slice();
                        while (records.length > 0)
                            mutations.push(records.pop());
                    }
                };
                ScrollBlot.prototype.update = function (mutations, context) {
                    var _this = this;
                    if (context === void 0) { context = {}; }
                    mutations = mutations || this.observer.takeRecords();
                    // TODO use WeakMap
                    mutations
                        .map(function (mutation) {
                            var blot = Registry.find(mutation.target, true);
                            if (blot == null)
                                return null;
                            // @ts-ignore
                            if (blot.domNode[Registry.DATA_KEY].mutations == null) {
                                // @ts-ignore
                                blot.domNode[Registry.DATA_KEY].mutations = [mutation];
                                return blot;
                            }
                            else {
                                // @ts-ignore
                                blot.domNode[Registry.DATA_KEY].mutations.push(mutation);
                                return null;
                            }
                        })
                        .forEach(function (blot) {
                            if (blot == null ||
                                blot === _this ||
                                //@ts-ignore
                                blot.domNode[Registry.DATA_KEY] == null)
                                return;
                            // @ts-ignore
                            blot.update(blot.domNode[Registry.DATA_KEY].mutations || [], context);
                        });
                    // @ts-ignore
                    if (this.domNode[Registry.DATA_KEY].mutations != null) {
                        // @ts-ignore
                        _super.prototype.update.call(this, this.domNode[Registry.DATA_KEY].mutations, context);
                    }
                    this.optimize(mutations, context);
                };
                ScrollBlot.blotName = 'scroll';
                ScrollBlot.defaultChild = 'block';
                ScrollBlot.scope = Registry.Scope.BLOCK_BLOT;
                ScrollBlot.tagName = 'DIV';
                return ScrollBlot;
            }(container_1.default));
            exports.default = ScrollBlot;


            /***/ }),
        /* 46 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            var __extends = (this && this.__extends) || (function () {
                var extendStatics = Object.setPrototypeOf ||
                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
                return function (d, b) {
                    extendStatics(d, b);
                    function __() { this.constructor = d; }
                    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
                };
            })();
            Object.defineProperty(exports, "__esModule", { value: true });
            var format_1 = __webpack_require__(18);
            var Registry = __webpack_require__(1);
// Shallow object comparison
            function isEqual(obj1, obj2) {
                if (Object.keys(obj1).length !== Object.keys(obj2).length)
                    return false;
                // @ts-ignore
                for (var prop in obj1) {
                    // @ts-ignore
                    if (obj1[prop] !== obj2[prop])
                        return false;
                }
                return true;
            }
            var InlineBlot = /** @class */ (function (_super) {
                __extends(InlineBlot, _super);
                function InlineBlot() {
                    return _super !== null && _super.apply(this, arguments) || this;
                }
                InlineBlot.formats = function (domNode) {
                    if (domNode.tagName === InlineBlot.tagName)
                        return undefined;
                    return _super.formats.call(this, domNode);
                };
                InlineBlot.prototype.format = function (name, value) {
                    var _this = this;
                    if (name === this.statics.blotName && !value) {
                        this.children.forEach(function (child) {
                            if (!(child instanceof format_1.default)) {
                                child = child.wrap(InlineBlot.blotName, true);
                            }
                            _this.attributes.copy(child);
                        });
                        this.unwrap();
                    }
                    else {
                        _super.prototype.format.call(this, name, value);
                    }
                };
                InlineBlot.prototype.formatAt = function (index, length, name, value) {
                    if (this.formats()[name] != null || Registry.query(name, Registry.Scope.ATTRIBUTE)) {
                        var blot = this.isolate(index, length);
                        blot.format(name, value);
                    }
                    else {
                        _super.prototype.formatAt.call(this, index, length, name, value);
                    }
                };
                InlineBlot.prototype.optimize = function (context) {
                    _super.prototype.optimize.call(this, context);
                    var formats = this.formats();
                    if (Object.keys(formats).length === 0) {
                        return this.unwrap(); // unformatted span
                    }
                    var next = this.next;
                    if (next instanceof InlineBlot && next.prev === this && isEqual(formats, next.formats())) {
                        next.moveChildren(this);
                        next.remove();
                    }
                };
                InlineBlot.blotName = 'inline';
                InlineBlot.scope = Registry.Scope.INLINE_BLOT;
                InlineBlot.tagName = 'SPAN';
                return InlineBlot;
            }(format_1.default));
            exports.default = InlineBlot;


            /***/ }),
        /* 47 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            var __extends = (this && this.__extends) || (function () {
                var extendStatics = Object.setPrototypeOf ||
                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
                return function (d, b) {
                    extendStatics(d, b);
                    function __() { this.constructor = d; }
                    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
                };
            })();
            Object.defineProperty(exports, "__esModule", { value: true });
            var format_1 = __webpack_require__(18);
            var Registry = __webpack_require__(1);
            var BlockBlot = /** @class */ (function (_super) {
                __extends(BlockBlot, _super);
                function BlockBlot() {
                    return _super !== null && _super.apply(this, arguments) || this;
                }
                BlockBlot.formats = function (domNode) {
                    var tagName = Registry.query(BlockBlot.blotName).tagName;
                    if (domNode.tagName === tagName)
                        return undefined;
                    return _super.formats.call(this, domNode);
                };
                BlockBlot.prototype.format = function (name, value) {
                    if (Registry.query(name, Registry.Scope.BLOCK) == null) {
                        return;
                    }
                    else if (name === this.statics.blotName && !value) {
                        this.replaceWith(BlockBlot.blotName);
                    }
                    else {
                        _super.prototype.format.call(this, name, value);
                    }
                };
                BlockBlot.prototype.formatAt = function (index, length, name, value) {
                    if (Registry.query(name, Registry.Scope.BLOCK) != null) {
                        this.format(name, value);
                    }
                    else {
                        _super.prototype.formatAt.call(this, index, length, name, value);
                    }
                };
                BlockBlot.prototype.insertAt = function (index, value, def) {
                    if (def == null || Registry.query(value, Registry.Scope.INLINE) != null) {
                        // Insert text or inline
                        _super.prototype.insertAt.call(this, index, value, def);
                    }
                    else {
                        var after = this.split(index);
                        var blot = Registry.create(value, def);
                        after.parent.insertBefore(blot, after);
                    }
                };
                BlockBlot.prototype.update = function (mutations, context) {
                    if (navigator.userAgent.match(/Trident/)) {
                        this.build();
                    }
                    else {
                        _super.prototype.update.call(this, mutations, context);
                    }
                };
                BlockBlot.blotName = 'block';
                BlockBlot.scope = Registry.Scope.BLOCK_BLOT;
                BlockBlot.tagName = 'P';
                return BlockBlot;
            }(format_1.default));
            exports.default = BlockBlot;


            /***/ }),
        /* 48 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            var __extends = (this && this.__extends) || (function () {
                var extendStatics = Object.setPrototypeOf ||
                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
                return function (d, b) {
                    extendStatics(d, b);
                    function __() { this.constructor = d; }
                    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
                };
            })();
            Object.defineProperty(exports, "__esModule", { value: true });
            var leaf_1 = __webpack_require__(19);
            var EmbedBlot = /** @class */ (function (_super) {
                __extends(EmbedBlot, _super);
                function EmbedBlot() {
                    return _super !== null && _super.apply(this, arguments) || this;
                }
                EmbedBlot.formats = function (domNode) {
                    return undefined;
                };
                EmbedBlot.prototype.format = function (name, value) {
                    // super.formatAt wraps, which is what we want in general,
                    // but this allows subclasses to overwrite for formats
                    // that just apply to particular embeds
                    _super.prototype.formatAt.call(this, 0, this.length(), name, value);
                };
                EmbedBlot.prototype.formatAt = function (index, length, name, value) {
                    if (index === 0 && length === this.length()) {
                        this.format(name, value);
                    }
                    else {
                        _super.prototype.formatAt.call(this, index, length, name, value);
                    }
                };
                EmbedBlot.prototype.formats = function () {
                    return this.statics.formats(this.domNode);
                };
                return EmbedBlot;
            }(leaf_1.default));
            exports.default = EmbedBlot;


            /***/ }),
        /* 49 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";

            var __extends = (this && this.__extends) || (function () {
                var extendStatics = Object.setPrototypeOf ||
                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
                return function (d, b) {
                    extendStatics(d, b);
                    function __() { this.constructor = d; }
                    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
                };
            })();
            Object.defineProperty(exports, "__esModule", { value: true });
            var leaf_1 = __webpack_require__(19);
            var Registry = __webpack_require__(1);
            var TextBlot = /** @class */ (function (_super) {
                __extends(TextBlot, _super);
                function TextBlot(node) {
                    var _this = _super.call(this, node) || this;
                    _this.text = _this.statics.value(_this.domNode);
                    return _this;
                }
                TextBlot.create = function (value) {
                    return document.createTextNode(value);
                };
                TextBlot.value = function (domNode) {
                    var text = domNode.data;
                    // @ts-ignore
                    if (text['normalize'])
                        text = text['normalize']();
                    return text;
                };
                TextBlot.prototype.deleteAt = function (index, length) {
                    this.domNode.data = this.text = this.text.slice(0, index) + this.text.slice(index + length);
                };
                TextBlot.prototype.index = function (node, offset) {
                    if (this.domNode === node) {
                        return offset;
                    }
                    return -1;
                };
                TextBlot.prototype.insertAt = function (index, value, def) {
                    if (def == null) {
                        this.text = this.text.slice(0, index) + value + this.text.slice(index);
                        this.domNode.data = this.text;
                    }
                    else {
                        _super.prototype.insertAt.call(this, index, value, def);
                    }
                };
                TextBlot.prototype.length = function () {
                    return this.text.length;
                };
                TextBlot.prototype.optimize = function (context) {
                    _super.prototype.optimize.call(this, context);
                    this.text = this.statics.value(this.domNode);
                    if (this.text.length === 0) {
                        this.remove();
                    }
                    else if (this.next instanceof TextBlot && this.next.prev === this) {
                        this.insertAt(this.length(), this.next.value());
                        this.next.remove();
                    }
                };
                TextBlot.prototype.position = function (index, inclusive) {
                    if (inclusive === void 0) { inclusive = false; }
                    return [this.domNode, index];
                };
                TextBlot.prototype.split = function (index, force) {
                    if (force === void 0) { force = false; }
                    if (!force) {
                        if (index === 0)
                            return this;
                        if (index === this.length())
                            return this.next;
                    }
                    var after = Registry.create(this.domNode.splitText(index));
                    this.parent.insertBefore(after, this.next);
                    this.text = this.statics.value(this.domNode);
                    return after;
                };
                TextBlot.prototype.update = function (mutations, context) {
                    var _this = this;
                    if (mutations.some(function (mutation) {
                            return mutation.type === 'characterData' && mutation.target === _this.domNode;
                        })) {
                        this.text = this.statics.value(this.domNode);
                    }
                };
                TextBlot.prototype.value = function () {
                    return this.text;
                };
                TextBlot.blotName = 'text';
                TextBlot.scope = Registry.Scope.INLINE_BLOT;
                return TextBlot;
            }(leaf_1.default));
            exports.default = TextBlot;


            /***/ }),
        /* 50 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            var elem = document.createElement('div');
            elem.classList.toggle('test-class', false);
            if (elem.classList.contains('test-class')) {
                var _toggle = DOMTokenList.prototype.toggle;
                DOMTokenList.prototype.toggle = function (token, force) {
                    if (arguments.length > 1 && !this.contains(token) === !force) {
                        return force;
                    } else {
                        return _toggle.call(this, token);
                    }
                };
            }

            if (!String.prototype.startsWith) {
                String.prototype.startsWith = function (searchString, position) {
                    position = position || 0;
                    return this.substr(position, searchString.length) === searchString;
                };
            }

            if (!String.prototype.endsWith) {
                String.prototype.endsWith = function (searchString, position) {
                    var subjectString = this.toString();
                    if (typeof position !== 'number' || !isFinite(position) || Math.floor(position) !== position || position > subjectString.length) {
                        position = subjectString.length;
                    }
                    position -= searchString.length;
                    var lastIndex = subjectString.indexOf(searchString, position);
                    return lastIndex !== -1 && lastIndex === position;
                };
            }

            if (!Array.prototype.find) {
                Object.defineProperty(Array.prototype, "find", {
                    value: function value(predicate) {
                        if (this === null) {
                            throw new TypeError('Array.prototype.find called on null or undefined');
                        }
                        if (typeof predicate !== 'function') {
                            throw new TypeError('predicate must be a function');
                        }
                        var list = Object(this);
                        var length = list.length >>> 0;
                        var thisArg = arguments[1];
                        var value;

                        for (var i = 0; i < length; i++) {
                            value = list[i];
                            if (predicate.call(thisArg, value, i, list)) {
                                return value;
                            }
                        }
                        return undefined;
                    }
                });
            }

            document.addEventListener("DOMContentLoaded", function () {
                // Disable resizing in Firefox
                document.execCommand("enableObjectResizing", false, false);
                // Disable automatic linkifying in IE11
                document.execCommand("autoUrlDetect", false, false);
            });

            /***/ }),
        /* 51 */
        /***/ (function(module, exports) {

            /**
             * This library modifies the diff-patch-match library by Neil Fraser
             * by removing the patch and match functionality and certain advanced
             * options in the diff function. The original license is as follows:
             *
             * ===
             *
             * Diff Match and Patch
             *
             * Copyright 2006 Google Inc.
             * http://code.google.com/p/google-diff-match-patch/
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *   http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */


            /**
             * The data structure representing a diff is an array of tuples:
             * [[DIFF_DELETE, 'Hello'], [DIFF_INSERT, 'Goodbye'], [DIFF_EQUAL, ' world.']]
             * which means: delete 'Hello', add 'Goodbye' and keep ' world.'
             */
            var DIFF_DELETE = -1;
            var DIFF_INSERT = 1;
            var DIFF_EQUAL = 0;


            /**
             * Find the differences between two texts.  Simplifies the problem by stripping
             * any common prefix or suffix off the texts before diffing.
             * @param {string} text1 Old string to be diffed.
             * @param {string} text2 New string to be diffed.
             * @param {Int} cursor_pos Expected edit position in text1 (optional)
             * @return {Array} Array of diff tuples.
             */
            function diff_main(text1, text2, cursor_pos) {
                // Check for equality (speedup).
                if (text1 == text2) {
                    if (text1) {
                        return [[DIFF_EQUAL, text1]];
                    }
                    return [];
                }

                // Check cursor_pos within bounds
                if (cursor_pos < 0 || text1.length < cursor_pos) {
                    cursor_pos = null;
                }

                // Trim off common prefix (speedup).
                var commonlength = diff_commonPrefix(text1, text2);
                var commonprefix = text1.substring(0, commonlength);
                text1 = text1.substring(commonlength);
                text2 = text2.substring(commonlength);

                // Trim off common suffix (speedup).
                commonlength = diff_commonSuffix(text1, text2);
                var commonsuffix = text1.substring(text1.length - commonlength);
                text1 = text1.substring(0, text1.length - commonlength);
                text2 = text2.substring(0, text2.length - commonlength);

                // Compute the diff on the middle block.
                var diffs = diff_compute_(text1, text2);

                // Restore the prefix and suffix.
                if (commonprefix) {
                    diffs.unshift([DIFF_EQUAL, commonprefix]);
                }
                if (commonsuffix) {
                    diffs.push([DIFF_EQUAL, commonsuffix]);
                }
                diff_cleanupMerge(diffs);
                if (cursor_pos != null) {
                    diffs = fix_cursor(diffs, cursor_pos);
                }
                diffs = fix_emoji(diffs);
                return diffs;
            };


            /**
             * Find the differences between two texts.  Assumes that the texts do not
             * have any common prefix or suffix.
             * @param {string} text1 Old string to be diffed.
             * @param {string} text2 New string to be diffed.
             * @return {Array} Array of diff tuples.
             */
            function diff_compute_(text1, text2) {
                var diffs;

                if (!text1) {
                    // Just add some text (speedup).
                    return [[DIFF_INSERT, text2]];
                }

                if (!text2) {
                    // Just delete some text (speedup).
                    return [[DIFF_DELETE, text1]];
                }

                var longtext = text1.length > text2.length ? text1 : text2;
                var shorttext = text1.length > text2.length ? text2 : text1;
                var i = longtext.indexOf(shorttext);
                if (i != -1) {
                    // Shorter text is inside the longer text (speedup).
                    diffs = [[DIFF_INSERT, longtext.substring(0, i)],
                        [DIFF_EQUAL, shorttext],
                        [DIFF_INSERT, longtext.substring(i + shorttext.length)]];
                    // Swap insertions for deletions if diff is reversed.
                    if (text1.length > text2.length) {
                        diffs[0][0] = diffs[2][0] = DIFF_DELETE;
                    }
                    return diffs;
                }

                if (shorttext.length == 1) {
                    // Single character string.
                    // After the previous speedup, the character can't be an equality.
                    return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];
                }

                // Check to see if the problem can be split in two.
                var hm = diff_halfMatch_(text1, text2);
                if (hm) {
                    // A half-match was found, sort out the return data.
                    var text1_a = hm[0];
                    var text1_b = hm[1];
                    var text2_a = hm[2];
                    var text2_b = hm[3];
                    var mid_common = hm[4];
                    // Send both pairs off for separate processing.
                    var diffs_a = diff_main(text1_a, text2_a);
                    var diffs_b = diff_main(text1_b, text2_b);
                    // Merge the results.
                    return diffs_a.concat([[DIFF_EQUAL, mid_common]], diffs_b);
                }

                return diff_bisect_(text1, text2);
            };


            /**
             * Find the 'middle snake' of a diff, split the problem in two
             * and return the recursively constructed diff.
             * See Myers 1986 paper: An O(ND) Difference Algorithm and Its Variations.
             * @param {string} text1 Old string to be diffed.
             * @param {string} text2 New string to be diffed.
             * @return {Array} Array of diff tuples.
             * @private
             */
            function diff_bisect_(text1, text2) {
                // Cache the text lengths to prevent multiple calls.
                var text1_length = text1.length;
                var text2_length = text2.length;
                var max_d = Math.ceil((text1_length + text2_length) / 2);
                var v_offset = max_d;
                var v_length = 2 * max_d;
                var v1 = new Array(v_length);
                var v2 = new Array(v_length);
                // Setting all elements to -1 is faster in Chrome & Firefox than mixing
                // integers and undefined.
                for (var x = 0; x < v_length; x++) {
                    v1[x] = -1;
                    v2[x] = -1;
                }
                v1[v_offset + 1] = 0;
                v2[v_offset + 1] = 0;
                var delta = text1_length - text2_length;
                // If the total number of characters is odd, then the front path will collide
                // with the reverse path.
                var front = (delta % 2 != 0);
                // Offsets for start and end of k loop.
                // Prevents mapping of space beyond the grid.
                var k1start = 0;
                var k1end = 0;
                var k2start = 0;
                var k2end = 0;
                for (var d = 0; d < max_d; d++) {
                    // Walk the front path one step.
                    for (var k1 = -d + k1start; k1 <= d - k1end; k1 += 2) {
                        var k1_offset = v_offset + k1;
                        var x1;
                        if (k1 == -d || (k1 != d && v1[k1_offset - 1] < v1[k1_offset + 1])) {
                            x1 = v1[k1_offset + 1];
                        } else {
                            x1 = v1[k1_offset - 1] + 1;
                        }
                        var y1 = x1 - k1;
                        while (x1 < text1_length && y1 < text2_length &&
                        text1.charAt(x1) == text2.charAt(y1)) {
                            x1++;
                            y1++;
                        }
                        v1[k1_offset] = x1;
                        if (x1 > text1_length) {
                            // Ran off the right of the graph.
                            k1end += 2;
                        } else if (y1 > text2_length) {
                            // Ran off the bottom of the graph.
                            k1start += 2;
                        } else if (front) {
                            var k2_offset = v_offset + delta - k1;
                            if (k2_offset >= 0 && k2_offset < v_length && v2[k2_offset] != -1) {
                                // Mirror x2 onto top-left coordinate system.
                                var x2 = text1_length - v2[k2_offset];
                                if (x1 >= x2) {
                                    // Overlap detected.
                                    return diff_bisectSplit_(text1, text2, x1, y1);
                                }
                            }
                        }
                    }

                    // Walk the reverse path one step.
                    for (var k2 = -d + k2start; k2 <= d - k2end; k2 += 2) {
                        var k2_offset = v_offset + k2;
                        var x2;
                        if (k2 == -d || (k2 != d && v2[k2_offset - 1] < v2[k2_offset + 1])) {
                            x2 = v2[k2_offset + 1];
                        } else {
                            x2 = v2[k2_offset - 1] + 1;
                        }
                        var y2 = x2 - k2;
                        while (x2 < text1_length && y2 < text2_length &&
                        text1.charAt(text1_length - x2 - 1) ==
                        text2.charAt(text2_length - y2 - 1)) {
                            x2++;
                            y2++;
                        }
                        v2[k2_offset] = x2;
                        if (x2 > text1_length) {
                            // Ran off the left of the graph.
                            k2end += 2;
                        } else if (y2 > text2_length) {
                            // Ran off the top of the graph.
                            k2start += 2;
                        } else if (!front) {
                            var k1_offset = v_offset + delta - k2;
                            if (k1_offset >= 0 && k1_offset < v_length && v1[k1_offset] != -1) {
                                var x1 = v1[k1_offset];
                                var y1 = v_offset + x1 - k1_offset;
                                // Mirror x2 onto top-left coordinate system.
                                x2 = text1_length - x2;
                                if (x1 >= x2) {
                                    // Overlap detected.
                                    return diff_bisectSplit_(text1, text2, x1, y1);
                                }
                            }
                        }
                    }
                }
                // Diff took too long and hit the deadline or
                // number of diffs equals number of characters, no commonality at all.
                return [[DIFF_DELETE, text1], [DIFF_INSERT, text2]];
            };


            /**
             * Given the location of the 'middle snake', split the diff in two parts
             * and recurse.
             * @param {string} text1 Old string to be diffed.
             * @param {string} text2 New string to be diffed.
             * @param {number} x Index of split point in text1.
             * @param {number} y Index of split point in text2.
             * @return {Array} Array of diff tuples.
             */
            function diff_bisectSplit_(text1, text2, x, y) {
                var text1a = text1.substring(0, x);
                var text2a = text2.substring(0, y);
                var text1b = text1.substring(x);
                var text2b = text2.substring(y);

                // Compute both diffs serially.
                var diffs = diff_main(text1a, text2a);
                var diffsb = diff_main(text1b, text2b);

                return diffs.concat(diffsb);
            };


            /**
             * Determine the common prefix of two strings.
             * @param {string} text1 First string.
             * @param {string} text2 Second string.
             * @return {number} The number of characters common to the start of each
             *     string.
             */
            function diff_commonPrefix(text1, text2) {
                // Quick check for common null cases.
                if (!text1 || !text2 || text1.charAt(0) != text2.charAt(0)) {
                    return 0;
                }
                // Binary search.
                // Performance analysis: http://neil.fraser.name/news/2007/10/09/
                var pointermin = 0;
                var pointermax = Math.min(text1.length, text2.length);
                var pointermid = pointermax;
                var pointerstart = 0;
                while (pointermin < pointermid) {
                    if (text1.substring(pointerstart, pointermid) ==
                        text2.substring(pointerstart, pointermid)) {
                        pointermin = pointermid;
                        pointerstart = pointermin;
                    } else {
                        pointermax = pointermid;
                    }
                    pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);
                }
                return pointermid;
            };


            /**
             * Determine the common suffix of two strings.
             * @param {string} text1 First string.
             * @param {string} text2 Second string.
             * @return {number} The number of characters common to the end of each string.
             */
            function diff_commonSuffix(text1, text2) {
                // Quick check for common null cases.
                if (!text1 || !text2 ||
                    text1.charAt(text1.length - 1) != text2.charAt(text2.length - 1)) {
                    return 0;
                }
                // Binary search.
                // Performance analysis: http://neil.fraser.name/news/2007/10/09/
                var pointermin = 0;
                var pointermax = Math.min(text1.length, text2.length);
                var pointermid = pointermax;
                var pointerend = 0;
                while (pointermin < pointermid) {
                    if (text1.substring(text1.length - pointermid, text1.length - pointerend) ==
                        text2.substring(text2.length - pointermid, text2.length - pointerend)) {
                        pointermin = pointermid;
                        pointerend = pointermin;
                    } else {
                        pointermax = pointermid;
                    }
                    pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);
                }
                return pointermid;
            };


            /**
             * Do the two texts share a substring which is at least half the length of the
             * longer text?
             * This speedup can produce non-minimal diffs.
             * @param {string} text1 First string.
             * @param {string} text2 Second string.
             * @return {Array.<string>} Five element Array, containing the prefix of
             *     text1, the suffix of text1, the prefix of text2, the suffix of
             *     text2 and the common middle.  Or null if there was no match.
             */
            function diff_halfMatch_(text1, text2) {
                var longtext = text1.length > text2.length ? text1 : text2;
                var shorttext = text1.length > text2.length ? text2 : text1;
                if (longtext.length < 4 || shorttext.length * 2 < longtext.length) {
                    return null;  // Pointless.
                }

                /**
                 * Does a substring of shorttext exist within longtext such that the substring
                 * is at least half the length of longtext?
                 * Closure, but does not reference any external variables.
                 * @param {string} longtext Longer string.
                 * @param {string} shorttext Shorter string.
                 * @param {number} i Start index of quarter length substring within longtext.
                 * @return {Array.<string>} Five element Array, containing the prefix of
                 *     longtext, the suffix of longtext, the prefix of shorttext, the suffix
                 *     of shorttext and the common middle.  Or null if there was no match.
                 * @private
                 */
                function diff_halfMatchI_(longtext, shorttext, i) {
                    // Start with a 1/4 length substring at position i as a seed.
                    var seed = longtext.substring(i, i + Math.floor(longtext.length / 4));
                    var j = -1;
                    var best_common = '';
                    var best_longtext_a, best_longtext_b, best_shorttext_a, best_shorttext_b;
                    while ((j = shorttext.indexOf(seed, j + 1)) != -1) {
                        var prefixLength = diff_commonPrefix(longtext.substring(i),
                            shorttext.substring(j));
                        var suffixLength = diff_commonSuffix(longtext.substring(0, i),
                            shorttext.substring(0, j));
                        if (best_common.length < suffixLength + prefixLength) {
                            best_common = shorttext.substring(j - suffixLength, j) +
                                shorttext.substring(j, j + prefixLength);
                            best_longtext_a = longtext.substring(0, i - suffixLength);
                            best_longtext_b = longtext.substring(i + prefixLength);
                            best_shorttext_a = shorttext.substring(0, j - suffixLength);
                            best_shorttext_b = shorttext.substring(j + prefixLength);
                        }
                    }
                    if (best_common.length * 2 >= longtext.length) {
                        return [best_longtext_a, best_longtext_b,
                            best_shorttext_a, best_shorttext_b, best_common];
                    } else {
                        return null;
                    }
                }

                // First check if the second quarter is the seed for a half-match.
                var hm1 = diff_halfMatchI_(longtext, shorttext,
                    Math.ceil(longtext.length / 4));
                // Check again based on the third quarter.
                var hm2 = diff_halfMatchI_(longtext, shorttext,
                    Math.ceil(longtext.length / 2));
                var hm;
                if (!hm1 && !hm2) {
                    return null;
                } else if (!hm2) {
                    hm = hm1;
                } else if (!hm1) {
                    hm = hm2;
                } else {
                    // Both matched.  Select the longest.
                    hm = hm1[4].length > hm2[4].length ? hm1 : hm2;
                }

                // A half-match was found, sort out the return data.
                var text1_a, text1_b, text2_a, text2_b;
                if (text1.length > text2.length) {
                    text1_a = hm[0];
                    text1_b = hm[1];
                    text2_a = hm[2];
                    text2_b = hm[3];
                } else {
                    text2_a = hm[0];
                    text2_b = hm[1];
                    text1_a = hm[2];
                    text1_b = hm[3];
                }
                var mid_common = hm[4];
                return [text1_a, text1_b, text2_a, text2_b, mid_common];
            };


            /**
             * Reorder and merge like edit sections.  Merge equalities.
             * Any edit section can move as long as it doesn't cross an equality.
             * @param {Array} diffs Array of diff tuples.
             */
            function diff_cleanupMerge(diffs) {
                diffs.push([DIFF_EQUAL, '']);  // Add a dummy entry at the end.
                var pointer = 0;
                var count_delete = 0;
                var count_insert = 0;
                var text_delete = '';
                var text_insert = '';
                var commonlength;
                while (pointer < diffs.length) {
                    switch (diffs[pointer][0]) {
                        case DIFF_INSERT:
                            count_insert++;
                            text_insert += diffs[pointer][1];
                            pointer++;
                            break;
                        case DIFF_DELETE:
                            count_delete++;
                            text_delete += diffs[pointer][1];
                            pointer++;
                            break;
                        case DIFF_EQUAL:
                            // Upon reaching an equality, check for prior redundancies.
                            if (count_delete + count_insert > 1) {
                                if (count_delete !== 0 && count_insert !== 0) {
                                    // Factor out any common prefixies.
                                    commonlength = diff_commonPrefix(text_insert, text_delete);
                                    if (commonlength !== 0) {
                                        if ((pointer - count_delete - count_insert) > 0 &&
                                            diffs[pointer - count_delete - count_insert - 1][0] ==
                                            DIFF_EQUAL) {
                                            diffs[pointer - count_delete - count_insert - 1][1] +=
                                                text_insert.substring(0, commonlength);
                                        } else {
                                            diffs.splice(0, 0, [DIFF_EQUAL,
                                                text_insert.substring(0, commonlength)]);
                                            pointer++;
                                        }
                                        text_insert = text_insert.substring(commonlength);
                                        text_delete = text_delete.substring(commonlength);
                                    }
                                    // Factor out any common suffixies.
                                    commonlength = diff_commonSuffix(text_insert, text_delete);
                                    if (commonlength !== 0) {
                                        diffs[pointer][1] = text_insert.substring(text_insert.length -
                                            commonlength) + diffs[pointer][1];
                                        text_insert = text_insert.substring(0, text_insert.length -
                                            commonlength);
                                        text_delete = text_delete.substring(0, text_delete.length -
                                            commonlength);
                                    }
                                }
                                // Delete the offending records and add the merged ones.
                                if (count_delete === 0) {
                                    diffs.splice(pointer - count_insert,
                                        count_delete + count_insert, [DIFF_INSERT, text_insert]);
                                } else if (count_insert === 0) {
                                    diffs.splice(pointer - count_delete,
                                        count_delete + count_insert, [DIFF_DELETE, text_delete]);
                                } else {
                                    diffs.splice(pointer - count_delete - count_insert,
                                        count_delete + count_insert, [DIFF_DELETE, text_delete],
                                        [DIFF_INSERT, text_insert]);
                                }
                                pointer = pointer - count_delete - count_insert +
                                    (count_delete ? 1 : 0) + (count_insert ? 1 : 0) + 1;
                            } else if (pointer !== 0 && diffs[pointer - 1][0] == DIFF_EQUAL) {
                                // Merge this equality with the previous one.
                                diffs[pointer - 1][1] += diffs[pointer][1];
                                diffs.splice(pointer, 1);
                            } else {
                                pointer++;
                            }
                            count_insert = 0;
                            count_delete = 0;
                            text_delete = '';
                            text_insert = '';
                            break;
                    }
                }
                if (diffs[diffs.length - 1][1] === '') {
                    diffs.pop();  // Remove the dummy entry at the end.
                }

                // Second pass: look for single edits surrounded on both sides by equalities
                // which can be shifted sideways to eliminate an equality.
                // e.g: A<ins>BA</ins>C -> <ins>AB</ins>AC
                var changes = false;
                pointer = 1;
                // Intentionally ignore the first and last element (don't need checking).
                while (pointer < diffs.length - 1) {
                    if (diffs[pointer - 1][0] == DIFF_EQUAL &&
                        diffs[pointer + 1][0] == DIFF_EQUAL) {
                        // This is a single edit surrounded by equalities.
                        if (diffs[pointer][1].substring(diffs[pointer][1].length -
                                diffs[pointer - 1][1].length) == diffs[pointer - 1][1]) {
                            // Shift the edit over the previous equality.
                            diffs[pointer][1] = diffs[pointer - 1][1] +
                                diffs[pointer][1].substring(0, diffs[pointer][1].length -
                                    diffs[pointer - 1][1].length);
                            diffs[pointer + 1][1] = diffs[pointer - 1][1] + diffs[pointer + 1][1];
                            diffs.splice(pointer - 1, 1);
                            changes = true;
                        } else if (diffs[pointer][1].substring(0, diffs[pointer + 1][1].length) ==
                            diffs[pointer + 1][1]) {
                            // Shift the edit over the next equality.
                            diffs[pointer - 1][1] += diffs[pointer + 1][1];
                            diffs[pointer][1] =
                                diffs[pointer][1].substring(diffs[pointer + 1][1].length) +
                                diffs[pointer + 1][1];
                            diffs.splice(pointer + 1, 1);
                            changes = true;
                        }
                    }
                    pointer++;
                }
                // If shifts were made, the diff needs reordering and another shift sweep.
                if (changes) {
                    diff_cleanupMerge(diffs);
                }
            };


            var diff = diff_main;
            diff.INSERT = DIFF_INSERT;
            diff.DELETE = DIFF_DELETE;
            diff.EQUAL = DIFF_EQUAL;

            module.exports = diff;

            /*
 * Modify a diff such that the cursor position points to the start of a change:
 * E.g.
 *   cursor_normalize_diff([[DIFF_EQUAL, 'abc']], 1)
 *     => [1, [[DIFF_EQUAL, 'a'], [DIFF_EQUAL, 'bc']]]
 *   cursor_normalize_diff([[DIFF_INSERT, 'new'], [DIFF_DELETE, 'xyz']], 2)
 *     => [2, [[DIFF_INSERT, 'new'], [DIFF_DELETE, 'xy'], [DIFF_DELETE, 'z']]]
 *
 * @param {Array} diffs Array of diff tuples
 * @param {Int} cursor_pos Suggested edit position. Must not be out of bounds!
 * @return {Array} A tuple [cursor location in the modified diff, modified diff]
 */
            function cursor_normalize_diff (diffs, cursor_pos) {
                if (cursor_pos === 0) {
                    return [DIFF_EQUAL, diffs];
                }
                for (var current_pos = 0, i = 0; i < diffs.length; i++) {
                    var d = diffs[i];
                    if (d[0] === DIFF_DELETE || d[0] === DIFF_EQUAL) {
                        var next_pos = current_pos + d[1].length;
                        if (cursor_pos === next_pos) {
                            return [i + 1, diffs];
                        } else if (cursor_pos < next_pos) {
                            // copy to prevent side effects
                            diffs = diffs.slice();
                            // split d into two diff changes
                            var split_pos = cursor_pos - current_pos;
                            var d_left = [d[0], d[1].slice(0, split_pos)];
                            var d_right = [d[0], d[1].slice(split_pos)];
                            diffs.splice(i, 1, d_left, d_right);
                            return [i + 1, diffs];
                        } else {
                            current_pos = next_pos;
                        }
                    }
                }
                throw new Error('cursor_pos is out of bounds!')
            }

            /*
 * Modify a diff such that the edit position is "shifted" to the proposed edit location (cursor_position).
 *
 * Case 1)
 *   Check if a naive shift is possible:
 *     [0, X], [ 1, Y] -> [ 1, Y], [0, X]    (if X + Y === Y + X)
 *     [0, X], [-1, Y] -> [-1, Y], [0, X]    (if X + Y === Y + X) - holds same result
 * Case 2)
 *   Check if the following shifts are possible:
 *     [0, 'pre'], [ 1, 'prefix'] -> [ 1, 'pre'], [0, 'pre'], [ 1, 'fix']
 *     [0, 'pre'], [-1, 'prefix'] -> [-1, 'pre'], [0, 'pre'], [-1, 'fix']
 *         ^            ^
 *         d          d_next
 *
 * @param {Array} diffs Array of diff tuples
 * @param {Int} cursor_pos Suggested edit position. Must not be out of bounds!
 * @return {Array} Array of diff tuples
 */
            function fix_cursor (diffs, cursor_pos) {
                var norm = cursor_normalize_diff(diffs, cursor_pos);
                var ndiffs = norm[1];
                var cursor_pointer = norm[0];
                var d = ndiffs[cursor_pointer];
                var d_next = ndiffs[cursor_pointer + 1];

                if (d == null) {
                    // Text was deleted from end of original string,
                    // cursor is now out of bounds in new string
                    return diffs;
                } else if (d[0] !== DIFF_EQUAL) {
                    // A modification happened at the cursor location.
                    // This is the expected outcome, so we can return the original diff.
                    return diffs;
                } else {
                    if (d_next != null && d[1] + d_next[1] === d_next[1] + d[1]) {
                        // Case 1)
                        // It is possible to perform a naive shift
                        ndiffs.splice(cursor_pointer, 2, d_next, d)
                        return merge_tuples(ndiffs, cursor_pointer, 2)
                    } else if (d_next != null && d_next[1].indexOf(d[1]) === 0) {
                        // Case 2)
                        // d[1] is a prefix of d_next[1]
                        // We can assume that d_next[0] !== 0, since d[0] === 0
                        // Shift edit locations..
                        ndiffs.splice(cursor_pointer, 2, [d_next[0], d[1]], [0, d[1]]);
                        var suffix = d_next[1].slice(d[1].length);
                        if (suffix.length > 0) {
                            ndiffs.splice(cursor_pointer + 2, 0, [d_next[0], suffix]);
                        }
                        return merge_tuples(ndiffs, cursor_pointer, 3)
                    } else {
                        // Not possible to perform any modification
                        return diffs;
                    }
                }
            }

            /*
 * Check diff did not split surrogate pairs.
 * Ex. [0, '\uD83D'], [-1, '\uDC36'], [1, '\uDC2F'] -> [-1, '\uD83D\uDC36'], [1, '\uD83D\uDC2F']
 *     '\uD83D\uDC36' === 'ðŸ¶', '\uD83D\uDC2F' === 'ðŸ¯'
 *
 * @param {Array} diffs Array of diff tuples
 * @return {Array} Array of diff tuples
 */
            function fix_emoji (diffs) {
                var compact = false;
                var starts_with_pair_end = function(str) {
                    return str.charCodeAt(0) >= 0xDC00 && str.charCodeAt(0) <= 0xDFFF;
                }
                var ends_with_pair_start = function(str) {
                    return str.charCodeAt(str.length-1) >= 0xD800 && str.charCodeAt(str.length-1) <= 0xDBFF;
                }
                for (var i = 2; i < diffs.length; i += 1) {
                    if (diffs[i-2][0] === DIFF_EQUAL && ends_with_pair_start(diffs[i-2][1]) &&
                        diffs[i-1][0] === DIFF_DELETE && starts_with_pair_end(diffs[i-1][1]) &&
                        diffs[i][0] === DIFF_INSERT && starts_with_pair_end(diffs[i][1])) {
                        compact = true;

                        diffs[i-1][1] = diffs[i-2][1].slice(-1) + diffs[i-1][1];
                        diffs[i][1] = diffs[i-2][1].slice(-1) + diffs[i][1];

                        diffs[i-2][1] = diffs[i-2][1].slice(0, -1);
                    }
                }
                if (!compact) {
                    return diffs;
                }
                var fixed_diffs = [];
                for (var i = 0; i < diffs.length; i += 1) {
                    if (diffs[i][1].length > 0) {
                        fixed_diffs.push(diffs[i]);
                    }
                }
                return fixed_diffs;
            }

            /*
 * Try to merge tuples with their neigbors in a given range.
 * E.g. [0, 'a'], [0, 'b'] -> [0, 'ab']
 *
 * @param {Array} diffs Array of diff tuples.
 * @param {Int} start Position of the first element to merge (diffs[start] is also merged with diffs[start - 1]).
 * @param {Int} length Number of consecutive elements to check.
 * @return {Array} Array of merged diff tuples.
 */
            function merge_tuples (diffs, start, length) {
                // Check from (start-1) to (start+length).
                for (var i = start + length - 1; i >= 0 && i >= start - 1; i--) {
                    if (i + 1 < diffs.length) {
                        var left_d = diffs[i];
                        var right_d = diffs[i+1];
                        if (left_d[0] === right_d[1]) {
                            diffs.splice(i, 2, [left_d[0], left_d[1] + right_d[1]]);
                        }
                    }
                }
                return diffs;
            }


            /***/ }),
        /* 52 */
        /***/ (function(module, exports) {

            exports = module.exports = typeof Object.keys === 'function'
                ? Object.keys : shim;

            exports.shim = shim;
            function shim (obj) {
                var keys = [];
                for (var key in obj) keys.push(key);
                return keys;
            }


            /***/ }),
        /* 53 */
        /***/ (function(module, exports) {

            var supportsArgumentsClass = (function(){
                return Object.prototype.toString.call(arguments)
            })() == '[object Arguments]';

            exports = module.exports = supportsArgumentsClass ? supported : unsupported;

            exports.supported = supported;
            function supported(object) {
                return Object.prototype.toString.call(object) == '[object Arguments]';
            };

            exports.unsupported = unsupported;
            function unsupported(object){
                return object &&
                    typeof object == 'object' &&
                    typeof object.length == 'number' &&
                    Object.prototype.hasOwnProperty.call(object, 'callee') &&
                    !Object.prototype.propertyIsEnumerable.call(object, 'callee') ||
                    false;
            };


            /***/ }),
        /* 54 */
        /***/ (function(module, exports) {

            'use strict';

            var has = Object.prototype.hasOwnProperty
                , prefix = '~';

            /**
             * Constructor to create a storage for our `EE` objects.
             * An `Events` instance is a plain object whose properties are event names.
             *
             * @constructor
             * @api private
             */
            function Events() {}

//
// We try to not inherit from `Object.prototype`. In some engines creating an
// instance in this way is faster than calling `Object.create(null)` directly.
// If `Object.create(null)` is not supported we prefix the event names with a
// character to make sure that the built-in object properties are not
// overridden or used as an attack vector.
//
            if (Object.create) {
                Events.prototype = Object.create(null);

                //
                // This hack is needed because the `__proto__` property is still inherited in
                // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.
                //
                if (!new Events().__proto__) prefix = false;
            }

            /**
             * Representation of a single event listener.
             *
             * @param {Function} fn The listener function.
             * @param {Mixed} context The context to invoke the listener with.
             * @param {Boolean} [once=false] Specify if the listener is a one-time listener.
             * @constructor
             * @api private
             */
            function EE(fn, context, once) {
                this.fn = fn;
                this.context = context;
                this.once = once || false;
            }

            /**
             * Minimal `EventEmitter` interface that is molded against the Node.js
             * `EventEmitter` interface.
             *
             * @constructor
             * @api public
             */
            function EventEmitter() {
                this._events = new Events();
                this._eventsCount = 0;
            }

            /**
             * Return an array listing the events for which the emitter has registered
             * listeners.
             *
             * @returns {Array}
             * @api public
             */
            EventEmitter.prototype.eventNames = function eventNames() {
                var names = []
                    , events
                    , name;

                if (this._eventsCount === 0) return names;

                for (name in (events = this._events)) {
                    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);
                }

                if (Object.getOwnPropertySymbols) {
                    return names.concat(Object.getOwnPropertySymbols(events));
                }

                return names;
            };

            /**
             * Return the listeners registered for a given event.
             *
             * @param {String|Symbol} event The event name.
             * @param {Boolean} exists Only check if there are listeners.
             * @returns {Array|Boolean}
             * @api public
             */
            EventEmitter.prototype.listeners = function listeners(event, exists) {
                var evt = prefix ? prefix + event : event
                    , available = this._events[evt];

                if (exists) return !!available;
                if (!available) return [];
                if (available.fn) return [available.fn];

                for (var i = 0, l = available.length, ee = new Array(l); i < l; i++) {
                    ee[i] = available[i].fn;
                }

                return ee;
            };

            /**
             * Calls each of the listeners registered for a given event.
             *
             * @param {String|Symbol} event The event name.
             * @returns {Boolean} `true` if the event had listeners, else `false`.
             * @api public
             */
            EventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {
                var evt = prefix ? prefix + event : event;

                if (!this._events[evt]) return false;

                var listeners = this._events[evt]
                    , len = arguments.length
                    , args
                    , i;

                if (listeners.fn) {
                    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);

                    switch (len) {
                        case 1: return listeners.fn.call(listeners.context), true;
                        case 2: return listeners.fn.call(listeners.context, a1), true;
                        case 3: return listeners.fn.call(listeners.context, a1, a2), true;
                        case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;
                        case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;
                        case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;
                    }

                    for (i = 1, args = new Array(len -1); i < len; i++) {
                        args[i - 1] = arguments[i];
                    }

                    listeners.fn.apply(listeners.context, args);
                } else {
                    var length = listeners.length
                        , j;

                    for (i = 0; i < length; i++) {
                        if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);

                        switch (len) {
                            case 1: listeners[i].fn.call(listeners[i].context); break;
                            case 2: listeners[i].fn.call(listeners[i].context, a1); break;
                            case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;
                            case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;
                            default:
                                if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {
                                    args[j - 1] = arguments[j];
                                }

                                listeners[i].fn.apply(listeners[i].context, args);
                        }
                    }
                }

                return true;
            };

            /**
             * Add a listener for a given event.
             *
             * @param {String|Symbol} event The event name.
             * @param {Function} fn The listener function.
             * @param {Mixed} [context=this] The context to invoke the listener with.
             * @returns {EventEmitter} `this`.
             * @api public
             */
            EventEmitter.prototype.on = function on(event, fn, context) {
                var listener = new EE(fn, context || this)
                    , evt = prefix ? prefix + event : event;

                if (!this._events[evt]) this._events[evt] = listener, this._eventsCount++;
                else if (!this._events[evt].fn) this._events[evt].push(listener);
                else this._events[evt] = [this._events[evt], listener];

                return this;
            };

            /**
             * Add a one-time listener for a given event.
             *
             * @param {String|Symbol} event The event name.
             * @param {Function} fn The listener function.
             * @param {Mixed} [context=this] The context to invoke the listener with.
             * @returns {EventEmitter} `this`.
             * @api public
             */
            EventEmitter.prototype.once = function once(event, fn, context) {
                var listener = new EE(fn, context || this, true)
                    , evt = prefix ? prefix + event : event;

                if (!this._events[evt]) this._events[evt] = listener, this._eventsCount++;
                else if (!this._events[evt].fn) this._events[evt].push(listener);
                else this._events[evt] = [this._events[evt], listener];

                return this;
            };

            /**
             * Remove the listeners of a given event.
             *
             * @param {String|Symbol} event The event name.
             * @param {Function} fn Only remove the listeners that match this function.
             * @param {Mixed} context Only remove the listeners that have this context.
             * @param {Boolean} once Only remove one-time listeners.
             * @returns {EventEmitter} `this`.
             * @api public
             */
            EventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {
                var evt = prefix ? prefix + event : event;

                if (!this._events[evt]) return this;
                if (!fn) {
                    if (--this._eventsCount === 0) this._events = new Events();
                    else delete this._events[evt];
                    return this;
                }

                var listeners = this._events[evt];

                if (listeners.fn) {
                    if (
                        listeners.fn === fn
                        && (!once || listeners.once)
                        && (!context || listeners.context === context)
                    ) {
                        if (--this._eventsCount === 0) this._events = new Events();
                        else delete this._events[evt];
                    }
                } else {
                    for (var i = 0, events = [], length = listeners.length; i < length; i++) {
                        if (
                            listeners[i].fn !== fn
                            || (once && !listeners[i].once)
                            || (context && listeners[i].context !== context)
                        ) {
                            events.push(listeners[i]);
                        }
                    }

                    //
                    // Reset the array, or remove it completely if we have no more listeners.
                    //
                    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;
                    else if (--this._eventsCount === 0) this._events = new Events();
                    else delete this._events[evt];
                }

                return this;
            };

            /**
             * Remove all listeners, or those of the specified event.
             *
             * @param {String|Symbol} [event] The event name.
             * @returns {EventEmitter} `this`.
             * @api public
             */
            EventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {
                var evt;

                if (event) {
                    evt = prefix ? prefix + event : event;
                    if (this._events[evt]) {
                        if (--this._eventsCount === 0) this._events = new Events();
                        else delete this._events[evt];
                    }
                } else {
                    this._events = new Events();
                    this._eventsCount = 0;
                }

                return this;
            };

//
// Alias methods names because people roll like that.
//
            EventEmitter.prototype.off = EventEmitter.prototype.removeListener;
            EventEmitter.prototype.addListener = EventEmitter.prototype.on;

//
// This function doesn't apply anymore.
//
            EventEmitter.prototype.setMaxListeners = function setMaxListeners() {
                return this;
            };

//
// Expose the prefix.
//
            EventEmitter.prefixed = prefix;

//
// Allow `EventEmitter` to be imported as module namespace.
//
            EventEmitter.EventEmitter = EventEmitter;

//
// Expose the module.
//
            if ('undefined' !== typeof module) {
                module.exports = EventEmitter;
            }


            /***/ }),
        /* 55 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.matchText = exports.matchSpacing = exports.matchNewline = exports.matchBlot = exports.matchAttributor = exports.default = undefined;

            var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

            var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _extend2 = __webpack_require__(3);

            var _extend3 = _interopRequireDefault(_extend2);

            var _quillDelta = __webpack_require__(2);

            var _quillDelta2 = _interopRequireDefault(_quillDelta);

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _quill = __webpack_require__(5);

            var _quill2 = _interopRequireDefault(_quill);

            var _logger = __webpack_require__(10);

            var _logger2 = _interopRequireDefault(_logger);

            var _module = __webpack_require__(9);

            var _module2 = _interopRequireDefault(_module);

            var _align = __webpack_require__(36);

            var _background = __webpack_require__(37);

            var _code = __webpack_require__(13);

            var _code2 = _interopRequireDefault(_code);

            var _color = __webpack_require__(26);

            var _direction = __webpack_require__(38);

            var _font = __webpack_require__(39);

            var _size = __webpack_require__(40);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var debug = (0, _logger2.default)('quill:clipboard');

            var DOM_KEY = '__ql-matcher';

            var CLIPBOARD_CONFIG = [[Node.TEXT_NODE, matchText], [Node.TEXT_NODE, matchNewline], ['br', matchBreak], [Node.ELEMENT_NODE, matchNewline], [Node.ELEMENT_NODE, matchBlot], [Node.ELEMENT_NODE, matchSpacing], [Node.ELEMENT_NODE, matchAttributor], [Node.ELEMENT_NODE, matchStyles], ['li', matchIndent], ['b', matchAlias.bind(matchAlias, 'bold')], ['i', matchAlias.bind(matchAlias, 'italic')], ['style', matchIgnore]];

            var ATTRIBUTE_ATTRIBUTORS = [_align.AlignAttribute, _direction.DirectionAttribute].reduce(function (memo, attr) {
                memo[attr.keyName] = attr;
                return memo;
            }, {});

            var STYLE_ATTRIBUTORS = [_align.AlignStyle, _background.BackgroundStyle, _color.ColorStyle, _direction.DirectionStyle, _font.FontStyle, _size.SizeStyle].reduce(function (memo, attr) {
                memo[attr.keyName] = attr;
                return memo;
            }, {});

            var Clipboard = function (_Module) {
                _inherits(Clipboard, _Module);

                function Clipboard(quill, options) {
                    _classCallCheck(this, Clipboard);

                    var _this = _possibleConstructorReturn(this, (Clipboard.__proto__ || Object.getPrototypeOf(Clipboard)).call(this, quill, options));

                    _this.quill.root.addEventListener('paste', _this.onPaste.bind(_this));
                    _this.container = _this.quill.addContainer('ql-clipboard');
                    _this.container.setAttribute('contenteditable', true);
                    _this.container.setAttribute('tabindex', -1);
                    _this.matchers = [];
                    CLIPBOARD_CONFIG.concat(_this.options.matchers).forEach(function (_ref) {
                        var _ref2 = _slicedToArray(_ref, 2),
                            selector = _ref2[0],
                            matcher = _ref2[1];

                        if (!options.matchVisual && matcher === matchSpacing) return;
                        _this.addMatcher(selector, matcher);
                    });
                    return _this;
                }

                _createClass(Clipboard, [{
                    key: 'addMatcher',
                    value: function addMatcher(selector, matcher) {
                        this.matchers.push([selector, matcher]);
                    }
                }, {
                    key: 'convert',
                    value: function convert(html) {
                        if (typeof html === 'string') {
                            this.container.innerHTML = html.replace(/\>\r?\n +\</g, '><'); // Remove spaces between tags
                            return this.convert();
                        }
                        var formats = this.quill.getFormat(this.quill.selection.savedRange.index);
                        if (formats[_code2.default.blotName]) {
                            var text = this.container.innerText;
                            this.container.innerHTML = '';
                            return new _quillDelta2.default().insert(text, _defineProperty({}, _code2.default.blotName, formats[_code2.default.blotName]));
                        }

                        var _prepareMatching = this.prepareMatching(),
                            _prepareMatching2 = _slicedToArray(_prepareMatching, 2),
                            elementMatchers = _prepareMatching2[0],
                            textMatchers = _prepareMatching2[1];

                        var delta = traverse(this.container, elementMatchers, textMatchers);
                        // Remove trailing newline
                        if (deltaEndsWith(delta, '\n') && delta.ops[delta.ops.length - 1].attributes == null) {
                            delta = delta.compose(new _quillDelta2.default().retain(delta.length() - 1).delete(1));
                        }
                        debug.log('convert', this.container.innerHTML, delta);
                        this.container.innerHTML = '';
                        return delta;
                    }
                }, {
                    key: 'dangerouslyPasteHTML',
                    value: function dangerouslyPasteHTML(index, html) {
                        var source = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _quill2.default.sources.API;

                        if (typeof index === 'string') {
                            this.quill.setContents(this.convert(index), html);
                            this.quill.setSelection(0, _quill2.default.sources.SILENT);
                        } else {
                            var paste = this.convert(html);
                            this.quill.updateContents(new _quillDelta2.default().retain(index).concat(paste), source);
                            this.quill.setSelection(index + paste.length(), _quill2.default.sources.SILENT);
                        }
                    }
                }, {
                    key: 'onPaste',
                    value: function onPaste(e) {
                        var _this2 = this;

                        if (e.defaultPrevented || !this.quill.isEnabled()) return;
                        var range = this.quill.getSelection();
                        var delta = new _quillDelta2.default().retain(range.index);
                        var scrollTop = this.quill.scrollingContainer.scrollTop;
                        this.container.focus();
                        this.quill.selection.update(_quill2.default.sources.SILENT);
                        setTimeout(function () {
                            delta = delta.concat(_this2.convert()).delete(range.length);
                            _this2.quill.updateContents(delta, _quill2.default.sources.USER);
                            // range.length contributes to delta.length()
                            _this2.quill.setSelection(delta.length() - range.length, _quill2.default.sources.SILENT);
                            _this2.quill.scrollingContainer.scrollTop = scrollTop;
                            _this2.quill.focus();
                        }, 1);
                    }
                }, {
                    key: 'prepareMatching',
                    value: function prepareMatching() {
                        var _this3 = this;

                        var elementMatchers = [],
                            textMatchers = [];
                        this.matchers.forEach(function (pair) {
                            var _pair = _slicedToArray(pair, 2),
                                selector = _pair[0],
                                matcher = _pair[1];

                            switch (selector) {
                                case Node.TEXT_NODE:
                                    textMatchers.push(matcher);
                                    break;
                                case Node.ELEMENT_NODE:
                                    elementMatchers.push(matcher);
                                    break;
                                default:
                                    [].forEach.call(_this3.container.querySelectorAll(selector), function (node) {
                                        // TODO use weakmap
                                        node[DOM_KEY] = node[DOM_KEY] || [];
                                        node[DOM_KEY].push(matcher);
                                    });
                                    break;
                            }
                        });
                        return [elementMatchers, textMatchers];
                    }
                }]);

                return Clipboard;
            }(_module2.default);

            Clipboard.DEFAULTS = {
                matchers: [],
                matchVisual: true
            };

            function applyFormat(delta, format, value) {
                if ((typeof format === 'undefined' ? 'undefined' : _typeof(format)) === 'object') {
                    return Object.keys(format).reduce(function (delta, key) {
                        return applyFormat(delta, key, format[key]);
                    }, delta);
                } else {
                    return delta.reduce(function (delta, op) {
                        if (op.attributes && op.attributes[format]) {
                            return delta.push(op);
                        } else {
                            return delta.insert(op.insert, (0, _extend3.default)({}, _defineProperty({}, format, value), op.attributes));
                        }
                    }, new _quillDelta2.default());
                }
            }

            function computeStyle(node) {
                if (node.nodeType !== Node.ELEMENT_NODE) return {};
                var DOM_KEY = '__ql-computed-style';
                return node[DOM_KEY] || (node[DOM_KEY] = window.getComputedStyle(node));
            }

            function deltaEndsWith(delta, text) {
                var endText = "";
                for (var i = delta.ops.length - 1; i >= 0 && endText.length < text.length; --i) {
                    var op = delta.ops[i];
                    if (typeof op.insert !== 'string') break;
                    endText = op.insert + endText;
                }
                return endText.slice(-1 * text.length) === text;
            }

            function isLine(node) {
                if (node.childNodes.length === 0) return false; // Exclude embed blocks
                var style = computeStyle(node);
                return ['block', 'list-item'].indexOf(style.display) > -1;
            }

            function traverse(node, elementMatchers, textMatchers) {
                // Post-order
                if (node.nodeType === node.TEXT_NODE) {
                    return textMatchers.reduce(function (delta, matcher) {
                        return matcher(node, delta);
                    }, new _quillDelta2.default());
                } else if (node.nodeType === node.ELEMENT_NODE) {
                    return [].reduce.call(node.childNodes || [], function (delta, childNode) {
                        var childrenDelta = traverse(childNode, elementMatchers, textMatchers);
                        if (childNode.nodeType === node.ELEMENT_NODE) {
                            childrenDelta = elementMatchers.reduce(function (childrenDelta, matcher) {
                                return matcher(childNode, childrenDelta);
                            }, childrenDelta);
                            childrenDelta = (childNode[DOM_KEY] || []).reduce(function (childrenDelta, matcher) {
                                return matcher(childNode, childrenDelta);
                            }, childrenDelta);
                        }
                        return delta.concat(childrenDelta);
                    }, new _quillDelta2.default());
                } else {
                    return new _quillDelta2.default();
                }
            }

            function matchAlias(format, node, delta) {
                return applyFormat(delta, format, true);
            }

            function matchAttributor(node, delta) {
                var attributes = _parchment2.default.Attributor.Attribute.keys(node);
                var classes = _parchment2.default.Attributor.Class.keys(node);
                var styles = _parchment2.default.Attributor.Style.keys(node);
                var formats = {};
                attributes.concat(classes).concat(styles).forEach(function (name) {
                    var attr = _parchment2.default.query(name, _parchment2.default.Scope.ATTRIBUTE);
                    if (attr != null) {
                        formats[attr.attrName] = attr.value(node);
                        if (formats[attr.attrName]) return;
                    }
                    attr = ATTRIBUTE_ATTRIBUTORS[name];
                    if (attr != null && (attr.attrName === name || attr.keyName === name)) {
                        formats[attr.attrName] = attr.value(node) || undefined;
                    }
                    attr = STYLE_ATTRIBUTORS[name];
                    if (attr != null && (attr.attrName === name || attr.keyName === name)) {
                        attr = STYLE_ATTRIBUTORS[name];
                        formats[attr.attrName] = attr.value(node) || undefined;
                    }
                });
                if (Object.keys(formats).length > 0) {
                    delta = applyFormat(delta, formats);
                }
                return delta;
            }

            function matchBlot(node, delta) {
                var match = _parchment2.default.query(node);
                if (match == null) return delta;
                if (match.prototype instanceof _parchment2.default.Embed) {
                    var embed = {};
                    var value = match.value(node);
                    if (value != null) {
                        embed[match.blotName] = value;
                        delta = new _quillDelta2.default().insert(embed, match.formats(node));
                    }
                } else if (typeof match.formats === 'function') {
                    delta = applyFormat(delta, match.blotName, match.formats(node));
                }
                return delta;
            }

            function matchBreak(node, delta) {
                if (!deltaEndsWith(delta, '\n')) {
                    delta.insert('\n');
                }
                return delta;
            }

            function matchIgnore() {
                return new _quillDelta2.default();
            }

            function matchIndent(node, delta) {
                var match = _parchment2.default.query(node);
                if (match == null || match.blotName !== 'list-item' || !deltaEndsWith(delta, '\n')) {
                    return delta;
                }
                var indent = -1,
                    parent = node.parentNode;
                while (!parent.classList.contains('ql-clipboard')) {
                    if ((_parchment2.default.query(parent) || {}).blotName === 'list') {
                        indent += 1;
                    }
                    parent = parent.parentNode;
                }
                if (indent <= 0) return delta;
                return delta.compose(new _quillDelta2.default().retain(delta.length() - 1).retain(1, { indent: indent }));
            }

            function matchNewline(node, delta) {
                if (!deltaEndsWith(delta, '\n')) {
                    if (isLine(node) || delta.length() > 0 && node.nextSibling && isLine(node.nextSibling)) {
                        delta.insert('\n');
                    }
                }
                return delta;
            }

            function matchSpacing(node, delta) {
                if (isLine(node) && node.nextElementSibling != null && !deltaEndsWith(delta, '\n\n')) {
                    var nodeHeight = node.offsetHeight + parseFloat(computeStyle(node).marginTop) + parseFloat(computeStyle(node).marginBottom);
                    if (node.nextElementSibling.offsetTop > node.offsetTop + nodeHeight * 1.5) {
                        delta.insert('\n');
                    }
                }
                return delta;
            }

            function matchStyles(node, delta) {
                var formats = {};
                var style = node.style || {};
                if (style.fontStyle && computeStyle(node).fontStyle === 'italic') {
                    formats.italic = true;
                }
                if (style.fontWeight && (computeStyle(node).fontWeight.startsWith('bold') || parseInt(computeStyle(node).fontWeight) >= 700)) {
                    formats.bold = true;
                }
                if (Object.keys(formats).length > 0) {
                    delta = applyFormat(delta, formats);
                }
                if (parseFloat(style.textIndent || 0) > 0) {
                    // Could be 0.5in
                    delta = new _quillDelta2.default().insert('\t').concat(delta);
                }
                return delta;
            }

            function matchText(node, delta) {
                var text = node.data;
                // Word represents empty line with <o:p>&nbsp;</o:p>
                if (node.parentNode.tagName === 'O:P') {
                    return delta.insert(text.trim());
                }
                if (text.trim().length === 0 && node.parentNode.classList.contains('ql-clipboard')) {
                    return delta;
                }
                if (!computeStyle(node.parentNode).whiteSpace.startsWith('pre')) {
                    // eslint-disable-next-line func-style
                    var replacer = function replacer(collapse, match) {
                        match = match.replace(/[^\u00a0]/g, ''); // \u00a0 is nbsp;
                        return match.length < 1 && collapse ? ' ' : match;
                    };
                    text = text.replace(/\r\n/g, ' ').replace(/\n/g, ' ');
                    text = text.replace(/\s\s+/g, replacer.bind(replacer, true)); // collapse whitespace
                    if (node.previousSibling == null && isLine(node.parentNode) || node.previousSibling != null && isLine(node.previousSibling)) {
                        text = text.replace(/^\s+/, replacer.bind(replacer, false));
                    }
                    if (node.nextSibling == null && isLine(node.parentNode) || node.nextSibling != null && isLine(node.nextSibling)) {
                        text = text.replace(/\s+$/, replacer.bind(replacer, false));
                    }
                }
                return delta.insert(text);
            }

            exports.default = Clipboard;
            exports.matchAttributor = matchAttributor;
            exports.matchBlot = matchBlot;
            exports.matchNewline = matchNewline;
            exports.matchSpacing = matchSpacing;
            exports.matchText = matchText;

            /***/ }),
        /* 56 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _inline = __webpack_require__(6);

            var _inline2 = _interopRequireDefault(_inline);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Bold = function (_Inline) {
                _inherits(Bold, _Inline);

                function Bold() {
                    _classCallCheck(this, Bold);

                    return _possibleConstructorReturn(this, (Bold.__proto__ || Object.getPrototypeOf(Bold)).apply(this, arguments));
                }

                _createClass(Bold, [{
                    key: 'optimize',
                    value: function optimize(context) {
                        _get(Bold.prototype.__proto__ || Object.getPrototypeOf(Bold.prototype), 'optimize', this).call(this, context);
                        if (this.domNode.tagName !== this.statics.tagName[0]) {
                            this.replaceWith(this.statics.blotName);
                        }
                    }
                }], [{
                    key: 'create',
                    value: function create() {
                        return _get(Bold.__proto__ || Object.getPrototypeOf(Bold), 'create', this).call(this);
                    }
                }, {
                    key: 'formats',
                    value: function formats() {
                        return true;
                    }
                }]);

                return Bold;
            }(_inline2.default);

            Bold.blotName = 'bold';
            Bold.tagName = ['STRONG', 'B'];

            exports.default = Bold;

            /***/ }),
        /* 57 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.addControls = exports.default = undefined;

            var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _quillDelta = __webpack_require__(2);

            var _quillDelta2 = _interopRequireDefault(_quillDelta);

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _quill = __webpack_require__(5);

            var _quill2 = _interopRequireDefault(_quill);

            var _logger = __webpack_require__(10);

            var _logger2 = _interopRequireDefault(_logger);

            var _module = __webpack_require__(9);

            var _module2 = _interopRequireDefault(_module);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var debug = (0, _logger2.default)('quill:toolbar');

            var Toolbar = function (_Module) {
                _inherits(Toolbar, _Module);

                function Toolbar(quill, options) {
                    _classCallCheck(this, Toolbar);

                    var _this = _possibleConstructorReturn(this, (Toolbar.__proto__ || Object.getPrototypeOf(Toolbar)).call(this, quill, options));

                    if (Array.isArray(_this.options.container)) {
                        var container = document.createElement('div');
                        addControls(container, _this.options.container);
                        quill.container.parentNode.insertBefore(container, quill.container);
                        _this.container = container;
                    } else if (typeof _this.options.container === 'string') {
                        _this.container = document.querySelector(_this.options.container);
                    } else {
                        _this.container = _this.options.container;
                    }
                    if (!(_this.container instanceof HTMLElement)) {
                        var _ret;

                        return _ret = debug.error('Container required for toolbar', _this.options), _possibleConstructorReturn(_this, _ret);
                    }
                    _this.container.classList.add('ql-toolbar');
                    _this.controls = [];
                    _this.handlers = {};
                    Object.keys(_this.options.handlers).forEach(function (format) {
                        _this.addHandler(format, _this.options.handlers[format]);
                    });
                    [].forEach.call(_this.container.querySelectorAll('button, select'), function (input) {
                        _this.attach(input);
                    });
                    _this.quill.on(_quill2.default.events.EDITOR_CHANGE, function (type, range) {
                        if (type === _quill2.default.events.SELECTION_CHANGE) {
                            _this.update(range);
                        }
                    });
                    _this.quill.on(_quill2.default.events.SCROLL_OPTIMIZE, function () {
                        var _this$quill$selection = _this.quill.selection.getRange(),
                            _this$quill$selection2 = _slicedToArray(_this$quill$selection, 1),
                            range = _this$quill$selection2[0]; // quill.getSelection triggers update


                        _this.update(range);
                    });
                    return _this;
                }

                _createClass(Toolbar, [{
                    key: 'addHandler',
                    value: function addHandler(format, handler) {
                        this.handlers[format] = handler;
                    }
                }, {
                    key: 'attach',
                    value: function attach(input) {
                        var _this2 = this;

                        var format = [].find.call(input.classList, function (className) {
                            return className.indexOf('ql-') === 0;
                        });
                        if (!format) return;
                        format = format.slice('ql-'.length);
                        if (input.tagName === 'BUTTON') {
                            input.setAttribute('type', 'button');
                        }
                        if (this.handlers[format] == null) {
                            if (this.quill.scroll.whitelist != null && this.quill.scroll.whitelist[format] == null) {
                                debug.warn('ignoring attaching to disabled format', format, input);
                                return;
                            }
                            if (_parchment2.default.query(format) == null) {
                                debug.warn('ignoring attaching to nonexistent format', format, input);
                                return;
                            }
                        }
                        var eventName = input.tagName === 'SELECT' ? 'change' : 'click';
                        input.addEventListener(eventName, function (e) {
                            var value = void 0;
                            if (input.tagName === 'SELECT') {
                                if (input.selectedIndex < 0) return;
                                var selected = input.options[input.selectedIndex];
                                if (selected.hasAttribute('selected')) {
                                    value = false;
                                } else {
                                    value = selected.value || false;
                                }
                            } else {
                                if (input.classList.contains('ql-active')) {
                                    value = false;
                                } else {
                                    value = input.value || !input.hasAttribute('value');
                                }
                                e.preventDefault();
                            }
                            _this2.quill.focus();

                            var _quill$selection$getR = _this2.quill.selection.getRange(),
                                _quill$selection$getR2 = _slicedToArray(_quill$selection$getR, 1),
                                range = _quill$selection$getR2[0];

                            if (_this2.handlers[format] != null) {
                                _this2.handlers[format].call(_this2, value);
                            } else if (_parchment2.default.query(format).prototype instanceof _parchment2.default.Embed) {
                                value = prompt('Enter ' + format);
                                if (!value) return;
                                _this2.quill.updateContents(new _quillDelta2.default().retain(range.index).delete(range.length).insert(_defineProperty({}, format, value)), _quill2.default.sources.USER);
                            } else {
                                _this2.quill.format(format, value, _quill2.default.sources.USER);
                            }
                            _this2.update(range);
                        });
                        // TODO use weakmap
                        this.controls.push([format, input]);
                    }
                }, {
                    key: 'update',
                    value: function update(range) {
                        var formats = range == null ? {} : this.quill.getFormat(range);
                        this.controls.forEach(function (pair) {
                            var _pair = _slicedToArray(pair, 2),
                                format = _pair[0],
                                input = _pair[1];

                            if (input.tagName === 'SELECT') {
                                var option = void 0;
                                if (range == null) {
                                    option = null;
                                } else if (formats[format] == null) {
                                    option = input.querySelector('option[selected]');
                                } else if (!Array.isArray(formats[format])) {
                                    var value = formats[format];
                                    if (typeof value === 'string') {
                                        value = value.replace(/\"/g, '\\"');
                                    }
                                    option = input.querySelector('option[value="' + value + '"]');
                                }
                                if (option == null) {
                                    input.value = ''; // TODO make configurable?
                                    input.selectedIndex = -1;
                                } else {
                                    option.selected = true;
                                }
                            } else {
                                if (range == null) {
                                    input.classList.remove('ql-active');
                                } else if (input.hasAttribute('value')) {
                                    // both being null should match (default values)
                                    // '1' should match with 1 (headers)
                                    var isActive = formats[format] === input.getAttribute('value') || formats[format] != null && formats[format].toString() === input.getAttribute('value') || formats[format] == null && !input.getAttribute('value');
                                    input.classList.toggle('ql-active', isActive);
                                } else {
                                    input.classList.toggle('ql-active', formats[format] != null);
                                }
                            }
                        });
                    }
                }]);

                return Toolbar;
            }(_module2.default);

            Toolbar.DEFAULTS = {};

            function addButton(container, format, value) {
                var input = document.createElement('button');
                input.setAttribute('type', 'button');
                input.classList.add('ql-' + format);
                if (value != null) {
                    input.value = value;
                }
                container.appendChild(input);
            }

            function addControls(container, groups) {
                if (!Array.isArray(groups[0])) {
                    groups = [groups];
                }
                groups.forEach(function (controls) {
                    var group = document.createElement('span');
                    group.classList.add('ql-formats');
                    controls.forEach(function (control) {
                        if (typeof control === 'string') {
                            addButton(group, control);
                        } else {
                            var format = Object.keys(control)[0];
                            var value = control[format];
                            if (Array.isArray(value)) {
                                addSelect(group, format, value);
                            } else {
                                addButton(group, format, value);
                            }
                        }
                    });
                    container.appendChild(group);
                });
            }

            function addSelect(container, format, values) {
                var input = document.createElement('select');
                input.classList.add('ql-' + format);
                values.forEach(function (value) {
                    var option = document.createElement('option');
                    if (value !== false) {
                        option.setAttribute('value', value);
                    } else {
                        option.setAttribute('selected', 'selected');
                    }
                    input.appendChild(option);
                });
                container.appendChild(input);
            }

            Toolbar.DEFAULTS = {
                container: null,
                handlers: {
                    clean: function clean() {
                        var _this3 = this;

                        var range = this.quill.getSelection();
                        if (range == null) return;
                        if (range.length == 0) {
                            var formats = this.quill.getFormat();
                            Object.keys(formats).forEach(function (name) {
                                // Clean functionality in existing apps only clean inline formats
                                if (_parchment2.default.query(name, _parchment2.default.Scope.INLINE) != null) {
                                    _this3.quill.format(name, false);
                                }
                            });
                        } else {
                            this.quill.removeFormat(range, _quill2.default.sources.USER);
                        }
                    },
                    direction: function direction(value) {
                        var align = this.quill.getFormat()['align'];
                        if (value === 'rtl' && align == null) {
                            this.quill.format('align', 'right', _quill2.default.sources.USER);
                        } else if (!value && align === 'right') {
                            this.quill.format('align', false, _quill2.default.sources.USER);
                        }
                        this.quill.format('direction', value, _quill2.default.sources.USER);
                    },
                    indent: function indent(value) {
                        var range = this.quill.getSelection();
                        var formats = this.quill.getFormat(range);
                        var indent = parseInt(formats.indent || 0);
                        if (value === '+1' || value === '-1') {
                            var modifier = value === '+1' ? 1 : -1;
                            if (formats.direction === 'rtl') modifier *= -1;
                            this.quill.format('indent', indent + modifier, _quill2.default.sources.USER);
                        }
                    },
                    link: function link(value) {
                        if (value === true) {
                            value = prompt('Enter link URL:');
                        }
                        this.quill.format('link', value, _quill2.default.sources.USER);
                    },
                    list: function list(value) {
                        var range = this.quill.getSelection();
                        var formats = this.quill.getFormat(range);
                        if (value === 'check') {
                            if (formats['list'] === 'checked' || formats['list'] === 'unchecked') {
                                this.quill.format('list', false, _quill2.default.sources.USER);
                            } else {
                                this.quill.format('list', 'unchecked', _quill2.default.sources.USER);
                            }
                        } else {
                            this.quill.format('list', value, _quill2.default.sources.USER);
                        }
                    }
                }
            };

            exports.default = Toolbar;
            exports.addControls = addControls;

            /***/ }),
        /* 58 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <polyline class=\"ql-even ql-stroke\" points=\"5 7 3 9 5 11\"></polyline> <polyline class=\"ql-even ql-stroke\" points=\"13 7 15 9 13 11\"></polyline> <line class=ql-stroke x1=10 x2=8 y1=5 y2=13></line> </svg>";

            /***/ }),
        /* 59 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _picker = __webpack_require__(28);

            var _picker2 = _interopRequireDefault(_picker);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var ColorPicker = function (_Picker) {
                _inherits(ColorPicker, _Picker);

                function ColorPicker(select, label) {
                    _classCallCheck(this, ColorPicker);

                    var _this = _possibleConstructorReturn(this, (ColorPicker.__proto__ || Object.getPrototypeOf(ColorPicker)).call(this, select));

                    _this.label.innerHTML = label;
                    _this.container.classList.add('ql-color-picker');
                    [].slice.call(_this.container.querySelectorAll('.ql-picker-item'), 0, 7).forEach(function (item) {
                        item.classList.add('ql-primary');
                    });
                    return _this;
                }

                _createClass(ColorPicker, [{
                    key: 'buildItem',
                    value: function buildItem(option) {
                        var item = _get(ColorPicker.prototype.__proto__ || Object.getPrototypeOf(ColorPicker.prototype), 'buildItem', this).call(this, option);
                        item.style.backgroundColor = option.getAttribute('value') || '';
                        return item;
                    }
                }, {
                    key: 'selectItem',
                    value: function selectItem(item, trigger) {
                        _get(ColorPicker.prototype.__proto__ || Object.getPrototypeOf(ColorPicker.prototype), 'selectItem', this).call(this, item, trigger);
                        var colorLabel = this.label.querySelector('.ql-color-label');
                        var value = item ? item.getAttribute('data-value') || '' : '';
                        if (colorLabel) {
                            if (colorLabel.tagName === 'line') {
                                colorLabel.style.stroke = value;
                            } else {
                                colorLabel.style.fill = value;
                            }
                        }
                    }
                }]);

                return ColorPicker;
            }(_picker2.default);

            exports.default = ColorPicker;

            /***/ }),
        /* 60 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _picker = __webpack_require__(28);

            var _picker2 = _interopRequireDefault(_picker);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var IconPicker = function (_Picker) {
                _inherits(IconPicker, _Picker);

                function IconPicker(select, icons) {
                    _classCallCheck(this, IconPicker);

                    var _this = _possibleConstructorReturn(this, (IconPicker.__proto__ || Object.getPrototypeOf(IconPicker)).call(this, select));

                    _this.container.classList.add('ql-icon-picker');
                    [].forEach.call(_this.container.querySelectorAll('.ql-picker-item'), function (item) {
                        item.innerHTML = icons[item.getAttribute('data-value') || ''];
                    });
                    _this.defaultItem = _this.container.querySelector('.ql-selected');
                    _this.selectItem(_this.defaultItem);
                    return _this;
                }

                _createClass(IconPicker, [{
                    key: 'selectItem',
                    value: function selectItem(item, trigger) {
                        _get(IconPicker.prototype.__proto__ || Object.getPrototypeOf(IconPicker.prototype), 'selectItem', this).call(this, item, trigger);
                        item = item || this.defaultItem;
                        this.label.innerHTML = item.innerHTML;
                    }
                }]);

                return IconPicker;
            }(_picker2.default);

            exports.default = IconPicker;

            /***/ }),
        /* 61 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            var Tooltip = function () {
                function Tooltip(quill, boundsContainer) {
                    var _this = this;

                    _classCallCheck(this, Tooltip);

                    this.quill = quill;
                    this.boundsContainer = boundsContainer || document.body;
                    this.root = quill.addContainer('ql-tooltip');
                    this.root.innerHTML = this.constructor.TEMPLATE;
                    if (this.quill.root === this.quill.scrollingContainer) {
                        this.quill.root.addEventListener('scroll', function () {
                            _this.root.style.marginTop = -1 * _this.quill.root.scrollTop + 'px';
                        });
                    }
                    this.hide();
                }

                _createClass(Tooltip, [{
                    key: 'hide',
                    value: function hide() {
                        this.root.classList.add('ql-hidden');
                    }
                }, {
                    key: 'position',
                    value: function position(reference) {
                        var left = reference.left + reference.width / 2 - this.root.offsetWidth / 2;
                        // root.scrollTop should be 0 if scrollContainer !== root
                        var top = reference.bottom + this.quill.root.scrollTop;
                        this.root.style.left = left + 'px';
                        this.root.style.top = top + 'px';
                        this.root.classList.remove('ql-flip');
                        var containerBounds = this.boundsContainer.getBoundingClientRect();
                        var rootBounds = this.root.getBoundingClientRect();
                        var shift = 0;
                        if (rootBounds.right > containerBounds.right) {
                            shift = containerBounds.right - rootBounds.right;
                            this.root.style.left = left + shift + 'px';
                        }
                        if (rootBounds.left < containerBounds.left) {
                            shift = containerBounds.left - rootBounds.left;
                            this.root.style.left = left + shift + 'px';
                        }
                        if (rootBounds.bottom > containerBounds.bottom) {
                            var height = rootBounds.bottom - rootBounds.top;
                            var verticalShift = reference.bottom - reference.top + height;
                            this.root.style.top = top - verticalShift + 'px';
                            this.root.classList.add('ql-flip');
                        }
                        return shift;
                    }
                }, {
                    key: 'show',
                    value: function show() {
                        this.root.classList.remove('ql-editing');
                        this.root.classList.remove('ql-hidden');
                    }
                }]);

                return Tooltip;
            }();

            exports.default = Tooltip;

            /***/ }),
        /* 62 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _extend = __webpack_require__(3);

            var _extend2 = _interopRequireDefault(_extend);

            var _emitter = __webpack_require__(8);

            var _emitter2 = _interopRequireDefault(_emitter);

            var _base = __webpack_require__(43);

            var _base2 = _interopRequireDefault(_base);

            var _link = __webpack_require__(27);

            var _link2 = _interopRequireDefault(_link);

            var _selection = __webpack_require__(15);

            var _icons = __webpack_require__(41);

            var _icons2 = _interopRequireDefault(_icons);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var TOOLBAR_CONFIG = [[{ header: ['1', '2', '3', false] }], ['bold', 'italic', 'underline', 'link'], [{ list: 'ordered' }, { list: 'bullet' }], ['clean']];

            var SnowTheme = function (_BaseTheme) {
                _inherits(SnowTheme, _BaseTheme);

                function SnowTheme(quill, options) {
                    _classCallCheck(this, SnowTheme);

                    if (options.modules.toolbar != null && options.modules.toolbar.container == null) {
                        options.modules.toolbar.container = TOOLBAR_CONFIG;
                    }

                    var _this = _possibleConstructorReturn(this, (SnowTheme.__proto__ || Object.getPrototypeOf(SnowTheme)).call(this, quill, options));

                    _this.quill.container.classList.add('ql-snow');
                    return _this;
                }

                _createClass(SnowTheme, [{
                    key: 'extendToolbar',
                    value: function extendToolbar(toolbar) {
                        toolbar.container.classList.add('ql-snow');
                        this.buildButtons([].slice.call(toolbar.container.querySelectorAll('button')), _icons2.default);
                        this.buildPickers([].slice.call(toolbar.container.querySelectorAll('select')), _icons2.default);
                        this.tooltip = new SnowTooltip(this.quill, this.options.bounds);
                        if (toolbar.container.querySelector('.ql-link')) {
                            this.quill.keyboard.addBinding({ key: 'K', shortKey: true }, function (range, context) {
                                toolbar.handlers['link'].call(toolbar, !context.format.link);
                            });
                        }
                    }
                }]);

                return SnowTheme;
            }(_base2.default);

            SnowTheme.DEFAULTS = (0, _extend2.default)(true, {}, _base2.default.DEFAULTS, {
                modules: {
                    toolbar: {
                        handlers: {
                            link: function link(value) {
                                if (value) {
                                    var range = this.quill.getSelection();
                                    if (range == null || range.length == 0) return;
                                    var preview = this.quill.getText(range);
                                    if (/^\S+@\S+\.\S+$/.test(preview) && preview.indexOf('mailto:') !== 0) {
                                        preview = 'mailto:' + preview;
                                    }
                                    var tooltip = this.quill.theme.tooltip;
                                    tooltip.edit('link', preview);
                                } else {
                                    this.quill.format('link', false);
                                }
                            }
                        }
                    }
                }
            });

            var SnowTooltip = function (_BaseTooltip) {
                _inherits(SnowTooltip, _BaseTooltip);

                function SnowTooltip(quill, bounds) {
                    _classCallCheck(this, SnowTooltip);

                    var _this2 = _possibleConstructorReturn(this, (SnowTooltip.__proto__ || Object.getPrototypeOf(SnowTooltip)).call(this, quill, bounds));

                    _this2.preview = _this2.root.querySelector('a.ql-preview');
                    return _this2;
                }

                _createClass(SnowTooltip, [{
                    key: 'listen',
                    value: function listen() {
                        var _this3 = this;

                        _get(SnowTooltip.prototype.__proto__ || Object.getPrototypeOf(SnowTooltip.prototype), 'listen', this).call(this);
                        this.root.querySelector('a.ql-action').addEventListener('click', function (event) {
                            if (_this3.root.classList.contains('ql-editing')) {
                                _this3.save();
                            } else {
                                _this3.edit('link', _this3.preview.textContent);
                            }
                            event.preventDefault();
                        });
                        this.root.querySelector('a.ql-remove').addEventListener('click', function (event) {
                            if (_this3.linkRange != null) {
                                var range = _this3.linkRange;
                                _this3.restoreFocus();
                                _this3.quill.formatText(range, 'link', false, _emitter2.default.sources.USER);
                                delete _this3.linkRange;
                            }
                            event.preventDefault();
                            _this3.hide();
                        });
                        this.quill.on(_emitter2.default.events.SELECTION_CHANGE, function (range, oldRange, source) {
                            if (range == null) return;
                            if (range.length === 0 && source === _emitter2.default.sources.USER) {
                                var _quill$scroll$descend = _this3.quill.scroll.descendant(_link2.default, range.index),
                                    _quill$scroll$descend2 = _slicedToArray(_quill$scroll$descend, 2),
                                    link = _quill$scroll$descend2[0],
                                    offset = _quill$scroll$descend2[1];

                                if (link != null) {
                                    _this3.linkRange = new _selection.Range(range.index - offset, link.length());
                                    var preview = _link2.default.formats(link.domNode);
                                    _this3.preview.textContent = preview;
                                    _this3.preview.setAttribute('href', preview);
                                    _this3.show();
                                    _this3.position(_this3.quill.getBounds(_this3.linkRange));
                                    return;
                                }
                            } else {
                                delete _this3.linkRange;
                            }
                            _this3.hide();
                        });
                    }
                }, {
                    key: 'show',
                    value: function show() {
                        _get(SnowTooltip.prototype.__proto__ || Object.getPrototypeOf(SnowTooltip.prototype), 'show', this).call(this);
                        this.root.removeAttribute('data-mode');
                    }
                }]);

                return SnowTooltip;
            }(_base.BaseTooltip);

            SnowTooltip.TEMPLATE = ['<a class="ql-preview" target="_blank" href="about:blank"></a>', '<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">', '<a class="ql-action"></a>', '<a class="ql-remove"></a>'].join('');

            exports.default = SnowTheme;

            /***/ }),
        /* 63 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _core = __webpack_require__(29);

            var _core2 = _interopRequireDefault(_core);

            var _align = __webpack_require__(36);

            var _direction = __webpack_require__(38);

            var _indent = __webpack_require__(64);

            var _blockquote = __webpack_require__(65);

            var _blockquote2 = _interopRequireDefault(_blockquote);

            var _header = __webpack_require__(66);

            var _header2 = _interopRequireDefault(_header);

            var _list = __webpack_require__(67);

            var _list2 = _interopRequireDefault(_list);

            var _background = __webpack_require__(37);

            var _color = __webpack_require__(26);

            var _font = __webpack_require__(39);

            var _size = __webpack_require__(40);

            var _bold = __webpack_require__(56);

            var _bold2 = _interopRequireDefault(_bold);

            var _italic = __webpack_require__(68);

            var _italic2 = _interopRequireDefault(_italic);

            var _link = __webpack_require__(27);

            var _link2 = _interopRequireDefault(_link);

            var _script = __webpack_require__(69);

            var _script2 = _interopRequireDefault(_script);

            var _strike = __webpack_require__(70);

            var _strike2 = _interopRequireDefault(_strike);

            var _underline = __webpack_require__(71);

            var _underline2 = _interopRequireDefault(_underline);

            var _image = __webpack_require__(72);

            var _image2 = _interopRequireDefault(_image);

            var _video = __webpack_require__(73);

            var _video2 = _interopRequireDefault(_video);

            var _code = __webpack_require__(13);

            var _code2 = _interopRequireDefault(_code);

            var _formula = __webpack_require__(74);

            var _formula2 = _interopRequireDefault(_formula);

            var _syntax = __webpack_require__(75);

            var _syntax2 = _interopRequireDefault(_syntax);

            var _toolbar = __webpack_require__(57);

            var _toolbar2 = _interopRequireDefault(_toolbar);

            var _icons = __webpack_require__(41);

            var _icons2 = _interopRequireDefault(_icons);

            var _picker = __webpack_require__(28);

            var _picker2 = _interopRequireDefault(_picker);

            var _colorPicker = __webpack_require__(59);

            var _colorPicker2 = _interopRequireDefault(_colorPicker);

            var _iconPicker = __webpack_require__(60);

            var _iconPicker2 = _interopRequireDefault(_iconPicker);

            var _tooltip = __webpack_require__(61);

            var _tooltip2 = _interopRequireDefault(_tooltip);

            var _bubble = __webpack_require__(108);

            var _bubble2 = _interopRequireDefault(_bubble);

            var _snow = __webpack_require__(62);

            var _snow2 = _interopRequireDefault(_snow);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            _core2.default.register({
                'attributors/attribute/direction': _direction.DirectionAttribute,

                'attributors/class/align': _align.AlignClass,
                'attributors/class/background': _background.BackgroundClass,
                'attributors/class/color': _color.ColorClass,
                'attributors/class/direction': _direction.DirectionClass,
                'attributors/class/font': _font.FontClass,
                'attributors/class/size': _size.SizeClass,

                'attributors/style/align': _align.AlignStyle,
                'attributors/style/background': _background.BackgroundStyle,
                'attributors/style/color': _color.ColorStyle,
                'attributors/style/direction': _direction.DirectionStyle,
                'attributors/style/font': _font.FontStyle,
                'attributors/style/size': _size.SizeStyle
            }, true);

            _core2.default.register({
                'formats/align': _align.AlignClass,
                'formats/direction': _direction.DirectionClass,
                'formats/indent': _indent.IndentClass,

                'formats/background': _background.BackgroundStyle,
                'formats/color': _color.ColorStyle,
                'formats/font': _font.FontClass,
                'formats/size': _size.SizeClass,

                'formats/blockquote': _blockquote2.default,
                'formats/code-block': _code2.default,
                'formats/header': _header2.default,
                'formats/list': _list2.default,

                'formats/bold': _bold2.default,
                'formats/code': _code.Code,
                'formats/italic': _italic2.default,
                'formats/link': _link2.default,
                'formats/script': _script2.default,
                'formats/strike': _strike2.default,
                'formats/underline': _underline2.default,

                'formats/image': _image2.default,
                'formats/video': _video2.default,

                'formats/list/item': _list.ListItem,

                'modules/formula': _formula2.default,
                'modules/syntax': _syntax2.default,
                'modules/toolbar': _toolbar2.default,

                'themes/bubble': _bubble2.default,
                'themes/snow': _snow2.default,

                'ui/icons': _icons2.default,
                'ui/picker': _picker2.default,
                'ui/icon-picker': _iconPicker2.default,
                'ui/color-picker': _colorPicker2.default,
                'ui/tooltip': _tooltip2.default
            }, true);

            exports.default = _core2.default;

            /***/ }),
        /* 64 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.IndentClass = undefined;

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var IdentAttributor = function (_Parchment$Attributor) {
                _inherits(IdentAttributor, _Parchment$Attributor);

                function IdentAttributor() {
                    _classCallCheck(this, IdentAttributor);

                    return _possibleConstructorReturn(this, (IdentAttributor.__proto__ || Object.getPrototypeOf(IdentAttributor)).apply(this, arguments));
                }

                _createClass(IdentAttributor, [{
                    key: 'add',
                    value: function add(node, value) {
                        if (value === '+1' || value === '-1') {
                            var indent = this.value(node) || 0;
                            value = value === '+1' ? indent + 1 : indent - 1;
                        }
                        if (value === 0) {
                            this.remove(node);
                            return true;
                        } else {
                            return _get(IdentAttributor.prototype.__proto__ || Object.getPrototypeOf(IdentAttributor.prototype), 'add', this).call(this, node, value);
                        }
                    }
                }, {
                    key: 'canAdd',
                    value: function canAdd(node, value) {
                        return _get(IdentAttributor.prototype.__proto__ || Object.getPrototypeOf(IdentAttributor.prototype), 'canAdd', this).call(this, node, value) || _get(IdentAttributor.prototype.__proto__ || Object.getPrototypeOf(IdentAttributor.prototype), 'canAdd', this).call(this, node, parseInt(value));
                    }
                }, {
                    key: 'value',
                    value: function value(node) {
                        return parseInt(_get(IdentAttributor.prototype.__proto__ || Object.getPrototypeOf(IdentAttributor.prototype), 'value', this).call(this, node)) || undefined; // Don't return NaN
                    }
                }]);

                return IdentAttributor;
            }(_parchment2.default.Attributor.Class);

            var IndentClass = new IdentAttributor('indent', 'ql-indent', {
                scope: _parchment2.default.Scope.BLOCK,
                whitelist: [1, 2, 3, 4, 5, 6, 7, 8]
            });

            exports.IndentClass = IndentClass;

            /***/ }),
        /* 65 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _block = __webpack_require__(4);

            var _block2 = _interopRequireDefault(_block);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Blockquote = function (_Block) {
                _inherits(Blockquote, _Block);

                function Blockquote() {
                    _classCallCheck(this, Blockquote);

                    return _possibleConstructorReturn(this, (Blockquote.__proto__ || Object.getPrototypeOf(Blockquote)).apply(this, arguments));
                }

                return Blockquote;
            }(_block2.default);

            Blockquote.blotName = 'blockquote';
            Blockquote.tagName = 'blockquote';

            exports.default = Blockquote;

            /***/ }),
        /* 66 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _block = __webpack_require__(4);

            var _block2 = _interopRequireDefault(_block);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Header = function (_Block) {
                _inherits(Header, _Block);

                function Header() {
                    _classCallCheck(this, Header);

                    return _possibleConstructorReturn(this, (Header.__proto__ || Object.getPrototypeOf(Header)).apply(this, arguments));
                }

                _createClass(Header, null, [{
                    key: 'formats',
                    value: function formats(domNode) {
                        return this.tagName.indexOf(domNode.tagName) + 1;
                    }
                }]);

                return Header;
            }(_block2.default);

            Header.blotName = 'header';
            Header.tagName = ['H1', 'H2', 'H3', 'H4', 'H5', 'H6'];

            exports.default = Header;

            /***/ }),
        /* 67 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.default = exports.ListItem = undefined;

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _block = __webpack_require__(4);

            var _block2 = _interopRequireDefault(_block);

            var _container = __webpack_require__(25);

            var _container2 = _interopRequireDefault(_container);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var ListItem = function (_Block) {
                _inherits(ListItem, _Block);

                function ListItem() {
                    _classCallCheck(this, ListItem);

                    return _possibleConstructorReturn(this, (ListItem.__proto__ || Object.getPrototypeOf(ListItem)).apply(this, arguments));
                }

                _createClass(ListItem, [{
                    key: 'format',
                    value: function format(name, value) {
                        if (name === List.blotName && !value) {
                            this.replaceWith(_parchment2.default.create(this.statics.scope));
                        } else {
                            _get(ListItem.prototype.__proto__ || Object.getPrototypeOf(ListItem.prototype), 'format', this).call(this, name, value);
                        }
                    }
                }, {
                    key: 'remove',
                    value: function remove() {
                        if (this.prev == null && this.next == null) {
                            this.parent.remove();
                        } else {
                            _get(ListItem.prototype.__proto__ || Object.getPrototypeOf(ListItem.prototype), 'remove', this).call(this);
                        }
                    }
                }, {
                    key: 'replaceWith',
                    value: function replaceWith(name, value) {
                        this.parent.isolate(this.offset(this.parent), this.length());
                        if (name === this.parent.statics.blotName) {
                            this.parent.replaceWith(name, value);
                            return this;
                        } else {
                            this.parent.unwrap();
                            return _get(ListItem.prototype.__proto__ || Object.getPrototypeOf(ListItem.prototype), 'replaceWith', this).call(this, name, value);
                        }
                    }
                }], [{
                    key: 'formats',
                    value: function formats(domNode) {
                        return domNode.tagName === this.tagName ? undefined : _get(ListItem.__proto__ || Object.getPrototypeOf(ListItem), 'formats', this).call(this, domNode);
                    }
                }]);

                return ListItem;
            }(_block2.default);

            ListItem.blotName = 'list-item';
            ListItem.tagName = 'LI';

            var List = function (_Container) {
                _inherits(List, _Container);

                _createClass(List, null, [{
                    key: 'create',
                    value: function create(value) {
                        var tagName = value === 'ordered' ? 'OL' : 'UL';
                        var node = _get(List.__proto__ || Object.getPrototypeOf(List), 'create', this).call(this, tagName);
                        if (value === 'checked' || value === 'unchecked') {
                            node.setAttribute('data-checked', value === 'checked');
                        }
                        return node;
                    }
                }, {
                    key: 'formats',
                    value: function formats(domNode) {
                        if (domNode.tagName === 'OL') return 'ordered';
                        if (domNode.tagName === 'UL') {
                            if (domNode.hasAttribute('data-checked')) {
                                return domNode.getAttribute('data-checked') === 'true' ? 'checked' : 'unchecked';
                            } else {
                                return 'bullet';
                            }
                        }
                        return undefined;
                    }
                }]);

                function List(domNode) {
                    _classCallCheck(this, List);

                    var _this2 = _possibleConstructorReturn(this, (List.__proto__ || Object.getPrototypeOf(List)).call(this, domNode));

                    var listEventHandler = function listEventHandler(e) {
                        if (e.target.parentNode !== domNode) return;
                        var format = _this2.statics.formats(domNode);
                        var blot = _parchment2.default.find(e.target);
                        if (format === 'checked') {
                            blot.format('list', 'unchecked');
                        } else if (format === 'unchecked') {
                            blot.format('list', 'checked');
                        }
                    };

                    domNode.addEventListener('touchstart', listEventHandler);
                    domNode.addEventListener('mousedown', listEventHandler);
                    return _this2;
                }

                _createClass(List, [{
                    key: 'format',
                    value: function format(name, value) {
                        if (this.children.length > 0) {
                            this.children.tail.format(name, value);
                        }
                    }
                }, {
                    key: 'formats',
                    value: function formats() {
                        // We don't inherit from FormatBlot
                        return _defineProperty({}, this.statics.blotName, this.statics.formats(this.domNode));
                    }
                }, {
                    key: 'insertBefore',
                    value: function insertBefore(blot, ref) {
                        if (blot instanceof ListItem) {
                            _get(List.prototype.__proto__ || Object.getPrototypeOf(List.prototype), 'insertBefore', this).call(this, blot, ref);
                        } else {
                            var index = ref == null ? this.length() : ref.offset(this);
                            var after = this.split(index);
                            after.parent.insertBefore(blot, after);
                        }
                    }
                }, {
                    key: 'optimize',
                    value: function optimize(context) {
                        _get(List.prototype.__proto__ || Object.getPrototypeOf(List.prototype), 'optimize', this).call(this, context);
                        var next = this.next;
                        if (next != null && next.prev === this && next.statics.blotName === this.statics.blotName && next.domNode.tagName === this.domNode.tagName && next.domNode.getAttribute('data-checked') === this.domNode.getAttribute('data-checked')) {
                            next.moveChildren(this);
                            next.remove();
                        }
                    }
                }, {
                    key: 'replace',
                    value: function replace(target) {
                        if (target.statics.blotName !== this.statics.blotName) {
                            var item = _parchment2.default.create(this.statics.defaultChild);
                            target.moveChildren(item);
                            this.appendChild(item);
                        }
                        _get(List.prototype.__proto__ || Object.getPrototypeOf(List.prototype), 'replace', this).call(this, target);
                    }
                }]);

                return List;
            }(_container2.default);

            List.blotName = 'list';
            List.scope = _parchment2.default.Scope.BLOCK_BLOT;
            List.tagName = ['OL', 'UL'];
            List.defaultChild = 'list-item';
            List.allowedChildren = [ListItem];

            exports.ListItem = ListItem;
            exports.default = List;

            /***/ }),
        /* 68 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _bold = __webpack_require__(56);

            var _bold2 = _interopRequireDefault(_bold);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Italic = function (_Bold) {
                _inherits(Italic, _Bold);

                function Italic() {
                    _classCallCheck(this, Italic);

                    return _possibleConstructorReturn(this, (Italic.__proto__ || Object.getPrototypeOf(Italic)).apply(this, arguments));
                }

                return Italic;
            }(_bold2.default);

            Italic.blotName = 'italic';
            Italic.tagName = ['EM', 'I'];

            exports.default = Italic;

            /***/ }),
        /* 69 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _inline = __webpack_require__(6);

            var _inline2 = _interopRequireDefault(_inline);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Script = function (_Inline) {
                _inherits(Script, _Inline);

                function Script() {
                    _classCallCheck(this, Script);

                    return _possibleConstructorReturn(this, (Script.__proto__ || Object.getPrototypeOf(Script)).apply(this, arguments));
                }

                _createClass(Script, null, [{
                    key: 'create',
                    value: function create(value) {
                        if (value === 'super') {
                            return document.createElement('sup');
                        } else if (value === 'sub') {
                            return document.createElement('sub');
                        } else {
                            return _get(Script.__proto__ || Object.getPrototypeOf(Script), 'create', this).call(this, value);
                        }
                    }
                }, {
                    key: 'formats',
                    value: function formats(domNode) {
                        if (domNode.tagName === 'SUB') return 'sub';
                        if (domNode.tagName === 'SUP') return 'super';
                        return undefined;
                    }
                }]);

                return Script;
            }(_inline2.default);

            Script.blotName = 'script';
            Script.tagName = ['SUB', 'SUP'];

            exports.default = Script;

            /***/ }),
        /* 70 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _inline = __webpack_require__(6);

            var _inline2 = _interopRequireDefault(_inline);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Strike = function (_Inline) {
                _inherits(Strike, _Inline);

                function Strike() {
                    _classCallCheck(this, Strike);

                    return _possibleConstructorReturn(this, (Strike.__proto__ || Object.getPrototypeOf(Strike)).apply(this, arguments));
                }

                return Strike;
            }(_inline2.default);

            Strike.blotName = 'strike';
            Strike.tagName = 'S';

            exports.default = Strike;

            /***/ }),
        /* 71 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _inline = __webpack_require__(6);

            var _inline2 = _interopRequireDefault(_inline);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var Underline = function (_Inline) {
                _inherits(Underline, _Inline);

                function Underline() {
                    _classCallCheck(this, Underline);

                    return _possibleConstructorReturn(this, (Underline.__proto__ || Object.getPrototypeOf(Underline)).apply(this, arguments));
                }

                return Underline;
            }(_inline2.default);

            Underline.blotName = 'underline';
            Underline.tagName = 'U';

            exports.default = Underline;

            /***/ }),
        /* 72 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _link = __webpack_require__(27);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var ATTRIBUTES = ['alt', 'height', 'width'];

            var Image = function (_Parchment$Embed) {
                _inherits(Image, _Parchment$Embed);

                function Image() {
                    _classCallCheck(this, Image);

                    return _possibleConstructorReturn(this, (Image.__proto__ || Object.getPrototypeOf(Image)).apply(this, arguments));
                }

                _createClass(Image, [{
                    key: 'format',
                    value: function format(name, value) {
                        if (ATTRIBUTES.indexOf(name) > -1) {
                            if (value) {
                                this.domNode.setAttribute(name, value);
                            } else {
                                this.domNode.removeAttribute(name);
                            }
                        } else {
                            _get(Image.prototype.__proto__ || Object.getPrototypeOf(Image.prototype), 'format', this).call(this, name, value);
                        }
                    }
                }], [{
                    key: 'create',
                    value: function create(value) {
                        var node = _get(Image.__proto__ || Object.getPrototypeOf(Image), 'create', this).call(this, value);
                        if (typeof value === 'string') {
                            node.setAttribute('src', this.sanitize(value));
                        }
                        return node;
                    }
                }, {
                    key: 'formats',
                    value: function formats(domNode) {
                        return ATTRIBUTES.reduce(function (formats, attribute) {
                            if (domNode.hasAttribute(attribute)) {
                                formats[attribute] = domNode.getAttribute(attribute);
                            }
                            return formats;
                        }, {});
                    }
                }, {
                    key: 'match',
                    value: function match(url) {
                        return (/\.(jpe?g|gif|png)$/.test(url) || /^data:image\/.+;base64/.test(url)
                        );
                    }
                }, {
                    key: 'sanitize',
                    value: function sanitize(url) {
                        return (0, _link.sanitize)(url, ['http', 'https', 'data']) ? url : '//:0';
                    }
                }, {
                    key: 'value',
                    value: function value(domNode) {
                        return domNode.getAttribute('src');
                    }
                }]);

                return Image;
            }(_parchment2.default.Embed);

            Image.blotName = 'image';
            Image.tagName = 'IMG';

            exports.default = Image;

            /***/ }),
        /* 73 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _block = __webpack_require__(4);

            var _link = __webpack_require__(27);

            var _link2 = _interopRequireDefault(_link);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var ATTRIBUTES = ['height', 'width'];

            var Video = function (_BlockEmbed) {
                _inherits(Video, _BlockEmbed);

                function Video() {
                    _classCallCheck(this, Video);

                    return _possibleConstructorReturn(this, (Video.__proto__ || Object.getPrototypeOf(Video)).apply(this, arguments));
                }

                _createClass(Video, [{
                    key: 'format',
                    value: function format(name, value) {
                        if (ATTRIBUTES.indexOf(name) > -1) {
                            if (value) {
                                this.domNode.setAttribute(name, value);
                            } else {
                                this.domNode.removeAttribute(name);
                            }
                        } else {
                            _get(Video.prototype.__proto__ || Object.getPrototypeOf(Video.prototype), 'format', this).call(this, name, value);
                        }
                    }
                }], [{
                    key: 'create',
                    value: function create(value) {
                        var node = _get(Video.__proto__ || Object.getPrototypeOf(Video), 'create', this).call(this, value);
                        node.setAttribute('frameborder', '0');
                        node.setAttribute('allowfullscreen', true);
                        node.setAttribute('src', this.sanitize(value));
                        return node;
                    }
                }, {
                    key: 'formats',
                    value: function formats(domNode) {
                        return ATTRIBUTES.reduce(function (formats, attribute) {
                            if (domNode.hasAttribute(attribute)) {
                                formats[attribute] = domNode.getAttribute(attribute);
                            }
                            return formats;
                        }, {});
                    }
                }, {
                    key: 'sanitize',
                    value: function sanitize(url) {
                        return _link2.default.sanitize(url);
                    }
                }, {
                    key: 'value',
                    value: function value(domNode) {
                        return domNode.getAttribute('src');
                    }
                }]);

                return Video;
            }(_block.BlockEmbed);

            Video.blotName = 'video';
            Video.className = 'ql-video';
            Video.tagName = 'IFRAME';

            exports.default = Video;

            /***/ }),
        /* 74 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.default = exports.FormulaBlot = undefined;

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _embed = __webpack_require__(35);

            var _embed2 = _interopRequireDefault(_embed);

            var _quill = __webpack_require__(5);

            var _quill2 = _interopRequireDefault(_quill);

            var _module = __webpack_require__(9);

            var _module2 = _interopRequireDefault(_module);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var FormulaBlot = function (_Embed) {
                _inherits(FormulaBlot, _Embed);

                function FormulaBlot() {
                    _classCallCheck(this, FormulaBlot);

                    return _possibleConstructorReturn(this, (FormulaBlot.__proto__ || Object.getPrototypeOf(FormulaBlot)).apply(this, arguments));
                }

                _createClass(FormulaBlot, null, [{
                    key: 'create',
                    value: function create(value) {
                        var node = _get(FormulaBlot.__proto__ || Object.getPrototypeOf(FormulaBlot), 'create', this).call(this, value);
                        if (typeof value === 'string') {
                            window.katex.render(value, node, {
                                throwOnError: false,
                                errorColor: '#f00'
                            });
                            node.setAttribute('data-value', value);
                        }
                        return node;
                    }
                }, {
                    key: 'value',
                    value: function value(domNode) {
                        return domNode.getAttribute('data-value');
                    }
                }]);

                return FormulaBlot;
            }(_embed2.default);

            FormulaBlot.blotName = 'formula';
            FormulaBlot.className = 'ql-formula';
            FormulaBlot.tagName = 'SPAN';

            var Formula = function (_Module) {
                _inherits(Formula, _Module);

                _createClass(Formula, null, [{
                    key: 'register',
                    value: function register() {
                        _quill2.default.register(FormulaBlot, true);
                    }
                }]);

                function Formula() {
                    _classCallCheck(this, Formula);

                    var _this2 = _possibleConstructorReturn(this, (Formula.__proto__ || Object.getPrototypeOf(Formula)).call(this));

                    if (window.katex == null) {
                        throw new Error('Formula module requires KaTeX.');
                    }
                    return _this2;
                }

                return Formula;
            }(_module2.default);

            exports.FormulaBlot = FormulaBlot;
            exports.default = Formula;

            /***/ }),
        /* 75 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.default = exports.CodeToken = exports.CodeBlock = undefined;

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _parchment = __webpack_require__(0);

            var _parchment2 = _interopRequireDefault(_parchment);

            var _quill = __webpack_require__(5);

            var _quill2 = _interopRequireDefault(_quill);

            var _module = __webpack_require__(9);

            var _module2 = _interopRequireDefault(_module);

            var _code = __webpack_require__(13);

            var _code2 = _interopRequireDefault(_code);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var SyntaxCodeBlock = function (_CodeBlock) {
                _inherits(SyntaxCodeBlock, _CodeBlock);

                function SyntaxCodeBlock() {
                    _classCallCheck(this, SyntaxCodeBlock);

                    return _possibleConstructorReturn(this, (SyntaxCodeBlock.__proto__ || Object.getPrototypeOf(SyntaxCodeBlock)).apply(this, arguments));
                }

                _createClass(SyntaxCodeBlock, [{
                    key: 'replaceWith',
                    value: function replaceWith(block) {
                        this.domNode.textContent = this.domNode.textContent;
                        this.attach();
                        _get(SyntaxCodeBlock.prototype.__proto__ || Object.getPrototypeOf(SyntaxCodeBlock.prototype), 'replaceWith', this).call(this, block);
                    }
                }, {
                    key: 'highlight',
                    value: function highlight(_highlight) {
                        var text = this.domNode.textContent;
                        if (this.cachedText !== text) {
                            if (text.trim().length > 0 || this.cachedText == null) {
                                this.domNode.innerHTML = _highlight(text);
                                this.domNode.normalize();
                                this.attach();
                            }
                            this.cachedText = text;
                        }
                    }
                }]);

                return SyntaxCodeBlock;
            }(_code2.default);

            SyntaxCodeBlock.className = 'ql-syntax';

            var CodeToken = new _parchment2.default.Attributor.Class('token', 'hljs', {
                scope: _parchment2.default.Scope.INLINE
            });

            var Syntax = function (_Module) {
                _inherits(Syntax, _Module);

                _createClass(Syntax, null, [{
                    key: 'register',
                    value: function register() {
                        _quill2.default.register(CodeToken, true);
                        _quill2.default.register(SyntaxCodeBlock, true);
                    }
                }]);

                function Syntax(quill, options) {
                    _classCallCheck(this, Syntax);

                    var _this2 = _possibleConstructorReturn(this, (Syntax.__proto__ || Object.getPrototypeOf(Syntax)).call(this, quill, options));

                    if (typeof _this2.options.highlight !== 'function') {
                        throw new Error('Syntax module requires highlight.js. Please include the library on the page before Quill.');
                    }
                    var timer = null;
                    _this2.quill.on(_quill2.default.events.SCROLL_OPTIMIZE, function () {
                        clearTimeout(timer);
                        timer = setTimeout(function () {
                            _this2.highlight();
                            timer = null;
                        }, _this2.options.interval);
                    });
                    _this2.highlight();
                    return _this2;
                }

                _createClass(Syntax, [{
                    key: 'highlight',
                    value: function highlight() {
                        var _this3 = this;

                        if (this.quill.selection.composing) return;
                        this.quill.update(_quill2.default.sources.USER);
                        var range = this.quill.getSelection();
                        this.quill.scroll.descendants(SyntaxCodeBlock).forEach(function (code) {
                            code.highlight(_this3.options.highlight);
                        });
                        this.quill.update(_quill2.default.sources.SILENT);
                        if (range != null) {
                            this.quill.setSelection(range, _quill2.default.sources.SILENT);
                        }
                    }
                }]);

                return Syntax;
            }(_module2.default);

            Syntax.DEFAULTS = {
                highlight: function () {
                    if (window.hljs == null) return null;
                    return function (text) {
                        var result = window.hljs.highlightAuto(text);
                        return result.value;
                    };
                }(),
                interval: 1000
            };

            exports.CodeBlock = SyntaxCodeBlock;
            exports.CodeToken = CodeToken;
            exports.default = Syntax;

            /***/ }),
        /* 76 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <line class=ql-stroke x1=3 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=13 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=9 y1=4 y2=4></line> </svg>";

            /***/ }),
        /* 77 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=14 x2=4 y1=14 y2=14></line> <line class=ql-stroke x1=12 x2=6 y1=4 y2=4></line> </svg>";

            /***/ }),
        /* 78 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=5 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=9 y1=4 y2=4></line> </svg>";

            /***/ }),
        /* 79 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=3 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=3 y1=4 y2=4></line> </svg>";

            /***/ }),
        /* 80 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <g class=\"ql-fill ql-color-label\"> <polygon points=\"6 6.868 6 6 5 6 5 7 5.942 7 6 6.868\"></polygon> <rect height=1 width=1 x=4 y=4></rect> <polygon points=\"6.817 5 6 5 6 6 6.38 6 6.817 5\"></polygon> <rect height=1 width=1 x=2 y=6></rect> <rect height=1 width=1 x=3 y=5></rect> <rect height=1 width=1 x=4 y=7></rect> <polygon points=\"4 11.439 4 11 3 11 3 12 3.755 12 4 11.439\"></polygon> <rect height=1 width=1 x=2 y=12></rect> <rect height=1 width=1 x=2 y=9></rect> <rect height=1 width=1 x=2 y=15></rect> <polygon points=\"4.63 10 4 10 4 11 4.192 11 4.63 10\"></polygon> <rect height=1 width=1 x=3 y=8></rect> <path d=M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z></path> <path d=M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z></path> <path d=M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z></path> <rect height=1 width=1 x=12 y=2></rect> <rect height=1 width=1 x=11 y=3></rect> <path d=M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z></path> <rect height=1 width=1 x=2 y=3></rect> <rect height=1 width=1 x=6 y=2></rect> <rect height=1 width=1 x=3 y=2></rect> <rect height=1 width=1 x=5 y=3></rect> <rect height=1 width=1 x=9 y=2></rect> <rect height=1 width=1 x=15 y=14></rect> <polygon points=\"13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174\"></polygon> <rect height=1 width=1 x=13 y=7></rect> <rect height=1 width=1 x=15 y=5></rect> <rect height=1 width=1 x=14 y=6></rect> <rect height=1 width=1 x=15 y=8></rect> <rect height=1 width=1 x=14 y=9></rect> <path d=M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z></path> <rect height=1 width=1 x=14 y=3></rect> <polygon points=\"12 6.868 12 6 11.62 6 12 6.868\"></polygon> <rect height=1 width=1 x=15 y=2></rect> <rect height=1 width=1 x=12 y=5></rect> <rect height=1 width=1 x=13 y=4></rect> <polygon points=\"12.933 9 13 9 13 8 12.495 8 12.933 9\"></polygon> <rect height=1 width=1 x=9 y=14></rect> <rect height=1 width=1 x=8 y=15></rect> <path d=M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z></path> <rect height=1 width=1 x=5 y=15></rect> <path d=M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z></path> <rect height=1 width=1 x=11 y=15></rect> <path d=M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z></path> <rect height=1 width=1 x=14 y=15></rect> <rect height=1 width=1 x=15 y=11></rect> </g> <polyline class=ql-stroke points=\"5.5 13 9 5 12.5 13\"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=11 y2=11></line> </svg>";

            /***/ }),
        /* 81 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <rect class=\"ql-fill ql-stroke\" height=3 width=3 x=4 y=5></rect> <rect class=\"ql-fill ql-stroke\" height=3 width=3 x=11 y=5></rect> <path class=\"ql-even ql-fill ql-stroke\" d=M7,8c0,4.031-3,5-3,5></path> <path class=\"ql-even ql-fill ql-stroke\" d=M14,8c0,4.031-3,5-3,5></path> </svg>";

            /***/ }),
        /* 82 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <path class=ql-stroke d=M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z></path> <path class=ql-stroke d=M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z></path> </svg>";

            /***/ }),
        /* 83 */
        /***/ (function(module, exports) {

            module.exports = "<svg class=\"\" viewbox=\"0 0 18 18\"> <line class=ql-stroke x1=5 x2=13 y1=3 y2=3></line> <line class=ql-stroke x1=6 x2=9.35 y1=12 y2=3></line> <line class=ql-stroke x1=11 x2=15 y1=11 y2=15></line> <line class=ql-stroke x1=15 x2=11 y1=11 y2=15></line> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=7 x=2 y=14></rect> </svg>";

            /***/ }),
        /* 84 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <line class=\"ql-color-label ql-stroke ql-transparent\" x1=3 x2=15 y1=15 y2=15></line> <polyline class=ql-stroke points=\"5.5 11 9 3 12.5 11\"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=9 y2=9></line> </svg>";

            /***/ }),
        /* 85 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <polygon class=\"ql-stroke ql-fill\" points=\"3 11 5 9 3 7 3 11\"></polygon> <line class=\"ql-stroke ql-fill\" x1=15 x2=11 y1=4 y2=4></line> <path class=ql-fill d=M11,3a3,3,0,0,0,0,6h1V3H11Z></path> <rect class=ql-fill height=11 width=1 x=11 y=4></rect> <rect class=ql-fill height=11 width=1 x=13 y=4></rect> </svg>";

            /***/ }),
        /* 86 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <polygon class=\"ql-stroke ql-fill\" points=\"15 12 13 10 15 8 15 12\"></polygon> <line class=\"ql-stroke ql-fill\" x1=9 x2=5 y1=4 y2=4></line> <path class=ql-fill d=M5,3A3,3,0,0,0,5,9H6V3H5Z></path> <rect class=ql-fill height=11 width=1 x=5 y=4></rect> <rect class=ql-fill height=11 width=1 x=7 y=4></rect> </svg>";

            /***/ }),
        /* 87 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <path class=ql-fill d=M14,16H4a1,1,0,0,1,0-2H14A1,1,0,0,1,14,16Z /> <path class=ql-fill d=M14,4H4A1,1,0,0,1,4,2H14A1,1,0,0,1,14,4Z /> <rect class=ql-fill x=3 y=6 width=12 height=6 rx=1 ry=1 /> </svg>";

            /***/ }),
        /* 88 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <path class=ql-fill d=M13,16H5a1,1,0,0,1,0-2h8A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H5A1,1,0,0,1,5,2h8A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=2 y=6 width=14 height=6 rx=1 ry=1 /> </svg>";

            /***/ }),
        /* 89 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <path class=ql-fill d=M15,8H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,8Z /> <path class=ql-fill d=M15,12H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,12Z /> <path class=ql-fill d=M15,16H5a1,1,0,0,1,0-2H15A1,1,0,0,1,15,16Z /> <path class=ql-fill d=M15,4H5A1,1,0,0,1,5,2H15A1,1,0,0,1,15,4Z /> <rect class=ql-fill x=2 y=6 width=8 height=6 rx=1 ry=1 /> </svg>";

            /***/ }),
        /* 90 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <path class=ql-fill d=M5,8H3A1,1,0,0,1,3,6H5A1,1,0,0,1,5,8Z /> <path class=ql-fill d=M5,12H3a1,1,0,0,1,0-2H5A1,1,0,0,1,5,12Z /> <path class=ql-fill d=M13,16H3a1,1,0,0,1,0-2H13A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H3A1,1,0,0,1,3,2H13A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=8 y=6 width=8 height=6 rx=1 ry=1 transform=\"translate(24 18) rotate(-180)\"/> </svg>";

            /***/ }),
        /* 91 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <path class=ql-fill d=M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z></path> <rect class=ql-fill height=1.6 rx=0.8 ry=0.8 width=5 x=5.15 y=6.2></rect> <path class=ql-fill d=M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z></path> </svg>";

            /***/ }),
        /* 92 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewBox=\"0 0 18 18\"> <path class=ql-fill d=M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z /> </svg>";

            /***/ }),
        /* 93 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewBox=\"0 0 18 18\"> <path class=ql-fill d=M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z /> </svg>";

            /***/ }),
        /* 94 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <line class=ql-stroke x1=7 x2=13 y1=4 y2=4></line> <line class=ql-stroke x1=5 x2=11 y1=14 y2=14></line> <line class=ql-stroke x1=8 x2=10 y1=14 y2=4></line> </svg>";

            /***/ }),
        /* 95 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <rect class=ql-stroke height=10 width=12 x=3 y=4></rect> <circle class=ql-fill cx=6 cy=7 r=1></circle> <polyline class=\"ql-even ql-fill\" points=\"5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12\"></polyline> </svg>";

            /***/ }),
        /* 96 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=\"ql-fill ql-stroke\" points=\"3 7 3 11 5 9 3 7\"></polyline> </svg>";

            /***/ }),
        /* 97 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points=\"5 7 5 11 3 9 5 7\"></polyline> </svg>";

            /***/ }),
        /* 98 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <line class=ql-stroke x1=7 x2=11 y1=7 y2=11></line> <path class=\"ql-even ql-stroke\" d=M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z></path> <path class=\"ql-even ql-stroke\" d=M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z></path> </svg>";

            /***/ }),
        /* 99 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <line class=ql-stroke x1=7 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=7 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=7 x2=15 y1=14 y2=14></line> <line class=\"ql-stroke ql-thin\" x1=2.5 x2=4.5 y1=5.5 y2=5.5></line> <path class=ql-fill d=M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z></path> <path class=\"ql-stroke ql-thin\" d=M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156></path> <path class=\"ql-stroke ql-thin\" d=M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109></path> </svg>";

            /***/ }),
        /* 100 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <line class=ql-stroke x1=6 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=6 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=6 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=3 y1=4 y2=4></line> <line class=ql-stroke x1=3 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=3 y1=14 y2=14></line> </svg>";

            /***/ }),
        /* 101 */
        /***/ (function(module, exports) {

            module.exports = "<svg class=\"\" viewbox=\"0 0 18 18\"> <line class=ql-stroke x1=9 x2=15 y1=4 y2=4></line> <polyline class=ql-stroke points=\"3 4 4 5 6 3\"></polyline> <line class=ql-stroke x1=9 x2=15 y1=14 y2=14></line> <polyline class=ql-stroke points=\"3 14 4 15 6 13\"></polyline> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points=\"3 9 4 10 6 8\"></polyline> </svg>";

            /***/ }),
        /* 102 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <path class=ql-fill d=M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z /> <path class=ql-fill d=M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z /> </svg>";

            /***/ }),
        /* 103 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <path class=ql-fill d=M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z /> <path class=ql-fill d=M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z /> </svg>";

            /***/ }),
        /* 104 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <line class=\"ql-stroke ql-thin\" x1=15.5 x2=2.5 y1=8.5 y2=9.5></line> <path class=ql-fill d=M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z></path> <path class=ql-fill d=M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z></path> </svg>";

            /***/ }),
        /* 105 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <path class=ql-stroke d=M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3></path> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=12 x=3 y=15></rect> </svg>";

            /***/ }),
        /* 106 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <rect class=ql-stroke height=12 width=12 x=3 y=3></rect> <rect class=ql-fill height=12 width=1 x=5 y=3></rect> <rect class=ql-fill height=12 width=1 x=12 y=3></rect> <rect class=ql-fill height=2 width=8 x=5 y=8></rect> <rect class=ql-fill height=1 width=3 x=3 y=5></rect> <rect class=ql-fill height=1 width=3 x=3 y=7></rect> <rect class=ql-fill height=1 width=3 x=3 y=10></rect> <rect class=ql-fill height=1 width=3 x=3 y=12></rect> <rect class=ql-fill height=1 width=3 x=12 y=5></rect> <rect class=ql-fill height=1 width=3 x=12 y=7></rect> <rect class=ql-fill height=1 width=3 x=12 y=10></rect> <rect class=ql-fill height=1 width=3 x=12 y=12></rect> </svg>";

            /***/ }),
        /* 107 */
        /***/ (function(module, exports) {

            module.exports = "<svg viewbox=\"0 0 18 18\"> <polygon class=ql-stroke points=\"7 11 9 13 11 11 7 11\"></polygon> <polygon class=ql-stroke points=\"7 7 9 5 11 7 7 7\"></polygon> </svg>";

            /***/ }),
        /* 108 */
        /***/ (function(module, exports, __webpack_require__) {

            "use strict";


            Object.defineProperty(exports, "__esModule", {
                value: true
            });
            exports.default = exports.BubbleTooltip = undefined;

            var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

            var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

            var _extend = __webpack_require__(3);

            var _extend2 = _interopRequireDefault(_extend);

            var _emitter = __webpack_require__(8);

            var _emitter2 = _interopRequireDefault(_emitter);

            var _base = __webpack_require__(43);

            var _base2 = _interopRequireDefault(_base);

            var _selection = __webpack_require__(15);

            var _icons = __webpack_require__(41);

            var _icons2 = _interopRequireDefault(_icons);

            function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

            function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

            function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

            function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

            var TOOLBAR_CONFIG = [['bold', 'italic', 'link'], [{ header: 1 }, { header: 2 }, 'blockquote']];

            var BubbleTheme = function (_BaseTheme) {
                _inherits(BubbleTheme, _BaseTheme);

                function BubbleTheme(quill, options) {
                    _classCallCheck(this, BubbleTheme);

                    if (options.modules.toolbar != null && options.modules.toolbar.container == null) {
                        options.modules.toolbar.container = TOOLBAR_CONFIG;
                    }

                    var _this = _possibleConstructorReturn(this, (BubbleTheme.__proto__ || Object.getPrototypeOf(BubbleTheme)).call(this, quill, options));

                    _this.quill.container.classList.add('ql-bubble');
                    return _this;
                }

                _createClass(BubbleTheme, [{
                    key: 'extendToolbar',
                    value: function extendToolbar(toolbar) {
                        this.tooltip = new BubbleTooltip(this.quill, this.options.bounds);
                        this.tooltip.root.appendChild(toolbar.container);
                        this.buildButtons([].slice.call(toolbar.container.querySelectorAll('button')), _icons2.default);
                        this.buildPickers([].slice.call(toolbar.container.querySelectorAll('select')), _icons2.default);
                    }
                }]);

                return BubbleTheme;
            }(_base2.default);

            BubbleTheme.DEFAULTS = (0, _extend2.default)(true, {}, _base2.default.DEFAULTS, {
                modules: {
                    toolbar: {
                        handlers: {
                            link: function link(value) {
                                if (!value) {
                                    this.quill.format('link', false);
                                } else {
                                    this.quill.theme.tooltip.edit();
                                }
                            }
                        }
                    }
                }
            });

            var BubbleTooltip = function (_BaseTooltip) {
                _inherits(BubbleTooltip, _BaseTooltip);

                function BubbleTooltip(quill, bounds) {
                    _classCallCheck(this, BubbleTooltip);

                    var _this2 = _possibleConstructorReturn(this, (BubbleTooltip.__proto__ || Object.getPrototypeOf(BubbleTooltip)).call(this, quill, bounds));

                    _this2.quill.on(_emitter2.default.events.EDITOR_CHANGE, function (type, range, oldRange, source) {
                        if (type !== _emitter2.default.events.SELECTION_CHANGE) return;
                        if (range != null && range.length > 0 && source === _emitter2.default.sources.USER) {
                            _this2.show();
                            // Lock our width so we will expand beyond our offsetParent boundaries
                            _this2.root.style.left = '0px';
                            _this2.root.style.width = '';
                            _this2.root.style.width = _this2.root.offsetWidth + 'px';
                            var lines = _this2.quill.getLines(range.index, range.length);
                            if (lines.length === 1) {
                                _this2.position(_this2.quill.getBounds(range));
                            } else {
                                var lastLine = lines[lines.length - 1];
                                var index = _this2.quill.getIndex(lastLine);
                                var length = Math.min(lastLine.length() - 1, range.index + range.length - index);
                                var _bounds = _this2.quill.getBounds(new _selection.Range(index, length));
                                _this2.position(_bounds);
                            }
                        } else if (document.activeElement !== _this2.textbox && _this2.quill.hasFocus()) {
                            _this2.hide();
                        }
                    });
                    return _this2;
                }

                _createClass(BubbleTooltip, [{
                    key: 'listen',
                    value: function listen() {
                        var _this3 = this;

                        _get(BubbleTooltip.prototype.__proto__ || Object.getPrototypeOf(BubbleTooltip.prototype), 'listen', this).call(this);
                        this.root.querySelector('.ql-close').addEventListener('click', function () {
                            _this3.root.classList.remove('ql-editing');
                        });
                        this.quill.on(_emitter2.default.events.SCROLL_OPTIMIZE, function () {
                            // Let selection be restored by toolbar handlers before repositioning
                            setTimeout(function () {
                                if (_this3.root.classList.contains('ql-hidden')) return;
                                var range = _this3.quill.getSelection();
                                if (range != null) {
                                    _this3.position(_this3.quill.getBounds(range));
                                }
                            }, 1);
                        });
                    }
                }, {
                    key: 'cancel',
                    value: function cancel() {
                        this.show();
                    }
                }, {
                    key: 'position',
                    value: function position(reference) {
                        var shift = _get(BubbleTooltip.prototype.__proto__ || Object.getPrototypeOf(BubbleTooltip.prototype), 'position', this).call(this, reference);
                        var arrow = this.root.querySelector('.ql-tooltip-arrow');
                        arrow.style.marginLeft = '';
                        if (shift === 0) return shift;
                        arrow.style.marginLeft = -1 * shift - arrow.offsetWidth / 2 + 'px';
                    }
                }]);

                return BubbleTooltip;
            }(_base.BaseTooltip);

            BubbleTooltip.TEMPLATE = ['<span class="ql-tooltip-arrow"></span>', '<div class="ql-tooltip-editor">', '<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">', '<a class="ql-close"></a>', '</div>'].join('');

            exports.BubbleTooltip = BubbleTooltip;
            exports.default = BubbleTheme;

            /***/ }),
        /* 109 */
        /***/ (function(module, exports, __webpack_require__) {

            module.exports = __webpack_require__(63);


            /***/ })
        /******/ ])["default"];
});
$(document).ready(function() {

    const $menuCreateRowBtn = $('[js-create-row]');
    const $menuCreateRowCloseBtn = $('[js-menu-create-row-close-btn]');
    const $menuCreateRow = $('[js-menu-create-row]');

    const $saveRowBtn = $('[js-save-row]');
    const $createRowForm = $('[js-row-form]');

    $menuCreateRowBtn.on('click', function () {
        $menuCreateRow.addClass('is-open');
        checkBodyHidden()
    });

    $menuCreateRowCloseBtn.on('click', function() {
        $menuCreateRow.removeClass('is-open');
        $createRowForm.trigger('reset');
        checkBodyHidden()
    });

    $saveRowBtn.on('click', function(event) {
        event.preventDefault();
        $createRowForm.trigger('submit');
    });

    $createRowForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var data = $createRowForm.serializeObject();
            saveRow(data);
        }
    });

    initDeleteRowFromList();
    initDatePicker();
});
function saveRow(rowData) {
    $('[js-save-row]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveRow",
        data: JSON.stringify(rowData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            addRowToFrontList(data);
            $('[js-menu-create-row]').removeClass('is-open');
            checkBodyHidden();
            $('[js-row-form]').trigger('reset');
            $('[js-save-row]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-row]').prop("disabled", false);
        }
    });
}
function addRowToFrontList(data) {
    $('[table-body]').html(
        '<tr class="custom-table__body-row">' +
        '<td class="custom-table__body-col"></td>' +
        '<td class="custom-table__body-col">' + data.date + '</td>' +
        '                        <td class="custom-table__body-col">' + data.count + '</td>' +
        '                        <td class="custom-table__body-col">' + data.course + '</td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_last">' +
        '                            <div edit-menu class="column-links display-flex-none is-open">' +
        '                                <form delete-row-form class="column-form" action="#">' +
        '                                    <input type="hidden" value="' + data.id + '" name="id" required>' +
        '                                    <button delete-row type="button" class="column_mwidth column_mwidth-delete"></button>' +
        '                                </form>' +
        '                            </div>' +
        '                        </td>' +
        '                    </tr>'
        + $('[table-body]').html()
    );
    initDeleteRowFromList();
}
function initDatePicker() {
    $('.datepicker-here-cs').datepicker({
        autoClose: true
    });
}

var CURRENT_ROW = {};
//активация формы удаления
function initDeleteRowFromList() {
    $('[delete-row]').on('click', function (event) {
        event.preventDefault();
        CURRENT_ROW = $(this);
        $(this).closest('[delete-row-form]').trigger('submit');
    });

    $('[delete-row-form]').submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var formData = $(this).serializeObject();
            deleteRowFromList(formData);
        }
    });
}
function deleteRowFromList(formData) {
    $('[delete-row]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "deleteRow",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            CURRENT_ROW.closest('.custom-table__body-row').remove();
            $('[delete-row]').prop("disabled", false);
        },
        error: function (data) {
            $('[delete-row]').prop("disabled", false);
        }
    });
}
$(document).on('click', '.datepicker-here', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).ready(function() {

    const $menuCreateCheckBtn = $('[js-create-check]');
    const $menuCreateCheckCloseBtn = $('[js-menu-create-check-close-btn]');
    const $menuCreateCheck = $('[js-menu-create-check]');

    const $saveCheckBtn = $('[js-save-check]');
    const $createCheckForm = $('[js-check-form]');

    $menuCreateCheckBtn.on('click', function () {
        $menuCreateCheck.addClass('is-open');
        checkBodyHidden()
    });

    $menuCreateCheckCloseBtn.on('click', function() {
        $menuCreateCheck.removeClass('is-open');
        $createCheckForm.trigger('reset');
        checkBodyHidden()
    });

    $saveCheckBtn.on('click', function(event) {
        event.preventDefault();
        $createCheckForm.trigger('submit');
    });

    $createCheckForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var checkData = $createCheckForm.serializeObject();
            createCheck(checkData);
        }
    });

    initDatePicker();
});

function createCheck(checkData) {
    $('[js-save-check]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveCheck",
        data: JSON.stringify(checkData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            addRowToTable(data);
            $('[js-menu-create-check]').removeClass('is-open');
            checkBodyHidden();
            $('[js-check-form]').trigger('reset');
            $('[js-save-check]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-check]').prop("disabled", false);
        }
    });
}
function addRowToTable(smsCheck) {
    $('[table-body]').html(
        '<tr class="custom-table__body-row">' +
        '  <input type="hidden" s-id value="' + smsCheck.id + '" name="id" required>' +
        '     <td class="custom-table__body-col">' + smsCheck.id + '</td>' +
        '     <td class="custom-table__body-col custom-table__body-col_medium">' +
        '        <input s-date' +
        '           data-position="top left"' +
        '           name="date"' +
        '           class="datepicker-here menu-input__input menu-input__input_small editable"' +
        '           autocomplete="off"' +
        '           value="' + smsCheck.date + '"' +
        '           disabled' +
        '           data-autoclose="true"' +
        '           placeholder="—"' +
        '           required>' +
        '     </td>' +
        '     <td class="custom-table__body-col custom-table__body-col_full" >' +
        '        <input s-text name="text"' +
        '            class="menu-input__input menu-input__input_small editable"' +
        '           title="' + smsCheck.text + '"' +
        '           value="' + smsCheck.text + '"' +
        '           disabled' +
        '           placeholder="—"' +
        '           required>' +
        '     </td>' +
        '     <td class="custom-table__body-col custom-table__body-col_medium">' +
        '        <div class="indicated-select menu-input__wrapper indicated-select_false">' +
        '           <div class="menu-input__input menu-input__input_xxsmall menu-input__input_white">Не забран</div>' +
        '       </div>' +
        '     </td>' +
        '     <td class="custom-table__body-col custom-table__body-col_last">' +
        '         <div edit-btns class="column-links display-flex-none">' +
        '             <div edit-check-accept class="column_mwidth column_mwidth-accept"></div>' +
        '             <div edit-check-cancel class="column_mwidth column_mwidth-cancel"></div>' +
        '         </div>' +
        '         <div edit-menu class="column-links display-flex-none is-open">' +
        '             <div edit-check class="column_mwidth div-table__body-col_center column_mwidth-edit column_mwidth-edit-b"></div>' +
        '         </div>' +
        '     </td>' +
        ' </tr>'
        + $('[table-body]').html()
    );

    initDatePicker();
}

function initDatePicker() {
    $('.datepicker-here-sc').datepicker({
        autoClose: true,
        todayButton: true
    });
}

//активация редактирования формы
var CHECKS_INFO_TEMP = {};
$(document).on('click', '[edit-check]', function(event) {
    event.preventDefault();
    $(this).closest('[edit-menu]').removeClass('is-open').siblings('[edit-btns]').addClass('is-open');
    var list = {};

    var date = $(this).closest('.custom-table__body-row').find('[s-date]');
    date.removeAttr('disabled');
    list['date'] = date.val();

    var text = $(this).closest('.custom-table__body-row').find('[s-text]');
    text.removeAttr('disabled');
    list['text'] = text.val();

    $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
    CHECKS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[s-id]').val()] = list;
});
$(document).on('click', '[edit-check-cancel]', function(event) {
    event.preventDefault();
    var values = CHECKS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[s-id]').val()];

    $(this).closest('.custom-table__body-row').find('[s-date]').val(values.date).attr("disabled", true);
    $(this).closest('.custom-table__body-row').find('[s-text]').val(values.text).attr("disabled", true);

    $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
    delete CHECKS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[s-id]').val()];
});

var CHECKS_ACCEPT_BTN;
$(document).on('click', '[edit-check-accept]', function(event) {
    event.preventDefault();
    CHECKS_ACCEPT_BTN = $(this);

    var checkData = new Object();
    checkData.id = $(this).closest('.custom-table__body-row').find('[s-id]').val();
    checkData.date = $(this).closest('.custom-table__body-row').find('[s-date]').val();
    checkData.text = $(this).closest('.custom-table__body-row').find('[s-text]').val();


    $('[edit-check-accept]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/sms-checks/update",
        data: JSON.stringify(checkData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            CHECKS_ACCEPT_BTN.closest('.custom-table__body-row').find('[s-date]').val(checkData.date).attr("disabled", true);
            CHECKS_ACCEPT_BTN.closest('.custom-table__body-row').find('[s-text]').val(checkData.text).attr("disabled", true);

            CHECKS_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
            delete CHECKS_INFO_TEMP[checkData.id];

            $('[edit-check-accept]').prop("disabled", false);
        },
        error: function (data) {
            var values = CHECKS_INFO_TEMP[checkData.id];

            CHECKS_ACCEPT_BTN.closest('.custom-table__body-row').find('[s-text]').val(values.text).attr("disabled", true);
            CHECKS_ACCEPT_BTN.closest('.custom-table__body-row').find('[s-date]').val(values.date).attr("disabled", true);

            CHECKS_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');

            delete CHECKS_INFO_TEMP[checkData.id];
            $('[edit-check-accept]').prop("disabled", false);
        }
    });
});

$(document).on('click', '[delete-check]', function(event) {

    var row = $(this).closest('.custom-table__body-row');
    var checkData = new Object();
    checkData.id = row.find('[s-id]').val();

    $('[delete-check]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/sms-checks/delete",
        data: JSON.stringify(checkData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            row.remove();
            $('[delete-check]').prop("disabled", false);
        },
        error: function (data) {
            $('[delete-check]').prop("disabled", false);
        }
    });
});
$(document).on('keyup', '[js-sms-checks-search]', function(event){
    var $v = $(this).val().toLowerCase();

    $('[sms-check-row]').each(function () {
        if (!(~$(this).find('[sms-check-text]').text().toLowerCase().indexOf($v))) {
            $(this).addClass('none');
        } else {
            $(this).removeClass('none');
        }
    })
});

$(document).on('click', '[sms-check-row]', function(event){
    $(this).find('input[type=radio]').prop("checked", true);
    $('[sms-check-row]').removeClass('div-table__row_selected');
    $(this).addClass('div-table__row_selected');
});

$(document).on('click', '[js-delete-sms-check]', function(event){
    var button = $(this);
    var idBill = button.closest('[data-bill-id]').attr('data-bill-id');

    $('[js-delete-sms-check]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/sms-checks/untieSmsCheck",
        data: JSON.stringify(idBill),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-delete-sms-check]').prop("disabled", false);
            updateSmsCheckButton(idBill, '');
        },
        error: function (data) {
            $('[js-delete-sms-check]').prop("disabled", false);
        }
    });
});

// var SMS_CHECK_BUTTON = {};
$(document).on('click', '[js-add-sms-check]', function(event){
    var button = $(this);
    // SMS_CHECK_BUTTON  = $(this);
    var idBill = button.closest('[data-bill-id]').attr('data-bill-id');

    $('[js-add-sms-check]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/sms-checks/getUnusedSmsChecks",
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-sms-checks-list-form]').find('[js-id-bill]').val(idBill);
            openSmsChecksMenu(data);
            $('[js-add-sms-check]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-sms-check]').prop("disabled", false);
        }
    });
});


$(document).on('click', '[js-select-sms-check]', function(event){
    event.preventDefault();
    $('[js-sms-checks-list-form]').trigger('submit');
});
$(document).on('submit', '[js-sms-checks-list-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var checkData = $('[js-sms-checks-list-form]').serializeObject();
        tieSmsCheck(checkData);
    }
});

$(document).ready(function() {
    const $menuSmsCheckListCloseBtn = $('[js-menu-sms-checks-list-close-btn]');
    const $menuSmsCheckList= $('[js-menu-sms-checks-list]');

    $menuSmsCheckListCloseBtn.on('click', function() {
        $menuSmsCheckList.removeClass('is-open');
        resetSmsCheckListForm();
        checkBodyHidden()
    });
});

function tieSmsCheck(checkData) {
    $('[js-select-sms-check]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/sms-checks/tieSmsCheck",
        data: JSON.stringify(checkData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-select-sms-check]').prop("disabled", false);
            updateSmsCheckButton(data.idBill, data.text);
            $('[js-menu-sms-checks-list]').removeClass('is-open');
            resetSmsCheckListForm();
            checkBodyHidden()
        },
        error: function (data) {
            $('[js-select-sms-check]').prop("disabled", false);
        }
    });
}

function resetSmsCheckListForm() {
    $('[js-sms-checks-list-form]').trigger('reset');
    $('[sms-checks-list]').html('');
    $('[js-select-sms-check-btn]').attr("js-select-sms-check", "");
}
function openSmsChecksMenu(data) {
    var rows = "";

    if (data.length === 0) {
        $('[js-select-sms-check-btn]').removeAttr("js-select-sms-check");
    }

    $.each(data, function(index, value) {
        rows += '<div sms-check-row class="div-table__row">' +
            '       <div class="div-table__row-wrapper">' +
            '           <div class="div-table__body-row">' +
            '               <div class="div-table__body-col div-table__body-col_exsmall">' +
            '                    <div class="input-element__radio ">' +
            '                         <input type="radio" id="' + value.id + '" class="radio radio_circle" name="id" value="' + value.id + '" required>' +
            '                         <label for="' + value.id + '" class="circle "></label>' +
            '                   </div>' +
            '              </div>' +
            '              <div class="div-table__body-col div-table__body-col_small">' + value.date + '</div>' +
            '              <div sms-check-text class="div-table__body-col div-table__body-col_full">' + value.text + '</div>' +
            '          </div>' +
            '      </div>' +
            '</div>'
    });

    $('[sms-checks-list]').html(rows);
    $('[js-menu-sms-checks-list]').addClass('is-open');
    checkBodyHidden();
}

function updateSmsCheckButton(idBill, comment) {
    var button = $('[data-bill-id="' + idBill + '"]').find('[js-check-btn]');

    var attr = button.attr('js-delete-sms-check');
    if (typeof attr !== typeof undefined && attr !== false) {
        button.removeAttr("js-delete-sms-check").removeAttr("title").removeClass('column_mwidth-delete-check')
            .attr("js-add-sms-check",'').addClass('column_mwidth-add-check');
    } else {
        button.removeAttr('js-add-sms-check').removeClass('column_mwidth-add-check')
            .attr("js-delete-sms-check",'').attr("title", comment).addClass('column_mwidth-delete-check');
    }
}
/* global window, exports, define */

!function() {
    'use strict'

    var re = {
        not_string: /[^s]/,
        not_bool: /[^t]/,
        not_type: /[^T]/,
        not_primitive: /[^v]/,
        number: /[diefg]/,
        numeric_arg: /[bcdiefguxX]/,
        json: /[j]/,
        not_json: /[^j]/,
        text: /^[^\x25]+/,
        modulo: /^\x25{2}/,
        placeholder: /^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,
        key: /^([a-z_][a-z_\d]*)/i,
        key_access: /^\.([a-z_][a-z_\d]*)/i,
        index_access: /^\[(\d+)\]/,
        sign: /^[+-]/
    }

    function sprintf(key) {
        // `arguments` is not an array, but should be fine for this call
        return sprintf_format(sprintf_parse(key), arguments)
    }

    function vsprintf(fmt, argv) {
        return sprintf.apply(null, [fmt].concat(argv || []))
    }

    function sprintf_format(parse_tree, argv) {
        var cursor = 1, tree_length = parse_tree.length, arg, output = '', i, k, ph, pad, pad_character, pad_length, is_positive, sign
        for (i = 0; i < tree_length; i++) {
            if (typeof parse_tree[i] === 'string') {
                output += parse_tree[i]
            }
            else if (typeof parse_tree[i] === 'object') {
                ph = parse_tree[i] // convenience purposes only
                if (ph.keys) { // keyword argument
                    arg = argv[cursor]
                    for (k = 0; k < ph.keys.length; k++) {
                        if (arg == undefined) {
                            throw new Error(sprintf('[sprintf] Cannot access property "%s" of undefined value "%s"', ph.keys[k], ph.keys[k-1]))
                        }
                        arg = arg[ph.keys[k]]
                    }
                }
                else if (ph.param_no) { // positional argument (explicit)
                    arg = argv[ph.param_no]
                }
                else { // positional argument (implicit)
                    arg = argv[cursor++]
                }

                if (re.not_type.test(ph.type) && re.not_primitive.test(ph.type) && arg instanceof Function) {
                    arg = arg()
                }

                if (re.numeric_arg.test(ph.type) && (typeof arg !== 'number' && isNaN(arg))) {
                    throw new TypeError(sprintf('[sprintf] expecting number but found %T', arg))
                }

                if (re.number.test(ph.type)) {
                    is_positive = arg >= 0
                }

                switch (ph.type) {
                    case 'b':
                        arg = parseInt(arg, 10).toString(2)
                        break
                    case 'c':
                        arg = String.fromCharCode(parseInt(arg, 10))
                        break
                    case 'd':
                    case 'i':
                        arg = parseInt(arg, 10)
                        break
                    case 'j':
                        arg = JSON.stringify(arg, null, ph.width ? parseInt(ph.width) : 0)
                        break
                    case 'e':
                        arg = ph.precision ? parseFloat(arg).toExponential(ph.precision) : parseFloat(arg).toExponential()
                        break
                    case 'f':
                        arg = ph.precision ? parseFloat(arg).toFixed(ph.precision) : parseFloat(arg)
                        break
                    case 'g':
                        arg = ph.precision ? String(Number(arg.toPrecision(ph.precision))) : parseFloat(arg)
                        break
                    case 'o':
                        arg = (parseInt(arg, 10) >>> 0).toString(8)
                        break
                    case 's':
                        arg = String(arg)
                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)
                        break
                    case 't':
                        arg = String(!!arg)
                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)
                        break
                    case 'T':
                        arg = Object.prototype.toString.call(arg).slice(8, -1).toLowerCase()
                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)
                        break
                    case 'u':
                        arg = parseInt(arg, 10) >>> 0
                        break
                    case 'v':
                        arg = arg.valueOf()
                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)
                        break
                    case 'x':
                        arg = (parseInt(arg, 10) >>> 0).toString(16)
                        break
                    case 'X':
                        arg = (parseInt(arg, 10) >>> 0).toString(16).toUpperCase()
                        break
                }
                if (re.json.test(ph.type)) {
                    output += arg
                }
                else {
                    if (re.number.test(ph.type) && (!is_positive || ph.sign)) {
                        sign = is_positive ? '+' : '-'
                        arg = arg.toString().replace(re.sign, '')
                    }
                    else {
                        sign = ''
                    }
                    pad_character = ph.pad_char ? ph.pad_char === '0' ? '0' : ph.pad_char.charAt(1) : ' '
                    pad_length = ph.width - (sign + arg).length
                    pad = ph.width ? (pad_length > 0 ? pad_character.repeat(pad_length) : '') : ''
                    output += ph.align ? sign + arg + pad : (pad_character === '0' ? sign + pad + arg : pad + sign + arg)
                }
            }
        }
        return output
    }

    var sprintf_cache = Object.create(null)

    function sprintf_parse(fmt) {
        if (sprintf_cache[fmt]) {
            return sprintf_cache[fmt]
        }

        var _fmt = fmt, match, parse_tree = [], arg_names = 0
        while (_fmt) {
            if ((match = re.text.exec(_fmt)) !== null) {
                parse_tree.push(match[0])
            }
            else if ((match = re.modulo.exec(_fmt)) !== null) {
                parse_tree.push('%')
            }
            else if ((match = re.placeholder.exec(_fmt)) !== null) {
                if (match[2]) {
                    arg_names |= 1
                    var field_list = [], replacement_field = match[2], field_match = []
                    if ((field_match = re.key.exec(replacement_field)) !== null) {
                        field_list.push(field_match[1])
                        while ((replacement_field = replacement_field.substring(field_match[0].length)) !== '') {
                            if ((field_match = re.key_access.exec(replacement_field)) !== null) {
                                field_list.push(field_match[1])
                            }
                            else if ((field_match = re.index_access.exec(replacement_field)) !== null) {
                                field_list.push(field_match[1])
                            }
                            else {
                                throw new SyntaxError('[sprintf] failed to parse named argument key')
                            }
                        }
                    }
                    else {
                        throw new SyntaxError('[sprintf] failed to parse named argument key')
                    }
                    match[2] = field_list
                }
                else {
                    arg_names |= 2
                }
                if (arg_names === 3) {
                    throw new Error('[sprintf] mixing positional and named placeholders is not (yet) supported')
                }

                parse_tree.push(
                    {
                        placeholder: match[0],
                        param_no:    match[1],
                        keys:        match[2],
                        sign:        match[3],
                        pad_char:    match[4],
                        align:       match[5],
                        width:       match[6],
                        precision:   match[7],
                        type:        match[8]
                    }
                )
            }
            else {
                throw new SyntaxError('[sprintf] unexpected placeholder')
            }
            _fmt = _fmt.substring(match[0].length)
        }
        return sprintf_cache[fmt] = parse_tree
    }

    /**
     * export to either browser or node.js
     */
    /* eslint-disable quote-props */
    if (typeof exports !== 'undefined') {
        exports['sprintf'] = sprintf
        exports['vsprintf'] = vsprintf
    }
    if (typeof window !== 'undefined') {
        window['sprintf'] = sprintf
        window['vsprintf'] = vsprintf

        if (typeof define === 'function' && define['amd']) {
            define(function() {
                return {
                    'sprintf': sprintf,
                    'vsprintf': vsprintf
                }
            })
        }
    }
    /* eslint-enable quote-props */
}(); // eslint-disable-line

$(document).on('change', '[s-filter]', function() {
    $('[s-filter-form]').trigger('submit');
});
$(document).on('click', '.datepicker-here', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).on('click', '.datepicker-here-start', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});

var $coursesMap;
function setCoursesMap(coursesMap) {
    $coursesMap = coursesMap;
}

var $projects;
function setProjectsList(projects) {
    $projects = projects;
}

$(document).ready(function() {
    initTimePicker();

    $('.datepicker-here-start').datepicker({
        autoClose: true,
        minDate: new Date(),
        todayButton: true
    });

    $('.datepicker-here').datepicker({
        autoClose: true,
        todayButton: true
    });
});

function initTimePicker() {
    $('.only-time').datepicker({
        dateFormat: ' ',
        timepicker: true,
        classes: 'only-timepicker'
    });
}

$(document).on('click', '[add-streams]', function(event){
    resetAddStreamsMenu();

    $('[add-streams-project]').trigger('change');

    $('[js-menu-add-streams]').addClass('is-open');
    checkBodyHidden();
});
$(document).on('click', '[js-menu-add-streams-close-btn]', function(event){
    $('[js-menu-add-streams]').removeClass('is-open');
    checkBodyHidden();
});
function resetAddStreamsMenu() {
    $('[js-add-streams-form]').trigger('reset');
}

$(document).on('change', '[projects]', function() {
    var projectsBlock = $(this);
    resetCourses(projectsBlock);
    setCourses(projectsBlock);
});
function setCourses(block) {
    var seloption = "";
    $.each($coursesMap[$('option:selected', block).val()], function(index, value){
        seloption += '<option value="' + value.id + '">' + value.name + '</option>';
    });

    var coursesBlock =  block.closest('[block-wrapper]').find('[courses]');
    coursesBlock.html(coursesBlock.html() + seloption);
}

function resetCourses(block) {
    block.closest('[block-wrapper]').find('[courses]').html('<option value="" disabled>Выберите продукт</option>');
}

$(document).on('click', '[js-add-streams]', function(event){
    event.preventDefault();
    $('[js-add-streams-form]').trigger('submit');
});

$(document).on('submit', '[js-add-streams-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-add-streams-form]')[0]);
        saveStreams(formData);
    }
});

function saveStreams(formData) {
    $('[js-add-streams]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveStreams",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $.each(data, function(index, streams){
                var list = '';
                $.each(streams, function(index2, stream){
                    list += '<div class="calendar-stream ' + (stream.isStarted ? 'calendar-stream_started' : '') + '"><span>' + stream.nameCourse + '</span></div>';
                });

                $('[data-date="' + index + '"]').find('[stream-list]').html('' +
                    '<div class="calendar-streams c-tooltip">' +
                    '   <div class="c-tooltip__wrapper c-tooltip__wrapper_right">' +
                    '   ' + list +
                    '   </div>' +
                    '   <div class="calendar-stream calendar-stream_hover"><span>' + streams.length + ' потоков</span></div>' +
                    '</div>');
            });

            $('[js-menu-add-streams]').removeClass('is-open');
            checkBodyHidden();
            $('[js-add-streams]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-streams]').prop("disabled", false);
        }
    });
}


$(document).on('click', '[edit-streams]', function(event){
    resetUpdateStreamsMenu();

    var formData = new FormData();
    formData.append('startDate', $(this).data('date'));

    openEditStreamsMenu(formData);
});
$(document).on('click', '[js-menu-update-streams-close-btn]', function(event){
    $('[js-menu-update-streams]').removeClass('is-open');
    checkBodyHidden();
});
function resetUpdateStreamsMenu() {
    $('[u-date]').html('');
    $('[u-start-list]').html('');
    DELETE_STARTS_LIST = [];
}

var STREAM_COUNTER = 0;
function openEditStreamsMenu(formData) {
    $('[edit-streams]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getStreamsByDate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[u-date]').html(data.startDate);
            $('[update-start-date]').val(data.startDate);

            var seloption = "";
            $.each($projects, function(index, value){
                seloption += '<option value="' + value.id + '">' + value.name + '</option>';
            });

            var streamList = $('[u-start-list]');
            var projectBlock;

            STREAM_COUNTER = data.streams.length;
            $.each(data.streams, function(index, stream){
                streamList.append(
                    (stream.dealsCounter === 0
                        ? '<div class="collapse-block__header collapsed" data-toggle="collapse" data-target="#stream' + stream.id  + '" aria-expanded="false" aria-controls="stream' + stream.id  + '">'
                        : '<div class="collapse-block__header collapse-block__header_hidden">') +
                    '    <div class="collapse-desc">' +
                    '        <div class="collapse-desc__title">' + stream.nameCourse + '</div>' +
                    '            <div class="collapse-desc__wrapper">' +
                    '                <div class="collapse-desc__text">' + stream.nameProject + '</div>' +
                    '                <div class="collapse-desc__delim"><span></span></div>' +
                    '                <div class="collapse-desc__text">№ потока  <span>' + stream.id  + '</span></div>' +
                    '                <div class="collapse-desc__delim"><span></span></div>' +
                    '                <div class="collapse-desc__text">Учеников  <span>' + stream.dealsCounter  + '</span></div>' +
                    '            </div>' +
                    '        </div>' +
                            (stream.dealsCounter === 0 ? '<div delete-start data-id="' + stream.id  + '" class="collapse-delete"></div>' : '') +
                    '</div>' +
                    (stream.dealsCounter === 0
                        ? '    <div class="collapse-block__body collapse" id="stream' + stream.id  + '">' +
                        '       <input type="hidden" name="streams[' + index + '].id" value="' + stream.id + '">' +
                        '        <div block-wrapper class="collapse-body">' +
                        '            <div class="menu-input menu-input_xsmall menu-input_t20">' +
                        '                 <div class="menu-input__title">Проект *</div>' +
                        '                 <div class="menu-input__wrapper menu-input__wrapper_select">' +
                        '                           <select projects class="menu-input__input menu-input__input_small menu-input__input_select" required>' +
                            seloption +
                        '                           </select>' +
                        '                 </div>' +
                        '             </div>' +
                        '             <div class="menu-input menu-input_xsmall">' +
                        '                 <div class="menu-input__title">Продукт *</div>' +
                        '                 <div class="menu-input__wrapper menu-input__wrapper_select">' +
                        '                     <select courses name="streams[' + index + '].idCourse" class="menu-input__input menu-input__input_small menu-input__input_select" required>' +
                        '                         <option value="" disabled>Выберите продукт</option>' +
                        '                     </select>' +
                        '                 </div>' +
                        '              </div>' +
                        '              <div class="menu-input menu-input_xsmall">' +
                        '                  <div class="menu-input__title">Время старта *</div>' +
                        '                  <div class="menu-input__wrapper menu-input__wrapper_cal">' +
                        '                      <input value="' + stream.startTime + '" name="streams[' + index + '].startTime" autocomplete="off" class="only-time menu-input__input menu-input__input_small" placeholder="Выберите время" required/>' +
                        '                  </div>' +
                        '              </div>' +
                        '           </div>' +
                        '        </div>'
                        : '')
                    );

                projectBlock = $("#stream" + stream.id).find('[projects]');
                projectBlock.val(stream.idProject);

                setCourses(projectBlock);

                $("#stream" + stream.id).find('[courses]').val(stream.idCourse);
            });

            initTimePicker();

            $('[js-menu-update-streams]').addClass('is-open');
            checkBodyHidden();
            $('[edit-streams]').prop("disabled", false);
        },
        error: function (data) {
            $('[edit-streams]').prop("disabled", false);
        }
    });
}



$(document).on('click', '[add-start]', function(event){
    var seloption = "";
    $.each($projects, function(index, value){
        seloption += '<option value="' + value.id + '">' + value.name + '</option>';
    });

    $('[u-start-list]').append(
        '<div class="collapse-block__header" data-toggle="collapse" data-target="#new' + STREAM_COUNTER  + '" aria-expanded="true" aria-controls="new' + STREAM_COUNTER  + '">' +
        '    <div class="collapse-desc">' +
        '        <div class="collapse-desc__title">Новый поток</div>' +
        '        </div>' +
        '        <div delete-start class="collapse-delete"></div>' +
        '</div>' +
        '    <div class="collapse-block__body collapse show" id="new' + STREAM_COUNTER + '">' +
        '        <div block-wrapper class="collapse-body">' +
        '            <div class="menu-input menu-input_xsmall menu-input_t20">' +
        '                 <div class="menu-input__title">Проект *</div>' +
        '                 <div class="menu-input__wrapper menu-input__wrapper_select">' +
        '                           <select projects class="menu-input__input menu-input__input_small menu-input__input_select" required>' +
                                        seloption +
        '                           </select>' +
        '                 </div>' +
        '             </div>' +
        '             <div class="menu-input menu-input_xsmall">' +
        '                 <div class="menu-input__title">Продукт *</div>' +
        '                 <div class="menu-input__wrapper menu-input__wrapper_select">' +
        '                     <select courses name="streams[' + STREAM_COUNTER + '].idCourse" class="menu-input__input menu-input__input_small menu-input__input_select" required>' +
        '                         <option value="" disabled>Выберите продукт</option>' +
        '                     </select>' +
        '                 </div>' +
        '              </div>' +
        '              <div class="menu-input menu-input_xsmall">' +
        '                  <div class="menu-input__title">Время старта *</div>' +
        '                  <div class="menu-input__wrapper menu-input__wrapper_cal">' +
        '                      <input name="streams[' + STREAM_COUNTER + '].startTime" autocomplete="off" class="only-time menu-input__input menu-input__input_small" placeholder="Выберите время" required/>' +
        '                  </div>' +
        '              </div>' +
        '           </div>' +
        '        </div>');

    $("#new" + STREAM_COUNTER).find('[projects]').trigger('change');
    $("#new" + STREAM_COUNTER).find('.only-time').datepicker({
        dateFormat: ' ',
        timepicker: true,
        classes: 'only-timepicker'
    });

    STREAM_COUNTER++;
});

$(document).on('click', '[js-update-streams]', function(event){
    event.preventDefault();
    $('[js-update-streams-form]').trigger('submit');
});

$(document).on('submit', '[js-update-streams-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-update-streams-form]')[0]);
        formData.append("deletedStreams", DELETE_STARTS_LIST);
        updateStreams(formData);
    }
});

function updateStreams(formData) {
    $('[js-update-streams]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "updateStreams",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateDayStreams(data);

            $('[js-menu-update-streams]').removeClass('is-open');
            checkBodyHidden();
            $('[js-update-streams]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-streams]').prop("disabled", false);
        }
    });
}

var DELETE_STARTS_LIST = [];
$(document).on('click', '[delete-start]', function(event){
    var attr = $(this).attr('data-id');

    if (typeof attr !== typeof undefined && attr !== false) {
        DELETE_STARTS_LIST.push($(this).data('id'));
    }

    var needDelete = $(this).closest('.collapse-block__header').attr('aria-controls');
    $(this).closest('.collapse-block__header').remove();
    $('#' + needDelete).remove();
});

function updateDayStreams(data) {
    if (data.streams.length !== 0) {
        var list = "";
        $.each(data.streams, function(index, stream){
            list += '<div class="calendar-stream ' + (stream.isStarted ? 'calendar-stream_started' : '') + '"><span>' + stream.nameCourse + '</span></div>';
        });
        $('[data-date="' + data.startDate + '"]').find('[stream-list]').html('' +
            '<div class="calendar-streams c-tooltip">' +
            '   <div class="c-tooltip__wrapper c-tooltip__wrapper_right">' +
            '   ' + list +
            '   </div>' +
            '   <div class="calendar-stream calendar-stream_hover"><span>' + data.streams.length + ' потоков</span></div>' +
            '</div>');
    } else {
        $('[data-date="' + data.startDate + '"]').find('[stream-list]').html('' +
            '<div class="calendar-streams">' +
            '   <div class="calendar-text">Нет потоков</div>' +
            '</div>');
    }
}
$(document).ready(function() {
    $("#is-need-sort-table").tablesorter({
        // sortList: [[1,1]],
        headers: {
            0: { sorter: false},
            1: { sorter: false},
            2: { sorter: false},
            3: { sorter: false},
            4: { sorter: false},
            5: { sorter: false},
            7: { sorter: false},
            8: { sorter: false},
            9: { sorter: false}
        }
    });
});
$(document).ready(function() {
    $("#is-need-sort-table").tablesorter({
        sortList: [[0,1]],
        headers: {
            1: { sorter: false},
            2: { sorter: false},
            3: { sorter: false},
            6: { sorter: false},
            7: { sorter: false},
            8: { sorter: false},
            9: { sorter: false},
            10: { sorter: false},
            11: { sorter: false}
        }
    });
});
$(document).on('click', '[js-tab]', function(event) {
    var $currentTab = $(this);
    var currentActiveId = $currentTab.data('tab');

    $currentTab.closest('.tabs__wrapper').find('[js-tab]').removeClass('active');
    $currentTab.closest('.tabs__wrapper').find('[lesson-tab]').removeClass('active');
    $currentTab.addClass('active');

    $currentTab.closest('.tabs__wrapper').find('[js-tab-panel]').removeClass('is-open');
    $currentTab.closest('.tabs__wrapper').find('[js-tab-panel]').filter('[data-tab=' + currentActiveId + ']').addClass('is-open');
});

$(document).ready(function(context) {
    $('[js-tabby-tab]', context).tabby();
});
$(document).on('click', '[js-save-update-theme]', function(event){
    event.preventDefault();
    $('[js-update-theme-form]').trigger('submit');
});
$(document).on('submit', '[js-update-theme-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var themeData = $('[js-update-theme-form]').serializeObject();
        updateTheme(themeData);
    }
});
$(document).on('click', '[js-update-theme]', function(event) {
    setUpdateThemeFormData($(this).closest('.theme').attr('data-theme'));
    $('[js-menu-update-theme]').addClass('is-open');
    checkBodyHidden()
});



$(document).on('click', '[js-create-article]', function(event){
    $('[js-menu-create-article]').addClass('is-open');
    var idTheme = $(this).closest('.theme').attr('data-theme');
    $('[js-article-form-id-theme]').val(idTheme);
    checkBodyHidden();
});
$(document).on('click', '[js-update-article]', function(event) {
    setUpdateArticleFormData($(this).closest('.article').attr('data-article'));
    $('[js-menu-update-article]').addClass('is-open');
    checkBodyHidden()
});
$(document).on('click', '[js-update-save-article]', function(event){
    event.preventDefault();
    $('[js-update-article-form]').trigger('submit');
});
$(document).on('submit', '[js-update-article-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var form = $('#update-article-form')[0];
        var articleData = new FormData(form);
        updateArticle(articleData);
    }
});

$(document).ready(function() {

    const $menuCreateThemeBtn = $('[js-create-theme]');
    const $menuCreateThemeCloseBtn = $('[js-menu-create-theme-close-btn]');
    const $menuCreateTheme = $('[js-menu-create-theme]');

    const $saveThemeBtn = $('[js-save-theme]');
    const $createThemeForm = $('[js-theme-form]');

    $menuCreateThemeBtn.on('click', function () {
        $menuCreateTheme.addClass('is-open');
        checkBodyHidden()
    });

    $menuCreateThemeCloseBtn.on('click', function() {
        $menuCreateTheme.removeClass('is-open');
        $createThemeForm.trigger('reset');
        checkBodyHidden()
    });

    $saveThemeBtn.on('click', function(event) {
        event.preventDefault();
        $createThemeForm.trigger('submit');
    });

    $createThemeForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var themeData = $createThemeForm.serializeObject();
            createTheme(themeData);
        }
    });


    $('[js-menu-update-theme-close-btn]').on('click', function() {
        $('[js-menu-update-theme]').removeClass('is-open');
        $('[js-update-theme-form]').trigger('reset');
        checkBodyHidden()
    });

    const $menuCreateArticleCloseBtn = $('[js-menu-create-article-close-btn]');
    const $menuCreateArticle = $('[js-menu-create-article]');

    const $saveArticleBtn = $('[js-save-article]');
    const $createArticleForm = $('[js-article-form]');

    $menuCreateArticleCloseBtn.on('click', function() {
        $menuCreateArticle.removeClass('is-open');
        $createArticleForm.trigger('reset');
        $('.js-labelFile').removeClass('has-file');
        $('.js-fileName').html('Загрузите обложку 280x180');
        checkBodyHidden()
    });

    $saveArticleBtn.on('click', function(event) {
        event.preventDefault();
        $createArticleForm.trigger('submit');
    });

    $createArticleForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var form = $createArticleForm[0];
            var articleData = new FormData(form);
            createArticle(articleData);
        }
    });

    $('[js-menu-update-article-close-btn]').on('click', function() {
        $('[js-menu-update-article]').removeClass('is-open');
        $('[js-update-article-form]').trigger('reset');
        $('.js-labelFile').removeClass('has-file');
        $('.js-fileName').html('Загрузите обложку 280x180');
        checkBodyHidden()
    });

    initDeleteTheme();
    initDeleteArticle();
});

//работа с записями
function createArticle(articleData) {
    $('[js-save-article]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: "multipart/form-data",
        url: "saveArticle",
        data: articleData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateArticleInTheme(data);
            $('[js-menu-create-article]').removeClass('is-open');
            checkBodyHidden();
            $('[js-article-form]').trigger('reset');
            $('.js-labelFile').removeClass('has-file');
            $('.js-fileName').html('Загрузите обложку 280x180');
            $('[js-save-article]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-article]').prop("disabled", false);
        }
    });
}
function updateArticleInTheme(articleData) {
    var $themeArticles = $('.theme[data-theme="' + articleData.idTheme + '"]').find('.theme__articles');
    $themeArticles.html($themeArticles.html() +
        '<div class="article" data-article="' + articleData.id + '">' +
        '   <div class="article-wrapper">' +
        '       <div class="article__title">' + articleData.name + '</div>' +
        '       <div class="article-preview">' +
        '           <div class="article__preview">' +
        '               <div class="article__preview-hover"></div>' +
        '               <img src="/' + articleData.previewImg + '" alt="" class="article__img">' +
        '               <div class="article__link-wrapper">' +
        '                   <a href="' + articleData.link + '" target="_blank" class="article__link">Открыть</a>' +
        '                   <div js-update-article  class="article__btn-link">Редактировать</div>' +
        '               </div>' +
        '           </div>' +
        '       </div>' +
        '   </div>' +
        '</div>'
    );
}
function initDeleteArticle() {
    $('[js-delete-article]').on('click', function(event) {
        var idArticle = $('[js-update-article-form-id]').val();

        $('[js-delete-article]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "deleteArticle",
            data: JSON.stringify(idArticle),
            dataType: 'json',
            cache: false,
            success: function (data) {
                $('.article[data-article="' + idArticle + '"]').remove();
                $('[js-menu-update-article]').removeClass('is-open');
                checkBodyHidden();
                $('[js-update-article-form]').trigger('reset');
                $('.js-labelFile').removeClass('has-file');
                $('.js-fileName').html('Загрузите обложку 280x180');
                $('[js-delete-article]').prop("disabled", false);
            },
            error: function (data) {
                $('[js-delete-article]').prop("disabled", false);
            }
        });
    });
}
function setUpdateArticleFormData(idArticle) {
    $('[js-update-article]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getArticle",
        data: JSON.stringify(idArticle),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-update-article-form-id]').val(data.id);
            $('[js-update-article-form-name]').val(data.name);
            $('[js-update-article-form-link]').val(data.link);
            $('[js-update-article-form-img]').val(data.previewImg);
            $('[js-update-article]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-article]').prop("disabled", false);
        }
    });
}
function updateArticle(articleData) {
    $('[js-save-update-article]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: "multipart/form-data",
        url: "updateArticle",
        data: articleData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateArticleInContainer(data);
            $('[js-menu-update-article]').removeClass('is-open');
            checkBodyHidden();
            $('[js-update-article-form]').trigger('reset');
            $('.js-labelFile').removeClass('has-file');
            $('.js-fileName').html('Загрузите обложку 280x180');
            $('[js-save-update-article]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-update-article]').prop("disabled", false);
        }
    });
}
function updateArticleInContainer(articleData) {
    var $article = $('.article[data-article="' + articleData.id + '"]');
    $article.find('.article__title').html(articleData.name);
    $article.find('.article__img').attr('src', '/' + articleData.previewImg);
    $article.find('.article__link').attr('href', articleData.link);
}


//работа с темами
function createTheme(themeData) {
    $('[js-save-theme]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveTheme",
        data: JSON.stringify(themeData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateThemeContainer(data);
            $('[js-menu-create-theme]').removeClass('is-open');
            checkBodyHidden();
            $('[js-theme-form]').trigger('reset');
            $('[js-save-theme]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-theme]').prop("disabled", false);
        }
    });
}
function updateThemeContainer(data) {
    $('.theme-container').html($('.theme-container').html() +
        '<div class="theme" data-theme="' + data.id + '">' +
        '   <div class="theme-wrapper">' +
        '       <div class="theme__title-wrapper">' +
        '           <div theme-name class="theme-title theme-title_delim">' + data.name + '</div>' +
        '           <div js-update-theme class="theme-setting"></div>' +
        '           <div js-create-article class="add-button add-button_right">+ Добавить файл</div>' +
        '       </div>' +
        '       <div class="theme__articles">' +
        '       </div>' +
        '   </div>' +
        '</div>'
    );
}
function initDeleteTheme() {
    $('[js-delete-theme]').on('click', function(event) {
        var idTheme = $('[js-update-theme-form-id]').val();

        $('[js-delete-theme]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "deleteTheme",
            data: JSON.stringify(idTheme),
            dataType: 'json',
            cache: false,
            success: function (data) {
                $('.theme[data-theme="' + idTheme + '"]').remove();
                $('[js-menu-update-theme]').removeClass('is-open');
                checkBodyHidden();
                $('[js-update-theme-form]').trigger('reset');
                $('[js-delete-theme]').prop("disabled", false);
            },
            error: function (data) {
                $('[js-delete-theme]').prop("disabled", false);
            }
        });
    });
}
function setUpdateThemeFormData(idTheme) {
    $('[js-update-theme]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getTheme",
        data: JSON.stringify(idTheme),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-update-theme-form-id]').val(data.id);
            $('[js-update-theme-form-name]').val(data.name);
            $('[js-update-theme-form-type]').val(data.type);
            $('[js-update-theme]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-theme]').prop("disabled", false);
        }
    });
}
function updateTheme(themeData) {
    $('[js-save-update-theme]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateTheme",
        data: JSON.stringify(themeData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            updateThemeInContainer(data);
            $('[js-menu-update-theme]').removeClass('is-open');
            checkBodyHidden();
            $('[js-update-theme-form]').trigger('reset');
            $('[js-save-update-theme]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-update-theme]').prop("disabled", false);
        }
    });
}
function updateThemeInContainer(themeData) {
    if (themeData.type === $('[js-type]').attr('type')) {
        $('.theme[data-theme="' + themeData.id + '"]').find('[theme-name]').html(themeData.name);
    } else {
        $('.theme[data-theme="' + themeData.id + '"]').remove();
    }
}

function validateForm(form) {

    $(form).validate({
        onkeyup: false,
        onfocusout: false,
        errorPlacement: function(label, element) {
            label.addClass('error-wrapper');
            label.insertAfter(element.parent().last());
        },
        wrapper: 'span'
    });
    $(form).rules('add', {
        messages: {
            required: 'Заполните это поле.',
        }
    });

    return $(form).valid();
}

function resetCreateForm() {
    $('[js-theme-form]').trigger('reset');
    $('.js-labelFile').removeClass('has-file');
    $('.js-fileName').html('Загрузите обложку 280x180');
}

function getTimeRemaining(nowtime, endtime) {
    var t = Date.parse(endtime) - nowtime;
    var seconds = Math.floor((t / 1000) % 60);
    var minutes = Math.floor((t / 1000 / 60) % 60);
    var hours = Math.floor((t / (1000 * 60 * 60)) % 24);
    var days = Math.floor(t / (1000 * 60 * 60 * 24));
    return {
        'total': t,
        'days': days,
        'hours': hours,
        'minutes': minutes,
        'seconds': seconds
    };
}

function initializeClock(id, now, endtime) {
    var nowtime = Date.parse(now);

    var clock = document.getElementById(id);
    var daysSpan = clock.querySelector('.days');
    var hoursSpan = clock.querySelector('.hours');
    var minutesSpan = clock.querySelector('.minutes');
    var secondsSpan = clock.querySelector('.seconds');

    function updateClock() {
        nowtime += 1000;
        var t = getTimeRemaining(nowtime, endtime);

        daysSpan.innerHTML = t.days;
        hoursSpan.innerHTML = ('0' + t.hours).slice(-2);
        minutesSpan.innerHTML = ('0' + t.minutes).slice(-2);
        secondsSpan.innerHTML = ('0' + t.seconds).slice(-2);

        if (t.total <= 0) {
            clearInterval(timeinterval);
        }
    }

    updateClock();
    var timeinterval = setInterval(updateClock, 1000);
}

$(document).on('change', '[s-filter]', function() {
    $('[s-filter-form]').trigger('submit');
});
$(document).on('click', '.datepicker-here', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});
$(document).on('click', '.datepicker-here-start', function(event){
    $('.datepicker.active').find('[data-action="today"]').trigger('click');
});

var $coursesMap;
function setCoursesMap(coursesMap) {
    $coursesMap = coursesMap;
}

var $projects;
function setProjectsList(projects) {
    $projects = projects;
}

$(document).ready(function() {
    $('.only-time').datepicker({
        dateFormat: ' ',
        timepicker: true,
        classes: 'only-timepicker'
    });

    $('.datepicker-here-start').datepicker({
        autoClose: true,
        minDate: new Date(),
        todayButton: true
    });

    $('.datepicker-here').datepicker({
        autoClose: true,
        todayButton: true
    });
});

$(document).on('click', '[add-streams]', function(event){
    resetAddStreamsMenu();
    openAddStreamMenu();
});
$(document).on('click', '[js-menu-add-streams-close-btn]', function(event){
    $('[js-menu-add-streams]').removeClass('is-open');
    checkBodyHidden();
});
function resetAddStreamsMenu() {
    $('[js-add-streams-form]').trigger('reset');
}
function openAddStreamMenu() {
    $('[add-streams]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getCompanyProjects",
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            setMenuProjects($('[add-streams-project]'), data);
            $('[add-streams-project]').trigger('change');

            $('[js-menu-add-streams]').addClass('is-open');
            checkBodyHidden();
            $('[add-streams]').prop("disabled", false);
        },
        error: function (data) {
            $('[add-streams]').prop("disabled", false);
        }
    });
}
function setMenuProjects(selector, data) {
    var seloption = "";
    $.each(data, function(index, value){
        seloption += '<option value="' + value.id + '">' + value.name + '</option>';
    });
    selector.html(seloption);
}

$(document).on('change', '[projects]', function() {
    var projectsBlock = $(this);
    resetCourses(projectsBlock);

    var formData = new FormData();
    formData.append('id', Number($('option:selected', this).val()));

    $('[projects]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getProjectCourses",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            var seloption = "";
            $.each(data, function(index, value){
                seloption += '<option value="' + value.id + '">' + value.name + '</option>';
            });

            var coursesBlock =  projectsBlock.closest('[block-wrapper]').find('[courses]');
            coursesBlock.html(coursesBlock.html() + seloption);

            $('[projects]').prop("disabled", false);
        },
        error: function (data) {
            $('[projects]').prop("disabled", false);
        }
    });
});
function resetCourses(block) {
    block.closest('[block-wrapper]').find('[courses]').html('<option value="" disabled>Выберите продукт</option>');
}

$(document).on('click', '[js-add-streams]', function(event){
    event.preventDefault();
    $('[js-add-streams-form]').trigger('submit');
});

$(document).on('submit', '[js-add-streams-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var formData = new FormData($('[js-add-streams-form]')[0]);
        saveStreams(formData);
    }
});

function saveStreams(formData) {
    $('[js-add-streams]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "saveStreams",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $.each(data, function(index, streams){
                var list = '';
                $.each(streams, function(index2, stream){
                    list += '<div class="calendar-stream"><span>' + stream.nameCourse + '</span></div>';
                });

                $('[data-date="' + index + '"]').find('[stream-list]').html(list);
            });

            $('[js-menu-add-streams]').removeClass('is-open');
            checkBodyHidden();
            $('[js-add-streams]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-add-streams]').prop("disabled", false);
        }
    });
}


var LIST_PROJECTS = {};
$(document).on('click', '[edit-streams]', function(event){
    resetUpdateStreamsMenu();

    var formData = new FormData();
    formData.append('startDate', $(this).data('date'));

    $.ajax({
        type: "POST",
        url: "getCompanyProjects",
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            LIST_PROJECTS = data;
            openEditStreamsMenu(formData);
            $('[add-streams]').prop("disabled", false);
        },
        error: function (data) {
            $('[add-streams]').prop("disabled", false);
        }
    });

});
$(document).on('click', '[js-menu-update-streams-close-btn]', function(event){
    $('[js-menu-update-streams]').removeClass('is-open');
    checkBodyHidden();
});
function resetUpdateStreamsMenu() {
    $('[u-date]').html('');
    $('[u-start-list]').html('');
}
function openEditStreamsMenu(formData) {
    $('[edit-streams]').prop("disabled", true);
    $.ajax({
        type: "POST",
        url: "getStreamsByDate",
        data: formData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[u-date]').html(data.startDate);

            var seloption = "";
            $.each(LIST_PROJECTS, function(index, value){
                seloption += '<option value="' + value.id + '">' + value.name + '</option>';
            });

            var streamList = $('[u-start-list]');
            $.each(data.streams, function(index, stream){
                streamList.html(streamList.html() +
                    '<div class="collapse-block__header collapsed" data-toggle="collapse" data-target="#stream' + stream.id  + '" aria-expanded="false" aria-controls="stream' + stream.id  + '">' +
                    '    <div class="collapse-desc">' +
                    '        <div class="collapse-desc__title">' + stream.nameCourse + '</div>' +
                    '            <div class="collapse-desc__wrapper">' +
                    '                <div class="collapse-desc__text">' + stream.nameProject + '</div>' +
                    '                <div class="collapse-desc__delim"><span></span></div>' +
                    '                <div class="collapse-desc__text">№ потока  ' + stream.id  + '</div>' +
                    '            </div>' +
                    '        </div>' +
                    '        <div delete-start class="collapse-delete"></div>' +
                    '</div>' +
                    '    <div class="collapse-block__body collapse" id="stream' + stream.id  + '">' +
                    '        <div block-wrapper class="collapse-body">' +
                    '            <div class="menu-input menu-input_xsmall menu-input_t20">' +
                    '                 <div class="menu-input__title">Проект *</div>' +
                    '                 <div class="menu-input__wrapper menu-input__wrapper_select">' +
                    '                           <select projects class="menu-input__input menu-input__input_small menu-input__input_select" required>' +
                    seloption +
                    '                           </select>' +
                    '                 </div>' +
                    '             </div>' +
                    '             <div class="menu-input menu-input_xsmall">' +
                    '                 <div class="menu-input__title">Продукт *</div>' +
                    '                 <div class="menu-input__wrapper menu-input__wrapper_select">' +
                    '                     <select courses name="idCourse" class="menu-input__input menu-input__input_small menu-input__input_select" required>' +
                    '                         <option value="" disabled>Выберите продукт</option>' +
                    '                     </select>' +
                    '                 </div>' +
                    '              </div>' +
                    '              <div class="menu-input menu-input_xsmall">' +
                    '                  <div class="menu-input__title">Время старта *</div>' +
                    '                  <div class="menu-input__wrapper menu-input__wrapper_cal">' +
                    '                      <input name="startTime" autocomplete="off" class="only-time menu-input__input menu-input__input_small" placeholder="Выберите время" required/>' +
                    '                  </div>' +
                    '              </div>' +
                    '           </div>' +
                    '        </div>');

                var projectsBlock = $('#stream' + stream.id  + '').find('[projects]');
                projectsBlock.val(stream.idProject);

                var formData = new FormData();
                formData.append('id', Number(stream.idProject));

                $.ajax({
                    type: "POST",
                    url: "getProjectCourses",
                    data: formData,
                    processData: false,
                    contentType: false,
                    cache: false,
                    success: function (data) {
                        var seloption = "";
                        $.each(data, function(index, value){
                            seloption += '<option value="' + value.id + '">' + value.name + '</option>';
                        });

                        var coursesBlock =  projectsBlock.closest('[block-wrapper]').find('[courses]');
                        coursesBlock.html(coursesBlock.html() + seloption);
                        coursesBlock.val(stream.idCourse);

                    },
                    error: function (data) {
                    }
                });
            });

            $('[js-menu-update-streams]').addClass('is-open');
            checkBodyHidden();
            $('[edit-streams]').prop("disabled", false);
        },
        error: function (data) {
            $('[edit-streams]').prop("disabled", false);
        }
    });
}
$(document).ready(function(){
    const $filterForm = $('[tr-filter-form]');
    const $filterFormBtn = $('[tr-filter-form-btn]');
    const $filter = $('[tr-filter]');
    const $filterOpenBtn = $('[tr-filter-btn]');
    const $filterCloseBtn = $('[tr-filter-close-btn]');

    $filterOpenBtn.on('click', function() {
        $('body').addClass('hiddenOverflow');
        $filter.addClass('is-open');
    });

    $filterCloseBtn.on('click', function() {
        $('body').removeClass('hiddenOverflow');
        $filter.removeClass('is-open');
        resetFilter(FILTER_FROM_BACK);
    });

    $filterFormBtn.on('click', function(event) {
        event.preventDefault();
        $filterForm.trigger('submit');
    });
});

//список фильтр
var FILTER_FROM_BACK;
function setDashboardFilter(filter) {
    FILTER_FROM_BACK = filter;
}

function resetFilter(filter) {
    $('#idManager option:selected').removeAttr('selected');
    $('#idManager').val(filter.idManager);

    $('#course option:selected').removeAttr('selected');
    $('#course').val(filter.projectId);

    $('#startPeriod').val(filter.startPeriod);
    $('#endPeriod').val(filter.endPeriod);
    $('#payDate').val(filter.payDate);
    $('#dealDate').val(filter.dealDate);
    $('#client').val(filter.client);
    $('#link').val(filter.link);
    $('#number').val(filter.number);
    $('#sum').val(filter.sum);
}

$(document).on('change', '[filter-parameter]', function() {
    $(this).closest('form').trigger('submit');
});;
$(document).ready(function(){
    const $filterForm = $('[tr-filter-form]');
    const $filterFormBtn = $('[tr-filter-form-btn]');
    const $filter = $('[tr-filter]');
    const $filterOpenBtn = $('[tr-filter-btn]');
    const $filterCloseBtn = $('[tr-filter-close-btn]');

    $filterOpenBtn.on('click', function() {
        $('body').addClass('hiddenOverflow');
        $filter.addClass('is-open');
    });

    $filterCloseBtn.on('click', function() {
        $('body').removeClass('hiddenOverflow');
        $filter.removeClass('is-open');
        resetFilter($filterFromBack);
    });

    $filterFormBtn.on('click', function(event) {
        event.preventDefault();
        $filterForm.trigger('submit');
    });

    $('.datepicker-here-f').datepicker({
        autoClose: true
    });

    downloadDealsExcel();



    $searchClient = $('[search-client]');
    $searchClientForm = $('[search-client-form]');
    $searchClientBtn = $('[search-client-btn]');
    $searchClientClear = $('[search-client-clear]');

    $searchClient.on('keyup', function () {
        $searchClientClear.removeClass('is-open');
        $searchClientBtn.addClass('is-open');
        $(this).addClass('active');
    });

    $searchClientBtn.on('click', function (event) {
        event.preventDefault();
        $searchClientForm.trigger('submit');
    });

    $searchClientClear.on('click', function (event) {
        event.preventDefault();
        $searchClient.val('');
        $searchClientForm.trigger('submit');
    });
});

//список фильтр
var $filterFromBack;
function setFilter(filter) {
    $filterFromBack = filter;
}

function resetFilter(filter) {
    $('#idManager option:selected').removeAttr('selected');
    $('#idManager').val(filter.idManager);

    $('#idSocial option:selected').removeAttr('selected');
    $('#idSocial').val(filter.idSocial);

    $('#projectId option:selected').removeAttr('selected');
    $('#projectId').val(filter.projectId);

    $('#product option:selected').removeAttr('selected');
    $('#product').val(filter.product);

    setKindToFilter($('[filter-courses]'));
    selectKind($filterFromBack.kind);

    $('#saleType option:selected').removeAttr('selected');
    $('#saleType').val(filter.saleType);

    $('#paymentMethod option:selected').removeAttr('selected');
    $('#paymentMethod').val(filter.paymentMethod);

    $('input:radio[name="trial"]').prop("checked", false).attr("checked", false).removeAttr("checked");
    $('input:radio[name="trial"]').filter('[value="' + filter.trial + '"]').attr('checked', true).prop("checked", true);

    $('input:radio[name="mailing"]').prop("checked", false).attr("checked", false).removeAttr("checked");
    $('input:radio[name="mailing"]').filter('[value="' + filter.mailing + '"]').attr('checked', true).prop("checked", true);

    $('#tag').val(filter.tag);
    $('#comment').val(filter.comment);

    $('#createDateFrom').val(filter.createDateFrom);
    $('#createDateTo').val(filter.createDateTo);
    $('#startDateFrom').val(filter.startDateFrom);
    $('#startDateTo').val(filter.startDateTo);

    $('#dealDateFrom').val(filter.dealDateFrom);
    $('#dealDateTo').val(filter.dealDateTo);
    $('#payDateFrom').val(filter.payDateFrom);
    $('#payDateTo').val(filter.payDateTo);
    $('#reminderDateFrom').val(filter.reminderDateFrom);
    $('#reminderDateTo').val(filter.reminderDateTo);

    $('#priceFrom').val(filter.priceFrom);
    $('#priceTo').val(filter.priceTo);
    $('#paidFrom').val(filter.paidFrom);
    $('#paidTo').val(filter.paidTo);

    $('input:checkbox[name="other"]').prop("checked", false).attr("checked", false).removeAttr("checked");
    $.each(filter.other, function(index, value) {
        $('input:checkbox[name="other"]').filter('[value="' + value + '"]').attr('checked', true).prop("checked", true);
    });

    $('input:checkbox[name="statuses"]').prop("checked", false).attr("checked", false).removeAttr("checked");
    $.each(filter.statuses, function(index, value) {
        $('input:checkbox[name="statuses"]').filter('[value="' + value + '"]').attr('checked', true).prop("checked", true);
    });

    $('input:checkbox[name="empties"]').prop("checked", false).attr("checked", false).removeAttr("checked");
    $.each(filter.statuses, function(index, value) {
        $('input:checkbox[name="empties"]').filter('[value="' + value + '"]').attr('checked', true).prop("checked", true);
    });
}

//скачивание файла
function downloadDealsExcel() {
    $('[js-download-deals-excel]').on('click', function () {
        $('[js-download-deals-excel]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "text/html",
            url: "download/deals.xslx",
            data: '',
            dataType: 'json',
            cache: false,
            success: function (data) {
                $('[js-download-deals-excel]').prop("disabled", false);
            },
            error: function (data) {
                $('[js-download-deals-excel]').prop("disabled", false);
            }
        });
    })
}

function showLoader() {
    $('.transition-loader').addClass('show');
}

function hideLoader() {
    $('.transition-loader').removeClass('show');
}
$(document).on('click', '[js-update-tutorial]', function(event) {
    setUpdateTutorialFormData($(this).closest('.theme').attr('data-tutorial'));
    $('[js-menu-update-tutorial]').addClass('is-open');
    checkBodyHidden();
});
$(document).on('click', '[js-menu-update-tutorial-close-btn]', function(event) {
    $('[js-menu-update-tutorial]').removeClass('is-open');
    resetUpdateForm();
    checkBodyHidden();
});
$(document).on('click', '[js-update-save-tutorial]', function(event){
    event.preventDefault();
    $('[js-update-tutorial-form]').trigger('submit');
});
$(document).on('submit', '[js-update-tutorial-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var form = $('[js-update-tutorial-form]')[0];
        var tutorialData = new FormData(form);
        updateTutorial(tutorialData);
    }
});

$(document).ready(function() {
    const $menuCreateTutorialBtn = $('[js-create-tutorial]');
    const $menuCreateTutorialCloseBtn = $('[js-menu-create-tutorial-close-btn]');
    const $menuCreateTutorial = $('[js-menu-create-tutorial]');

    const $saveTutorialBtn = $('[js-save-tutorial]');
    const $createTutorialForm = $('[js-tutorial-form]');

    $menuCreateTutorialBtn.on('click', function () {
        $menuCreateTutorial.addClass('is-open');
        checkBodyHidden()
    });

    $menuCreateTutorialCloseBtn.on('click', function () {
        $menuCreateTutorial.removeClass('is-open');
        resetCreateForm();
        checkBodyHidden()
    });

    $saveTutorialBtn.on('click', function (event) {
        event.preventDefault();
        $createTutorialForm.trigger('submit');
    });

    $createTutorialForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var form = $createTutorialForm[0];
            var tutorialData = new FormData(form);
            createTutorial(tutorialData);
        }
    });

    initDeleteTutorial();

});

function updateTutorial(tutorialData) {
    $('[js-save-update-tutorial]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: "multipart/form-data",
        url: "updateTutorial",
        data: tutorialData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateTutorialAfterUpdate(data);
            $('[js-menu-update-tutorial]').removeClass('is-open');
            checkBodyHidden();
            resetUpdateForm();
            $('[js-save-update-tutorial]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-update-tutorial]').prop("disabled", false);
        }
    });
}

function updateTutorialAfterUpdate(tutorialData) {
    if (tutorialData.type === $('[js-type]').attr('type')) {
        $('.theme[data-tutorial="' + tutorialData.id + '"]').find('[tutorial-name]').html(tutorialData.name);
        $('.theme[data-tutorial="' + tutorialData.id + '"]').find('[tutorial-preview]').attr('src', '/' + tutorialData.previewImg);
    } else {
        $('.theme[data-tutorial="' + tutorialData.id + '"]').remove();
    }
}

function setUpdateTutorialFormData(idTutorial) {
    $('[js-update-tutorial]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getTutorial",
        data: JSON.stringify(idTutorial),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-update-tutorial-form-id]').val(data.id);
            $('[js-update-tutorial-form-name]').val(data.name);
            $('[js-update-tutorial-form-type]').val(data.type);
            $('[js-update-tutorial-form-img]').val(data.previewImg);
            $('[js-update-tutorial]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-update-tutorial]').prop("disabled", false);
        }
    });
}

function createTutorial(tutorialData) {
    $('[js-save-tutorial]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: "multipart/form-data",
        url: "saveTutorial",
        data: tutorialData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            updateTutorialInContainer(data);
            $('[js-menu-create-tutorial]').removeClass('is-open');
            resetCreateForm();
            checkBodyHidden();
            $('[js-save-tutorial]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-tutorial]').prop("disabled", false);
        }
    });
}
function updateTutorialInContainer(data) {
    if (data.type === $('[js-type]').attr('type')) {
        $('.theme-container').html($('.theme-container').html() +
            '<div class="theme " data-tutorial="' + data.id + '">' +
            '   <div class="theme-wrapper">' +
            '       <div class="theme__title-wrapper theme__title-wrapper_b20">' +
            '           <div tutorial-name class="theme-title theme-title_delim">' + data.name + '</div>' +
            '           <div js-update-tutorial class="theme-setting"></div>' +
            '           <div js-create-lesson class="add-button add-button_right">+ Добавить урок</div>' +
            '       </div>' +
            '       <div class="theme__img">' +
            '           <img tutorial-preview class="article__img"src="/' + data.previewImg + '">' +
            '       </div>' +
            '       <div class="theme__lessons">' +
            '       </div>' +
            '   </div>' +
            '</div>'
        );
    }
}
function resetCreateForm() {
    $('[js-tutorial-form]').trigger('reset');
    $('.js-labelFile').removeClass('has-file');
    $('.js-fileName').html('Загрузите обложку курса 1180x350');
}

function resetUpdateForm() {
    $('[js-update-tutorial-form]').trigger('reset');
    $('.js-labelFile').removeClass('has-file');
    $('.js-fileName').html('Загрузите обложку курса 1180x350');
}

function validateForm(form) {

    $(form).validate({
        onkeyup: false,
        onfocusout: false,
        errorPlacement: function(label, element) {
            label.addClass('error-wrapper');
            label.insertAfter(element.parent().last());
        },
        wrapper: 'span'
    });
    $(form).rules('add', {
        messages: {
            required: 'Заполните это поле.',
        }
    });

    return $(form).valid();
}

function initDeleteTutorial() {
    $('[js-delete-tutorial]').on('click', function(event) {
        var idTutorial = $('[js-update-tutorial-form-id]').val();

        $('[js-delete-tutorial]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "deleteTutorial",
            data: JSON.stringify(idTutorial),
            dataType: 'json',
            cache: false,
            success: function (data) {
                $('.theme[data-tutorial="' + idTutorial + '"]').remove();
                $('[js-menu-update-tutorial]').removeClass('is-open');
                checkBodyHidden();
                resetUpdateForm();
                $('[js-delete-tutorial]').prop("disabled", false);
            },
            error: function (data) {
                $('[js-delete-tutorial]').prop("disabled", false);
            }
        });
    });
}
$(document).on('click', '[js-edit-btn]', function(event) {
    $('[js-client-card-name]').removeAttr('disabled');
    $('[js-client-card-link]').removeAttr('disabled');
    $('[js-client-card-link]').closest('.menu-input').find('.menu-input__title').html('Ссылка ВК **');
    $('[js-client-card-phone]').removeAttr('disabled');
    $('[js-client-card-phone]').closest('.menu-input').find('.menu-input__title').html('Номер телефона **');
    $('[js-client-card-email]').removeAttr('disabled');
    $('[js-client-card-email]').closest('.menu-input').find('.menu-input__title').html('Email **');

    $('[check-required="edit-client-info"]').trigger('change');

    $('[js-client-card-desc]').addClass('is-open');
    $('[js-edit-footer]').addClass('is-open');
});

function closeEdit() {
    $('[js-client-card-name]').attr("disabled", true);
    $('[js-client-card-link]').attr("disabled", true);
    $('[js-client-card-link]').closest('.menu-input').find('.menu-input__title').html('Ссылка ВК');
    $('[js-client-card-phone]').attr("disabled", true);
    $('[js-client-card-phone]').closest('.menu-input').find('.menu-input__title').html('Номер телефона');
    $('[js-client-card-email]').attr("disabled", true);
    $('[js-client-card-email]').closest('.menu-input').find('.menu-input__title').html('Email');
    $('[js-client-card-desc]').removeClass('is-open');
    $('[js-edit-footer]').removeClass('is-open');
}

//кнопка редактирования клиента
$(document).on('click', '[js-edit-client-btn]', function(event) {
    event.preventDefault();
    $(this).closest('[js-edit-client-form]').trigger('submit');
});
//form'a редактирование клиента
$(document).on('submit', '[js-edit-client-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        updateClient(formData);
    }
});
function updateClient(formData) {
    $('[js-update-deal]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/clients/updateClient",
        data: JSON.stringify(formData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            closeEdit();
            updateClientNameOnFront(data);
            updateClientLinkOnFront(data);
            updateClientPhoneOnFront(data);
            updateClientNameOnList(data);
            $('[js-update-deal]').prop("disabled", false);
            $('[js-client-name-copy]').text(data.name);
            $('[js-client-name-copy]').attr('data-link', data.name);
        },
        error: function (data) {
            $('[js-update-deal]').prop("disabled", false);
        }
    });
}
function updateClientNameOnFront(value) {
    var clientRow = $('[data-client="' + value.id + '"]');
    clientRow.siblings('span').html(value.name);
}
function updateClientLinkOnFront(value) {
    var clientCell = $('[data-link-client="' + value.id + '"]');
    if (value.link === null || value.link === '') {
        clientCell.html('<div>—</div>');
    } else {
        clientCell.html('<div class="column-links">' +
            '<div js-copy-link class="column_mwidth column_mwidth-copy" data-link="' + value.link + '"></div>' +
            '<a href="' + value.link + '" target="_blank" class="column_mwidth column_mwidth-open"></a>' +
            '</div>');
    }
}
function updateClientPhoneOnFront(value) {
    var clientCell = $('[data-phone-client="' + value.id + '"]');
    if (value.phone === null || value.phone === '') {
        clientCell.html('');
    } else {
        clientCell.html('<div js-copy-link class="client-phone" data-link="' + value.phone + '">' + value.phone + '</div>');
    }
}

function updateClientNameOnList(value) {
    var clientCard = $('[value="' + value.id + '"].js-client-id-l');
    var card = clientCard.closest('[js-client-card]');
    card.find('.client-card__title').html(value.name);
    card.find('.client-card__info-link').html(value.link);
    card.find('.client-card__info-phone').html(value.phone);
}

//обновление карточек сделок
function updateDealCard(idClient) {
    if (typeof idClient !== "undefined") {
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/api/deals/getDeals",
            data: JSON.stringify(idClient),
            dataType: 'json',
            cache: false,
            success: function (data) {
                var $dealList = $('[js-deals-list]');
                $dealList.html('');
                $.each(data, function(index, value) {
                    // установка значения в списке
                    updateDealPriceOnList(value);

                    var reminder = "";
                    if (value.reminder) {
                        reminder += '<div class="menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-violet">' +
                            '<div class="deal__comment" title="' + value.reminderMessage + '">' + value.reminderMessage + '</div></div>';
                    } else {
                        reminder += '<div class="menu-comment__input menu-comment__input menu-comment__input_deal menu-comment__input_deal-empty">' +
                            '<div class="deal__comment">Нет напоминаний</div></div>';
                    }

                    var response = $("<div/>").attr("class", "deal deal_low deal_white")
                        .append($("<div/>").attr("class", "deal-wrapper")
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_bordered deal__wrapper_column")
                                .append($("<div/>").attr("class", "deal__title").html(value.status === 1 ? 'Целевая заявка' : value.course))
                                .append($("<div/>").attr("class", "deal__subtitle")
                                    .append($("<div/>").attr("class", value.kind !== null ? "deal__kind deal__kind_del" : "deal__kind").html(value.kind))
                                    .append($("<div/>").attr("class", "deal__date").html(value.createDate)))
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_overflow deal__wrapper_bordered c-tooltip")
                                .append($("<div/>").attr("class", "c-tooltip__wrapper")
                                    .append($("<div/>").attr("class", "c-tooltip__text").html(value.managerAccessName)))
                                .append($("<div/>").attr("class", "deal__social")
                                    .append($("<div/>").attr("class", "deal-social deal-social_" + value.socialCode)))
                                .append($("<div/>").attr("class", "deal__manager").html(value.managerName))
                                .append($("<div/>").attr("class", "deal__sale-type").html(value.type))
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_between deal__wrapper_bordered ")
                                .append($("<div/>").attr("class", "deal__sum")
                                    .append($("<div/>").attr("class", "deal__sum-title").html("Стоимость"))
                                    .append($("<div/>").attr("class", "deal__sum-value").html(value.price))
                                )
                                .append($("<div/>").attr("class", "deal__sum")
                                    .append($("<div/>").attr("class", "deal__sum-title").html("Получено"))
                                    .append($("<div/>").attr("class", "deal__sum-value deal__sum-value_blue").html(value.paid))
                                )
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                                .append($("<div/>").attr("class", "deal__select deal__select_" + value.statusCode)
                                    .append($("<div/>").attr("class","deal-select menu-input__input_select").html(value.statusName))
                                )
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column deal__wrapper_bordered")
                                .append($("<div/>").attr("class", "deal__reminder")
                                    .append($("<div/>").attr("class", (value.reminder) ?
                                        (value.reminderExpiration) ? "deal__reminder-title deal-reminder deal-reminder_red " :
                                            (value.reminderToday) ? "deal__reminder-title deal-reminder deal-reminder_green " : "deal__reminder-title deal-reminder deal-reminder_gray " : "deal__reminder-title deal__reminder-title_left")
                                        .html((value.reminder) ? value.reminderDate : "Нет напоминания"))
                                )
                            )
                            .append($("<div/>").attr("class", "deal__wrapper deal__wrapper_column")
                                .append($("<form/>").attr("class", "button_full").attr("action", "#").attr("js-view-deal-form", "")
                                    .append($("<input/>").attr("name", "id").attr("type", "hidden").val(value.id))
                                    .append($("<button/>").attr("type", "button").attr("class", "button button_white button_full").attr("js-view-deal-btn", "").html("Посмотреть сделку"))
                                )
                            )
                        );
                    $dealList.append(response);
                });
            }
        });
    }
}



$(document).on('click', '[js-menu-client-card-close-btn]', function(event){
    $('[js-menu-client-card]').removeClass('is-open');
    checkBodyHidden();
});

$(document).ready(function(){
    const $statusForm = $('[js-action-status-form]')
    const $statusSelector = $statusForm.find('[js-action-status]')

    $statusSelector.on('change', function () {
        $(this).parent().trigger('submit')
    })
});
$(document).ready(function(){
    const $statusForm = $('[js-status-form]')
    const $statusSelector = $statusForm.find('[js-status]')

    $statusSelector.on('change', function () {
        $(this).parent().parent().trigger('submit')
    });

    initFancy();
});
function initFancy() {
    $('[data-fancybox]').fancybox({
        infobar: false,
        buttons: [
            "close"
        ],
    });
}
var FILES = new FormData();
$(document).on('click', '[js-delete-doc]', function() {
    FILES.delete($(this).attr('data-file'));
    $(this).closest('.input-element__document-wrapper').remove();
});
$(document).on('change', '.input-upload-file', function() {
    setFiles(this.files);
    updateFiles($(this));
    $(this).val('');
});
function setFiles(files) {
    for (var i = 0; i < files.length; i++) {
        FILES.append(files[i].name, files[i]);
    }
}
function updateFiles(element) {

    var documents = '';
    for(var pair of FILES.entries()){
        var fileName = pair[1].name;
        var name = fileName.substr(0, fileName.lastIndexOf('.'));
        var type = fileName.substr(fileName.lastIndexOf('.') + 1, fileName.length);

        documents += '<div class="input-element__document-wrapper">' +
            '<div class="lesson-document lesson-document_full lesson-document_without-hover">' +
            '<div class="lesson-document__type lesson-document__type_' + type + '">' + type + '</div>' +
            '<div class="lesson-document__name">' + name + '</div>' +
            '</div>' +
            '<div data-file="' + fileName + '" js-delete-doc class="lesson-document__delete-btn"></div>' +
            '</div>';
    }

    element.closest('.menu-input').find('.input-element__documents-new').html(documents);
}

function addFilesToFormData(lessonData){
    for(var pair of FILES.entries()) {
        lessonData.append('files', pair[1]);
    }
}
function clearFiles(form) {
    form.find('.input-element__documents-new').html('');
    for(var pair of FILES.entries()) {
        FILES.delete(pair[0]);
    }
}
$(document).ready(function(){
    const $inputFile = $('[js-input-file]');

    $inputFile.on('change', function (e) {
        var fileName = '';
        var $label = $(this).siblings('.js-labelFile'),
            labelVal = $label.html();

        if (e.target.value) {
            fileName = e.target.value.split('\\').pop();
        }

        fileName ? $label.addClass('has-file').children('.js-fileName').html(fileName) : $label.removeClass('has-file').html(labelVal);
    })
});
$(document).on('change', '.input-file', function(element) {
    var $input = $(this),
        $label = $input.next('.js-labelFile'),
        labelVal = $label.html();

    var fileName = '';
    if (element.target.value) fileName = element.target.value.split('\\').pop();
    fileName ? $label.addClass('has-file').find('.js-fileName').html(fileName) : $label.removeClass('has-file').html(labelVal);

});

var TEMP_ITEM_FILES = {};
$(document).on('change', '.upload-btn__item-file', function(element) {
    if (element.target.value) {
        var $filesGallery = $(this).closest('[upload-block]').find('[upload-list]'),
            $name = $(this).data('name');

        $.each(element.target.files, function(index, file) {
            var tmpPath = URL.createObjectURL(file);
            var id = tmpPath.split('\\').pop();

            var fl = element.target.value.split('\\').pop();
            var fileType = fl.split('.').pop();
            var fileName = fl.split('.').shift();
            if (fileType === 'doc' || fileType === 'docx' || fileType === 'pdf') {
                $filesGallery.prepend(
                    '<div id="' + id + '" class="gallery__item">' +
                    '   <div class="gallery-item gallery-item_small gallery-item_' + fileType + '">' +
                    '       <div class="gallery-item__title">' + fileType + '</div>' +
                    '       <div class="gallery-item__subtitle">' + fileName + '</div>' +
                    '   </div>' +
                    '   <span class="gallery__delete-btn"></span>' +
                    '</div>');
            } else {
                $filesGallery.prepend(
                    '<div id="' + id + '" class="gallery__item">' +
                    '   <a href="' + tmpPath + '" data-fancybox="' + file.name + '" class="gallery-item gallery-item_small">' +
                    '       <img class="gallery-item__preview" src="' + tmpPath + '">' +
                    '   </a>' +
                    '   <span class="gallery__delete-btn"></span>' +
                    '</div>');
            }

            var tmpFile = {};
            tmpFile['name'] = $name;
            tmpFile['file'] = file;

            TEMP_ITEM_FILES[id] = tmpFile;
        });
        $(this).val('');
    }
});
$(document).on('click', '.gallery__delete-btn', function(element) {
    var $file = $(this).closest('.gallery__item');
    delete TEMP_ITEM_FILES[$file.attr('id')];
    $file.remove();
});

function setFilesToFormData(formData) {
    $.each(TEMP_ITEM_FILES, function(index, file) {
        formData.append(file['name'], file['file']);
    });

    TEMP_ITEM_FILES = {};
}
$(document).on('change', '[js-report-file]', function(event){
    var fileName = '';

    if (event.target.value) {
        fileName = event.target.value.split('\\').pop();
    }

    if (fileName) {
        $(this).closest('form').trigger('submit');
    }
});

$(document).on('submit', '[js-report-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        processReport(new FormData($('[js-report-form]')[0]));
    }
});

function processReport (requestData) {
    $('[js-report-file]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: "multipart/form-data",
        url: "processReport",
        data: requestData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[dialog]').find('.dialog__title').html('Результат обработки таблицы');
            $('[dialog]').find('.dialog__text').html(
                '<div>Прочитано строк из таблицы: ' + data + '</div>'
            );
            $('[dialog]').addClass('is-open');

            $('[js-report-file]').prop("disabled", false);
            hideLoader();
        },
        error: function (data) {
            $('[js-report-file]').prop("disabled", false);
            hideLoader();
        },
        beforeSend: function() {
            showLoader();
        }
    });

}

$(document).on('click', '[close-dialog]', function(event) {
    location.reload();
});


$(document).on('change', '[js-report-file]', function(event){
    var fileName = '';

    if (event.target.value) {
        fileName = event.target.value.split('\\').pop();
    }

    if (fileName) {
        $(this).closest('form').trigger('submit');
    }
});

$(document).on('submit', '[js-report-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        processReport(new FormData($('[js-report-form]')[0]));
    }
});

function processReport (requestData) {
    $('[js-report-file]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: "multipart/form-data",
        url: "processReport",
        data: requestData,
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[dialog]').find('.dialog__title').html('Результат обработки отчета');
            $('[dialog]').find('.dialog__text').html(
                '<div>Прочитано строк из отчета: ' + data.reportRowCount + '</div>' +
                '<div>Найдено совпадений в базе: ' + data.dataBaseRowCount + '</div>' +
                '<div>Было обновлено в базе: ' + data.processedRowCount + '</div>'
            );
            $('[dialog]').addClass('is-open');

            $('[js-report-file]').prop("disabled", false);
            hideLoader();
        },
        error: function (data) {
            $('[js-report-file]').prop("disabled", false);
            hideLoader();
        },
        beforeSend: function() {
            showLoader();
        }
    });
    
}

$(document).on('click', '[close-dialog]', function(event) {
    location.reload();
});


$(document).on('click', '[js-set-sale-type]', function(event){
    var idCompany = $(this).closest('.custom-table__body-row').find('[u-id-company]').val();
    setSaleTypeFormData(idCompany);
    $('[js-menu-sale-type]').addClass('is-open');
    checkBodyHidden();
});
$(document).on('click', '[js-menu-sale-type-close-btn]', function(event){
    $('[js-menu-sale-type]').removeClass('is-open');
    $('[js-sale-type-form]').trigger('reset');
    $('input:radio[sale-type][name="id"]').attr('checked',false).prop("checked", false);
    checkBodyHidden();
});
$(document).on('click', '[js-save-sale-type]', function(event){
    event.preventDefault();
    $('[js-sale-type-form]').trigger('submit');
});
$(document).on('submit', '[js-sale-type-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $('[js-sale-type-form]').serializeObject();
        saveSaleType(formData);
    }
});
function setSaleTypeFormData(idCompany) {
    $('[js-set-sale-type]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getSaleType",
        data: JSON.stringify(idCompany),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-sale-type-id-company]').val(idCompany);

            $('input:radio[sale-type][value="' + data.id + '"]').attr('checked', true).prop("checked", true);

            $('[js-set-sale-type]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-set-sale-type]').prop("disabled", false);
        }
    });
}
function saveSaleType(accessData) {
    $('[js-save-sale-type]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "updateSaleType",
        data: JSON.stringify(accessData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-menu-sale-type]').removeClass('is-open');
            $('[js-sale-type-form]').trigger('reset');
            $('input:radio[sale-type][name="id"]').attr('checked',false).prop("checked", false);
            checkBodyHidden();
            $('[js-save-sale-type]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-sale-type]').prop("disabled", false);
        }
    });
}


$(document).on('click', '[js-set-access]', function(event){
    var idCompany = $(this).closest('.custom-table__body-row').find('[u-id-company]').val();
    setAccessFormData(idCompany);
    $('[js-menu-set-access]').addClass('is-open');
    checkBodyHidden();
});
$(document).on('click', '[js-menu-set-access-close-btn]', function(event){
    $('[js-menu-set-access]').removeClass('is-open');
    resetAccessForm()
    checkBodyHidden();
});
$(document).on('click', '[js-save-access]', function(event){
    event.preventDefault();
    $('[js-access-form]').trigger('submit');
});
$(document).on('submit', '[js-access-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var accessData = $('[js-access-form]').serializeObject();
        saveAccessInformation(accessData);
    }
});

function setAccessFormData(idCompany) {
    $('[js-set-access]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getAccess",
        data: JSON.stringify(idCompany),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-access-fotm-id-company]').val(idCompany);

            $('input:checkbox[name="about"]').attr('checked', data.about).prop("checked", data.about);
            $('input:checkbox[name="regulations"]').attr('checked', data.regulations).prop("checked", data.regulations);
            $('input:checkbox[name="bookmarks"]').attr('checked', data.bookmarks).prop("checked", data.bookmarks);
            $('input:checkbox[name="training"]').attr('checked', data.training).prop("checked", data.training);
            $('input:checkbox[name="events"]').attr('checked', data.events).prop("checked", data.events);
            $('input:checkbox[name="production"]').attr('checked', data.production).prop("checked", data.production);
            $('[js-set-access]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-set-access]').prop("disabled", false);
        }
    });
}

function saveAccessInformation(accessData) {
    $('[js-save-access]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveAccess",
        data: JSON.stringify(accessData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-menu-set-access]').removeClass('is-open');
            checkBodyHidden();
            resetAccessForm()
            $('[js-save-access]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-access]').prop("disabled", false);
        }
    });
}

function resetAccessForm() {
    $('[js-access-form]').trigger('reset');

    $('input:checkbox[name="about"]').attr('checked',false).prop("checked", false);
    $('input:checkbox[name="regulations"]').attr('checked', false).prop("checked", false);
    $('input:checkbox[name="bookmarks"]').attr('checked', false).prop("checked", false);
    $('input:checkbox[name="training"]').attr('checked', false).prop("checked", false);
    $('input:checkbox[name="events"]').attr('checked', false).prop("checked", false);
    $('input:checkbox[name="production"]').attr('checked', false).prop("checked", false);
}
$(document).ready(function() {

    const $menuCreateUserBtn = $('[js-create-user]');
    const $menuCreateUserCloseBtn = $('[js-menu-create-user-close-btn]');
    const $menuCreateUser = $('[js-menu-create-user]');

    const $saveUserBtn = $('[js-save-manager]');
    const $createUserForm = $('[js-manager-form]');

    $menuCreateUserBtn.on('click', function () {
        $menuCreateUser.addClass('is-open');
        checkBodyHidden()
    });

    $menuCreateUserCloseBtn.on('click', function() {
        $menuCreateUser.removeClass('is-open');
        $createUserForm.trigger('reset');
        checkBodyHidden()
    });

    $saveUserBtn.on('click', function(event) {
        event.preventDefault();
        $createUserForm.trigger('submit');
    });

    $createUserForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var userData = $createUserForm.serializeObject();
            createManager(userData);
        }
    });

    const $saveAdvertiserBtn = $('[js-save-advertiser]');
    const $createAdvertiserForm = $('[js-advertiser-form]');

    $saveAdvertiserBtn.on('click', function(event) {
        event.preventDefault();
        $createAdvertiserForm.trigger('submit');
    });

    $createAdvertiserForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var userData = $createAdvertiserForm.serializeObject();
            createAdvertiser(userData);
        }
    });

    const $saveAdminBtn = $('[js-save-admin]');
    const $createAdminForm = $('[js-admin-form]');

    $saveAdminBtn.on('click', function(event) {
        event.preventDefault();
        $createAdminForm.trigger('submit');
    });

    $createAdminForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var userData = $createAdminForm.serializeObject();
            createAdmin(userData);
        }
    });

    initEditUsersFromList();
    initCancelEditUserFromList();
    initAcceptEditUserFromList();
    initDatePicker();
    uploadAvatar();

    changeSelectorIndicator();
});

function changeSelectorIndicator() {
    $('.indicated-select select').on('change', function(event) {
        var vl = $('option:selected', this).attr('value');
        $(this).closest('.indicated-select').removeClassWild("indicated-select_*").addClass('indicated-select_' + vl);
    });
}
function createAdvertiser(userData) {
    $('[js-save-advertiser]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "createAdvertiser",
        data: JSON.stringify(userData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-menu-create-user]').removeClass('is-open');
            checkBodyHidden();
            $('[js-advertiser-form]').trigger('reset');
            $('[js-save-advertiser]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-advertiser]').prop("disabled", false);
        }
    });
}

function createAdmin(userData) {
    $('[js-save-advertiser]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveAdmin",
        data: JSON.stringify(userData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-menu-create-user]').removeClass('is-open');
            checkBodyHidden();
            $('[js-advertiser-form]').trigger('reset');
            $('[js-save-advertiser]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-advertiser]').prop("disabled", false);
        }
    });
}

function createManager(userData) {
    $('[js-save-manager]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveManager",
        data: JSON.stringify(userData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-menu-create-user]').removeClass('is-open');
            checkBodyHidden();
            $('[js-manager-form]').trigger('reset');
            $('[js-save-manager]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-manager]').prop("disabled", false);
        }
    });
}

function initDatePicker() {
    $('.datepicker-here-cs').datepicker({
        autoClose: true
    });
}

//активация редактирования формы
var USERS_INFO_TEMP = {};
function initEditUsersFromList() {

    $('[edit-user]').on('click', function (event) {
        event.preventDefault();
        $(this).closest('[edit-menu]').removeClass('is-open').siblings('[edit-btns]').addClass('is-open');
        var list = {};

        var name = $(this).closest('.custom-table__body-row').find('[u-name]');
        // name.removeAttr('disabled');
        list['name'] = name.val();

        var companyName = $(this).closest('.custom-table__body-row').find('[u-company-name]');
        companyName.removeAttr('disabled');
        list['companyName'] = companyName.val();

        var legalName = $(this).closest('.custom-table__body-row').find('[u-legal-name]');
        legalName.removeAttr('disabled');
        list['legalName'] = legalName.val();

        var username = $(this).closest('.custom-table__body-row').find('[u-username]');
        username.removeAttr('disabled');
        list['username'] = username.val();

        var password = $(this).closest('.custom-table__body-row').find('[u-password]');
        password.removeAttr('disabled');
        list['password'] = password.val();

        var timezone = $(this).closest('.custom-table__body-row').find('[u-timezone]');
        timezone.removeAttr('disabled');
        list['timezone'] = timezone.val();

        var phone = $(this).closest('.custom-table__body-row').find('[u-phone]');
        phone.removeAttr('disabled');
        list['phone'] = phone.val();

        var link = $(this).closest('.custom-table__body-row').find('[u-link]');
        link.removeAttr('disabled');
        list['link'] = link.val();

        var companyCode = $(this).closest('.custom-table__body-row').find('[u-company-code]');
        companyCode.removeAttr('disabled');
        list['companyCode'] = companyCode.val();

        var doorsCardNumber = $(this).closest('.custom-table__body-row').find('[u-doorscardnumber]');
        doorsCardNumber.removeAttr('disabled');
        list['doorsCardNumber'] = doorsCardNumber.val();

        var birthday = $(this).closest('.custom-table__body-row').find('[u-birthday]');
        birthday.removeAttr('disabled');
        list['birthday'] = birthday.val();

        var isHasKey = $(this).closest('.custom-table__body-row').find('[u-ishaskey]');
        isHasKey.removeAttr('disabled');
        list['isHasKey'] = isHasKey.prop('checked');

        $(this).closest('.custom-table__body-row').find('[u-type-wrapper]').removeClass('disabled');
        $(this).closest('.custom-table__body-row').find('[u-type-selector]').removeAttr('disabled');
        var type = $(this).closest('.custom-table__body-row').find('[u-type-selector]');
        list['type'] = type.val();

        $(this).closest('.custom-table__body-row').find('[u-dismiss-wrapper]').removeClass('disabled');
        $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]').removeAttr('disabled');
        var dismiss = $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]');
        list['dismiss'] = dismiss.val();

        $(this).closest('.custom-table__body-row').find('[u-access-wrapper]').removeClass('disabled');
        $(this).closest('.custom-table__body-row').find('[u-access-selector]').removeAttr('disabled');
        var access = $(this).closest('.custom-table__body-row').find('[u-access-selector]');
        list['access'] = access.val();

        $(this).closest('.custom-table__body-row').find('[u-partner-wrapper]').removeClass('disabled');
        $(this).closest('.custom-table__body-row').find('[u-partner-selector]').removeAttr('disabled');
        var isPartner = $(this).closest('.custom-table__body-row').find('[u-partner-selector]');
        list['isPartner'] = isPartner.val();

        $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
        USERS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[u-id]').val()] = list;
    });
}
function initCancelEditUserFromList() {
    $('[edit-user-cancel]').on('click', function (event) {
        event.preventDefault();
        var values = USERS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[u-id]').val()];

        $(this).closest('.custom-table__body-row').find('[u-name]').val(values.name).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-company-name]').val(values.companyName).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-legal-name]').val(values.legalName).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-username]').val(values.username).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-password]').val(values.password).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-timezone]').val(values.timezone).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-phone]').val(values.phone).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-link]').val(values.link).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-company-code]').val(values.companyCode).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-doorscardnumber]').val(values.doorsCardNumber).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-birthday]').val(values.birthday).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked', values.isHasKey).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-type-wrapper]').addClass('disabled');
        $(this).closest('.custom-table__body-row').find('[u-type-selector]').val(values.type).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-dismiss-wrapper]').removeClassWild("indicated-select_*").addClass('indicated-select_' + values.dismiss).addClass('disabled');
        $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]').val(values.dismiss).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-access-wrapper]').removeClassWild("indicated-select_*").addClass('indicated-select_' + values.access).addClass('disabled');
        $(this).closest('.custom-table__body-row').find('[u-access-selector]').val(values.access).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-partner-wrapper]').removeClassWild("indicated-select_*").addClass('indicated-select_' + values.isPartner).addClass('disabled');
        $(this).closest('.custom-table__body-row').find('[u-partner-selector]').val(values.isPartner).attr("disabled", true);

        $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
        delete USERS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[u-id]').val()];
    });
}
var USERS_ACCEPT_BTN;
function initAcceptEditUserFromList() {
    $('[edit-user-accept]').on('click', function (event) {
        event.preventDefault();
        USERS_ACCEPT_BTN = $(this);

        var userData = new Object();
        userData.id = $(this).closest('.custom-table__body-row').find('[u-id]').val();
        userData.idCompany = $(this).closest('.custom-table__body-row').find('[u-id-company]').val();
        userData.name = $(this).closest('.custom-table__body-row').find('[u-name]').val();
        userData.companyName = $(this).closest('.custom-table__body-row').find('[u-company-name]').val();
        userData.legalName = $(this).closest('.custom-table__body-row').find('[u-legal-name]').val();
        userData.username = $(this).closest('.custom-table__body-row').find('[u-username]').val();
        userData.password = $(this).closest('.custom-table__body-row').find('[u-password]').val();
        userData.timezoneHour = $(this).closest('.custom-table__body-row').find('[u-timezone]').val();
        userData.phone = $(this).closest('.custom-table__body-row').find('[u-phone]').val();
        userData.link = $(this).closest('.custom-table__body-row').find('[u-link]').val();
        userData.companyCode = $(this).closest('.custom-table__body-row').find('[u-company-code]').val();
        userData.doorsCardNumber = $(this).closest('.custom-table__body-row').find('[u-doorscardnumber]').val();
        userData.birthday = $(this).closest('.custom-table__body-row').find('[u-birthday]').val();
        userData.isHasKey = $(this).closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked');
        userData.type = $(this).closest('.custom-table__body-row').find('[u-type-selector]').val();
        userData.isNotDisMiss = $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]').val();
        userData.access = $(this).closest('.custom-table__body-row').find('[u-access-selector]').val();
        userData.isPartner = $(this).closest('.custom-table__body-row').find('[u-partner-selector]').val();

        $('[edit-user-accept]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "update",
            data: JSON.stringify(userData),
            dataType: 'json',
            cache: false,
            success: function (data) {
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-name]').val(data.name).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-company-name]').val(data.companyName).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-legal-name]').val(data.legalName).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-username]').val(data.username).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-password]').val('').attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-timezone]').val(data.timezoneHour).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-phone]').val(data.phone).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-link]').val(data.link).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-company-code]').val(data.companyCode).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-doorscardnumber]').val(data.doorsCardNumber).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-birthday]').val(data.birthday).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked', data.isHasKey).attr("disabled", true);

                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-wrapper]').addClass('disabled');
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-selector]').val(data.type).attr("disabled", true);
                if (typeof data.isNotDisMiss !== 'undefined') {
                    USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-wrapper]').addClass('disabled');
                    USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-selector]').val(data.isNotDisMiss.toString()).attr("disabled", true);

                }
                if (typeof data.access !== 'undefined') {
                    USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-access-wrapper]').addClass('disabled');
                    USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-access-selector]').val(data.access.toString()).attr("disabled", true);
                }
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-partner-wrapper]').addClass('disabled');
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-partner-selector]').val(data.isPartner.toString()).attr("disabled", true);

                USERS_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
                delete USERS_INFO_TEMP[data.id];

                $('[edit-user-accept]').prop("disabled", false);
            },
            error: function (data) {
                var values = USERS_INFO_TEMP[userData.id];

                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-name]').val(values.name).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-company-name]').val(values.companyName).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-legal-name]').val(values.legalName).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-username]').val(values.username).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-password]').val('').attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-timezone]').val(values.timezone).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-phone]').val(values.phone).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-link]').val(values.link).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-company-code]').val(values.companyCode).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-doorscardnumber]').val(values.doorsCardNumber).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-birthday]').val(values.birthday).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked', values.isHasKey).attr("disabled", true);

                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-wrapper]').addClass('disabled');
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-selector]').val(values.type).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-wrapper]').addClass('disabled');
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-selector]').val(values.dismiss).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-access-wrapper]').addClass('disabled');
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-access-selector]').val(values.access).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-partner-wrapper]').addClass('disabled');
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-partner-selector]').val(values.isPartner).attr("disabled", true);

                USERS_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');

                delete USERS_INFO_TEMP[data.id];
                $('[edit-user-accept]').prop("disabled", false);
            }
        });
    });
}

$(document).on('change', '[u-upload-background]', function(event){
    var form = $(this).closest('[u-upload-background-form]')
    var data = new FormData(form[0]);
    $('[u-upload-background]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "uploadBackground",
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 300000,
        success: function (data) {
            form.find('.avatar-upload__upload').removeClassWild("avatar-upload__upload_*");
            form.find('.avatar-upload__upload').html('<img src="/' + data + '" alt>');
            $('[u-upload-background]').prop("disabled", false);
        },
        error: function (data) {
            $('[u-upload-background]').prop("disabled", false);
        }
    });
});

function uploadAvatar() {
    $('[u-upload-avatar]').on('change', function () {
        var form = $(this).closest('[u-upload-avatar-form]')
        var data = new FormData(form[0]);
        $('[u-upload-avatar]').prop("disabled", true);
        $.ajax({
            type: "POST",
            enctype: 'multipart/form-data',
            url: "uploadAvatar",
            data: data,
            processData: false,
            contentType: false,
            cache: false,
            timeout: 300000,
            success: function (data) {
                form.find('.avatar-upload__upload').removeClassWild("avatar-upload__upload_*");
                form.find('.avatar-upload__upload').html('<img src="/' + data + '" alt>');
                $('[u-upload-avatar]').prop("disabled", false);
            },
            error: function (data) {
                $('[u-upload-avatar]').prop("disabled", false);
            }
        });
    });
}

$(document).on('click', '[js-copy-company-link]', function(event){
    var $tmp = $("<textarea>");
    $("body").append($tmp);
    $tmp.val($(this).attr('data-link') + $(this).closest('.custom-table__body-row').find('[u-company-code]').val()).select();
    document.execCommand("copy");
    $tmp.remove();
});
$(document).on('click', '[js-open-company-link]', function(event){
    window.open($(this).attr('data-link') + $(this).closest('.custom-table__body-row').find('[u-company-code]').val(), '_blank')
});

$(document).on('change', '[u-upload-manager-avatar]', function(event) {
    var form = $(this).closest('[u-upload-avatar-form]')
    var data = new FormData(form[0]);
    $('[u-upload-manager-avatar]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "uploadManagerAvatar",
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 300000,
        success: function (data) {
            form.find('.avatar-upload__upload').removeClassWild("avatar-upload__upload_*");
            form.find('.avatar-upload__upload').html('<img src="/' + data + '" alt>');
            $('[u-upload-manager-avatar]').prop("disabled", false);
        },
        error: function (data) {
            $('[u-upload-manager-avatar]').prop("disabled", false);
        }
    });
});
$(document).on('change', '[u-upload-advertiser-avatar]', function(event) {
    var form = $(this).closest('[u-upload-avatar-form]')
    var data = new FormData(form[0]);
    $('[u-upload-advertiser-avatar]').prop("disabled", true);
    $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: "uploadAdvertiserAvatar",
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 300000,
        success: function (data) {
            form.find('.avatar-upload__upload').removeClassWild("avatar-upload__upload_*");
            form.find('.avatar-upload__upload').html('<img src="/' + data + '" alt>');
            $('[u-upload-advertiser-avatar]').prop("disabled", false);
        },
        error: function (data) {
            $('[u-upload-advertiser-avatar]').prop("disabled", false);
        }
    });
});
$(document).ready(function() {

    const $menuCreateManagerBtn = $('[js-create-manager]');
    const $menuCreateManagerCloseBtn = $('[js-menu-create-manager-close-btn]');
    const $menuCreateManager = $('[js-menu-create-manager]');

    const $saveManagerBtn = $('[js-save-manager]');
    const $createManagerForm = $('[js-manager-form]');

    $menuCreateManagerBtn.on('click', function () {
        $menuCreateManager.addClass('is-open');
        checkBodyHidden()
    });

    $menuCreateManagerCloseBtn.on('click', function() {
        $menuCreateManager.removeClass('is-open');
        $createManagerForm.trigger('reset');
        checkBodyHidden()
    });

    $saveManagerBtn.on('click', function(event) {
        event.preventDefault();
        $createManagerForm.trigger('submit');
    });

    $createManagerForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var userData = $createManagerForm.serializeObject();
            createManager(userData);
        }
    });

    const $menuCreateAdvertiserBtn = $('[js-create-advertiser]');
    const $menuCreateAdvertiserCloseBtn = $('[js-menu-create-advertiser-close-btn]');
    const $menuCreateAdvertiser = $('[js-menu-create-advertiser]');

    const $saveAdvertiserBtn = $('[js-save-advertiser]');
    const $createAdvertiserForm = $('[js-advertiser-form]');

    $menuCreateAdvertiserBtn.on('click', function () {
        $menuCreateAdvertiser.addClass('is-open');
        checkBodyHidden()
    });

    $menuCreateAdvertiserCloseBtn.on('click', function() {
        $menuCreateAdvertiser.removeClass('is-open');
        $createAdvertiserForm.trigger('reset');
        checkBodyHidden()
    });

    $saveAdvertiserBtn.on('click', function(event) {
        event.preventDefault();
        $createAdvertiserForm.trigger('submit');
    });

    $createAdvertiserForm.submit(function (event) {
        event.preventDefault();
        if (validateForm(this)) {
            var userData = $createAdvertiserForm.serializeObject();
            createAdvertiser(userData);
        }
    });


    const $managersListCloseBtn = $('[js-menu-managers-list-close-btn]');
    const $managersListMenu = $('[js-menu-managers-list]');
    const $managersList = $('[manager-list]');

    $managersListCloseBtn.on('click', function() {
        $managersListMenu.removeClass('is-open');
        $managersList.html('');

        TEMP_ROW.find('option:selected').removeAttr('selected');
        TEMP_ROW.val("true");
        TEMP_ROW.closest('[u-dismiss-wrapper]').removeClass('indicated-select_false').addClass('indicated-select_true');

        checkBodyHidden()
    });

    initDateUserPicker();
});

function createAdvertiser(userData) {
    $('[js-save-advertiser]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "createAdvertiser",
        data: JSON.stringify(userData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            addAdvertiserToTable(data);
            $('[js-menu-create-advertiser]').removeClass('is-open');
            checkBodyHidden();
            $('[js-advertiser-form]').trigger('reset');
            $('[js-save-advertiser]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-advertiser]').prop("disabled", false);
        }
    });
}

function createManager(userData) {
    $('[js-save-manager]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "saveManager",
        data: JSON.stringify(userData),
        dataType: 'json',
        cache: false,
        success: function (data) {
            addManagerToTable(data);
            $('[js-menu-create-manager]').removeClass('is-open');
            checkBodyHidden();
            $('[js-manager-form]').trigger('reset');
            $('[js-save-manager]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-manager]').prop("disabled", false);
        }
    });
}
function addManagerToTable(manager) {

    var seloption = "";
    $.each($managerTypeList, function(index, value){
        seloption += '<option value="'+ value.id +'" ' + (value.id === manager.type ? 'selected="selected" ': '') +'>' + value.title + '</option>';
    });

    var table = $('[department="manager"]').closest('.custom-table__body');
    table.html('<tr data-manager="' + manager.id + '" department="manager" class="custom-table__body-row">' +
        '                        <input type="hidden" u-id value="' + manager.id + '" name="id" required>' +
        '                        <td class="custom-table__body-col" >' + manager.idManager + '</td>' +
        '                        <td class="custom-table__body-col">' +
        '                            <div class="avatar-upload">' +
        '                                <form u-upload-avatar-form action="#" enctype="multipart/form-data">' +
        '                                    <input type="hidden" value="' + manager.idManager + '" name="id" required>' +
        '                                    <input u-upload-manager-avatar accept="image/*,image/jpeg" class="input-file" name="file" type="file" id="avatarM' + manager.id + '">' +
        '                                    <label for="avatarM' + manager.id + '">' +
        '                                            <span class="avatar-upload__upload avatar-upload__upload_default-user" ></span>' +
        '                                    </label>' +
        '                                </form>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_xlarge" >' +
        '                            <input u-name name="name"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + manager.name + '"' +
        '                                   value="' + manager.name + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_xlarge">' +
        '                            <input u-username name="username"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + manager.username +'"' +
        '                                   value="' + manager.username + '"' +
        '                                   disabled' +
        '                                   placeholder="—"' +
        '                                   required>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-password name="password"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   value=""' +
        '                                   disabled' +
        '                                   placeholder="✱✱✱✱✱✱"' +
        '                                   required>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-phone name="phone"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + manager.phone + '"' +
        '                                   value="' + manager.phone + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-link name="link"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + manager.link + '"' +
        '                                   value="' + manager.link + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-doorscardnumber name="doorsCardNumber"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + manager.doorsCardNumber + '"' +
        '                                   value="' + manager.doorsCardNumber + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_small">' +
        '                            <input u-birthday' +
        '                                   data-position="top left"' +
        '                                   name="birthday"' +
        '                                   class="datepicker-here-u menu-input__input menu-input__input_small editable"' +
        '                                   autocomplete="off"' +
        '                                   value="' + manager.birthday + '"' +
        '                                   disabled' +
        '                                   data-autoclose="true"' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col">' +
        '                            <div class="input-element__checkbox input-element__checkbox_mid">' +
        '                                <input u-ishaskey' +
        '                                       name="isHasKey"' +
        '                                       type="checkbox"' +
        '                                       class="checkbox"' +
        '                                       value="true"' +
        '                                       disabled' +
        '                                       id="keyM' + + manager.id + '"' +
                                              ((manager.isHasKey) ? 'checked=checked' : '') +
'                                               >' +
        '                                <label class="checkbox-label checkbox-label_gray" for="keyM' + manager.id + '"></label>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <div u-type-wrapper class="menu-input__wrapper menu-input__wrapper_select disabled">' +
        '                                <select u-type-selector disabled class="editable menu-input__input menu-input__input_medium menu-input__input_select menu-input__input_white">' +
        '                                    <option th:value="0" disabled>Выберите тип</option>' +
        seloption +
        '                                </select>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <div u-dismiss-wrapper class="indicated-select menu-input__wrapper menu-input__wrapper_select disabled indicated-select_true" >' +
        '                                <select u-dismiss-selector disabled class="editable menu-input__input menu-input__input_xsmall menu-input__input_select menu-input__input_white">' +
        '                                    <option value="true" selected=selected>Работает</option>' +
        '                                    <option value="false">Уволен</option>' +
        '                                </select>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_small">' +
        '                            <div js-set-projects="" class="setting-wrapper">' +
        '                                   <div class="theme-setting theme-setting_big theme-setting_m"></div>' +
        '                           </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_last">' +
        '                            <div edit-btns class="column-links display-flex-none">' +
        '                                <div edit-user-accept class="column_mwidth column_mwidth-accept"></div>' +
        '                                <div edit-user-cancel class="column_mwidth column_mwidth-cancel"></div>' +
        '                            </div>' +
        '                            <div edit-menu class="column-links display-flex-none is-open">' +
        '                                <div edit-user class="column_mwidth div-table__body-col_center column_mwidth-edit column_mwidth-edit-b"></div>' +
        '                            </div>' +
        '                        </td>' +
        '                    </tr>'
        + table.html());

    initDateUserPicker();
}
function addAdvertiserToTable(advertiser) {

    var seloption = "";
    $.each($advertiserTypeList, function(index, value){
        seloption += '<option value="'+ value.id +'" ' + (value.id === advertiser.type ? 'selected="selected" ': '') +'>' + value.title + '</option>';
    });

    var table = $('[department="advertiser"]').closest('.custom-table__body');
    table.html('<tr data-advertiser="' + advertiser.id + '" department="advertiser" class="custom-table__body-row" >' +
        '                        <input type="hidden" u-id value="' + advertiser.id + '" name="id" required>' +
        '                        <td class="custom-table__body-col" >' + advertiser.idManager + '</td>' +
        '                        <td class="custom-table__body-col">' +
        '                            <div class="avatar-upload">' +
        '                                <form u-upload-avatar-form action="#" enctype="multipart/form-data">' +
        '                                    <input type="hidden" th:value="${advertiser.idManager}" name="id" required>' +
        '                                    <input u-upload-avatar accept="image/*,image/jpeg" class="input-file" name="file" type="file" id="avatarA' +  advertiser.id + '">' +
        '                                    <label for="avatarA' + advertiser.id + '">' +
        '                                            <span class="avatar-upload__upload avatar-upload__upload_default-user"></span>' +
        '                                    </label>' +
        '                                </form>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_xlarge" >' +
        '                            <input u-name name="name"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + advertiser.name + '"' +
        '                                   value="' + advertiser.name + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_xlarge">' +
        '                            <input u-username name="username"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + advertiser.username + '"' +
        '                                   value="' + advertiser.username + '"' +
        '                                   disabled' +
        '                                   placeholder="—"' +
        '                                   required>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-password name="password"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   value=""' +
        '                                   disabled' +
        '                                   placeholder="✱✱✱✱✱✱"' +
        '                                   required>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-phone name="phone"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + advertiser.phone + '"' +
        '                                   value="' + advertiser.phone + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-link name="link"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + advertiser.link + '"' +
        '                                   value="' + advertiser.link + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <input u-doorscardnumber name="doorsCardNumber"' +
        '                                   class="menu-input__input menu-input__input_small editable"' +
        '                                   title="' + advertiser.doorsCardNumber + '"' +
        '                                   value="' + advertiser.doorsCardNumber + '"' +
        '                                   disabled' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_small">' +
        '                            <input u-birthday' +
        '                                   data-position="top left"' +
        '                                   name="birthday"' +
        '                                   class="datepicker-here-u menu-input__input menu-input__input_small editable"' +
        '                                   autocomplete="off"' +
        '                                   value="' + advertiser.birthday + '"' +
        '                                   disabled' +
        '                                   data-autoclose="true"' +
        '                                   placeholder="—">' +
        '                        </td>' +
        '                        <td class="custom-table__body-col">' +
        '                            <div class="input-element__checkbox input-element__checkbox_mid">' +
        '                                <input u-ishaskey' +
        '                                       name="isHasKey"' +
        '                                       type="checkbox"' +
        '                                       class="checkbox"' +
        '                                       value="true"' +
        '                                       disabled' +
        '                                       id="keyA' + advertiser.id + '"' +
        ((advertiser.isHasKey) ? 'checked=checked' : '') +
        '>' +
        '                                <label class="checkbox-label checkbox-label_gray" for="keyA' + advertiser.id + '"></label>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <div u-type-wrapper class="menu-input__wrapper menu-input__wrapper_select disabled">' +
        '                                <select u-type-selector disabled class="editable menu-input__input menu-input__input_medium menu-input__input_select menu-input__input_white">' +
        '                                    <option th:value="0" disabled>Выберите тип</option>' +
        seloption +
        '                                </select>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        '                            <div u-dismiss-wrapper class="indicated-select menu-input__wrapper menu-input__wrapper_select disabled indicated-select_true" >' +
        '                                <select u-dismiss-selector disabled class="editable menu-input__input menu-input__input_xsmall menu-input__input_select menu-input__input_white">' +
        '                                    <option value="true" selected=selected>Работает</option>' +
        '                                    <option value="false">Уволен</option>' +
        '                                </select>' +
        '                            </div>' +
        '                        </td>' +
        // '                        <td class="custom-table__body-col custom-table__body-col_medium">' +
        // '                            <div u-access-wrapper class="indicated-select menu-input__wrapper menu-input__wrapper_select disabled indicated-select_' + advertiser.access + '" >' +
        // '                                <select u-access-selector disabled class="editable menu-input__input menu-input__input_medium menu-input__input_select menu-input__input_white">' +
        // '                                    <option value="true" ' + ((advertiser.access) ? 'selected=selected' : '') + ' >Есть доступ</option>' +
        // '                                    <option value="false" ' + ((advertiser.access) ? '' : 'selected=selected') + '>Нет доступа</option>' +
        // '                                </select>' +
        // '                            </div>' +
        // '                        </td>' +
        '                           <td class="custom-table__body-col custom-table__body-col_small">' +
        '                            <div class="input-element__checkbox input-element__checkbox_mid">' +
        '                                <input u-access' +
        '                                       name="access"' +
        '                                       type="checkbox"' +
        '                                       class="checkbox"' +
        '                                       value="true"' +
        '                                       disabled' +
        '                                       id="keyAccess' + advertiser.id+ '"' +
                                                ((advertiser.access) ? 'checked=checked' : '') +
        '>' +
        '                                <label class="label-pk" for="keyAccess' + advertiser.id+ '"></label>' +
        '                            </div>' +
        '                        </td>' +
        '                        <td class="custom-table__body-col custom-table__body-col_last">' +
        '                            <div edit-btns class="column-links display-flex-none">' +
        '                                <div edit-user-accept class="column_mwidth column_mwidth-accept"></div>' +
        '                                <div edit-user-cancel class="column_mwidth column_mwidth-cancel"></div>' +
        '                            </div>' +
        '                            <div edit-menu class="column-links display-flex-none is-open">' +
        '                                <div edit-user class="column_mwidth div-table__body-col_center column_mwidth-edit column_mwidth-edit-b"></div>' +
        '                            </div>' +
        '                        </td>' +
        '                    </tr>'
        + table.html());

    initDateUserPicker();
}
function initDateUserPicker() {
    $('.datepicker-here-u').datepicker({
        autoClose: true
    });
}
//список фильтр
var $managerTypeList;
function setManagerTypes(managerTypeList) {
    $managerTypeList = managerTypeList;
}
//список фильтр
var $advertiserTypeList;
function setAdvertiserTypes(advertiserTypeList) {
    $advertiserTypeList = advertiserTypeList;
}

$(document).on('change', '[manager-access]', function (event) {
    var attr = $('option:selected', this).attr('data-access');
    if (typeof attr !== typeof undefined && attr === "false") {
        TEMP_MANAGER_ID = $(this).siblings('[name="idManagerAccess"]').val()
        TEMP_MANAGER_ID_LIST[TEMP_MANAGER_ID] = null;
        TEMP_ROW = $(this);

        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "getManagers",
            dataType: 'json',
            cache: false,
            success: function (data) {
                openManagersMenu(data);
            },
            error: function (data) {
            }
        });
    }
});

//активация редактирования формы
var USERS_INFO_TEMP = {};
$(document).on('click', '[edit-user]', function(event) {
        event.preventDefault();
        $(this).closest('[edit-menu]').removeClass('is-open').siblings('[edit-btns]').addClass('is-open');
        var list = {};

        var name = $(this).closest('.custom-table__body-row').find('[u-name]');
        // name.removeAttr('disabled');
        list['name'] = name.val();

        var idManager = $(this).closest('.custom-table__body-row').find('[u-id-manager]');
        list['idManager'] = idManager.val();

        var username = $(this).closest('.custom-table__body-row').find('[u-username]');
        username.removeAttr('disabled');
        list['username'] = username.val();

        var password = $(this).closest('.custom-table__body-row').find('[u-password]');
        password.removeAttr('disabled');
        list['password'] = password.val();

        var phone = $(this).closest('.custom-table__body-row').find('[u-phone]');
        phone.removeAttr('disabled');
        list['phone'] = phone.val();

        var link = $(this).closest('.custom-table__body-row').find('[u-link]');
        link.removeAttr('disabled');
        list['link'] = link.val();

        var doorsCardNumber = $(this).closest('.custom-table__body-row').find('[u-doorscardnumber]');
        doorsCardNumber.removeAttr('disabled');
        list['doorsCardNumber'] = doorsCardNumber.val();

        var birthday = $(this).closest('.custom-table__body-row').find('[u-birthday]');
        birthday.removeAttr('disabled');
        list['birthday'] = birthday.val();

        var isHasKey = $(this).closest('.custom-table__body-row').find('[u-ishaskey]');
        isHasKey.removeAttr('disabled');
        list['isHasKey'] = isHasKey.prop('checked');

        var isNeedShow = $(this).closest('.custom-table__body-row').find('[u-isneedshow]');
        isNeedShow.removeAttr('disabled');
        list['isNeedShow'] = isNeedShow.prop('checked');

        $(this).closest('.custom-table__body-row').find('[u-type-wrapper]').removeClass('disabled');
        $(this).closest('.custom-table__body-row').find('[u-type-selector]').removeAttr('disabled');
        var type = $(this).closest('.custom-table__body-row').find('[u-type-selector]');
        list['type'] = type.val();

        $(this).closest('.custom-table__body-row').find('[u-dismiss-wrapper]').removeClass('disabled');
        $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]').removeAttr('disabled');
        var dismiss = $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]');
        list['dismiss'] = dismiss.val();
        //
        // $(this).closest('.custom-table__body-row').find('[u-access-wrapper]').removeClass('disabled');
        // $(this).closest('.custom-table__body-row').find('[u-access-selector]').removeAttr('disabled');
        // var access = $(this).closest('.custom-table__body-row').find('[u-access-selector]');
        // list['access'] = access.val();

        var access = $(this).closest('.custom-table__body-row').find('[u-access]');
        access.removeAttr('disabled');
        list['access'] = access.prop('checked');

        $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
        USERS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[u-id]').val()] = list;
});
$(document).on('click', '[edit-user-cancel]', function(event) {
        event.preventDefault();
        var values = USERS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[u-id]').val()];

        $(this).closest('.custom-table__body-row').find('[u-name]').val(values.name).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-username]').val(values.username).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-password]').val(values.password).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-phone]').val(values.phone).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-link]').val(values.link).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-doorscardnumber]').val(values.doorsCardNumber).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-birthday]').val(values.birthday).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked', values.isHasKey).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-isneedshow]').prop('checked', values.isNeedShow).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-type-wrapper]').addClass('disabled');
        $(this).closest('.custom-table__body-row').find('[u-type-selector]').val(values.type).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-dismiss-wrapper]').removeClassWild("indicated-select_*").addClass('indicated-select_' + values.dismiss).addClass('disabled');
        $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]').val(values.dismiss).attr("disabled", true);
        // $(this).closest('.custom-table__body-row').find('[u-access-wrapper]').removeClassWild("indicated-select_*").addClass('indicated-select_' + values.access).addClass('disabled');
        // $(this).closest('.custom-table__body-row').find('[u-access-selector]').val(values.access).attr("disabled", true);
        $(this).closest('.custom-table__body-row').find('[u-access]').prop('checked', values.access).attr("disabled", true);

        $(this).closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');

        delete USERS_INFO_TEMP[$(this).closest('.custom-table__body-row').find('[u-id]').val()];
        delete TEMP_MANAGER_ID_LIST[$(this).closest('.custom-table__body-row').find('[u-id-manager]').val()];
});
var USERS_ACCEPT_BTN;
$(document).on('click', '[edit-user-accept]', function(event) {
        event.preventDefault();
        USERS_ACCEPT_BTN = $(this);

        var userData = new Object();
        userData.id = $(this).closest('.custom-table__body-row').find('[u-id]').val();
        userData.idCompany = $(this).closest('.custom-table__body-row').find('[u-id-company]').val();
        userData.name = $(this).closest('.custom-table__body-row').find('[u-name]').val();
        userData.username = $(this).closest('.custom-table__body-row').find('[u-username]').val();
        userData.password = $(this).closest('.custom-table__body-row').find('[u-password]').val();
        userData.phone = $(this).closest('.custom-table__body-row').find('[u-phone]').val();
        userData.link = $(this).closest('.custom-table__body-row').find('[u-link]').val();
        userData.doorsCardNumber = $(this).closest('.custom-table__body-row').find('[u-doorscardnumber]').val();
        userData.birthday = $(this).closest('.custom-table__body-row').find('[u-birthday]').val();
        userData.isHasKey = $(this).closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked');
        userData.isNeedShow = $(this).closest('.custom-table__body-row').find('[u-isneedshow]').prop('checked');
        userData.type = $(this).closest('.custom-table__body-row').find('[u-type-selector]').val();
        userData.isNotDisMiss = $(this).closest('.custom-table__body-row').find('[u-dismiss-selector]').val();
        // userData.access = $(this).closest('.custom-table__body-row').find('[u-access-selector]').val();
        userData.access = $(this).closest('.custom-table__body-row').find('[u-access]').prop('checked');

        var department = $(this).closest('.custom-table__body-row').attr('department');
        var updateLink = "";
        if (department === 'manager') {
            updateLink = "updateManager";
            userData.idManager = $(this).closest('.custom-table__body-row').find('[u-id-manager]').val();
            userData.idManagerAccess = TEMP_MANAGER_ID_LIST[$(this).closest('.custom-table__body-row').find('[u-id-manager]').val()];
        } else if (department === 'advertiser') {
            updateLink = "updateAdvertiser";
        }

        $('[edit-user-accept]').prop("disabled", true);
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: updateLink,
            data: JSON.stringify(userData),
            dataType: 'json',
            cache: false,
            success: function (data) {
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-name]').val(data.name).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-username]').val(data.username).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-password]').val('').attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-phone]').val(data.phone).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-link]').val(data.link).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-doorscardnumber]').val(data.doorsCardNumber).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-birthday]').val(data.birthday).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked', data.isHasKey).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-isneedshow]').prop('checked', data.isNeedShow).attr("disabled", true);

                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-wrapper]').addClass('disabled');
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-selector]').val(data.type).attr("disabled", true);
                if (typeof data.isNotDisMiss !== 'undefined') {
                    USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-wrapper]').addClass('disabled');
                    USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-selector]').val(data.isNotDisMiss.toString()).attr("disabled", true);

                    if (data.isNotDisMiss.toString() === "false") {
                        USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-selector]').find('[data-access]').attr("data-access", "true");
                    }
                }
                if (typeof data.access !== 'undefined') {
                    // USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-access-wrapper]').addClass('disabled');
                    // USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-access-selector]').val(data.access.toString()).attr("disabled", true);

                    USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-access]').prop('checked', data.access).attr("disabled", true);


                }

                USERS_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');
                delete USERS_INFO_TEMP[data.id];
                delete TEMP_MANAGER_ID_LIST[USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-id-manager]').val()];

                $('[edit-user-accept]').prop("disabled", false);
            },
            error: function (data) {
                var values = USERS_INFO_TEMP[userData.id];

                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-name]').val(values.name).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-username]').val(values.username).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-password]').val('').attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-phone]').val(values.phone).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-link]').val(values.link).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-doorscardnumber]').val(values.doorsCardNumber).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-birthday]').val(values.birthday).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-ishaskey]').prop('checked', values.isHasKey).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-isneedshow]').prop('checked', values.isNeedShow).attr("disabled", true);

                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-wrapper]').addClass('disabled');
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-type-selector]').val(values.type).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-wrapper]').addClass('disabled');
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-dismiss-selector]').val(values.dismiss).attr("disabled", true);
                // USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-access-wrapper]').addClass('disabled');
                // USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-access-selector]').val(values.access).attr("disabled", true);
                USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-access]').prop('checked', values.access).attr("disabled", true);

                USERS_ACCEPT_BTN.closest('[edit-btns]').removeClass('is-open').siblings('[edit-menu]').addClass('is-open');

                delete USERS_INFO_TEMP[data.id];
                delete TEMP_MANAGER_ID_LIST[USERS_ACCEPT_BTN.closest('.custom-table__body-row').find('[u-id-manager]').val()];

                $('[edit-user-accept]').prop("disabled", false);
            }
        });
});


//
// $(document).on('click', '[delete-user]', function(event) {
//     event.preventDefault();
//     $('[delete-user-form]').trigger('submit');
// });

var TEMP_MANAGER_ID_LIST = {};
var TEMP_MANAGER_ID;
var TEMP_ROW;
$(document).on('submit', '[delete-user-form]', function(event) {
    event.preventDefault();
    TEMP_MANAGER_ID_LIST = $(this).find('[name="idManagerAccess"]').val();
    TEMP_ROW = $(this);

    $('[delete-user]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getManagers",
        dataType: 'json',
        cache: false,
        success: function (data) {
            openManagersMenu(data);

            $('[delete-user]').prop("disabled", false);
        },
        error: function (data) {
            $('[delete-user]').prop("disabled", false);
        }
    });

});
function openManagersMenu(data) {
    var rows = "";

    $.each(data, function(index, value) {
        rows += '<div manager-row class="div-table__row">' +
            '       <div class="div-table__row-wrapper">' +
            '           <div class="div-table__body-row">' +
            '               <div class="div-table__body-col div-table__body-col_exsmall">' +
            '                    <div class="input-element__radio ">' +
            '                         <input type="radio" id="man' + value.id + '" class="radio radio_circle" name="idManager" value="' + value.id + '" required>' +
            '                         <label for="man' + value.id + '" class="circle "></label>' +
            '                   </div>' +
            '              </div>' +
            '              <div sms-check-text class="div-table__body-col div-table__body-col_full">' + value.name + '</div>' +
            '          </div>' +
            '      </div>' +
            '</div>'
    });

    $('[manager-list]').html(rows);
    $('[js-menu-managers-list]').addClass('is-open');
    checkBodyHidden();
}
$(document).on('click', '[manager-row]', function(event){
    $(this).find('input[type=radio]').prop("checked", true);
    $('[sms-check-row]').removeClass('div-table__row_selected');
    $(this).addClass('div-table__row_selected');
});

$(document).on('click', '[js-select-manager-btn]', function(event){
    event.preventDefault();
    $('[js-managers-list-form]').trigger('submit');
});
$(document).on('submit', '[js-managers-list-form]', function(event){
    event.preventDefault();
    if (validateForm(this)) {
        var requestData = $('[js-managers-list-form]').serializeObject();
        TEMP_MANAGER_ID_LIST[TEMP_MANAGER_ID] = requestData['idManager'];

        $('[js-menu-managers-list]').removeClass('is-open');
        $('[manager-list]').html('');

        checkBodyHidden();
    }
});




$(document).on('click', '[js-set-projects]', function(event){
    var idManager = $(this).closest('.custom-table__body-row').find('[u-id-manager]').val();
    setManagerProjectsFormData(idManager);
    $('[js-menu-set-projects]').addClass('is-open');
    checkBodyHidden();
});
function setManagerProjectsFormData(idManager) {
    $('[js-set-projects]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "getManagerProjects",
        data: JSON.stringify(idManager),
        dataType: 'json',
        cache: false,
        success: function (data) {
            $('[js-projects-form-id-manager]').val(idManager);

            $.each(data.projects, function(i, item) {
                $('input:checkbox[name="projects"][id="project' + item + '"]').attr('checked', true).prop("checked", true);
            });

            $('[js-set-projects]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-set-projects]').prop("disabled", false);
        }
    });
}

$(document).on('click', '[js-menu-set-projects-close-btn]', function(event){
    $('[js-menu-set-projects]').removeClass('is-open');
    checkBodyHidden();

    $('[js-projects-form]').trigger('reset');
    $('input:checkbox[name="projects"]').attr('checked',false).prop("checked", false);
});

$(document).on('click', '[js-save-projects]', function(event){
    event.preventDefault();
    $('[js-projects-form]').trigger('submit');
});
$(document).on('submit', '[js-projects-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        // var requestData = $('[js-projects-form]').serializeObject();
        var form = $('[js-projects-form]');
        var requestData = new FormData(form[0]);
        saveManagerProjects(requestData);
    }
});
function saveManagerProjects(requestData) {
    $('[jjs-save-projects]').prop("disabled", true);
    $.ajax({
        type: "POST",
        // contentType: "application/json",
        url: "saveManagerProjects",
        data: requestData,
        // dataType: 'json',
        processData: false,
        contentType: false,
        cache: false,
        success: function (data) {
            $('[js-menu-set-projects]').removeClass('is-open');
            checkBodyHidden();

            $('[js-projects-form]').trigger('reset');
            $('input:checkbox[name="projects"]').attr('checked',false).prop("checked", false);

            $('[js-save-projects]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-save-projects]').prop("disabled", false);
        }
    });
}
//
// var TEMP_MANAGER_ID;
// var TEMP_ROW;
// $(document).on('submit', '[delete-user-form]', function(event) {
//     event.preventDefault();
//     TEMP_MANAGER_ID = $(this).find('[name="idManagerAccess"]').val();
//     TEMP_ROW = $(this);
//
//     $('[delete-user]').prop("disabled", true);
//     $.ajax({
//         type: "POST",
//         contentType: "application/json",
//         url: "getManagers",
//         dataType: 'json',
//         cache: false,
//         success: function (data) {
//             openManagersMenu(data);
//
//             $('[delete-user]').prop("disabled", false);
//         },
//         error: function (data) {
//             $('[delete-user]').prop("disabled", false);
//         }
//     });
//
// });
// function openManagersMenu(data) {
//     var rows = "";
//
//     $.each(data, function(index, value) {
//         rows += '<div manager-row class="div-table__row">' +
//             '       <div class="div-table__row-wrapper">' +
//             '           <div class="div-table__body-row">' +
//             '               <div class="div-table__body-col div-table__body-col_exsmall">' +
//             '                    <div class="input-element__radio ">' +
//             '                         <input type="radio" id="man' + value.id + '" class="radio radio_circle" name="idManager" value="' + value.id + '" required>' +
//             '                         <label for="man' + value.id + '" class="circle "></label>' +
//             '                   </div>' +
//             '              </div>' +
//             '              <div sms-check-text class="div-table__body-col div-table__body-col_full">' + value.name + '</div>' +
//             '          </div>' +
//             '      </div>' +
//             '</div>'
//     });
//
//     $('[manager-list]').html(rows);
//     $('[js-menu-managers-list]').addClass('is-open');
//     checkBodyHidden();
// }
// $(document).on('click', '[manager-row]', function(event){
//     $(this).find('input[type=radio]').prop("checked", true);
//     $('[sms-check-row]').removeClass('div-table__row_selected');
//     $(this).addClass('div-table__row_selected');
// });
//
// $(document).on('click', '[js-select-manager-btn]', function(event){
//     event.preventDefault();
//     $('[js-managers-list-form]').trigger('submit');
// });
// $(document).on('submit', '[js-managers-list-form]', function(event){
//     event.preventDefault();
//     if (validateForm(this)) {
//         var requestData = $('[js-managers-list-form]').serializeObject();
//         requestData['idManagerAccess'] = TEMP_MANAGER_ID;
//         createManagerAccess(requestData);
//     }
// });
//
// function createManagerAccess(requestData) {
//     $('[js-select-manager-btn]').prop("disabled", true);
//     $.ajax({
//         type: "POST",
//         contentType: "application/json",
//         url: "saveManagerAccess",
//         data: JSON.stringify(requestData),
//         dataType: 'json',
//         cache: false,
//         success: function (data) {
//             TEMP_ROW.closest('.custom-table__body-row').remove();
//             $('[js-menu-managers-list]').removeClass('is-open');
//             $('[manager-list]').html('');
//             $('[js-select-manager-btn]').prop("disabled", false);
//         },
//         error: function (data) {
//             $('[js-select-manager-btn]').prop("disabled", false);
//         }
//     });
// }
'use strict';

window.chartColors = {
	white: 'rgb(255, 255, 255)',
	red: 'rgb(255, 99, 132)',
	orange: 'rgb(255, 159, 64)',
	yellow: 'rgb(255, 205, 86)',
	green: 'rgb(75, 192, 192)',
	blue: 'rgb(54, 162, 235)',
	purple: 'rgb(153, 102, 255)',
	grey: 'rgb(201, 203, 207)',
	grey_half: 'rgba(201, 203, 207, 0.5)',
	custom_red: 'rgb(255, 40, 79)',
	custom_red_half: 'rgba(255, 40, 79, 0.5)',
	custom_yellow: 'rgb(255, 165, 21)',
	custom_yellow_half: 'rgba(255, 165, 21, 0.5)',
	custom_orange: 'rgb(255, 77, 0)',
	custom_blue: 'rgb(3, 108, 181)',
	custom_light_blue: 'rgb(29, 185, 242)',
	custom_violet: 'rgb(133, 73, 186)',
	custom_pink: 'rgb(255, 20, 147)',
	custom_dblue: 'rgb(1, 69, 118)',
	custom_lblue: 'rgb(103, 137, 229)',
	custom_green: 'rgb(39, 174, 96)',
	custom_green_half: 'rgba(39, 174, 96, 0.5)',
	custom_dgreen: 'rgb(13, 113, 56)',
	custom_lgreen: 'rgb(90, 215, 144)'
};

window.pieColors = [
    '#20a620',
    '#4426aa',
    '#f53794',
    '#e10000',
    '#ffa9a9',
    '#63ff63',
    '#c5b3ff',
    '#2553a6',
    '#ff63c5',
    '#7ea620',
    '#a62020',
    '#ffff63',
	'#ff6363',
    '#4dc9f6',
    '#f67019',
    '#f53794',
    '#537bc4',
    '#acc236',
    '#166a8f',
    '#00a950',
    '#58595b',
    '#8549ba',
    '#ff63dd',
    '#a62088',
	'#ffeb8a',
    '#a9ffa9',
];

(function(global) {
	var MONTHS = [
		'January',
		'February',
		'March',
		'April',
		'May',
		'June',
		'July',
		'August',
		'September',
		'October',
		'November',
		'December'
	];

	var COLORS = [
		'#4dc9f6',
		'#f67019',
		'#f53794',
		'#537bc4',
		'#acc236',
		'#166a8f',
		'#00a950',
		'#58595b',
		'#8549ba'
	];

	var Samples = global.Samples || (global.Samples = {});
	var Color = global.Color;

	Samples.utils = {
		// Adapted from http://indiegamr.com/generate-repeatable-random-numbers-in-js/
		srand: function(seed) {
			this._seed = seed;
		},

		rand: function(min, max) {
			var seed = this._seed;
			min = min === undefined ? 0 : min;
			max = max === undefined ? 1 : max;
			this._seed = (seed * 9301 + 49297) % 233280;
			return min + (this._seed / 233280) * (max - min);
		},

		numbers: function(config) {
			var cfg = config || {};
			var min = cfg.min || 0;
			var max = cfg.max || 1;
			var from = cfg.from || [];
			var count = cfg.count || 8;
			var decimals = cfg.decimals || 8;
			var continuity = cfg.continuity || 1;
			var dfactor = Math.pow(10, decimals) || 0;
			var data = [];
			var i, value;

			for (i = 0; i < count; ++i) {
				value = (from[i] || 0) + this.rand(min, max);
				if (this.rand() <= continuity) {
					data.push(Math.round(dfactor * value) / dfactor);
				} else {
					data.push(null);
				}
			}

			return data;
		},

		labels: function(config) {
			var cfg = config || {};
			var min = cfg.min || 0;
			var max = cfg.max || 100;
			var count = cfg.count || 8;
			var step = (max - min) / count;
			var decimals = cfg.decimals || 8;
			var dfactor = Math.pow(10, decimals) || 0;
			var prefix = cfg.prefix || '';
			var values = [];
			var i;

			for (i = min; i < max; i += step) {
				values.push(prefix + Math.round(dfactor * i) / dfactor);
			}

			return values;
		},

		months: function(config) {
			var cfg = config || {};
			var count = cfg.count || 12;
			var section = cfg.section;
			var values = [];
			var i, value;

			for (i = 0; i < count; ++i) {
				value = MONTHS[Math.ceil(i) % 12];
				values.push(value.substring(0, section));
			}

			return values;
		},

		color: function(index) {
			return COLORS[index % COLORS.length];
		},

		transparentize: function(color, opacity) {
			var alpha = opacity === undefined ? 0.5 : 1 - opacity;
			return Color(color).alpha(alpha).rgbString();
		}
	};

	// DEPRECATED
	window.randomScalingFactor = function() {
		return Math.round(Samples.utils.rand(-100, 100));
	};

	// INITIALIZATION

	Samples.utils.srand(Date.now());

	// Google Analytics
	/* eslint-disable */
	if (document.location.hostname.match(/^(www\.)?chartjs\.org$/)) {
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-28909194-3', 'auto');
		ga('send', 'pageview');
	}
	/* eslint-enable */

}(this));

$(document).on('click', '[js-view-deal-btn]', function(event) {
    event.preventDefault();
    $(this).closest('[js-view-deal-form]').trigger('submit');
});

$(document).on('submit', '[js-view-deal-form]', function(event) {
    event.preventDefault();
    if (validateForm(this)) {
        var formData = $(this).serializeObject();
        getViewDealInfo(formData);
    }
});

$(document).on('click', '[js-menu-view-deal-close-btn]', function(event){
    $('[js-menu-view-deal]').removeClass('is-open');
    checkBodyHidden();
});
function getViewDealInfo(data) {
    $('[js-view-deal-btn]').prop("disabled", true);
    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/api/deals/getViewDeal",
        data: JSON.stringify(data),
        dataType: 'json',
        cache: false,
        success: function (data) {
            setViewDealInfo(data);
            $('[js-view-deal-btn]').prop("disabled", false);
        },
        error: function (data) {
            $('[js-view-deal-btn]').prop("disabled", false);
        }
    });
}

function setViewDealInfo(data) {
    resetViewDealMenu();
    $('[d-view-status]').html(data.statusName);
    $('[d-view-social]').html(data.socialName);
    $('[d-view-deal-date]').html(data.dealDate);
    $('[d-view-product]').html(data.product);
    $('[d-view-course]').html(data.course);
    $('[d-view-type]').html(data.type);
    $('[d-view-price]').html(data.price);
    $('[d-view-tag]').html(data.tag);
    $('[d-view-comment]').html(data.comment);

    if (data.type === 'Трафик') {
        $('[view-deal-mailing-block]').addClass('is-open');
        $('[d-view-mailing]').prop("checked", data.isMailing);

    }

    if (data.kind !== null) {
        $('[view-deal-kind-block]').addClass('is-open');
        $('[d-view-kind]').prop("checked", data.kind);

    }

    if (data.idSaleType === 2) {
        $('[view-deal-start-date-block]').addClass('is-open');
        $('[d-view-start-date]').html(data.startDate);

        $('[view-deal-trial-block]').addClass('is-open');
        $('[d-view-mailing]').prop("checked", data.trial);
    }

    $('[js-menu-view-deal]').addClass('is-open');
    checkBodyHidden();
}
function resetViewDealMenu() {
    $('[d-view-status]').html('');
    $('[d-view-social]').html('');
    $('[d-view-deal-date]').html('');
    $('[d-view-product]').html('');
    $('[d-view-course]').html('');
    $('[d-view-type]').html('');
    $('[d-view-price]').html('');
    $('[d-view-tag]').html('');
    $('[d-view-comment]').html('');

    $('[view-deal-mailing-block]').removeClass('is-open');
    $('[d-view-mailing]').prop("checked", false);

    $('[view-deal-kind-block]').removeClass('is-open');
    $('[d-view-kind]').prop("checked", false);

    $('[view-deal-start-date-block]').removeClass('is-open');
    $('[d-view-start-date]').html('');

    $('[view-deal-trial-block]').removeClass('is-open');
    $('[d-view-mailing]').prop("checked", false);
}
;(function ($) { $.fn.datepicker.language['en'] = {
    days: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
    daysShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
    daysMin: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
    months: ['January','February','March','April','May','June', 'July','August','September','October','November','December'],
    monthsShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
    today: 'Today',
    clear: 'Clear',
    dateFormat: 'mm/dd/yyyy',
    timeFormat: 'hh:ii aa',
    firstDay: 0
}; })(jQuery);
;(function ($) { $.fn.datepicker.language['ru'] = {
    days: ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота'],
    daysShort: ['Вос', 'Пон', 'Вто', 'Сре', 'Чет', 'Пят', 'Суб'],
    daysMin: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
    months: ['Январь','Ферваль','Март','Апрель','Май','Июнь', 'Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'],
    monthsShort: ['Янв', 'Фев', 'Март', 'Апр', 'Май', 'Июнь', 'Июль', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
    today: 'Сегодня',
    clear: 'Очистить',
    dateFormat: 'yyyy-mm-dd',
    timeFormat: 'hh:ii aa',
    firstDay: 0
}; })(jQuery);
/*! jQuery Validation Plugin - v1.19.1 - 6/15/2019
 * https://jqueryvalidation.org/
 * Copyright (c) 2019 Jörn Zaefferer; Licensed MIT */
!function(a){"function"==typeof define&&define.amd?define(["jquery","../jquery.validate.min"],a):"object"==typeof module&&module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){return a.extend(a.validator.messages,{required:"Заполните это поле.",remote:"Пожалуйста, введите правильное значение.",email:"Пожалуйста, введите корректный адрес электронной почты.",url:"Пожалуйста, введите корректный URL.",date:"Пожалуйста, введите корректную дату.",dateISO:"Пожалуйста, введите корректную дату в формате ISO.",number:"Пожалуйста, введите число.",digits:"Пожалуйста, вводите только цифры.",creditcard:"Пожалуйста, введите правильный номер кредитной карты.",equalTo:"Пожалуйста, введите такое же значение ещё раз.",extension:"Пожалуйста, выберите файл с правильным расширением.",maxlength:a.validator.format("Пожалуйста, введите не больше {0} символов."),minlength:a.validator.format("Пожалуйста, введите не меньше {0} символов."),rangelength:a.validator.format("Пожалуйста, введите значение длиной от {0} до {1} символов."),range:a.validator.format("Пожалуйста, введите число от {0} до {1}."),max:a.validator.format("Пожалуйста, введите число, меньшее или равное {0}."),min:a.validator.format("Пожалуйста, введите число, большее или равное {0}.")}),a});